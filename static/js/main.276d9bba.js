/*! For license information please see main.276d9bba.js.LICENSE.txt */
(()=>{var e={18:(e,t,n)=>{var i=n(132),r=n(188),s=n(489),a=n(748),o=r.DOMImplementation,l=i.NAMESPACE,c=a.ParseError,u=a.XMLReader;function h(e){return e.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function d(e){this.options=e||{locator:{}}}function p(){this.cdata=!1}function f(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function g(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function m(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function y(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}d.prototype.parseFromString=function(e,t){var n=this.options,i=new u,r=n.domBuilder||new p,a=n.errorHandler,o=n.locator,c=n.xmlns||{},d=/\/x?html?$/.test(t),f=d?s.HTML_ENTITIES:s.XML_ENTITIES;o&&r.setDocumentLocator(o),i.errorHandler=function(e,t,n){if(!e){if(t instanceof p)return t;e=t}var i={},r=e instanceof Function;function s(t){var s=e[t];!s&&r&&(s=2==e.length?function(n){e(t,n)}:e),i[t]=s&&function(e){s("[xmldom "+t+"]\t"+e+g(n))}||function(){}}return n=n||{},s("warning"),s("error"),s("fatalError"),i}(a,r,o),i.domBuilder=n.domBuilder||r,d&&(c[""]=l.HTML),c.xml=c.xml||l.XML;var m=n.normalizeLineEndings||h;return e&&"string"===typeof e?i.parse(m(e),c,f):i.errorHandler.error("invalid doc source"),r.doc},p.prototype={startDocument:function(){this.doc=(new o).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,i){var r=this.doc,s=r.createElementNS(e,n||t),a=i.length;y(this,s),this.currentElement=s,this.locator&&f(this.locator,s);for(var o=0;o<a;o++){e=i.getURI(o);var l=i.getValue(o),c=(n=i.getQName(o),r.createAttributeNS(e,n));this.locator&&f(i.getLocator(o),c),c.value=c.nodeValue=l,s.setAttributeNode(c)}},endElement:function(e,t,n){var i=this.currentElement;i.tagName;this.currentElement=i.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&f(this.locator,n),y(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=m.apply(this,arguments)){if(this.cdata)var i=this.doc.createCDATASection(e);else i=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(i):/^\s*$/.test(e)&&this.doc.appendChild(i),this.locator&&f(this.locator,i)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=m.apply(this,arguments);var i=this.doc.createComment(e);this.locator&&f(this.locator,i),y(this,i)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var i=this.doc.implementation;if(i&&i.createDocumentType){var r=i.createDocumentType(e,t,n);this.locator&&f(this.locator,r),y(this,r),this.doc.doctype=r}},warning:function(e){console.warn("[xmldom warning]\t"+e,g(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,g(this.locator))},fatalError:function(e){throw new c(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){p.prototype[e]=function(){return null}}),t.DOMParser=d},24:(e,t,n)=>{var i=n(672).getUint64;e.exports=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},r=12;0===n.version?(n.earliestPresentationTime=t.getUint32(r),n.firstOffset=t.getUint32(r+4),r+=8):(n.earliestPresentationTime=i(e.subarray(r)),n.firstOffset=i(e.subarray(r+8)),r+=16),r+=2;var s=t.getUint16(r);for(r+=2;s>0;r+=12,s--)n.references.push({referenceType:(128&e[r])>>>7,referencedSize:2147483647&t.getUint32(r),subsegmentDuration:t.getUint32(r+4),startsWithSap:!!(128&e[r+8]),sapType:(112&e[r+8])>>>4,sapDeltaTime:268435455&t.getUint32(r+8)});return n}},45:(e,t,n)=>{"use strict";var i=n(626);e.exports=function(e,t){return void 0===t&&(t=!1),function(n,r,s){if(n)e(n);else if(r.statusCode>=400&&r.statusCode<=599){var a=s;if(t)if(i.TextDecoder){var o=function(e){void 0===e&&(e="");return e.toLowerCase().split(";").reduce(function(e,t){var n=t.split("="),i=n[0],r=n[1];return"charset"===i.trim()?r.trim():e},"utf-8")}(r.headers&&r.headers["content-type"]);try{a=new TextDecoder(o).decode(s)}catch(l){}}else a=String.fromCharCode.apply(null,new Uint8Array(s));e({cause:a})}else e(null,s)}}},49:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function b(){}function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var _=v.prototype=new b;_.constructor=v,g(_,y.prototype),_.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,T={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,i){var r,s={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)w.call(t,r)&&!k.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:n,type:e,key:a,ref:o,props:s,_owner:T.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function N(e,t,r,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return a=a(l=e),e=""===s?"."+E(l,0):s,x(a)?(r="",null!=e&&(r=e.replace(I,"$&/")+"/"),N(a,t,r,"",function(e){return e})):null!=a&&(C(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(I,"$&/")+"/")+e)),t.push(a)),1;if(l=0,s=""===s?".":s+":",x(e))for(var c=0;c<e.length;c++){var u=s+E(o=e[c],c);l+=N(o,t,r,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=N(o=o.value,t,r,u=s+E(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function A(e,t,n){if(null==e)return e;var i=[],r=0;return N(e,i,"","",function(e){return t.call(n,e,r++)}),i}function R(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},O={transition:null},L={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:O,ReactCurrentOwner:T};function P(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=r,t.Profiler=a,t.PureComponent=v,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.act=P,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=g({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=T.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!k.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:s,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=P,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},53:(e,t,n)=>{var i=n(658),r=n(271),s=n(545),a=n(281),o=n(647),l=n(855),c=n(583);c.alea=i,c.xor128=r,c.xorwow=s,c.xorshift7=a,c.xor4096=o,c.tychei=l,e.exports=c},63:(e,t,n)=>{var i,r="undefined"!==typeof n.g?n.g:"undefined"!==typeof window?window:{},s=n(542);"undefined"!==typeof document?i=document:(i=r["__GLOBAL_DOCUMENT_CACHE@4"])||(i=r["__GLOBAL_DOCUMENT_CACHE@4"]=s),e.exports=i},72:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(S){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function i(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=i;var r={},s={};function a(e,t){var n,i,a;return t?(a=0<=(e>>>=0)&&e<256)&&(i=s[e])?i:(n=l(e,(0|e)<0?-1:0,!0),a&&(s[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(i=r[e])?i:(n=l(e,e<0?-1:0,!1),a&&(r[e]=n),n)}function o(e,t){if(isNaN(e))return t?y:m;if(t){if(e<0)return y;if(e>=p)return w}else{if(e<=-f)return T;if(e+1>=f)return x}return e<0?o(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,i){return new n(e,t,i)}n.fromInt=a,n.fromNumber=o,n.fromBits=l;var c=Math.pow;function u(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return u(e.substring(1),t,n).neg();for(var r=o(c(n,8)),s=m,a=0;a<e.length;a+=8){var l=Math.min(8,e.length-a),h=parseInt(e.substring(a,a+l),n);if(l<8){var d=o(c(n,l));s=s.mul(d).add(o(h))}else s=(s=s.mul(r)).add(o(h))}return s.unsigned=t,s}function h(e,t){return"number"===typeof e?o(e,t):"string"===typeof e?u(e,t):l(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=u,n.fromValue=h;var d=4294967296,p=d*d,f=p/2,g=a(1<<24),m=a(0);n.ZERO=m;var y=a(0,!0);n.UZERO=y;var b=a(1);n.ONE=b;var v=a(1,!0);n.UONE=v;var _=a(-1);n.NEG_ONE=_;var x=l(-1,2147483647,!1);n.MAX_VALUE=x;var w=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var T=l(0,-2147483648,!1);n.MIN_VALUE=T;var k=n.prototype;k.toInt=function(){return this.unsigned?this.low>>>0:this.low},k.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},k.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var t=o(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=o(c(e,6),this.unsigned),s=this,a="";;){var l=s.div(r),u=(s.sub(l.mul(r)).toInt()>>>0).toString(e);if((s=l).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},k.getHighBits=function(){return this.high},k.getHighBitsUnsigned=function(){return this.high>>>0},k.getLowBits=function(){return this.low},k.getLowBitsUnsigned=function(){return this.low>>>0},k.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},k.isZero=function(){return 0===this.high&&0===this.low},k.eqz=k.isZero,k.isNegative=function(){return!this.unsigned&&this.high<0},k.isPositive=function(){return this.unsigned||this.high>=0},k.isOdd=function(){return 1===(1&this.low)},k.isEven=function(){return 0===(1&this.low)},k.equals=function(e){return i(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},k.eq=k.equals,k.notEquals=function(e){return!this.eq(e)},k.neq=k.notEquals,k.ne=k.notEquals,k.lessThan=function(e){return this.comp(e)<0},k.lt=k.lessThan,k.lessThanOrEqual=function(e){return this.comp(e)<=0},k.lte=k.lessThanOrEqual,k.le=k.lessThanOrEqual,k.greaterThan=function(e){return this.comp(e)>0},k.gt=k.greaterThan,k.greaterThanOrEqual=function(e){return this.comp(e)>=0},k.gte=k.greaterThanOrEqual,k.ge=k.greaterThanOrEqual,k.compare=function(e){if(i(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},k.comp=k.compare,k.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(b)},k.neg=k.negate,k.add=function(e){i(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,a=e.high>>>16,o=65535&e.high,c=e.low>>>16,u=0,d=0,p=0,f=0;return p+=(f+=s+(65535&e.low))>>>16,d+=(p+=r+c)>>>16,u+=(d+=n+o)>>>16,u+=t+a,l((p&=65535)<<16|(f&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},k.subtract=function(e){return i(e)||(e=h(e)),this.add(e.neg())},k.sub=k.subtract,k.multiply=function(e){if(this.isZero())return m;if(i(e)||(e=h(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(T))return e.isOdd()?T:m;if(e.eq(T))return this.isOdd()?T:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return o(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,s=this.low>>>16,a=65535&this.low,c=e.high>>>16,u=65535&e.high,d=e.low>>>16,p=65535&e.low,f=0,y=0,b=0,v=0;return b+=(v+=a*p)>>>16,y+=(b+=s*p)>>>16,b&=65535,y+=(b+=a*d)>>>16,f+=(y+=r*p)>>>16,y&=65535,f+=(y+=s*d)>>>16,y&=65535,f+=(y+=a*u)>>>16,f+=n*p+r*d+s*u+a*c,l((b&=65535)<<16|(v&=65535),(f&=65535)<<16|(y&=65535),this.unsigned)},k.mul=k.multiply,k.divide=function(e){if(i(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,r,s;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return v;s=y}else{if(this.eq(T))return e.eq(b)||e.eq(_)?T:e.eq(T)?b:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?b:_:(r=this.sub(e.mul(n)),s=n.add(r.div(e)));if(e.eq(T))return this.unsigned?y:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=m}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),u=a<=48?1:c(2,a-48),d=o(n),p=d.mul(e);p.isNegative()||p.gt(r);)p=(d=o(n-=u,this.unsigned)).mul(e);d.isZero()&&(d=b),s=s.add(d),r=r.sub(p)}return s},k.div=k.divide,k.modulo=function(e){return i(e)||(e=h(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},k.mod=k.modulo,k.rem=k.modulo,k.not=function(){return l(~this.low,~this.high,this.unsigned)},k.and=function(e){return i(e)||(e=h(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},k.or=function(e){return i(e)||(e=h(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},k.xor=function(e){return i(e)||(e=h(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},k.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},k.shl=k.shiftLeft,k.shiftRight=function(e){return i(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},k.shr=k.shiftRight,k.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},k.shru=k.shiftRightUnsigned,k.shr_u=k.shiftRightUnsigned,k.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},k.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},k.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},k.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},k.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,i){return i?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},108:()=>{},118:e=>{var t={"":1,lr:1,rl:1},n={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function i(e){return"string"===typeof e&&(!!n[e.toLowerCase()]&&e.toLowerCase())}function r(e,n,r){this.hasBeenReset=!1;var s="",a=!1,o=e,l=n,c=r,u=null,h="",d=!0,p="auto",f="start",g="auto",m="auto",y=100,b="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return s},set:function(e){s=""+e}},pauseOnExit:{enumerable:!0,get:function(){return a},set:function(e){a=!!e}},startTime:{enumerable:!0,get:function(){return o},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");o=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return l},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");l=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return c},set:function(e){c=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return u},set:function(e){u=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return h},set:function(e){var n=function(e){return"string"===typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");h=n,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return d},set:function(e){d=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return p},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("Line: an invalid number or illegal string was specified.");p=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return f},set:function(e){var t=i(e);t?(f=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return g},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");g=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return m},set:function(e){var t=i(e);t?(m=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");y=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return b},set:function(e){var t=i(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");b=t,this.hasBeenReset=!0}}}),this.displayState=void 0}r.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},e.exports=r},119:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(345)},132:(e,t)=>{"use strict";function n(e,t){return void 0===t&&(t=Object),t&&"function"===typeof t.freeze?t.freeze(e):e}var i=n({HTML:"text/html",isHTML:function(e){return e===i.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),r=n({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(e){return e===r.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});t.assign=function(e,t){if(null===e||"object"!==typeof e)throw new TypeError("target is not an object");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},t.find=function(e,t,n){if(void 0===n&&(n=Array.prototype),e&&"function"===typeof n.find)return n.find.call(e,t);for(var i=0;i<e.length;i++)if(Object.prototype.hasOwnProperty.call(e,i)){var r=e[i];if(t.call(void 0,r,i,e))return r}},t.freeze=n,t.MIME_TYPE=i,t.NAMESPACE=r},163:function(e,t,n){!function(){var t=n(601);e.exports=function(e){"use strict";var t=e.browser.IS_IOS||e.browser.IS_NATIVE_ANDROID,n=e.getTech("Tech");class i extends n{constructor(e,n){super(e,n),this.setPoster(e.poster),this.setSrc(this.options_.source,!0),this.setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-youtube",t&&(this.el_.parentNode.className+=" vjs-youtube-mobile"),i.isApiReady?this.initYTPlayer():i.apiReadyQueue.push(this))}.bind(this))}dispose(){if(this.ytPlayer)this.ytPlayer.stopVideo&&this.ytPlayer.stopVideo(),this.ytPlayer.destroy&&this.ytPlayer.destroy();else{var e=i.apiReadyQueue.indexOf(this);-1!==e&&i.apiReadyQueue.splice(e,1)}this.ytPlayer=null,this.el_.parentNode.className=this.el_.parentNode.className.replace(" vjs-youtube","").replace(" vjs-youtube-mobile",""),this.el_.parentNode.removeChild(this.el_),n.prototype.dispose.call(this)}createEl(){var e=document.createElement("div");e.setAttribute("id",this.options_.techId),e.setAttribute("style","width:100%;height:100%;top:0;left:0;position:absolute"),e.setAttribute("class","vjs-tech");var n=document.createElement("div");if(n.appendChild(e),!t&&!this.options_.ytControls){var i=document.createElement("div");i.setAttribute("class","vjs-iframe-blocker"),i.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),i.onclick=function(){this.pause()}.bind(this),n.appendChild(i)}return n}initYTPlayer(){var e={controls:0,modestbranding:1,rel:0,showinfo:0,loop:this.options_.loop?1:0};if("undefined"!==typeof this.options_.autohide&&(e.autohide=this.options_.autohide),"undefined"!==typeof this.options_.cc_load_policy&&(e.cc_load_policy=this.options_.cc_load_policy),"undefined"!==typeof this.options_.ytControls&&(e.controls=this.options_.ytControls),"undefined"!==typeof this.options_.disablekb&&(e.disablekb=this.options_.disablekb),"undefined"!==typeof this.options_.color&&(e.color=this.options_.color),e.controls?"undefined"!==typeof this.options_.fs&&(e.fs=this.options_.fs):e.fs=0,-1!==this.options_.source.src.indexOf("end=")){var t=this.options_.source.src.match(/end=([0-9]*)/);this.options_.end=parseInt(t[1])}if("undefined"!==typeof this.options_.end&&(e.end=this.options_.end),"undefined"!==typeof this.options_.hl?e.hl=this.options_.hl:"undefined"!==typeof this.options_.language&&(e.hl=this.options_.language.substr(0,2)),"undefined"!==typeof this.options_.iv_load_policy&&(e.iv_load_policy=this.options_.iv_load_policy),"undefined"!==typeof this.options_.list?e.list=this.options_.list:this.url&&"undefined"!==typeof this.url.listId&&(e.list=this.url.listId),"undefined"!==typeof this.options_.listType&&(e.listType=this.options_.listType),"undefined"!==typeof this.options_.modestbranding&&(e.modestbranding=this.options_.modestbranding),"undefined"!==typeof this.options_.playlist&&(e.playlist=this.options_.playlist),"undefined"!==typeof this.options_.playsinline&&(e.playsinline=this.options_.playsinline),"undefined"!==typeof this.options_.rel&&(e.rel=this.options_.rel),"undefined"!==typeof this.options_.showinfo&&(e.showinfo=this.options_.showinfo),-1!==this.options_.source.src.indexOf("start=")){var n=this.options_.source.src.match(/start=([0-9]*)/);this.options_.start=parseInt(n[1])}if("undefined"!==typeof this.options_.start&&(e.start=this.options_.start),"undefined"!==typeof this.options_.theme&&(e.theme=this.options_.theme),"undefined"!==typeof this.options_.customVars){var i=this.options_.customVars;Object.keys(i).forEach(function(t){e[t]=i[t]})}this.activeVideoId=this.url?this.url.videoId:null,this.activeList=e.list;var r={videoId:this.activeVideoId,playerVars:e,events:{onReady:this.onPlayerReady.bind(this),onPlaybackQualityChange:this.onPlayerPlaybackQualityChange.bind(this),onPlaybackRateChange:this.onPlayerPlaybackRateChange.bind(this),onStateChange:this.onPlayerStateChange.bind(this),onVolumeChange:this.onPlayerVolumeChange.bind(this),onError:this.onPlayerError.bind(this)}};"undefined"!==typeof this.options_.enablePrivacyEnhancedMode&&this.options_.enablePrivacyEnhancedMode&&(r.host="https://www.youtube-nocookie.com"),this.ytPlayer=new YT.Player(this.options_.techId,r)}onPlayerReady(){this.options_.muted&&this.ytPlayer.mute(),this.ytPlayer.getAvailablePlaybackRates().length>1&&(this.featuresPlaybackRate=!0),this.playerReady_=!0,this.triggerReady(),this.playOnReady?this.play():this.cueOnReady&&(this.cueVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId)}onPlayerPlaybackQualityChange(){}onPlayerPlaybackRateChange(){this.trigger("ratechange")}onPlayerStateChange(e){var t=e.data;if(t!==this.lastState&&!this.errorNumber)switch(this.lastState=t,t){case-1:this.trigger("loadstart"),this.trigger("loadedmetadata"),this.trigger("durationchange"),this.trigger("ratechange");break;case YT.PlayerState.ENDED:this.trigger("ended");break;case YT.PlayerState.PLAYING:this.trigger("timeupdate"),this.trigger("durationchange"),this.trigger("playing"),this.trigger("play"),this.isSeeking&&this.onSeeked();break;case YT.PlayerState.PAUSED:this.trigger("canplay"),this.isSeeking?this.onSeeked():this.trigger("pause");break;case YT.PlayerState.BUFFERING:this.player_.trigger("timeupdate"),this.player_.trigger("waiting")}}onPlayerVolumeChange(){this.trigger("volumechange")}onPlayerError(e){this.errorNumber=e.data,this.trigger("pause"),this.trigger("error")}error(){var e=1e3+this.errorNumber;switch(this.errorNumber){case 5:return{code:e,message:"Error while trying to play the video"};case 2:case 100:return{code:e,message:"Unable to find the video"};case 101:case 150:return{code:e,message:"Playback on other Websites has been disabled by the video owner."}}return{code:e,message:"YouTube unknown error ("+this.errorNumber+")"}}loadVideoById_(e){var t={videoId:e};this.options_.start&&(t.startSeconds=this.options_.start),this.options_.end&&(t.endSeconds=this.options_.end),this.ytPlayer.loadVideoById(t)}cueVideoById_(e){var t={videoId:e};this.options_.start&&(t.startSeconds=this.options_.start),this.options_.end&&(t.endSeconds=this.options_.end),this.ytPlayer.cueVideoById(t)}src(e){return e&&this.setSrc({src:e}),this.source}poster(){return t?null:this.poster_}setPoster(e){this.poster_=e}setSrc(e){e&&e.src&&(delete this.errorNumber,this.source=e,this.url=i.parseUrl(e.src),this.options_.poster||this.url.videoId&&(this.poster_="https://img.youtube.com/vi/"+this.url.videoId+"/0.jpg",this.trigger("posterchange"),this.checkHighResPoster()),this.options_.autoplay&&!t?this.isReady_?this.play():this.playOnReady=!0:this.activeVideoId!==this.url.videoId&&(this.isReady_?(this.cueVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId):this.cueOnReady=!0))}autoplay(){return this.options_.autoplay}setAutoplay(e){this.options_.autoplay=e}loop(){return this.options_.loop}setLoop(e){this.options_.loop=e}play(){this.url&&this.url.videoId&&(this.wasPausedBeforeSeek=!1,this.isReady_?(this.url.listId&&(this.activeList===this.url.listId?this.ytPlayer.playVideo():(this.ytPlayer.loadPlaylist(this.url.listId),this.activeList=this.url.listId)),this.activeVideoId===this.url.videoId?this.ytPlayer.playVideo():(this.loadVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId)):(this.trigger("waiting"),this.playOnReady=!0))}pause(){this.ytPlayer&&this.ytPlayer.pauseVideo()}paused(){return!this.ytPlayer||this.lastState!==YT.PlayerState.PLAYING&&this.lastState!==YT.PlayerState.BUFFERING}currentTime(){return this.ytPlayer?this.ytPlayer.getCurrentTime():0}setCurrentTime(e){this.lastState===YT.PlayerState.PAUSED&&(this.timeBeforeSeek=this.currentTime()),this.isSeeking||(this.wasPausedBeforeSeek=this.paused()),this.ytPlayer.seekTo(e,!0),this.trigger("timeupdate"),this.trigger("seeking"),this.isSeeking=!0,this.lastState===YT.PlayerState.PAUSED&&this.timeBeforeSeek!==e&&(clearInterval(this.checkSeekedInPauseInterval),this.checkSeekedInPauseInterval=setInterval(function(){this.lastState===YT.PlayerState.PAUSED&&this.isSeeking?this.currentTime()!==this.timeBeforeSeek&&(this.trigger("timeupdate"),this.onSeeked()):clearInterval(this.checkSeekedInPauseInterval)}.bind(this),250))}seeking(){return this.isSeeking}seekable(){return this.ytPlayer?e.createTimeRange(0,this.ytPlayer.getDuration()):e.createTimeRange()}onSeeked(){clearInterval(this.checkSeekedInPauseInterval),this.isSeeking=!1,this.wasPausedBeforeSeek&&this.pause(),this.trigger("seeked")}playbackRate(){return this.ytPlayer?this.ytPlayer.getPlaybackRate():1}setPlaybackRate(e){this.ytPlayer&&this.ytPlayer.setPlaybackRate(e)}duration(){return this.ytPlayer?this.ytPlayer.getDuration():0}currentSrc(){return this.source&&this.source.src}ended(){return!!this.ytPlayer&&this.lastState===YT.PlayerState.ENDED}volume(){return this.ytPlayer?this.ytPlayer.getVolume()/100:1}setVolume(e){this.ytPlayer&&this.ytPlayer.setVolume(100*e)}muted(){return!!this.ytPlayer&&this.ytPlayer.isMuted()}setMuted(e){this.ytPlayer&&(this.muted(!0),e?this.ytPlayer.mute():this.ytPlayer.unMute(),this.setTimeout(function(){this.trigger("volumechange")},50))}buffered(){if(!this.ytPlayer||!this.ytPlayer.getVideoLoadedFraction)return e.createTimeRange();var t=this.ytPlayer.getVideoLoadedFraction()*this.ytPlayer.getDuration();return e.createTimeRange(0,t)}preload(){}load(){}reset(){}networkState(){if(!this.ytPlayer)return 0;switch(this.ytPlayer.getPlayerState()){case-1:return 0;case 3:return 2;default:return 1}}readyState(){if(!this.ytPlayer)return 0;switch(this.ytPlayer.getPlayerState()){case-1:return 0;case 5:return 1;case 3:return 2;default:return 4}}supportsFullScreen(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled}checkHighResPoster(){var e="https://img.youtube.com/vi/"+this.url.videoId+"/maxresdefault.jpg";try{var t=new Image;t.onload=function(){if("naturalHeight"in t){if(t.naturalHeight<=90||t.naturalWidth<=120)return}else if(t.height<=90||t.width<=120)return;this.poster_=e,this.trigger("posterchange")}.bind(this),t.onerror=function(){},t.src=e}catch(n){}}}function r(){YT.ready(function(){i.isApiReady=!0;for(var e=0;e<i.apiReadyQueue.length;++e)i.apiReadyQueue[e].initYTPlayer()})}function s(e,t){var n=!1,i=document.createElement("script"),r=document.getElementsByTagName("script")[0];r&&(r.parentNode.insertBefore(i,r),i.onload=function(){n||(n=!0,t())},i.onreadystatechange=function(){n||"complete"!==this.readyState&&"loaded"!==this.readyState||(n=!0,t())},i.src=e)}function a(){var e=".vjs-youtube .vjs-iframe-blocker { display: none; }.vjs-youtube.vjs-user-inactive .vjs-iframe-blocker { display: block; }.vjs-youtube .vjs-poster { background-size: cover; }.vjs-youtube-mobile .vjs-big-play-button { display: none; }",t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n)}i.isSupported=function(){return!0},i.canPlaySource=function(e){return i.canPlayType(e.type)},i.canPlayType=function(e){return"video/youtube"===e},i.parseUrl=function(e){var t={videoId:null},n=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,i=e.match(n);i&&11===i[2].length&&(t.videoId=i[2]);var r=/[?&]list=([^#\&\?]+)/;return(i=e.match(r))&&i[1]&&(t.listId=i[1]),t},i.apiReadyQueue=[],"undefined"!==typeof document&&(s("https://www.youtube.com/iframe_api",r),a());"undefined"!==typeof e.registerTech?e.registerTech("Youtube",i):e.registerComponent("Youtube",i)}(t.default||t)}()},181:(e,t,n)=>{var i=n(63),r=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function s(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function a(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+(0|i)/1e3}var n=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function o(){this.values=r(null)}function l(e,t,n,i){var r=i?e.split(i):[e];for(var s in r)if("string"===typeof r[s]){var a=r[s].split(n);if(2===a.length)t(a[0].trim(),a[1].trim())}}function c(e,t,n){var i=e;function r(){var t=a(e);if(null===t)throw new s(s.Errors.BadTimeStamp,"Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function c(){e=e.replace(/^\s+/,"")}if(c(),t.startTime=r(),c(),"--\x3e"!==e.substr(0,3))throw new s(s.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),c(),t.endTime=r(),c(),function(e,t){var i=new o;l(e,function(e,t){switch(e){case"region":for(var r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var s=t.split(","),a=s[0];i.integer(e,a),i.percent(e,a)&&i.set("snapToLines",!1),i.alt(e,a,["auto"]),2===s.length&&i.alt("lineAlign",s[1],["start","center","end"]);break;case"position":s=t.split(","),i.percent(e,s[0]),2===s.length&&i.alt("positionAlign",s[1],["start","center","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","center","end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");try{t.line=i.get("line","auto")}catch(r){}t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100);try{t.align=i.get("align","center")}catch(r){t.align=i.get("align","middle")}try{t.position=i.get("position","auto")}catch(r){t.position=i.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=i.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}(e,t)}s.prototype=r(Error.prototype),s.prototype.constructor=s,s.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},o.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var u=i.createElement&&i.createElement("textarea"),h={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},d={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},p={v:"title",lang:"lang"},f={rt:"ruby"};function g(e,t){function n(){if(!t)return null;var e,n=t.match(/^([^<]*)(<[^>]*>?)?/);return e=n[1]?n[1]:n[2],t=t.substr(e.length),e}function i(e){return u.innerHTML=e,e=u.textContent,u.textContent="",e}function r(e,t){return!f[t.localName]||f[t.localName]===e.localName}function s(t,n){var i=h[t];if(!i)return null;var r=e.document.createElement(i),s=p[t];return s&&n&&(r[s]=n.trim()),r}for(var o,l=e.document.createElement("div"),c=l,g=[];null!==(o=n());)if("<"!==o[0])c.appendChild(e.document.createTextNode(i(o)));else{if("/"===o[1]){g.length&&g[g.length-1]===o.substr(2).replace(">","")&&(g.pop(),c=c.parentNode);continue}var m,y=a(o.substr(1,o.length-2));if(y){m=e.document.createProcessingInstruction("timestamp",y),c.appendChild(m);continue}var b=o.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!b)continue;if(!(m=s(b[1],b[3])))continue;if(!r(c,m))continue;if(b[2]){var v=b[2].split(".");v.forEach(function(e){var t=/^bg_/.test(e),n=t?e.slice(3):e;if(d.hasOwnProperty(n)){var i=t?"background-color":"color",r=d[n];m.style[i]=r}}),m.className=v.join(" ")}g.push(b[1]),c.appendChild(m),c=m}return l}var m=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function y(e){for(var t=0;t<m.length;t++){var n=m[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function b(e){var t=[],n="";if(!e||!e.childNodes)return"ltr";function i(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function r(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var s=n.match(/^.*(\n|\r)/);return s?(e.length=0,s[0]):n}return"ruby"===t.tagName?r(e):t.childNodes?(i(e,t),r(e)):void 0}for(i(t,e);n=r(t);)for(var s=0;s<n.length;s++)if(y(n.charCodeAt(s)))return"rtl";return"ltr"}function v(){}function _(e,t,n){v.call(this),this.cue=t,this.cueDiv=g(e,t.text);var i={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(i,this.cueDiv),this.div=e.document.createElement("div"),i={direction:b(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(i),this.div.appendChild(this.cueDiv);var r=0;switch(t.positionAlign){case"start":case"line-left":r=t.position;break;case"center":r=t.position-t.size/2;break;case"end":case"line-right":r=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function x(e){var t,n,i,r;if(e.div){n=e.div.offsetHeight,i=e.div.offsetWidth,r=e.div.offsetTop;var s=(s=e.div.childNodes)&&(s=s[0])&&s.getClientRects&&s.getClientRects();e=e.div.getBoundingClientRect(),t=s?Math.max(s[0]&&s[0].height||0,e.height/s.length):0}this.left=e.left,this.right=e.right,this.top=e.top||r,this.height=e.height||n,this.bottom=e.bottom||r+(e.height||n),this.width=e.width||i,this.lineHeight=void 0!==t?t:e.lineHeight}function w(e,t,n,i){var r=new x(t),s=t.cue,a=function(e){if("number"===typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,i=0,r=0;r<n.length&&n[r]!==t;r++)"showing"===n[r].mode&&i++;return-1*++i}(s),o=[];if(s.snapToLines){var l;switch(s.vertical){case"":o=["+y","-y"],l="height";break;case"rl":o=["+x","-x"],l="width";break;case"lr":o=["-x","+x"],l="width"}var c=r.lineHeight,u=c*Math.round(a),h=n[l]+c,d=o[0];Math.abs(u)>h&&(u=u<0?-1:1,u*=Math.ceil(h/c)*c),a<0&&(u+=""===s.vertical?n.height:n.width,o=o.reverse()),r.move(d,u)}else{var p=r.lineHeight/n.height*100;switch(s.lineAlign){case"center":a-=p/2;break;case"end":a-=p}switch(s.vertical){case"":t.applyStyles({top:t.formatStyle(a,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(a,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(a,"%")})}o=["+y","-x","+x","-y"],r=new x(t)}var f=function(e,t){for(var r,s=new x(e),a=1,o=0;o<t.length;o++){for(;e.overlapsOppositeAxis(n,t[o])||e.within(n)&&e.overlapsAny(i);)e.move(t[o]);if(e.within(n))return e;var l=e.intersectPercentage(n);a>l&&(r=new x(e),a=l),e=new x(s)}return r||s}(r,o);t.move(f.toCSSCompatValues(n))}function T(){}v.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},v.prototype.formatStyle=function(e,t){return 0===e?0:e+t},_.prototype=r(v.prototype),_.prototype.constructor=_,x.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},x.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},x.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},x.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},x.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},x.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},x.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},x.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||n}},T.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},T.convertCueToDOMTree=function(e,t){return e&&t?g(e,t):null};T.processCues=function(e,t,n){if(!e||!t||!n)return null;for(;n.firstChild;)n.removeChild(n.firstChild);var i=e.document.createElement("div");if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin="1.5%",n.appendChild(i),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var r=[],s=x.getSimpleBoxPosition(i),a={font:Math.round(.05*s.height*100)/100+"px sans-serif"};!function(){for(var n,o,l=0;l<t.length;l++)o=t[l],n=new _(e,o,a),i.appendChild(n.div),w(0,n,s,r),o.displayState=n.div,r.push(x.getSimpleBoxPosition(n))}()}else for(var o=0;o<t.length;o++)i.appendChild(t[o].displayState)},T.Parser=function(e,t,n){n||(n=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[]},T.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof s))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function n(){for(var e=t.buffer,n=0;n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var i=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),i}function i(e){e.match(/X-TIMESTAMP-MAP/)?l(e,function(e,n){if("X-TIMESTAMP-MAP"===e)!function(e){var n=new o;l(e,function(e,t){switch(e){case"MPEGT":n.integer(e+"S",t);break;case"LOCA":n.set(e+"L",a(t))}},/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:n.get("MPEGTS"),LOCAL:n.get("LOCAL")})}(n)},/=/):l(e,function(e,n){if("Region"===e)!function(e){var n=new o;if(l(e,function(e,t){switch(e){case"id":n.set(e,t);break;case"width":n.percent(e,t);break;case"lines":n.integer(e,t);break;case"regionanchor":case"viewportanchor":var i=t.split(",");if(2!==i.length)break;var r=new o;if(r.percent("x",i[0]),r.percent("y",i[1]),!r.has("x")||!r.has("y"))break;n.set(e+"X",r.get("x")),n.set(e+"Y",r.get("y"));break;case"scroll":n.alt(e,t,["up"])}},/=/,/\s/),n.has("id")){var i=new(t.vttjs.VTTRegion||t.window.VTTRegion);i.width=n.get("width",100),i.lines=n.get("lines",3),i.regionAnchorX=n.get("regionanchorX",0),i.regionAnchorY=n.get("regionanchorY",100),i.viewportAnchorX=n.get("viewportanchorX",0),i.viewportAnchorY=n.get("viewportanchorY",100),i.scroll=n.get("scroll",""),t.onregion&&t.onregion(i),t.regionList.push({id:n.get("id"),region:i})}}(n)},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var u=(r=n()).match(/^WEBVTT([ \t].*)?$/);if(!u||!u[0])throw new s(s.Errors.BadSignature);t.state="HEADER"}for(var h=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(h?h=!1:r=n(),t.state){case"HEADER":/:/.test(r)?i(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");try{t.cue.align="center"}catch(p){t.cue.align="middle"}if(t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{c(r,t.cue,t.regionList)}catch(p){t.reportOrThrowError(p),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var d=-1!==r.indexOf("--\x3e");if(!r||d&&(h=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":r||(t.state="ID");continue}}}catch(p){t.reportOrThrowError(p),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new s(s.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}},e.exports=T},188:(e,t,n)=>{var i=n(132),r=i.find,s=i.NAMESPACE;function a(e){return""!==e}function o(e,t){return e.hasOwnProperty(t)||(e[t]=!0),e}function l(e){if(!e)return[];var t=function(e){return e?e.split(/[\t\n\f\r ]+/).filter(a):[]}(e);return Object.keys(t.reduce(o,{}))}function c(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function u(e,t){var n=e.prototype;if(!(n instanceof t)){function i(){}i.prototype=t.prototype,c(n,i=new i),e.prototype=n=i}n.constructor!=e&&("function"!=typeof e&&console.error("unknown Class:"+e),n.constructor=e)}var h={},d=h.ELEMENT_NODE=1,p=h.ATTRIBUTE_NODE=2,f=h.TEXT_NODE=3,g=h.CDATA_SECTION_NODE=4,m=h.ENTITY_REFERENCE_NODE=5,y=h.ENTITY_NODE=6,b=h.PROCESSING_INSTRUCTION_NODE=7,v=h.COMMENT_NODE=8,_=h.DOCUMENT_NODE=9,x=h.DOCUMENT_TYPE_NODE=10,w=h.DOCUMENT_FRAGMENT_NODE=11,T=h.NOTATION_NODE=12,k={},S={},C=(k.INDEX_SIZE_ERR=(S[1]="Index size error",1),k.DOMSTRING_SIZE_ERR=(S[2]="DOMString size error",2),k.HIERARCHY_REQUEST_ERR=(S[3]="Hierarchy request error",3)),I=(k.WRONG_DOCUMENT_ERR=(S[4]="Wrong document",4),k.INVALID_CHARACTER_ERR=(S[5]="Invalid character",5),k.NO_DATA_ALLOWED_ERR=(S[6]="No data allowed",6),k.NO_MODIFICATION_ALLOWED_ERR=(S[7]="No modification allowed",7),k.NOT_FOUND_ERR=(S[8]="Not found",8)),E=(k.NOT_SUPPORTED_ERR=(S[9]="Not supported",9),k.INUSE_ATTRIBUTE_ERR=(S[10]="Attribute in use",10));k.INVALID_STATE_ERR=(S[11]="Invalid state",11),k.SYNTAX_ERR=(S[12]="Syntax error",12),k.INVALID_MODIFICATION_ERR=(S[13]="Invalid modification",13),k.NAMESPACE_ERR=(S[14]="Invalid namespace",14),k.INVALID_ACCESS_ERR=(S[15]="Invalid access",15);function N(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,S[e]),this.message=S[e],Error.captureStackTrace&&Error.captureStackTrace(this,N);return n.code=e,t&&(this.message=this.message+": "+t),n}function A(){}function R(e,t){this._node=e,this._refresh=t,D(this)}function D(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!==t){var n=e._refresh(e._node);if(_e(e,"length",n.length),!e.$$length||n.length<e.$$length)for(var i=n.length;i in e;i++)Object.prototype.hasOwnProperty.call(e,i)&&delete e[i];c(n,e),e._inc=t}}function O(){}function L(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function P(e,t,n,i){if(i?t[L(t,i)]=n:t[t.length++]=n,e){n.ownerElement=e;var r=e.ownerDocument;r&&(i&&j(r,e,i),function(e,t,n){e&&e._inc++;var i=n.namespaceURI;i===s.XMLNS&&(t._nsMap[n.prefix?n.localName:""]=n.value)}(r,e,n))}}function F(e,t,n){var i=L(t,n);if(!(i>=0))throw new N(I,new Error(e.tagName+"@"+n));for(var r=t.length-1;i<r;)t[i]=t[++i];if(t.length=r,e){var s=e.ownerDocument;s&&(j(s,e,n),n.ownerElement=null)}}function M(){}function U(){}function B(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function z(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(z(e,t))return!0}while(e=e.nextSibling)}function V(){this.ownerDocument=this}function j(e,t,n,i){e&&e._inc++,n.namespaceURI===s.XMLNS&&delete t._nsMap[n.prefix?n.localName:""]}function W(e,t,n){if(e&&e._inc){e._inc++;var i=t.childNodes;if(n)i[i.length++]=n;else{for(var r=t.firstChild,s=0;r;)i[s++]=r,r=r.nextSibling;i.length=s,delete i[i.length]}}}function H(e,t){var n=t.previousSibling,i=t.nextSibling;return n?n.nextSibling=i:e.firstChild=i,i?i.previousSibling=n:e.lastChild=n,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,W(e.ownerDocument,e),t}function G(e){return e&&e.nodeType===U.DOCUMENT_TYPE_NODE}function q(e){return e&&e.nodeType===U.ELEMENT_NODE}function X(e){return e&&e.nodeType===U.TEXT_NODE}function K(e,t){var n=e.childNodes||[];if(r(n,q)||G(t))return!1;var i=r(n,G);return!(t&&i&&n.indexOf(i)>n.indexOf(t))}function Y(e,t){var n=e.childNodes||[];if(r(n,function(e){return q(e)&&e!==t}))return!1;var i=r(n,G);return!(t&&i&&n.indexOf(i)>n.indexOf(t))}function Q(e,t,n){if(!function(e){return e&&(e.nodeType===U.DOCUMENT_NODE||e.nodeType===U.DOCUMENT_FRAGMENT_NODE||e.nodeType===U.ELEMENT_NODE)}(e))throw new N(C,"Unexpected parent node type "+e.nodeType);if(n&&n.parentNode!==e)throw new N(I,"child not in parent");if(!function(e){return e&&(q(e)||X(e)||G(e)||e.nodeType===U.DOCUMENT_FRAGMENT_NODE||e.nodeType===U.COMMENT_NODE||e.nodeType===U.PROCESSING_INSTRUCTION_NODE)}(t)||G(t)&&e.nodeType!==U.DOCUMENT_NODE)throw new N(C,"Unexpected node type "+t.nodeType+" for parent node type "+e.nodeType)}function $(e,t,n){var i=e.childNodes||[],s=t.childNodes||[];if(t.nodeType===U.DOCUMENT_FRAGMENT_NODE){var a=s.filter(q);if(a.length>1||r(s,X))throw new N(C,"More than one element or text in fragment");if(1===a.length&&!K(e,n))throw new N(C,"Element in fragment can not be inserted before doctype")}if(q(t)&&!K(e,n))throw new N(C,"Only one element can be added and only after doctype");if(G(t)){if(r(i,G))throw new N(C,"Only one doctype is allowed");var o=r(i,q);if(n&&i.indexOf(o)<i.indexOf(n))throw new N(C,"Doctype can only be inserted before an element");if(!n&&o)throw new N(C,"Doctype can not be appended since element is present")}}function J(e,t,n){var i=e.childNodes||[],s=t.childNodes||[];if(t.nodeType===U.DOCUMENT_FRAGMENT_NODE){var a=s.filter(q);if(a.length>1||r(s,X))throw new N(C,"More than one element or text in fragment");if(1===a.length&&!Y(e,n))throw new N(C,"Element in fragment can not be inserted before doctype")}if(q(t)&&!Y(e,n))throw new N(C,"Only one element can be added and only after doctype");if(G(t)){if(r(i,function(e){return G(e)&&e!==n}))throw new N(C,"Only one doctype is allowed");var o=r(i,q);if(n&&i.indexOf(o)<i.indexOf(n))throw new N(C,"Doctype can only be inserted before an element")}}function Z(e,t,n,i){Q(e,t,n),e.nodeType===U.DOCUMENT_NODE&&(i||$)(e,t,n);var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===w){var s=t.firstChild;if(null==s)return t;var a=t.lastChild}else s=a=t;var o=n?n.previousSibling:e.lastChild;s.previousSibling=o,a.nextSibling=n,o?o.nextSibling=s:e.firstChild=s,null==n?e.lastChild=a:n.previousSibling=a;do{s.parentNode=e,ee(s,e.ownerDocument||e)}while(s!==a&&(s=s.nextSibling));return W(e.ownerDocument||e,e),t.nodeType==w&&(t.firstChild=t.lastChild=null),t}function ee(e,t){if(e.ownerDocument!==t){if(e.ownerDocument=t,e.nodeType===d&&e.attributes)for(var n=0;n<e.attributes.length;n++){var i=e.attributes.item(n);i&&(i.ownerDocument=t)}for(var r=e.firstChild;r;)ee(r,t),r=r.nextSibling}}function te(){this._nsMap={}}function ne(){}function ie(){}function re(){}function se(){}function ae(){}function oe(){}function le(){}function ce(){}function ue(){}function he(){}function de(){}function pe(){}function fe(e,t){var n=[],i=9==this.nodeType&&this.documentElement||this,r=i.prefix,s=i.namespaceURI;if(s&&null==r&&null==(r=i.lookupPrefix(s)))var a=[{namespace:s,prefix:null}];return ye(this,n,e,t,a),n.join("")}function ge(e,t,n){var i=e.prefix||"",r=e.namespaceURI;if(!r)return!1;if("xml"===i&&r===s.XML||r===s.XMLNS)return!1;for(var a=n.length;a--;){var o=n[a];if(o.prefix===i)return o.namespace!==r}return!0}function me(e,t,n){e.push(" ",t,'="',n.replace(/[<>&"\t\n\r]/g,B),'"')}function ye(e,t,n,i,r){if(r||(r=[]),i){if(!(e=i(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case d:var a=e.attributes,o=a.length,l=e.firstChild,c=e.tagName,u=c;if(!(n=s.isHTML(e.namespaceURI)||n)&&!e.prefix&&e.namespaceURI){for(var h,y=0;y<a.length;y++)if("xmlns"===a.item(y).name){h=a.item(y).value;break}if(!h)for(var T=r.length-1;T>=0;T--){if(""===(k=r[T]).prefix&&k.namespace===e.namespaceURI){h=k.namespace;break}}if(h!==e.namespaceURI)for(T=r.length-1;T>=0;T--){var k;if((k=r[T]).namespace===e.namespaceURI){k.prefix&&(u=k.prefix+":"+c);break}}}t.push("<",u);for(var S=0;S<o;S++){"xmlns"==(C=a.item(S)).prefix?r.push({prefix:C.localName,namespace:C.value}):"xmlns"==C.nodeName&&r.push({prefix:"",namespace:C.value})}for(S=0;S<o;S++){var C,I,E;if(ge(C=a.item(S),0,r))me(t,(I=C.prefix||"")?"xmlns:"+I:"xmlns",E=C.namespaceURI),r.push({prefix:I,namespace:E});ye(C,t,n,i,r)}if(c===u&&ge(e,0,r))me(t,(I=e.prefix||"")?"xmlns:"+I:"xmlns",E=e.namespaceURI),r.push({prefix:I,namespace:E});if(l||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(c)){if(t.push(">"),n&&/^script$/i.test(c))for(;l;)l.data?t.push(l.data):ye(l,t,n,i,r.slice()),l=l.nextSibling;else for(;l;)ye(l,t,n,i,r.slice()),l=l.nextSibling;t.push("</",u,">")}else t.push("/>");return;case _:case w:for(l=e.firstChild;l;)ye(l,t,n,i,r.slice()),l=l.nextSibling;return;case p:return me(t,e.name,e.value);case f:return t.push(e.data.replace(/[<&>]/g,B));case g:return t.push("<![CDATA[",e.data,"]]>");case v:return t.push("\x3c!--",e.data,"--\x3e");case x:var N=e.publicId,A=e.systemId;if(t.push("<!DOCTYPE ",e.name),N)t.push(" PUBLIC ",N),A&&"."!=A&&t.push(" ",A),t.push(">");else if(A&&"."!=A)t.push(" SYSTEM ",A,">");else{var R=e.internalSubset;R&&t.push(" [",R,"]"),t.push(">")}return;case b:return t.push("<?",e.target," ",e.data,"?>");case m:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function be(e,t,n){var i;switch(t.nodeType){case d:(i=t.cloneNode(!1)).ownerDocument=e;case w:break;case p:n=!0}if(i||(i=t.cloneNode(!1)),i.ownerDocument=e,i.parentNode=null,n)for(var r=t.firstChild;r;)i.appendChild(be(e,r,n)),r=r.nextSibling;return i}function ve(e,t,n){var i=new t.constructor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var s=t[r];"object"!=typeof s&&s!=i[r]&&(i[r]=s)}switch(t.childNodes&&(i.childNodes=new A),i.ownerDocument=e,i.nodeType){case d:var a=t.attributes,o=i.attributes=new O,l=a.length;o._ownerElement=i;for(var c=0;c<l;c++)i.setAttributeNode(ve(e,a.item(c),!0));break;case p:n=!0}if(n)for(var u=t.firstChild;u;)i.appendChild(ve(e,u,n)),u=u.nextSibling;return i}function _e(e,t,n){e[t]=n}N.prototype=Error.prototype,c(k,N),A.prototype={length:0,item:function(e){return e>=0&&e<this.length?this[e]:null},toString:function(e,t){for(var n=[],i=0;i<this.length;i++)ye(this[i],n,e,t);return n.join("")},filter:function(e){return Array.prototype.filter.call(this,e)},indexOf:function(e){return Array.prototype.indexOf.call(this,e)}},R.prototype.item=function(e){return D(this),this[e]||null},u(R,A),O.prototype={length:0,item:A.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new N(E);var n=this.getNamedItem(e.nodeName);return P(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new N(E);return t=this.getNamedItemNS(e.namespaceURI,e.localName),P(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return F(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return F(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var i=this[n];if(i.localName==t&&i.namespaceURI==e)return i}return null}},M.prototype={hasFeature:function(e,t){return!0},createDocument:function(e,t,n){var i=new V;if(i.implementation=this,i.childNodes=new A,i.doctype=n||null,n&&i.appendChild(n),t){var r=i.createElementNS(e,t);i.appendChild(r)}return i},createDocumentType:function(e,t,n){var i=new oe;return i.name=e,i.nodeName=e,i.publicId=t||"",i.systemId=n||"",i}},U.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return Z(this,e,t)},replaceChild:function(e,t){Z(this,e,t,J),t&&this.removeChild(t)},removeChild:function(e){return H(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return ve(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==f&&e.nodeType==f?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&n[i]===e)return i;t=t.nodeType==p?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&Object.prototype.hasOwnProperty.call(n,e))return n[e];t=t.nodeType==p?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},c(h,U),c(h,U.prototype),V.prototype={nodeName:"#document",nodeType:_,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==w){for(var n=e.firstChild;n;){var i=n.nextSibling;this.insertBefore(n,t),n=i}return e}return Z(this,e,t),ee(e,this),null===this.documentElement&&e.nodeType===d&&(this.documentElement=e),e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),H(this,e)},replaceChild:function(e,t){Z(this,e,t,J),ee(e,this),t&&this.removeChild(t),q(e)&&(this.documentElement=e)},importNode:function(e,t){return be(this,e,t)},getElementById:function(e){var t=null;return z(this.documentElement,function(n){if(n.nodeType==d&&n.getAttribute("id")==e)return t=n,!0}),t},getElementsByClassName:function(e){var t=l(e);return new R(this,function(n){var i=[];return t.length>0&&z(n.documentElement,function(r){if(r!==n&&r.nodeType===d){var s=r.getAttribute("class");if(s){var a=e===s;if(!a){var o=l(s);a=t.every((c=o,function(e){return c&&-1!==c.indexOf(e)}))}a&&i.push(r)}}var c}),i})},createElement:function(e){var t=new te;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.localName=e,t.childNodes=new A,(t.attributes=new O)._ownerElement=t,t},createDocumentFragment:function(){var e=new he;return e.ownerDocument=this,e.childNodes=new A,e},createTextNode:function(e){var t=new re;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new se;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new ae;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new de;return n.ownerDocument=this,n.tagName=n.nodeName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new ne;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new ue;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new te,i=t.split(":"),r=n.attributes=new O;return n.childNodes=new A,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=t,r._ownerElement=n,n},createAttributeNS:function(e,t){var n=new ne,i=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=t,n}},u(V,U),te.prototype={nodeType:d,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===w?this.insertBefore(e,null):function(e,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=e,t.previousSibling=e.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,e.lastChild=t,W(e.ownerDocument,e,t),ee(t,e.ownerDocument||e),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var i=this.ownerDocument.createAttributeNS(e,t);i.value=i.nodeValue=""+n,this.setAttributeNode(i)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new R(this,function(t){var n=[];return z(t,function(i){i===t||i.nodeType!=d||"*"!==e&&i.tagName!=e||n.push(i)}),n})},getElementsByTagNameNS:function(e,t){return new R(this,function(n){var i=[];return z(n,function(r){r===n||r.nodeType!==d||"*"!==e&&r.namespaceURI!==e||"*"!==t&&r.localName!=t||i.push(r)}),i})}},V.prototype.getElementsByTagName=te.prototype.getElementsByTagName,V.prototype.getElementsByTagNameNS=te.prototype.getElementsByTagNameNS,u(te,U),ne.prototype.nodeType=p,u(ne,U),ie.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(S[C])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},u(ie,U),re.prototype={nodeName:"#text",nodeType:f,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var i=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(i,this.nextSibling),i}},u(re,ie),se.prototype={nodeName:"#comment",nodeType:v},u(se,ie),ae.prototype={nodeName:"#cdata-section",nodeType:g},u(ae,ie),oe.prototype.nodeType=x,u(oe,U),le.prototype.nodeType=T,u(le,U),ce.prototype.nodeType=y,u(ce,U),ue.prototype.nodeType=m,u(ue,U),he.prototype.nodeName="#document-fragment",he.prototype.nodeType=w,u(he,U),de.prototype.nodeType=b,u(de,U),pe.prototype.serializeToString=function(e,t,n){return fe.call(e,t,n)},U.prototype.toString=fe;try{if(Object.defineProperty){function xe(e){switch(e.nodeType){case d:case w:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(xe(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(R.prototype,"length",{get:function(){return D(this),this.$$length}}),Object.defineProperty(U.prototype,"textContent",{get:function(){return xe(this)},set:function(e){switch(this.nodeType){case d:case w:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),_e=function(e,t,n){e["$$"+t]=n}}}catch(we){}t.DocumentType=oe,t.DOMException=N,t.DOMImplementation=M,t.Element=te,t.Node=U,t.NodeList=A,t.XMLSerializer=pe},234:()=>{},271:function(e,t,n){var i;!function(e,r){function s(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new s(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=o:n.amdD&&n.amdO?void 0===(i=function(){return o}.call(t,n,t,r))||(r.exports=i):this.xor128=o}(0,e=n.nmd(e),n.amdD)},281:function(e,t,n){var i;!function(e,r){function s(e){var t=this;t.next=function(){var e,n,i=t.x,r=t.i;return e=i[r],n=(e^=e>>>7)^e<<24,n^=(e=i[r+1&7])^e>>>10,n^=(e=i[r+3&7])^e>>>3,n^=(e=i[r+4&7])^e<<7,e=i[r+7&7],n^=(e^=e<<13)^e<<9,i[r]=n,t.i=r+1&7,n},function(e,t){var n,i=[];if(t===(0|t))i[0]=t;else for(t=""+t,n=0;n<t.length;++n)i[7&n]=i[7&n]<<15^t.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],e.x=i,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new s(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&(i.x&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=o:n.amdD&&n.amdO?void 0===(i=function(){return o}.call(t,n,t,r))||(r.exports=i):this.xorshift7=o}(0,e=n.nmd(e),n.amdD)},340:(e,t,n)=>{"use strict";e.exports=n(761)},345:(e,t,n)=>{"use strict";var i=n(950),r=n(340);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function g(e,t,n,i,r,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){m[e]=new g(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){m[e]=new g(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){m[e]=new g(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){m[e]=new g(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){m[e]=new g(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function v(e,t,n,i){var r=m.hasOwnProperty(t)?m[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,b);m[t]=new g(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,b);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,b);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)}),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)});var _=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),I=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function P(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var F,M=Object.assign;function U(e){if(void 0===F)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var B=!1;function z(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),s=i.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function V(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function j(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case w:return"Portal";case S:return"Profiler";case k:return"StrictMode";case N:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:j(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return j(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=G(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function J(e,t){$(e,t);var n=H(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function se(e,t){var n=H(t.value),i=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=ge(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ye=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _e=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Te=null,ke=null;function Se(e){if(e=vr(e)){if("function"!==typeof we)throw Error(s(280));var t=e.stateNode;t&&(t=xr(t),we(e.stateNode,e.type,t))}}function Ce(e){Te?ke?ke.push(e):ke=[e]:Te=e}function Ie(){if(Te){var e=Te,t=ke;if(ke=Te=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Ee(e,t){return e(t)}function Ne(){}var Ae=!1;function Re(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Ee(e,t,n)}finally{Ae=!1,(null!==Te||null!==ke)&&(Ne(),Ie())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var i=xr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Oe=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){Oe=!1}function Pe(e,t,n,i,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Fe=!1,Me=null,Ue=!1,Be=null,ze={onError:function(e){Fe=!0,Me=e}};function Ve(e,t,n,i,r,s,a,o,l){Fe=!1,Me=null,Pe.apply(ze,arguments)}function je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(je(e)!==e)throw Error(s(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=je(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return He(r),e;if(a===i)return He(r),t;a=a.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=a;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,i=a;break}if(l===i){o=!0,i=r,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,i=r;break}if(l===i){o=!0,i=a,n=r;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Xe=r.unstable_scheduleCallback,Ke=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Qe=r.unstable_requestPaint,$e=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~r;0!==o?i=ht(o):0!==(s&=a)&&(i=ht(s))}else 0!==(a=n&~r)?i=ht(a):0!==s&&(i=ht(s));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function bt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var vt=0;function _t(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,wt,Tt,kt,St,Ct=!1,It=[],Et=null,Nt=null,At=null,Rt=new Map,Dt=new Map,Ot=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pt(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Nt=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Ft(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=vr(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Mt(e){var t=br(e.target);if(null!==t){var n=je(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void St(e.priority,function(){Tt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vr(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);_e=i,n.target.dispatchEvent(i),_e=null,t.shift()}return!0}function Bt(e,t,n){Ut(e)&&n.delete(t)}function zt(){Ct=!1,null!==Et&&Ut(Et)&&(Et=null),null!==Nt&&Ut(Nt)&&(Nt=null),null!==At&&Ut(At)&&(At=null),Rt.forEach(Bt),Dt.forEach(Bt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,zt)))}function jt(e){function t(t){return Vt(t,e)}if(0<It.length){Vt(It[0],e);for(var n=1;n<It.length;n++){var i=It[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Et&&Vt(Et,e),null!==Nt&&Vt(Nt,e),null!==At&&Vt(At,e),Rt.forEach(t),Dt.forEach(t),n=0;n<Ot.length;n++)(i=Ot[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Ot.length&&null===(n=Ot[0]).blockedOn;)Mt(n),null===n.blockedOn&&Ot.shift()}var Wt=_.ReactCurrentBatchConfig,Ht=!0;function Gt(e,t,n,i){var r=vt,s=Wt.transition;Wt.transition=null;try{vt=1,Xt(e,t,n,i)}finally{vt=r,Wt.transition=s}}function qt(e,t,n,i){var r=vt,s=Wt.transition;Wt.transition=null;try{vt=4,Xt(e,t,n,i)}finally{vt=r,Wt.transition=s}}function Xt(e,t,n,i){if(Ht){var r=Yt(e,t,n,i);if(null===r)Hi(e,t,i,Kt,n),Pt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Et=Ft(Et,e,t,n,i,r),!0;case"dragenter":return Nt=Ft(Nt,e,t,n,i,r),!0;case"mouseover":return At=Ft(At,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return Rt.set(s,Ft(Rt.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Dt.set(s,Ft(Dt.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Pt(e,i),4&t&&-1<Lt.indexOf(e)){for(;null!==r;){var s=vr(r);if(null!==s&&xt(s),null===(s=Yt(e,t,n,i))&&Hi(e,t,i,Kt,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else Hi(e,t,i,null,n)}}var Kt=null;function Yt(e,t,n,i){if(Kt=null,null!==(e=br(e=xe(i))))if(null===(t=je(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var $t=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,i=n.length,r="value"in $t?$t.value:$t.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[s-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,i,r,s){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(cn),hn=M({},cn,{view:0,detail:0}),dn=sn(hn),pn=M({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),fn=sn(pn),gn=sn(M({},pn,{dataTransfer:0})),mn=sn(M({},hn,{relatedTarget:0})),yn=sn(M({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=M({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=sn(bn),_n=sn(M({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function Sn(){return kn}var Cn=M({},hn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=sn(Cn),En=sn(M({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Nn=sn(M({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),An=sn(M({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=M({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=sn(Rn),On=[9,13,27,32],Ln=u&&"CompositionEvent"in window,Pn=null;u&&"documentMode"in document&&(Pn=document.documentMode);var Fn=u&&"TextEvent"in window&&!Pn,Mn=u&&(!Ln||Pn&&8<Pn&&11>=Pn),Un=String.fromCharCode(32),Bn=!1;function zn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Gn(e,t,n,i){Ce(i),0<(t=qi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var qn=null,Xn=null;function Kn(e){Ui(e,0)}function Yn(e){if(X(_r(e)))return e}function Qn(e,t){if("change"===e)return t}var $n=!1;if(u){var Jn;if(u){var Zn="oninput"in document;if(!Zn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Zn="function"===typeof ei.oninput}Jn=Zn}else Jn=!1;$n=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){qn&&(qn.detachEvent("onpropertychange",ni),Xn=qn=null)}function ni(e){if("value"===e.propertyName&&Yn(Xn)){var t=[];Gn(t,Xn,e,xe(e)),Re(Kn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Xn=n,(qn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Xn)}function si(e,t){if("click"===e)return Yn(t)}function ai(e,t){if("input"===e||"change"===e)return Yn(t)}var oi="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(oi(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(t,r)||!oi(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function di(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=di(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!e.extend&&s>i&&(r=i,i=s,s=r),r=ui(n,s);var a=ui(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gi=u&&"documentMode"in document&&11>=document.documentMode,mi=null,yi=null,bi=null,vi=!1;function _i(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vi||null==mi||mi!==K(i)||("selectionStart"in(i=mi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},bi&&li(bi,i)||(bi=i,0<(i=qi(yi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=mi)))}function xi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:xi("Animation","AnimationEnd"),animationiteration:xi("Animation","AnimationIteration"),animationstart:xi("Animation","AnimationStart"),transitionend:xi("Transition","TransitionEnd")},Ti={},ki={};function Si(e){if(Ti[e])return Ti[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in ki)return Ti[e]=n[t];return e}u&&(ki=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ci=Si("animationend"),Ii=Si("animationiteration"),Ei=Si("animationstart"),Ni=Si("transitionend"),Ai=new Map,Ri="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Di(e,t){Ai.set(e,t),l(t,[e])}for(var Oi=0;Oi<Ri.length;Oi++){var Li=Ri[Oi];Di(Li.toLowerCase(),"on"+(Li[0].toUpperCase()+Li.slice(1)))}Di(Ci,"onAnimationEnd"),Di(Ii,"onAnimationIteration"),Di(Ei,"onAnimationStart"),Di("dblclick","onDoubleClick"),Di("focusin","onFocus"),Di("focusout","onBlur"),Di(Ni,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pi));function Mi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,o,l,c){if(Ve.apply(this,arguments),Fe){if(!Fe)throw Error(s(198));var u=Me;Fe=!1,Me=null,Ue||(Ue=!0,Be=u)}}(i,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;Mi(r,o,c),s=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;Mi(r,o,c),s=l}}}if(Ue)throw e=Be,Ue=!1,Be=null,e}function Bi(e,t){var n=t[gr];void 0===n&&(n=t[gr]=new Set);var i=e+"__bubble";n.has(i)||(Wi(t,e,2,!1),n.add(i))}function zi(e,t,n){var i=0;t&&(i|=4),Wi(n,e,i,t)}var Vi="_reactListening"+Math.random().toString(36).slice(2);function ji(e){if(!e[Vi]){e[Vi]=!0,a.forEach(function(t){"selectionchange"!==t&&(Fi.has(t)||zi(t,!1,e),zi(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vi]||(t[Vi]=!0,zi("selectionchange",!1,t))}}function Wi(e,t,n,i){switch(Qt(t)){case 1:var r=Gt;break;case 4:r=qt;break;default:r=Xt}n=r.bind(null,t,n,e),r=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Hi(e,t,n,i,r){var s=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=br(o)))return;if(5===(l=a.tag)||6===l){i=s=a;continue e}o=o.parentNode}}i=i.return}Re(function(){var i=s,r=xe(n),a=[];e:{var o=Ai.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=In;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Nn;break;case Ci:case Ii:case Ei:l=yn;break;case Ni:l=An;break;case"scroll":l=dn;break;case"wheel":l=Dn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=En}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=i;null!==f;){var g=(p=f).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==d&&(null!=(g=De(f,d))&&u.push(Gi(f,g,p)))),h)break;f=f.return}0<u.length&&(o=new l(o,c,null,n,r),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===_e||!(c=n.relatedTarget||n.fromElement)||!br(c)&&!c[fr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?br(c):null)&&(c!==(h=je(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,g="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=En,g="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?o:_r(l),p=null==c?o:_r(c),(o=new u(g,f+"leave",l,n,r)).target=h,o.relatedTarget=p,g=null,br(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,g=u),h=g,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Xi(p))f++;for(p=0,g=d;g;g=Xi(g))p++;for(;0<f-p;)u=Xi(u),f--;for(;0<p-f;)d=Xi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Xi(u),d=Xi(d)}u=null}else u=null;null!==l&&Ki(a,o,l,u,!1),null!==c&&null!==h&&Ki(a,h,c,u,!0)}if("select"===(l=(o=i?_r(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m=Qn;else if(Hn(o))if($n)m=ai;else{m=ri;var y=ii}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=si);switch(m&&(m=m(e,i))?Gn(a,m,n,r):(y&&y(e,o,i),"focusout"===e&&(y=o._wrapperState)&&y.controlled&&"number"===o.type&&ee(o,"number",o.value)),y=i?_r(i):window,e){case"focusin":(Hn(y)||"true"===y.contentEditable)&&(mi=y,yi=i,bi=null);break;case"focusout":bi=yi=mi=null;break;case"mousedown":vi=!0;break;case"contextmenu":case"mouseup":case"dragend":vi=!1,_i(a,n,r);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":_i(a,n,r)}var b;if(Ln)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else jn?zn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Mn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==v?"onCompositionEnd"===v&&jn&&(b=en()):(Jt="value"in($t=r)?$t.value:$t.textContent,jn=!0)),0<(y=qi(i,v)).length&&(v=new _n(v,e,null,n,r),a.push({event:v,listeners:y}),b?v.data=b:null!==(b=Vn(n))&&(v.data=b))),(b=Fn?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Un);case"textInput":return(e=t.data)===Un&&Bn?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!Ln&&zn(e,t)?(e=en(),Zt=Jt=$t=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=qi(i,"onBeforeInput")).length&&(r=new _n("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=b))}Ui(a,t)})}function Gi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=De(e,n))&&i.unshift(Gi(e,s,r)),null!=(s=De(e,t))&&i.push(Gi(e,s,r))),e=e.return}return i}function Xi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,t,n,i,r){for(var s=t._reactName,a=[];null!==n&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=De(n,s))&&a.unshift(Gi(n,l,o)):r||null!=(l=De(n,s))&&a.push(Gi(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Yi=/\r\n?/g,Qi=/\u0000|\uFFFD/g;function $i(e){return("string"===typeof e?e:""+e).replace(Yi,"\n").replace(Qi,"")}function Ji(e,t,n){if(t=$i(t),$i(e)!==t&&n)throw Error(s(425))}function Zi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(or)}:ir;function or(e){setTimeout(function(){throw e})}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void jt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);jt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,pr="__reactProps$"+hr,fr="__reactContainer$"+hr,gr="__reactEvents$"+hr,mr="__reactListeners$"+hr,yr="__reactHandles$"+hr;function br(e){var t=e[dr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fr]||n[dr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[dr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function vr(e){return!(e=e[dr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function _r(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function xr(e){return e[pr]||null}var wr=[],Tr=-1;function kr(e){return{current:e}}function Sr(e){0>Tr||(e.current=wr[Tr],wr[Tr]=null,Tr--)}function Cr(e,t){Tr++,wr[Tr]=e.current,e.current=t}var Ir={},Er=kr(Ir),Nr=kr(!1),Ar=Ir;function Rr(e,t){var n=e.type.contextTypes;if(!n)return Ir;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Dr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Or(){Sr(Nr),Sr(Er)}function Lr(e,t,n){if(Er.current!==Ir)throw Error(s(168));Cr(Er,t),Cr(Nr,n)}function Pr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(s(108,W(e)||"Unknown",r));return M({},n,i)}function Fr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ir,Ar=Er.current,Cr(Er,e),Cr(Nr,Nr.current),!0}function Mr(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=Pr(e,t,Ar),i.__reactInternalMemoizedMergedChildContext=e,Sr(Nr),Sr(Er),Cr(Er,e)):Sr(Nr),Cr(Nr,n)}var Ur=null,Br=!1,zr=!1;function Vr(e){null===Ur?Ur=[e]:Ur.push(e)}function jr(){if(!zr&&null!==Ur){zr=!0;var e=0,t=vt;try{var n=Ur;for(vt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Ur=null,Br=!1}catch(r){throw null!==Ur&&(Ur=Ur.slice(e+1)),Xe(Ze,jr),r}finally{vt=t,zr=!1}}return null}var Wr=[],Hr=0,Gr=null,qr=0,Xr=[],Kr=0,Yr=null,Qr=1,$r="";function Jr(e,t){Wr[Hr++]=qr,Wr[Hr++]=Gr,Gr=e,qr=t}function Zr(e,t,n){Xr[Kr++]=Qr,Xr[Kr++]=$r,Xr[Kr++]=Yr,Yr=e;var i=Qr;e=$r;var r=32-at(i)-1;i&=~(1<<r),n+=1;var s=32-at(t)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Qr=1<<32-at(t)+r|n<<r|i,$r=s+e}else Qr=1<<s|n<<r|i,$r=e}function es(e){null!==e.return&&(Jr(e,1),Zr(e,1,0))}function ts(e){for(;e===Gr;)Gr=Wr[--Hr],Wr[Hr]=null,qr=Wr[--Hr],Wr[Hr]=null;for(;e===Yr;)Yr=Xr[--Kr],Xr[Kr]=null,$r=Xr[--Kr],Xr[Kr]=null,Qr=Xr[--Kr],Xr[Kr]=null}var ns=null,is=null,rs=!1,ss=null;function as(e,t){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function os(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,is=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,is=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Qr,overflow:$r}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,is=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(rs){var t=is;if(t){var n=t;if(!os(e,t)){if(ls(e))throw Error(s(418));t=cr(n.nextSibling);var i=ns;t&&os(e,t)?as(i,n):(e.flags=-4097&e.flags|2,rs=!1,ns=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,rs=!1,ns=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function hs(e){if(e!==ns)return!1;if(!rs)return us(e),rs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=is)){if(ls(e))throw ds(),Error(s(418));for(;t;)as(e,t),t=cr(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){is=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}is=null}}else is=ns?cr(e.stateNode.nextSibling):null;return!0}function ds(){for(var e=is;e;)e=cr(e.nextSibling)}function ps(){is=ns=null,rs=!1}function fs(e){null===ss?ss=[e]:ss.push(e)}var gs=_.ReactCurrentBatchConfig;function ms(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function ys(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bs(e){return(0,e._init)(e._payload)}function vs(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Oc(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Mc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var s=n.type;return s===T?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===D&&bs(s)===t.type)?((i=r(t,n.props)).ref=ms(e,t,n),i.return=e,i):((i=Lc(n.type,n.key,n.props,null,e.mode,i)).ref=ms(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,s){return null===t||7!==t.tag?((t=Pc(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Mc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Lc(t.type,t.key,t.props,null,e.mode,n)).ref=ms(e,null,t),n.return=e,n;case w:return(t=Uc(t,e.mode,n)).return=e,t;case D:return d(e,(0,t._init)(t._payload),n)}if(te(t)||P(t))return(t=Pc(t,e.mode,n,null)).return=e,t;ys(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===r?c(e,t,n,i):null;case w:return n.key===r?u(e,t,n,i):null;case D:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||P(n))return null!==r?null:h(e,t,n,i,null);ys(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case x:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case D:return f(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||P(i))return h(t,e=e.get(n)||null,i,r,null);ys(t,i)}return null}function g(r,s,o,l){for(var c=null,u=null,h=s,g=s=0,m=null;null!==h&&g<o.length;g++){h.index>g?(m=h,h=null):m=h.sibling;var y=p(r,h,o[g],l);if(null===y){null===h&&(h=m);break}e&&h&&null===y.alternate&&t(r,h),s=a(y,s,g),null===u?c=y:u.sibling=y,u=y,h=m}if(g===o.length)return n(r,h),rs&&Jr(r,g),c;if(null===h){for(;g<o.length;g++)null!==(h=d(r,o[g],l))&&(s=a(h,s,g),null===u?c=h:u.sibling=h,u=h);return rs&&Jr(r,g),c}for(h=i(r,h);g<o.length;g++)null!==(m=f(h,r,g,o[g],l))&&(e&&null!==m.alternate&&h.delete(null===m.key?g:m.key),s=a(m,s,g),null===u?c=m:u.sibling=m,u=m);return e&&h.forEach(function(e){return t(r,e)}),rs&&Jr(r,g),c}function m(r,o,l,c){var u=P(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,g=o,m=o=0,y=null,b=l.next();null!==g&&!b.done;m++,b=l.next()){g.index>m?(y=g,g=null):y=g.sibling;var v=p(r,g,b.value,c);if(null===v){null===g&&(g=y);break}e&&g&&null===v.alternate&&t(r,g),o=a(v,o,m),null===h?u=v:h.sibling=v,h=v,g=y}if(b.done)return n(r,g),rs&&Jr(r,m),u;if(null===g){for(;!b.done;m++,b=l.next())null!==(b=d(r,b.value,c))&&(o=a(b,o,m),null===h?u=b:h.sibling=b,h=b);return rs&&Jr(r,m),u}for(g=i(r,g);!b.done;m++,b=l.next())null!==(b=f(g,r,m,b.value,c))&&(e&&null!==b.alternate&&g.delete(null===b.key?m:b.key),o=a(b,o,m),null===h?u=b:h.sibling=b,h=b);return e&&g.forEach(function(e){return t(r,e)}),rs&&Jr(r,m),u}return function e(i,s,a,l){if("object"===typeof a&&null!==a&&a.type===T&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case x:e:{for(var c=a.key,u=s;null!==u;){if(u.key===c){if((c=a.type)===T){if(7===u.tag){n(i,u.sibling),(s=r(u,a.props.children)).return=i,i=s;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&bs(c)===u.type){n(i,u.sibling),(s=r(u,a.props)).ref=ms(i,u,a),s.return=i,i=s;break e}n(i,u);break}t(i,u),u=u.sibling}a.type===T?((s=Pc(a.props.children,i.mode,l,a.key)).return=i,i=s):((l=Lc(a.type,a.key,a.props,null,i.mode,l)).ref=ms(i,s,a),l.return=i,i=l)}return o(i);case w:e:{for(u=a.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(i,s.sibling),(s=r(s,a.children||[])).return=i,i=s;break e}n(i,s);break}t(i,s),s=s.sibling}(s=Uc(a,i.mode,l)).return=i,i=s}return o(i);case D:return e(i,s,(u=a._init)(a._payload),l)}if(te(a))return g(i,s,a,l);if(P(a))return m(i,s,a,l);ys(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,a)).return=i,i=s):(n(i,s),(s=Mc(a,i.mode,l)).return=i,i=s),o(i)):n(i,s)}}var _s=vs(!0),xs=vs(!1),ws=kr(null),Ts=null,ks=null,Ss=null;function Cs(){Ss=ks=Ts=null}function Is(e){var t=ws.current;Sr(ws),e._currentValue=t}function Es(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ns(e,t){Ts=e,Ss=ks=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(vo=!0),e.firstContext=null)}function As(e){var t=e._currentValue;if(Ss!==e)if(e={context:e,memoizedValue:t,next:null},null===ks){if(null===Ts)throw Error(s(308));ks=e,Ts.dependencies={lanes:0,firstContext:e}}else ks=ks.next=e;return t}var Rs=null;function Ds(e){null===Rs?Rs=[e]:Rs.push(e)}function Os(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ds(t)):(n.next=r.next,r.next=n),t.interleaved=n,Ls(e,i)}function Ls(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ps=!1;function Fs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ms(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Us(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Bs(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&El)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Ls(e,n)}return null===(r=i.interleaved)?(t.next=t,Ds(i)):(t.next=r.next,r.next=t),i.interleaved=t,Ls(e,n)}function zs(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,bt(e,n)}}function Vs(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function js(e,t,n,i){var r=e.updateQueue;Ps=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==s){var h=r.baseState;for(a=0,u=c=l=null,o=s;;){var d=o.lane,p=o.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,g=o;switch(d=t,p=n,g.tag){case 1:if("function"===typeof(f=g.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=g.payload)?f.call(p,h,d):f)||void 0===d)break e;h=M({},h,d);break e;case 2:Ps=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,a|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(d=o).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);Fl|=a,e.lanes=a,e.memoizedState=h}}function Ws(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(s(191,r));r.call(i)}}}var Hs={},Gs=kr(Hs),qs=kr(Hs),Xs=kr(Hs);function Ks(e){if(e===Hs)throw Error(s(174));return e}function Ys(e,t){switch(Cr(Xs,t),Cr(qs,e),Cr(Gs,Hs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Sr(Gs),Cr(Gs,t)}function Qs(){Sr(Gs),Sr(qs),Sr(Xs)}function $s(e){Ks(Xs.current);var t=Ks(Gs.current),n=le(t,e.type);t!==n&&(Cr(qs,e),Cr(Gs,n))}function Js(e){qs.current===e&&(Sr(Gs),Sr(qs))}var Zs=kr(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ia=_.ReactCurrentDispatcher,ra=_.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ca=!1,ua=!1,ha=0,da=0;function pa(){throw Error(s(321))}function fa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!oi(e[n],t[n]))return!1;return!0}function ga(e,t,n,i,r,a){if(sa=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ia.current=null===e||null===e.memoizedState?Ja:Za,e=n(i,r),ua){a=0;do{if(ua=!1,ha=0,25<=a)throw Error(s(301));a+=1,la=oa=null,t.updateQueue=null,ia.current=eo,e=n(i,r)}while(ua)}if(ia.current=$a,t=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ca=!1,t)throw Error(s(300));return e}function ma(){var e=0!==ha;return ha=0,e}function ya(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ba(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function va(e,t){return"function"===typeof t?t(e):t}function _a(e){var t=ba(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=oa,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=o=null,c=null,u=a;do{var h=u.lane;if((sa&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=i):c=c.next=d,aa.lanes|=h,Fl|=h}u=u.next}while(null!==u&&u!==a);null===c?o=i:c.next=l,oi(i,t.memoizedState)||(vo=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,aa.lanes|=a,Fl|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function xa(e){var t=ba(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);oi(a,t.memoizedState)||(vo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function wa(){}function Ta(e,t){var n=aa,i=ba(),r=t(),a=!oi(i.memoizedState,r);if(a&&(i.memoizedState=r,vo=!0),i=i.queue,Pa(Ca.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,Aa(9,Sa.bind(null,n,i,r,t),void 0,null),null===Nl)throw Error(s(349));0!==(30&sa)||ka(n,t,r)}return r}function ka(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Sa(e,t,n,i){t.value=n,t.getSnapshot=i,Ia(t)&&Ea(e)}function Ca(e,t,n){return n(function(){Ia(t)&&Ea(e)})}function Ia(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!oi(e,n)}catch(i){return!0}}function Ea(e){var t=Ls(e,1);null!==t&&nc(t,e,1,-1)}function Na(e){var t=ya();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:e},t.queue=e,e=e.dispatch=Xa.bind(null,aa,e),[t.memoizedState,e]}function Aa(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ra(){return ba().memoizedState}function Da(e,t,n,i){var r=ya();aa.flags|=e,r.memoizedState=Aa(1|t,n,void 0,void 0===i?null:i)}function Oa(e,t,n,i){var r=ba();i=void 0===i?null:i;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==i&&fa(i,a.deps))return void(r.memoizedState=Aa(t,n,s,i))}aa.flags|=e,r.memoizedState=Aa(1|t,n,s,i)}function La(e,t){return Da(8390656,8,e,t)}function Pa(e,t){return Oa(2048,8,e,t)}function Fa(e,t){return Oa(4,2,e,t)}function Ma(e,t){return Oa(4,4,e,t)}function Ua(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ba(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Oa(4,4,Ua.bind(null,t,e),n)}function za(){}function Va(e,t){var n=ba();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&fa(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function ja(e,t){var n=ba();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&fa(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Wa(e,t,n){return 0===(21&sa)?(e.baseState&&(e.baseState=!1,vo=!0),e.memoizedState=n):(oi(n,t)||(n=gt(),aa.lanes|=n,Fl|=n,e.baseState=!0),t)}function Ha(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var i=ra.transition;ra.transition={};try{e(!1),t()}finally{vt=n,ra.transition=i}}function Ga(){return ba().memoizedState}function qa(e,t,n){var i=tc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Ka(e))Ya(t,n);else if(null!==(n=Os(e,t,n,i))){nc(n,e,i,ec()),Qa(n,t,i)}}function Xa(e,t,n){var i=tc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ka(e))Ya(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(r.hasEagerState=!0,r.eagerState=o,oi(o,a)){var l=t.interleaved;return null===l?(r.next=r,Ds(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Os(e,t,r,i))&&(nc(n,e,i,r=ec()),Qa(n,t,i))}}function Ka(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Ya(e,t){ua=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qa(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,bt(e,n)}}var $a={readContext:As,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},Ja={readContext:As,useCallback:function(e,t){return ya().memoizedState=[e,void 0===t?null:t],e},useContext:As,useEffect:La,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Da(4194308,4,Ua.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Da(4194308,4,e,t)},useInsertionEffect:function(e,t){return Da(4,2,e,t)},useMemo:function(e,t){var n=ya();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ya();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=qa.bind(null,aa,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ya().memoizedState=e},useState:Na,useDebugValue:za,useDeferredValue:function(e){return ya().memoizedState=e},useTransition:function(){var e=Na(!1),t=e[0];return e=Ha.bind(null,e[1]),ya().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=aa,r=ya();if(rs){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Nl)throw Error(s(349));0!==(30&sa)||ka(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,La(Ca.bind(null,i,a,e),[e]),i.flags|=2048,Aa(9,Sa.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=ya(),t=Nl.identifierPrefix;if(rs){var n=$r;t=":"+t+"R"+(n=(Qr&~(1<<32-at(Qr)-1)).toString(32)+n),0<(n=ha++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=da++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Za={readContext:As,useCallback:Va,useContext:As,useEffect:Pa,useImperativeHandle:Ba,useInsertionEffect:Fa,useLayoutEffect:Ma,useMemo:ja,useReducer:_a,useRef:Ra,useState:function(){return _a(va)},useDebugValue:za,useDeferredValue:function(e){return Wa(ba(),oa.memoizedState,e)},useTransition:function(){return[_a(va)[0],ba().memoizedState]},useMutableSource:wa,useSyncExternalStore:Ta,useId:Ga,unstable_isNewReconciler:!1},eo={readContext:As,useCallback:Va,useContext:As,useEffect:Pa,useImperativeHandle:Ba,useInsertionEffect:Fa,useLayoutEffect:Ma,useMemo:ja,useReducer:xa,useRef:Ra,useState:function(){return xa(va)},useDebugValue:za,useDeferredValue:function(e){var t=ba();return null===oa?t.memoizedState=e:Wa(t,oa.memoizedState,e)},useTransition:function(){return[xa(va)[0],ba().memoizedState]},useMutableSource:wa,useSyncExternalStore:Ta,useId:Ga,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var io={isMounted:function(e){return!!(e=e._reactInternals)&&je(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=ec(),r=tc(e),s=Us(i,r);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Bs(e,s,r))&&(nc(t,e,r,i),zs(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=ec(),r=tc(e),s=Us(i,r);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Bs(e,s,r))&&(nc(t,e,r,i),zs(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),i=tc(e),r=Us(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Bs(e,r,i))&&(nc(t,e,i,n),zs(t,e,i))}};function ro(e,t,n,i,r,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,s))}function so(e,t,n){var i=!1,r=Ir,s=t.contextType;return"object"===typeof s&&null!==s?s=As(s):(r=Dr(t)?Ar:Er.current,s=(i=null!==(i=t.contextTypes)&&void 0!==i)?Rr(e,r):Ir),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=io,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function ao(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&io.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Fs(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=As(s):(s=Dr(t)?Ar:Er.current,r.context=Rr(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(no(e,t,s,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&io.enqueueReplaceState(r,r.state,null),js(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",i=t;do{n+=V(i),i=i.return}while(i);var r=n}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function po(e,t,n){(n=Us(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Hl||(Hl=!0,Gl=i),uo(0,t)},n}function fo(e,t,n){(n=Us(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){uo(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof i&&(null===ql?ql=new Set([this]):ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function go(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ho;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Sc.bind(null,e,t,n),t.then(e,e))}function mo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function yo(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Us(-1,1)).tag=2,Bs(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var bo=_.ReactCurrentOwner,vo=!1;function _o(e,t,n,i){t.child=null===e?xs(t,null,n,i):_s(t,e.child,n,i)}function xo(e,t,n,i,r){n=n.render;var s=t.ref;return Ns(t,r),i=ga(e,t,n,i,s,r),n=ma(),null===e||vo?(rs&&n&&es(t),t.flags|=1,_o(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function wo(e,t,n,i,r){if(null===e){var s=n.type;return"function"!==typeof s||Dc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,To(e,t,s,i,r))}if(s=e.child,0===(e.lanes&r)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&e.ref===t.ref)return Ho(e,t,r)}return t.flags|=1,(e=Oc(s,i)).ref=t.ref,e.return=t,t.child=e}function To(e,t,n,i,r){if(null!==e){var s=e.memoizedProps;if(li(s,i)&&e.ref===t.ref){if(vo=!1,t.pendingProps=i=s,0===(e.lanes&r))return t.lanes=e.lanes,Ho(e,t,r);0!==(131072&e.flags)&&(vo=!0)}}return Co(e,t,n,i,r)}function ko(e,t,n){var i=t.pendingProps,r=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Ol,Dl),Dl|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(Ol,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:n,Cr(Ol,Dl),Dl|=i}else null!==s?(i=s.baseLanes|n,t.memoizedState=null):i=n,Cr(Ol,Dl),Dl|=i;return _o(e,t,r,n),t.child}function So(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,n,i,r){var s=Dr(n)?Ar:Er.current;return s=Rr(t,s),Ns(t,r),n=ga(e,t,n,i,s,r),i=ma(),null===e||vo?(rs&&i&&es(t),t.flags|=1,_o(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function Io(e,t,n,i,r){if(Dr(n)){var s=!0;Fr(t)}else s=!1;if(Ns(t,r),null===t.stateNode)Wo(e,t),so(t,n,i),oo(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=As(c):c=Rr(t,c=Dr(n)?Ar:Er.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==i||l!==c)&&ao(t,a,i,c),Ps=!1;var d=t.memoizedState;a.state=d,js(t,i,a,r),l=t.memoizedState,o!==i||d!==l||Nr.current||Ps?("function"===typeof u&&(no(t,n,u,i),l=t.memoizedState),(o=Ps||ro(t,n,o,i,d,l,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Ms(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,h=t.pendingProps,d=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=As(l):l=Rr(t,l=Dr(n)?Ar:Er.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==h||d!==l)&&ao(t,a,i,l),Ps=!1,d=t.memoizedState,a.state=d,js(t,i,a,r);var f=t.memoizedState;o!==h||d!==f||Nr.current||Ps?("function"===typeof p&&(no(t,n,p,i),f=t.memoizedState),(c=Ps||ro(t,n,c,i,d,f,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),a.props=i,a.state=f,a.context=l,i=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Eo(e,t,n,i,s,r)}function Eo(e,t,n,i,r,s){So(e,t);var a=0!==(128&t.flags);if(!i&&!a)return r&&Mr(t,n,!1),Ho(e,t,s);i=t.stateNode,bo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=_s(t,e.child,null,s),t.child=_s(t,null,o,s)):_o(e,t,o,s),t.memoizedState=i.state,r&&Mr(t,n,!0),t.child}function No(e){var t=e.stateNode;t.pendingContext?Lr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Lr(0,t.context,!1),Ys(e,t.containerInfo)}function Ao(e,t,n,i,r){return ps(),fs(r),t.flags|=256,_o(e,t,n,i),t.child}var Ro,Do,Oo,Lo,Po={dehydrated:null,treeContext:null,retryLane:0};function Fo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Mo(e,t,n){var i,r=t.pendingProps,a=Zs.current,o=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Cr(Zs,1&a),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Fc(l,r,0,null),e=Pc(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Fo(n),t.memoizedState=Po,e):Uo(t,l));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,o){if(n)return 256&t.flags?(t.flags&=-257,Bo(e,t,o,i=co(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=Fc({mode:"visible",children:i.children},r,0,null),(a=Pc(a,r,o,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&_s(t,e.child,null,o),t.child.memoizedState=Fo(o),t.memoizedState=Po,a);if(0===(1&t.mode))return Bo(e,t,o,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Bo(e,t,o,i=co(a=Error(s(419)),i,void 0))}if(l=0!==(o&e.childLanes),vo||l){if(null!==(i=Nl)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Ls(e,r),nc(i,e,r,-1))}return gc(),Bo(e,t,o,i=co(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Ic.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,is=cr(r.nextSibling),ns=t,rs=!0,ss=null,null!==e&&(Xr[Kr++]=Qr,Xr[Kr++]=$r,Xr[Kr++]=Yr,Qr=e.id,$r=e.overflow,Yr=t),t=Uo(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,a,n);if(o){o=r.fallback,l=t.mode,i=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Oc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==i?o=Oc(i,o):(o=Pc(o,l,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?Fo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Po,r}return e=(o=e.child).sibling,r=Oc(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Uo(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,n,i){return null!==i&&fs(i),_s(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zo(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Es(e.return,t,n)}function Vo(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function jo(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(_o(e,t,i.children,n),0!==(2&(i=Zs.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zo(e,n,t);else if(19===e.tag)zo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Cr(Zs,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Vo(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ea(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Vo(t,!0,n,null,s);break;case"together":Vo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Wo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ho(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Oc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Oc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Go(e,t){if(!rs)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function qo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xo(e,t,n){var i=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(t),null;case 1:case 17:return Dr(t.type)&&Or(),qo(t),null;case 3:return i=t.stateNode,Qs(),Sr(Nr),Sr(Er),na(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(hs(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),Do(e,t),qo(t),null;case 5:Js(t);var r=Ks(Xs.current);if(n=t.type,null!==e&&null!=t.stateNode)Oo(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(s(166));return qo(t),null}if(e=Ks(Gs.current),hs(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[dr]=t,i[pr]=a,e=0!==(1&t.mode),n){case"dialog":Bi("cancel",i),Bi("close",i);break;case"iframe":case"object":case"embed":Bi("load",i);break;case"video":case"audio":for(r=0;r<Pi.length;r++)Bi(Pi[r],i);break;case"source":Bi("error",i);break;case"img":case"image":case"link":Bi("error",i),Bi("load",i);break;case"details":Bi("toggle",i);break;case"input":Q(i,a),Bi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Bi("invalid",i);break;case"textarea":re(i,a),Bi("invalid",i)}for(var l in be(n,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,c,e),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Bi("scroll",i)}switch(n){case"input":q(i),Z(i,a,!0);break;case"textarea":q(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=Zi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[dr]=t,e[pr]=i,Ro(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(n,i),n){case"dialog":Bi("cancel",e),Bi("close",e),r=i;break;case"iframe":case"object":case"embed":Bi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Pi.length;r++)Bi(Pi[r],e);r=i;break;case"source":Bi("error",e),r=i;break;case"img":case"image":case"link":Bi("error",e),Bi("load",e),r=i;break;case"details":Bi("toggle",e),r=i;break;case"input":Q(e,i),r=Y(e,i),Bi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=M({},i,{value:void 0}),Bi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Bi("invalid",e)}for(a in be(n,r),c=r)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?me(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Bi("scroll",e):null!=u&&v(e,a,u,l))}switch(n){case"input":q(e),Z(e,i,!1);break;case"textarea":q(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+H(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Zi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qo(t),null;case 6:if(e&&null!=t.stateNode)Lo(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(n=Ks(Xs.current),Ks(Gs.current),hs(t)){if(i=t.stateNode,n=t.memoizedProps,i[dr]=t,(a=i.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=t,t.stateNode=i}return qo(t),null;case 13:if(Sr(Zs),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rs&&null!==is&&0!==(1&t.mode)&&0===(128&t.flags))ds(),ps(),t.flags|=98560,a=!1;else if(a=hs(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[dr]=t}else ps(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qo(t),a=!1}else null!==ss&&(ac(ss),ss=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zs.current)?0===Ll&&(Ll=3):gc())),null!==t.updateQueue&&(t.flags|=4),qo(t),null);case 4:return Qs(),Do(e,t),null===e&&ji(t.stateNode.containerInfo),qo(t),null;case 10:return Is(t.type._context),qo(t),null;case 19:if(Sr(Zs),null===(a=t.memoizedState))return qo(t),null;if(i=0!==(128&t.flags),null===(l=a.rendering))if(i)Go(a,!1);else{if(0!==Ll||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Go(a,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Cr(Zs,1&Zs.current|2),t.child}e=e.sibling}null!==a.tail&&$e()>jl&&(t.flags|=128,i=!0,Go(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ea(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Go(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!rs)return qo(t),null}else 2*$e()-a.renderingStartTime>jl&&1073741824!==n&&(t.flags|=128,i=!0,Go(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=$e(),t.sibling=null,n=Zs.current,Cr(Zs,i?1&n|2:1&n),t):(qo(t),null);case 22:case 23:return hc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(qo(t),6&t.subtreeFlags&&(t.flags|=8192)):qo(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Ko(e,t){switch(ts(t),t.tag){case 1:return Dr(t.type)&&Or(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qs(),Sr(Nr),Sr(Er),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Js(t),null;case 13:if(Sr(Zs),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Sr(Zs),null;case 4:return Qs(),null;case 10:return Is(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Ro=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Do=function(){},Oo=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Ks(Gs.current);var s,a=null;switch(n){case"input":r=Y(e,r),i=Y(e,i),a=[];break;case"select":r=M({},r,{value:void 0}),i=M({},i,{value:void 0}),a=[];break;case"textarea":r=ie(e,r),i=ie(e,i),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=Zi)}for(u in be(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Bi("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Lo=function(e,t,n,i){n!==i&&(t.flags|=4)};var Yo=!1,Qo=!1,$o="function"===typeof WeakSet?WeakSet:Set,Jo=null;function Zo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){kc(e,t,i)}else n.current=null}function el(e,t,n){try{n()}catch(i){kc(e,t,i)}}var tl=!1;function nl(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&el(t,n,s)}r=r.next}while(r!==i)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dr],delete t[pr],delete t[gr],delete t[mr],delete t[yr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zi));else if(4!==i&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,hl=!1;function dl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,n)}catch(o){}switch(n.tag){case 5:Qo||Zo(n,t);case 6:var i=ul,r=hl;ul=null,dl(e,t,n),hl=r,null!==(ul=i)&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),jt(e)):lr(ul,n.stateNode));break;case 4:i=ul,r=hl,ul=n.stateNode.containerInfo,hl=!0,dl(e,t,n),ul=i,hl=r;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&el(n,t,a),r=r.next}while(r!==i)}dl(e,t,n);break;case 1:if(!Qo&&(Zo(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(o){kc(n,t,o)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?(Qo=(i=Qo)||null!==n.memoizedState,dl(e,t,n),Qo=i):dl(e,t,n);break;default:dl(e,t,n)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $o),t.forEach(function(t){var i=Ec.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function gl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,hl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===ul)throw Error(s(160));pl(a,o,r),ul=null,hl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){kc(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)ml(t,e),t=t.sibling}function ml(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),yl(e),4&i){try{nl(3,e,e.return),il(3,e)}catch(m){kc(e,e.return,m)}try{nl(5,e,e.return)}catch(m){kc(e,e.return,m)}}break;case 1:gl(t,e),yl(e),512&i&&null!==n&&Zo(n,n.return);break;case 5:if(gl(t,e),yl(e),512&i&&null!==n&&Zo(n,n.return),32&e.flags){var r=e.stateNode;try{de(r,"")}catch(m){kc(e,e.return,m)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&$(r,a),ve(l,o);var u=ve(l,a);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];"style"===h?me(r,d):"dangerouslySetInnerHTML"===h?he(r,d):"children"===h?de(r,d):v(r,h,d,u)}switch(l){case"input":J(r,a);break;case"textarea":se(r,a);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ne(r,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(r,!!a.multiple,a.defaultValue,!0):ne(r,!!a.multiple,a.multiple?[]:"",!1))}r[pr]=a}catch(m){kc(e,e.return,m)}}break;case 6:if(gl(t,e),yl(e),4&i){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(m){kc(e,e.return,m)}}break;case 3:if(gl(t,e),yl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{jt(t.containerInfo)}catch(m){kc(e,e.return,m)}break;case 4:default:gl(t,e),yl(e);break;case 13:gl(t,e),yl(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Vl=$e())),4&i&&fl(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Qo=(u=Qo)||h,gl(t,e),Qo=u):gl(t,e),yl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Jo=e,h=e.child;null!==h;){for(d=Jo=h;null!==Jo;){switch(f=(p=Jo).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Zo(p,p.return);var g=p.stateNode;if("function"===typeof g.componentWillUnmount){i=p,n=p.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(m){kc(i,n,m)}}break;case 5:Zo(p,p.return);break;case 22:if(null!==p.memoizedState){xl(d);continue}}null!==f?(f.return=p,Jo=f):xl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,o=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=ge("display",o))}catch(m){kc(e,e.return,m)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){kc(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gl(t,e),yl(e),4&i&&fl(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var i=n;break e}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(de(r,""),i.flags&=-33),cl(e,ol(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(s(161))}}catch(o){kc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bl(e,t,n){Jo=e,vl(e,t,n)}function vl(e,t,n){for(var i=0!==(1&e.mode);null!==Jo;){var r=Jo,s=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||Yo;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Qo;o=Yo;var c=Qo;if(Yo=a,(Qo=l)&&!c)for(Jo=r;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?wl(r):null!==l?(l.return=a,Jo=l):wl(r);for(;null!==s;)Jo=s,vl(s,t,n),s=s.sibling;Jo=r,Yo=o,Qo=c}_l(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,Jo=s):_l(e)}}function _l(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||il(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Qo)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Ws(t,a,i);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ws(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&jt(d)}}}break;default:throw Error(s(163))}Qo||512&t.flags&&rl(t)}catch(p){kc(t,t.return,p)}}if(t===e){Jo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jo=n;break}Jo=t.return}}function xl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Jo=n;break}Jo=t.return}}function wl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(l){kc(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){kc(t,r,l)}}var s=t.return;try{rl(t)}catch(l){kc(t,s,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){kc(t,a,l)}}}catch(l){kc(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var Tl,kl=Math.ceil,Sl=_.ReactCurrentDispatcher,Cl=_.ReactCurrentOwner,Il=_.ReactCurrentBatchConfig,El=0,Nl=null,Al=null,Rl=0,Dl=0,Ol=kr(0),Ll=0,Pl=null,Fl=0,Ml=0,Ul=0,Bl=null,zl=null,Vl=0,jl=1/0,Wl=null,Hl=!1,Gl=null,ql=null,Xl=!1,Kl=null,Yl=0,Ql=0,$l=null,Jl=-1,Zl=0;function ec(){return 0!==(6&El)?$e():-1!==Jl?Jl:Jl=$e()}function tc(e){return 0===(1&e.mode)?1:0!==(2&El)&&0!==Rl?Rl&-Rl:null!==gs.transition?(0===Zl&&(Zl=gt()),Zl):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nc(e,t,n,i){if(50<Ql)throw Ql=0,$l=null,Error(s(185));yt(e,n,i),0!==(2&El)&&e===Nl||(e===Nl&&(0===(2&El)&&(Ml|=n),4===Ll&&oc(e,Rl)),ic(e,i),1===n&&0===El&&0===(1&t.mode)&&(jl=$e()+500,Br&&jr()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-at(s),o=1<<a,l=r[a];-1===l?0!==(o&n)&&0===(o&i)||(r[a]=pt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var i=dt(e,e===Nl?Rl:0);if(0===i)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Br=!0,Vr(e)}(lc.bind(null,e)):Vr(lc.bind(null,e)),ar(function(){0===(6&El)&&jr()}),n=null;else{switch(_t(i)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Nc(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Jl=-1,Zl=0,0!==(6&El))throw Error(s(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var i=dt(e,e===Nl?Rl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=mc(e,i);else{t=i;var r=El;El|=2;var a=fc();for(Nl===e&&Rl===t||(Wl=null,jl=$e()+500,dc(e,t));;)try{bc();break}catch(l){pc(e,l)}Cs(),Sl.current=a,El=r,null!==Al?t=0:(Nl=null,Rl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(i=r,t=sc(e,r))),1===t)throw n=Pl,dc(e,0),oc(e,i),ic(e,$e()),n;if(6===t)oc(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!oi(s(),r))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=mc(e,i))&&(0!==(a=ft(e))&&(i=a,t=sc(e,a))),1===t))throw n=Pl,dc(e,0),oc(e,i),ic(e,$e()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(s(345));case 2:case 5:xc(e,zl,Wl);break;case 3:if(oc(e,i),(130023424&i)===i&&10<(t=Vl+500-$e())){if(0!==dt(e,0))break;if(((r=e.suspendedLanes)&i)!==i){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(xc.bind(null,e,zl,Wl),t);break}xc(e,zl,Wl);break;case 4:if(oc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var o=31-at(i);a=1<<o,(o=t[o])>r&&(r=o),i&=~a}if(i=r,10<(i=(120>(i=$e()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*kl(i/1960))-i)){e.timeoutHandle=ir(xc.bind(null,e,zl,Wl),i);break}xc(e,zl,Wl);break;default:throw Error(s(329))}}}return ic(e,$e()),e.callbackNode===n?rc.bind(null,e):null}function sc(e,t){var n=Bl;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=zl,zl=n,null!==t&&ac(t)),e}function ac(e){null===zl?zl=e:zl.push.apply(zl,e)}function oc(e,t){for(t&=~Ul,t&=~Ml,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function lc(e){if(0!==(6&El))throw Error(s(327));wc();var t=dt(e,0);if(0===(1&t))return ic(e,$e()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=sc(e,i))}if(1===n)throw n=Pl,dc(e,0),oc(e,t),ic(e,$e()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,zl,Wl),ic(e,$e()),null}function cc(e,t){var n=El;El|=1;try{return e(t)}finally{0===(El=n)&&(jl=$e()+500,Br&&jr())}}function uc(e){null!==Kl&&0===Kl.tag&&0===(6&El)&&wc();var t=El;El|=1;var n=Il.transition,i=vt;try{if(Il.transition=null,vt=1,e)return e()}finally{vt=i,Il.transition=n,0===(6&(El=t))&&jr()}}function hc(){Dl=Ol.current,Sr(Ol)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Al)for(n=Al.return;null!==n;){var i=n;switch(ts(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Or();break;case 3:Qs(),Sr(Nr),Sr(Er),na();break;case 5:Js(i);break;case 4:Qs();break;case 13:case 19:Sr(Zs);break;case 10:Is(i.type._context);break;case 22:case 23:hc()}n=n.return}if(Nl=e,Al=e=Oc(e.current,null),Rl=Dl=t,Ll=0,Pl=null,Ul=Ml=Fl=0,zl=Bl=null,null!==Rs){for(t=0;t<Rs.length;t++)if(null!==(i=(n=Rs[t]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var a=s.next;s.next=r,i.next=a}n.pending=i}Rs=null}return e}function pc(e,t){for(;;){var n=Al;try{if(Cs(),ia.current=$a,ca){for(var i=aa.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ca=!1}if(sa=0,la=oa=aa=null,ua=!1,ha=0,Cl.current=null,null===n||null===n.return){Ll=1,Pl=t,Al=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Rl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=mo(o);if(null!==f){f.flags&=-257,yo(f,o,l,0,t),1&f.mode&&go(a,u,t),c=u;var g=(t=f).updateQueue;if(null===g){var m=new Set;m.add(c),t.updateQueue=m}else g.add(c);break e}if(0===(1&t)){go(a,u,t),gc();break e}c=Error(s(426))}else if(rs&&1&l.mode){var y=mo(o);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),yo(y,o,l,0,t),fs(lo(c,l));break e}}a=c=lo(c,l),4!==Ll&&(Ll=2),null===Bl?Bl=[a]:Bl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Vs(a,po(0,c,t));break e;case 1:l=c;var b=a.type,v=a.stateNode;if(0===(128&a.flags)&&("function"===typeof b.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===ql||!ql.has(v)))){a.flags|=65536,t&=-t,a.lanes|=t,Vs(a,fo(a,l,t));break e}}a=a.return}while(null!==a)}_c(n)}catch(_){t=_,Al===n&&null!==n&&(Al=n=n.return);continue}break}}function fc(){var e=Sl.current;return Sl.current=$a,null===e?$a:e}function gc(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===Nl||0===(268435455&Fl)&&0===(268435455&Ml)||oc(Nl,Rl)}function mc(e,t){var n=El;El|=2;var i=fc();for(Nl===e&&Rl===t||(Wl=null,dc(e,t));;)try{yc();break}catch(r){pc(e,r)}if(Cs(),El=n,Sl.current=i,null!==Al)throw Error(s(261));return Nl=null,Rl=0,Ll}function yc(){for(;null!==Al;)vc(Al)}function bc(){for(;null!==Al&&!Ye();)vc(Al)}function vc(e){var t=Tl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?_c(e):Al=t,Cl.current=null}function _c(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xo(n,t,Dl)))return void(Al=n)}else{if(null!==(n=Ko(n,t)))return n.flags&=32767,void(Al=n);if(null===e)return Ll=6,void(Al=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Al=t);Al=t=e}while(null!==t);0===Ll&&(Ll=5)}function xc(e,t,n){var i=vt,r=Il.transition;try{Il.transition=null,vt=1,function(e,t,n,i){do{wc()}while(null!==Kl);if(0!==(6&El))throw Error(s(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),s=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~s}}(e,a),e===Nl&&(Al=Nl=null,Rl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xl||(Xl=!0,Nc(tt,function(){return wc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Il.transition,Il.transition=null;var o=vt;vt=1;var l=El;El|=4,Cl.current=null,function(e,t){if(er=Ht,pi(e=di())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(x){n=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=o+r),d!==a||0!==i&&3!==d.nodeType||(c=o+i),3===d.nodeType&&(o+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===r&&(l=o),p===a&&++h===i&&(c=o),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Ht=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,y=g.memoizedState,b=t.stateNode,v=b.getSnapshotBeforeUpdate(t.elementType===t.type?m:to(t.type,m),y);b.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(s(163))}}catch(x){kc(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}g=tl,tl=!1}(e,n),ml(n,e),fi(tr),Ht=!!er,tr=er=null,e.current=n,bl(n,e,r),Qe(),El=l,vt=o,Il.transition=a}else e.current=n;if(Xl&&(Xl=!1,Kl=e,Yl=r),a=e.pendingLanes,0===a&&(ql=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,$e()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Hl)throw Hl=!1,e=Gl,Gl=null,e;0!==(1&Yl)&&0!==e.tag&&wc(),a=e.pendingLanes,0!==(1&a)?e===$l?Ql++:(Ql=0,$l=e):Ql=0,jr()}(e,t,n,i)}finally{Il.transition=r,vt=i}return null}function wc(){if(null!==Kl){var e=_t(Yl),t=Il.transition,n=vt;try{if(Il.transition=null,vt=16>e?16:e,null===Kl)var i=!1;else{if(e=Kl,Kl=null,Yl=0,0!==(6&El))throw Error(s(331));var r=El;for(El|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(0!==(16&Jo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Jo=u;null!==Jo;){var h=Jo;switch(h.tag){case 0:case 11:case 15:nl(8,h,a)}var d=h.child;if(null!==d)d.return=h,Jo=d;else for(;null!==Jo;){var p=(h=Jo).sibling,f=h.return;if(sl(h),h===u){Jo=null;break}if(null!==p){p.return=f,Jo=p;break}Jo=f}}}var g=a.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(null!==m)}}Jo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(a=Jo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var b=a.sibling;if(null!==b){b.return=a.return,Jo=b;break e}Jo=a.return}}var v=e.current;for(Jo=v;null!==Jo;){var _=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==_)_.return=o,Jo=_;else e:for(o=v;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(w){kc(l,l.return,w)}if(l===o){Jo=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Jo=x;break e}Jo=l.return}}if(El=r,jr(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(w){}i=!0}return i}finally{vt=n,Il.transition=t}}return!1}function Tc(e,t,n){e=Bs(e,t=po(0,t=lo(n,t),1),1),t=ec(),null!==e&&(yt(e,1,t),ic(e,t))}function kc(e,t,n){if(3===e.tag)Tc(e,e,n);else for(;null!==t;){if(3===t.tag){Tc(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===ql||!ql.has(i))){t=Bs(t,e=fo(t,e=lo(n,e),1),1),e=ec(),null!==t&&(yt(t,1,e),ic(t,e));break}}t=t.return}}function Sc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Nl===e&&(Rl&n)===n&&(4===Ll||3===Ll&&(130023424&Rl)===Rl&&500>$e()-Vl?dc(e,0):Ul|=n),ic(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Ls(e,t))&&(yt(e,t,n),ic(e,n))}function Ic(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Ec(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(t),Cc(e,n)}function Nc(e,t){return Xe(e,t)}function Ac(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,n,i){return new Ac(e,t,n,i)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oc(e,t){var n=e.alternate;return null===n?((n=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lc(e,t,n,i,r,a){var o=2;if(i=e,"function"===typeof e)Dc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case T:return Pc(n.children,r,a,t);case k:o=8,r|=8;break;case S:return(e=Rc(12,n,t,2|r)).elementType=S,e.lanes=a,e;case N:return(e=Rc(13,n,t,r)).elementType=N,e.lanes=a,e;case A:return(e=Rc(19,n,t,r)).elementType=A,e.lanes=a,e;case O:return Fc(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:o=10;break e;case I:o=9;break e;case E:o=11;break e;case R:o=14;break e;case D:o=16,i=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Rc(o,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Pc(e,t,n,i){return(e=Rc(7,e,i,t)).lanes=n,e}function Fc(e,t,n,i){return(e=Rc(22,e,i,t)).elementType=O,e.lanes=n,e.stateNode={isHidden:!1},e}function Mc(e,t,n){return(e=Rc(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function zc(e,t,n,i,r,s,a,o,l){return e=new Bc(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Rc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fs(s),e}function Vc(e){if(!e)return Ir;e:{if(je(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Dr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Dr(n))return Pr(e,n,t)}return t}function jc(e,t,n,i,r,s,a,o,l){return(e=zc(n,i,!0,e,0,s,0,o,l)).context=Vc(null),n=e.current,(s=Us(i=ec(),r=tc(n))).callback=void 0!==t&&null!==t?t:null,Bs(n,s,r),e.current.lanes=r,yt(e,r,i),ic(e,i),e}function Wc(e,t,n,i){var r=t.current,s=ec(),a=tc(r);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Us(s,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Bs(r,t,a))&&(nc(e,r,a,s),zs(e,r,a)),a}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function qc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}Tl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Nr.current)vo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return vo=!1,function(e,t,n){switch(t.tag){case 3:No(t),ps();break;case 5:$s(t);break;case 1:Dr(t.type)&&Fr(t);break;case 4:Ys(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Cr(ws,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Cr(Zs,1&Zs.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Mo(e,t,n):(Cr(Zs,1&Zs.current),null!==(e=Ho(e,t,n))?e.sibling:null);Cr(Zs,1&Zs.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return jo(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr(Zs,Zs.current),i)break;return null;case 22:case 23:return t.lanes=0,ko(e,t,n)}return Ho(e,t,n)}(e,t,n);vo=0!==(131072&e.flags)}else vo=!1,rs&&0!==(1048576&t.flags)&&Zr(t,qr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Wo(e,t),e=t.pendingProps;var r=Rr(t,Er.current);Ns(t,n),r=ga(null,t,i,e,r,n);var a=ma();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Dr(i)?(a=!0,Fr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Fs(t),r.updater=io,t.stateNode=r,r._reactInternals=t,oo(t,i,e,n),t=Eo(null,t,i,!0,a,n)):(t.tag=0,rs&&a&&es(t),_o(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Wo(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===R)return 14}return 2}(i),e=to(i,e),r){case 0:t=Co(null,t,i,e,n);break e;case 1:t=Io(null,t,i,e,n);break e;case 11:t=xo(null,t,i,e,n);break e;case 14:t=wo(null,t,i,to(i.type,e),n);break e}throw Error(s(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Co(e,t,i,r=t.elementType===i?r:to(i,r),n);case 1:return i=t.type,r=t.pendingProps,Io(e,t,i,r=t.elementType===i?r:to(i,r),n);case 3:e:{if(No(t),null===e)throw Error(s(387));i=t.pendingProps,r=(a=t.memoizedState).element,Ms(e,t),js(t,i,null,n);var o=t.memoizedState;if(i=o.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ao(e,t,i,n,r=lo(Error(s(423)),t));break e}if(i!==r){t=Ao(e,t,i,n,r=lo(Error(s(424)),t));break e}for(is=cr(t.stateNode.containerInfo.firstChild),ns=t,rs=!0,ss=null,n=xs(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ps(),i===r){t=Ho(e,t,n);break e}_o(e,t,i,n)}t=t.child}return t;case 5:return $s(t),null===e&&cs(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,nr(i,r)?o=null:null!==a&&nr(i,a)&&(t.flags|=32),So(e,t),_o(e,t,o,n),t.child;case 6:return null===e&&cs(t),null;case 13:return Mo(e,t,n);case 4:return Ys(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=_s(t,null,i,n):_o(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,xo(e,t,i,r=t.elementType===i?r:to(i,r),n);case 7:return _o(e,t,t.pendingProps,n),t.child;case 8:case 12:return _o(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,Cr(ws,i._currentValue),i._currentValue=o,null!==a)if(oi(a.value,o)){if(a.children===r.children&&!Nr.current){t=Ho(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=Us(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Es(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Es(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}_o(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Ns(t,n),i=i(r=As(r)),t.flags|=1,_o(e,t,i,n),t.child;case 14:return r=to(i=t.type,t.pendingProps),wo(e,t,i,r=to(i.type,r),n);case 15:return To(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:to(i,r),Wo(e,t),t.tag=1,Dr(i)?(e=!0,Fr(t)):e=!1,Ns(t,n),so(t,i,r),oo(t,i,r,n),Eo(null,t,i,!0,e,n);case 19:return jo(e,t,n);case 22:return ko(e,t,n)}throw Error(s(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Zc(e,t,n,i,r){var s=n._reactRootContainer;if(s){var a=s;if("function"===typeof r){var o=r;r=function(){var e=Hc(a);o.call(e)}}Wc(t,a,e,r)}else a=function(e,t,n,i,r){if(r){if("function"===typeof i){var s=i;i=function(){var e=Hc(a);s.call(e)}}var a=jc(t,i,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[fr]=a.current,ji(8===e.nodeType?e.parentNode:e),uc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var o=i;i=function(){var e=Hc(l);o.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fr]=l.current,ji(8===e.nodeType?e.parentNode:e),uc(function(){Wc(t,l,n,i)}),l}(n,t,e,r,i);return Hc(a)}Yc.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Wc(e,t,null,null)},Yc.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Wc(null,e,null,null)}),t[fr]=null}},Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ot.length&&0!==t&&t<Ot[n].priority;n++);Ot.splice(n,0,e),0===n&&Mt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(bt(t,1|n),ic(t,$e()),0===(6&El)&&(jl=$e()+500,jr()))}break;case 13:uc(function(){var t=Ls(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),qc(e,1)}},wt=function(e){if(13===e.tag){var t=Ls(e,134217728);if(null!==t)nc(t,e,134217728,ec());qc(e,134217728)}},Tt=function(e){if(13===e.tag){var t=tc(e),n=Ls(e,t);if(null!==n)nc(n,e,t,ec());qc(e,t)}},kt=function(){return vt},St=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=xr(i);if(!r)throw Error(s(90));X(i),J(i,r)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=cc,Ne=uc;var eu={usingClientEntryPoint:!1,Events:[vr,_r,xr,Ce,Ie,cc]},tu={findFiberByHostInstance:br,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{rt=iu.inject(nu),st=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(s(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(s(299));var n=!1,i="",r=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=zc(e,1,!1,null,0,n,0,i,r),e[fr]=t.current,ji(8===e.nodeType?e.parentNode:e),new Kc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!$c(t))throw Error(s(200));return Zc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",o=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=jc(t,null,e,1,null!=n?n:null,r,0,a,o),e[fr]=t.current,ji(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Yc(t)},t.render=function(e,t,n){if(!$c(t))throw Error(s(200));return Zc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!$c(e))throw Error(s(40));return!!e._reactRootContainer&&(uc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[fr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!$c(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return Zc(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},352:(e,t,n)=>{"use strict";var i=n(119);t.H=i.createRoot,i.hydrateRoot},356:e=>{var t,n,i,r,s,a,o,l=9e4;t=function(e){return e*l},n=function(e,t){return e*t},i=function(e){return e/l},r=function(e,t){return e/t},s=function(e,n){return t(r(e,n))},a=function(e,t){return n(i(e),t)},o=function(e,t,n){return i(n?e:e-t)},e.exports={ONE_SECOND_IN_TS:l,secondsToVideoTs:t,secondsToAudioTs:n,videoTsToSeconds:i,audioTsToSeconds:r,audioTsToVideoTs:s,videoTsToAudioTs:a,metadataTsToSeconds:o}},414:(e,t,n)=>{"use strict";e.exports=n(654)},489:(e,t,n)=>{"use strict";var i=n(132).freeze;t.XML_ENTITIES=i({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),t.HTML_ENTITIES=i({Aacute:"\xc1",aacute:"\xe1",Abreve:"\u0102",abreve:"\u0103",ac:"\u223e",acd:"\u223f",acE:"\u223e\u0333",Acirc:"\xc2",acirc:"\xe2",acute:"\xb4",Acy:"\u0410",acy:"\u0430",AElig:"\xc6",aelig:"\xe6",af:"\u2061",Afr:"\ud835\udd04",afr:"\ud835\udd1e",Agrave:"\xc0",agrave:"\xe0",alefsym:"\u2135",aleph:"\u2135",Alpha:"\u0391",alpha:"\u03b1",Amacr:"\u0100",amacr:"\u0101",amalg:"\u2a3f",AMP:"&",amp:"&",And:"\u2a53",and:"\u2227",andand:"\u2a55",andd:"\u2a5c",andslope:"\u2a58",andv:"\u2a5a",ang:"\u2220",ange:"\u29a4",angle:"\u2220",angmsd:"\u2221",angmsdaa:"\u29a8",angmsdab:"\u29a9",angmsdac:"\u29aa",angmsdad:"\u29ab",angmsdae:"\u29ac",angmsdaf:"\u29ad",angmsdag:"\u29ae",angmsdah:"\u29af",angrt:"\u221f",angrtvb:"\u22be",angrtvbd:"\u299d",angsph:"\u2222",angst:"\xc5",angzarr:"\u237c",Aogon:"\u0104",aogon:"\u0105",Aopf:"\ud835\udd38",aopf:"\ud835\udd52",ap:"\u2248",apacir:"\u2a6f",apE:"\u2a70",ape:"\u224a",apid:"\u224b",apos:"'",ApplyFunction:"\u2061",approx:"\u2248",approxeq:"\u224a",Aring:"\xc5",aring:"\xe5",Ascr:"\ud835\udc9c",ascr:"\ud835\udcb6",Assign:"\u2254",ast:"*",asymp:"\u2248",asympeq:"\u224d",Atilde:"\xc3",atilde:"\xe3",Auml:"\xc4",auml:"\xe4",awconint:"\u2233",awint:"\u2a11",backcong:"\u224c",backepsilon:"\u03f6",backprime:"\u2035",backsim:"\u223d",backsimeq:"\u22cd",Backslash:"\u2216",Barv:"\u2ae7",barvee:"\u22bd",Barwed:"\u2306",barwed:"\u2305",barwedge:"\u2305",bbrk:"\u23b5",bbrktbrk:"\u23b6",bcong:"\u224c",Bcy:"\u0411",bcy:"\u0431",bdquo:"\u201e",becaus:"\u2235",Because:"\u2235",because:"\u2235",bemptyv:"\u29b0",bepsi:"\u03f6",bernou:"\u212c",Bernoullis:"\u212c",Beta:"\u0392",beta:"\u03b2",beth:"\u2136",between:"\u226c",Bfr:"\ud835\udd05",bfr:"\ud835\udd1f",bigcap:"\u22c2",bigcirc:"\u25ef",bigcup:"\u22c3",bigodot:"\u2a00",bigoplus:"\u2a01",bigotimes:"\u2a02",bigsqcup:"\u2a06",bigstar:"\u2605",bigtriangledown:"\u25bd",bigtriangleup:"\u25b3",biguplus:"\u2a04",bigvee:"\u22c1",bigwedge:"\u22c0",bkarow:"\u290d",blacklozenge:"\u29eb",blacksquare:"\u25aa",blacktriangle:"\u25b4",blacktriangledown:"\u25be",blacktriangleleft:"\u25c2",blacktriangleright:"\u25b8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20e5",bnequiv:"\u2261\u20e5",bNot:"\u2aed",bnot:"\u2310",Bopf:"\ud835\udd39",bopf:"\ud835\udd53",bot:"\u22a5",bottom:"\u22a5",bowtie:"\u22c8",boxbox:"\u29c9",boxDL:"\u2557",boxDl:"\u2556",boxdL:"\u2555",boxdl:"\u2510",boxDR:"\u2554",boxDr:"\u2553",boxdR:"\u2552",boxdr:"\u250c",boxH:"\u2550",boxh:"\u2500",boxHD:"\u2566",boxHd:"\u2564",boxhD:"\u2565",boxhd:"\u252c",boxHU:"\u2569",boxHu:"\u2567",boxhU:"\u2568",boxhu:"\u2534",boxminus:"\u229f",boxplus:"\u229e",boxtimes:"\u22a0",boxUL:"\u255d",boxUl:"\u255c",boxuL:"\u255b",boxul:"\u2518",boxUR:"\u255a",boxUr:"\u2559",boxuR:"\u2558",boxur:"\u2514",boxV:"\u2551",boxv:"\u2502",boxVH:"\u256c",boxVh:"\u256b",boxvH:"\u256a",boxvh:"\u253c",boxVL:"\u2563",boxVl:"\u2562",boxvL:"\u2561",boxvl:"\u2524",boxVR:"\u2560",boxVr:"\u255f",boxvR:"\u255e",boxvr:"\u251c",bprime:"\u2035",Breve:"\u02d8",breve:"\u02d8",brvbar:"\xa6",Bscr:"\u212c",bscr:"\ud835\udcb7",bsemi:"\u204f",bsim:"\u223d",bsime:"\u22cd",bsol:"\\",bsolb:"\u29c5",bsolhsub:"\u27c8",bull:"\u2022",bullet:"\u2022",bump:"\u224e",bumpE:"\u2aae",bumpe:"\u224f",Bumpeq:"\u224e",bumpeq:"\u224f",Cacute:"\u0106",cacute:"\u0107",Cap:"\u22d2",cap:"\u2229",capand:"\u2a44",capbrcup:"\u2a49",capcap:"\u2a4b",capcup:"\u2a47",capdot:"\u2a40",CapitalDifferentialD:"\u2145",caps:"\u2229\ufe00",caret:"\u2041",caron:"\u02c7",Cayleys:"\u212d",ccaps:"\u2a4d",Ccaron:"\u010c",ccaron:"\u010d",Ccedil:"\xc7",ccedil:"\xe7",Ccirc:"\u0108",ccirc:"\u0109",Cconint:"\u2230",ccups:"\u2a4c",ccupssm:"\u2a50",Cdot:"\u010a",cdot:"\u010b",cedil:"\xb8",Cedilla:"\xb8",cemptyv:"\u29b2",cent:"\xa2",CenterDot:"\xb7",centerdot:"\xb7",Cfr:"\u212d",cfr:"\ud835\udd20",CHcy:"\u0427",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",Chi:"\u03a7",chi:"\u03c7",cir:"\u25cb",circ:"\u02c6",circeq:"\u2257",circlearrowleft:"\u21ba",circlearrowright:"\u21bb",circledast:"\u229b",circledcirc:"\u229a",circleddash:"\u229d",CircleDot:"\u2299",circledR:"\xae",circledS:"\u24c8",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",cirE:"\u29c3",cire:"\u2257",cirfnint:"\u2a10",cirmid:"\u2aef",cirscir:"\u29c2",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201d",CloseCurlyQuote:"\u2019",clubs:"\u2663",clubsuit:"\u2663",Colon:"\u2237",colon:":",Colone:"\u2a74",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2a6d",Congruent:"\u2261",Conint:"\u222f",conint:"\u222e",ContourIntegral:"\u222e",Copf:"\u2102",copf:"\ud835\udd54",coprod:"\u2210",Coproduct:"\u2210",COPY:"\xa9",copy:"\xa9",copysr:"\u2117",CounterClockwiseContourIntegral:"\u2233",crarr:"\u21b5",Cross:"\u2a2f",cross:"\u2717",Cscr:"\ud835\udc9e",cscr:"\ud835\udcb8",csub:"\u2acf",csube:"\u2ad1",csup:"\u2ad0",csupe:"\u2ad2",ctdot:"\u22ef",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22de",cuesc:"\u22df",cularr:"\u21b6",cularrp:"\u293d",Cup:"\u22d3",cup:"\u222a",cupbrcap:"\u2a48",CupCap:"\u224d",cupcap:"\u2a46",cupcup:"\u2a4a",cupdot:"\u228d",cupor:"\u2a45",cups:"\u222a\ufe00",curarr:"\u21b7",curarrm:"\u293c",curlyeqprec:"\u22de",curlyeqsucc:"\u22df",curlyvee:"\u22ce",curlywedge:"\u22cf",curren:"\xa4",curvearrowleft:"\u21b6",curvearrowright:"\u21b7",cuvee:"\u22ce",cuwed:"\u22cf",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232d",Dagger:"\u2021",dagger:"\u2020",daleth:"\u2138",Darr:"\u21a1",dArr:"\u21d3",darr:"\u2193",dash:"\u2010",Dashv:"\u2ae4",dashv:"\u22a3",dbkarow:"\u290f",dblac:"\u02dd",Dcaron:"\u010e",dcaron:"\u010f",Dcy:"\u0414",dcy:"\u0434",DD:"\u2145",dd:"\u2146",ddagger:"\u2021",ddarr:"\u21ca",DDotrahd:"\u2911",ddotseq:"\u2a77",deg:"\xb0",Del:"\u2207",Delta:"\u0394",delta:"\u03b4",demptyv:"\u29b1",dfisht:"\u297f",Dfr:"\ud835\udd07",dfr:"\ud835\udd21",dHar:"\u2965",dharl:"\u21c3",dharr:"\u21c2",DiacriticalAcute:"\xb4",DiacriticalDot:"\u02d9",DiacriticalDoubleAcute:"\u02dd",DiacriticalGrave:"`",DiacriticalTilde:"\u02dc",diam:"\u22c4",Diamond:"\u22c4",diamond:"\u22c4",diamondsuit:"\u2666",diams:"\u2666",die:"\xa8",DifferentialD:"\u2146",digamma:"\u03dd",disin:"\u22f2",div:"\xf7",divide:"\xf7",divideontimes:"\u22c7",divonx:"\u22c7",DJcy:"\u0402",djcy:"\u0452",dlcorn:"\u231e",dlcrop:"\u230d",dollar:"$",Dopf:"\ud835\udd3b",dopf:"\ud835\udd55",Dot:"\xa8",dot:"\u02d9",DotDot:"\u20dc",doteq:"\u2250",doteqdot:"\u2251",DotEqual:"\u2250",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22a1",doublebarwedge:"\u2306",DoubleContourIntegral:"\u222f",DoubleDot:"\xa8",DoubleDownArrow:"\u21d3",DoubleLeftArrow:"\u21d0",DoubleLeftRightArrow:"\u21d4",DoubleLeftTee:"\u2ae4",DoubleLongLeftArrow:"\u27f8",DoubleLongLeftRightArrow:"\u27fa",DoubleLongRightArrow:"\u27f9",DoubleRightArrow:"\u21d2",DoubleRightTee:"\u22a8",DoubleUpArrow:"\u21d1",DoubleUpDownArrow:"\u21d5",DoubleVerticalBar:"\u2225",DownArrow:"\u2193",Downarrow:"\u21d3",downarrow:"\u2193",DownArrowBar:"\u2913",DownArrowUpArrow:"\u21f5",DownBreve:"\u0311",downdownarrows:"\u21ca",downharpoonleft:"\u21c3",downharpoonright:"\u21c2",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295e",DownLeftVector:"\u21bd",DownLeftVectorBar:"\u2956",DownRightTeeVector:"\u295f",DownRightVector:"\u21c1",DownRightVectorBar:"\u2957",DownTee:"\u22a4",DownTeeArrow:"\u21a7",drbkarow:"\u2910",drcorn:"\u231f",drcrop:"\u230c",Dscr:"\ud835\udc9f",dscr:"\ud835\udcb9",DScy:"\u0405",dscy:"\u0455",dsol:"\u29f6",Dstrok:"\u0110",dstrok:"\u0111",dtdot:"\u22f1",dtri:"\u25bf",dtrif:"\u25be",duarr:"\u21f5",duhar:"\u296f",dwangle:"\u29a6",DZcy:"\u040f",dzcy:"\u045f",dzigrarr:"\u27ff",Eacute:"\xc9",eacute:"\xe9",easter:"\u2a6e",Ecaron:"\u011a",ecaron:"\u011b",ecir:"\u2256",Ecirc:"\xca",ecirc:"\xea",ecolon:"\u2255",Ecy:"\u042d",ecy:"\u044d",eDDot:"\u2a77",Edot:"\u0116",eDot:"\u2251",edot:"\u0117",ee:"\u2147",efDot:"\u2252",Efr:"\ud835\udd08",efr:"\ud835\udd22",eg:"\u2a9a",Egrave:"\xc8",egrave:"\xe8",egs:"\u2a96",egsdot:"\u2a98",el:"\u2a99",Element:"\u2208",elinters:"\u23e7",ell:"\u2113",els:"\u2a95",elsdot:"\u2a97",Emacr:"\u0112",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",EmptySmallSquare:"\u25fb",emptyv:"\u2205",EmptyVerySmallSquare:"\u25ab",emsp:"\u2003",emsp13:"\u2004",emsp14:"\u2005",ENG:"\u014a",eng:"\u014b",ensp:"\u2002",Eogon:"\u0118",eogon:"\u0119",Eopf:"\ud835\udd3c",eopf:"\ud835\udd56",epar:"\u22d5",eparsl:"\u29e3",eplus:"\u2a71",epsi:"\u03b5",Epsilon:"\u0395",epsilon:"\u03b5",epsiv:"\u03f5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2a96",eqslantless:"\u2a95",Equal:"\u2a75",equals:"=",EqualTilde:"\u2242",equest:"\u225f",Equilibrium:"\u21cc",equiv:"\u2261",equivDD:"\u2a78",eqvparsl:"\u29e5",erarr:"\u2971",erDot:"\u2253",Escr:"\u2130",escr:"\u212f",esdot:"\u2250",Esim:"\u2a73",esim:"\u2242",Eta:"\u0397",eta:"\u03b7",ETH:"\xd0",eth:"\xf0",Euml:"\xcb",euml:"\xeb",euro:"\u20ac",excl:"!",exist:"\u2203",Exists:"\u2203",expectation:"\u2130",ExponentialE:"\u2147",exponentiale:"\u2147",fallingdotseq:"\u2252",Fcy:"\u0424",fcy:"\u0444",female:"\u2640",ffilig:"\ufb03",fflig:"\ufb00",ffllig:"\ufb04",Ffr:"\ud835\udd09",ffr:"\ud835\udd23",filig:"\ufb01",FilledSmallSquare:"\u25fc",FilledVerySmallSquare:"\u25aa",fjlig:"fj",flat:"\u266d",fllig:"\ufb02",fltns:"\u25b1",fnof:"\u0192",Fopf:"\ud835\udd3d",fopf:"\ud835\udd57",ForAll:"\u2200",forall:"\u2200",fork:"\u22d4",forkv:"\u2ad9",Fouriertrf:"\u2131",fpartint:"\u2a0d",frac12:"\xbd",frac13:"\u2153",frac14:"\xbc",frac15:"\u2155",frac16:"\u2159",frac18:"\u215b",frac23:"\u2154",frac25:"\u2156",frac34:"\xbe",frac35:"\u2157",frac38:"\u215c",frac45:"\u2158",frac56:"\u215a",frac58:"\u215d",frac78:"\u215e",frasl:"\u2044",frown:"\u2322",Fscr:"\u2131",fscr:"\ud835\udcbb",gacute:"\u01f5",Gamma:"\u0393",gamma:"\u03b3",Gammad:"\u03dc",gammad:"\u03dd",gap:"\u2a86",Gbreve:"\u011e",gbreve:"\u011f",Gcedil:"\u0122",Gcirc:"\u011c",gcirc:"\u011d",Gcy:"\u0413",gcy:"\u0433",Gdot:"\u0120",gdot:"\u0121",gE:"\u2267",ge:"\u2265",gEl:"\u2a8c",gel:"\u22db",geq:"\u2265",geqq:"\u2267",geqslant:"\u2a7e",ges:"\u2a7e",gescc:"\u2aa9",gesdot:"\u2a80",gesdoto:"\u2a82",gesdotol:"\u2a84",gesl:"\u22db\ufe00",gesles:"\u2a94",Gfr:"\ud835\udd0a",gfr:"\ud835\udd24",Gg:"\u22d9",gg:"\u226b",ggg:"\u22d9",gimel:"\u2137",GJcy:"\u0403",gjcy:"\u0453",gl:"\u2277",gla:"\u2aa5",glE:"\u2a92",glj:"\u2aa4",gnap:"\u2a8a",gnapprox:"\u2a8a",gnE:"\u2269",gne:"\u2a88",gneq:"\u2a88",gneqq:"\u2269",gnsim:"\u22e7",Gopf:"\ud835\udd3e",gopf:"\ud835\udd58",grave:"`",GreaterEqual:"\u2265",GreaterEqualLess:"\u22db",GreaterFullEqual:"\u2267",GreaterGreater:"\u2aa2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2a7e",GreaterTilde:"\u2273",Gscr:"\ud835\udca2",gscr:"\u210a",gsim:"\u2273",gsime:"\u2a8e",gsiml:"\u2a90",Gt:"\u226b",GT:">",gt:">",gtcc:"\u2aa7",gtcir:"\u2a7a",gtdot:"\u22d7",gtlPar:"\u2995",gtquest:"\u2a7c",gtrapprox:"\u2a86",gtrarr:"\u2978",gtrdot:"\u22d7",gtreqless:"\u22db",gtreqqless:"\u2a8c",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\ufe00",gvnE:"\u2269\ufe00",Hacek:"\u02c7",hairsp:"\u200a",half:"\xbd",hamilt:"\u210b",HARDcy:"\u042a",hardcy:"\u044a",hArr:"\u21d4",harr:"\u2194",harrcir:"\u2948",harrw:"\u21ad",Hat:"^",hbar:"\u210f",Hcirc:"\u0124",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22b9",Hfr:"\u210c",hfr:"\ud835\udd25",HilbertSpace:"\u210b",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21ff",homtht:"\u223b",hookleftarrow:"\u21a9",hookrightarrow:"\u21aa",Hopf:"\u210d",hopf:"\ud835\udd59",horbar:"\u2015",HorizontalLine:"\u2500",Hscr:"\u210b",hscr:"\ud835\udcbd",hslash:"\u210f",Hstrok:"\u0126",hstrok:"\u0127",HumpDownHump:"\u224e",HumpEqual:"\u224f",hybull:"\u2043",hyphen:"\u2010",Iacute:"\xcd",iacute:"\xed",ic:"\u2063",Icirc:"\xce",icirc:"\xee",Icy:"\u0418",icy:"\u0438",Idot:"\u0130",IEcy:"\u0415",iecy:"\u0435",iexcl:"\xa1",iff:"\u21d4",Ifr:"\u2111",ifr:"\ud835\udd26",Igrave:"\xcc",igrave:"\xec",ii:"\u2148",iiiint:"\u2a0c",iiint:"\u222d",iinfin:"\u29dc",iiota:"\u2129",IJlig:"\u0132",ijlig:"\u0133",Im:"\u2111",Imacr:"\u012a",imacr:"\u012b",image:"\u2111",ImaginaryI:"\u2148",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",imof:"\u22b7",imped:"\u01b5",Implies:"\u21d2",in:"\u2208",incare:"\u2105",infin:"\u221e",infintie:"\u29dd",inodot:"\u0131",Int:"\u222c",int:"\u222b",intcal:"\u22ba",integers:"\u2124",Integral:"\u222b",intercal:"\u22ba",Intersection:"\u22c2",intlarhk:"\u2a17",intprod:"\u2a3c",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",IOcy:"\u0401",iocy:"\u0451",Iogon:"\u012e",iogon:"\u012f",Iopf:"\ud835\udd40",iopf:"\ud835\udd5a",Iota:"\u0399",iota:"\u03b9",iprod:"\u2a3c",iquest:"\xbf",Iscr:"\u2110",iscr:"\ud835\udcbe",isin:"\u2208",isindot:"\u22f5",isinE:"\u22f9",isins:"\u22f4",isinsv:"\u22f3",isinv:"\u2208",it:"\u2062",Itilde:"\u0128",itilde:"\u0129",Iukcy:"\u0406",iukcy:"\u0456",Iuml:"\xcf",iuml:"\xef",Jcirc:"\u0134",jcirc:"\u0135",Jcy:"\u0419",jcy:"\u0439",Jfr:"\ud835\udd0d",jfr:"\ud835\udd27",jmath:"\u0237",Jopf:"\ud835\udd41",jopf:"\ud835\udd5b",Jscr:"\ud835\udca5",jscr:"\ud835\udcbf",Jsercy:"\u0408",jsercy:"\u0458",Jukcy:"\u0404",jukcy:"\u0454",Kappa:"\u039a",kappa:"\u03ba",kappav:"\u03f0",Kcedil:"\u0136",kcedil:"\u0137",Kcy:"\u041a",kcy:"\u043a",Kfr:"\ud835\udd0e",kfr:"\ud835\udd28",kgreen:"\u0138",KHcy:"\u0425",khcy:"\u0445",KJcy:"\u040c",kjcy:"\u045c",Kopf:"\ud835\udd42",kopf:"\ud835\udd5c",Kscr:"\ud835\udca6",kscr:"\ud835\udcc0",lAarr:"\u21da",Lacute:"\u0139",lacute:"\u013a",laemptyv:"\u29b4",lagran:"\u2112",Lambda:"\u039b",lambda:"\u03bb",Lang:"\u27ea",lang:"\u27e8",langd:"\u2991",langle:"\u27e8",lap:"\u2a85",Laplacetrf:"\u2112",laquo:"\xab",Larr:"\u219e",lArr:"\u21d0",larr:"\u2190",larrb:"\u21e4",larrbfs:"\u291f",larrfs:"\u291d",larrhk:"\u21a9",larrlp:"\u21ab",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21a2",lat:"\u2aab",lAtail:"\u291b",latail:"\u2919",late:"\u2aad",lates:"\u2aad\ufe00",lBarr:"\u290e",lbarr:"\u290c",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298b",lbrksld:"\u298f",lbrkslu:"\u298d",Lcaron:"\u013d",lcaron:"\u013e",Lcedil:"\u013b",lcedil:"\u013c",lceil:"\u2308",lcub:"{",Lcy:"\u041b",lcy:"\u043b",ldca:"\u2936",ldquo:"\u201c",ldquor:"\u201e",ldrdhar:"\u2967",ldrushar:"\u294b",ldsh:"\u21b2",lE:"\u2266",le:"\u2264",LeftAngleBracket:"\u27e8",LeftArrow:"\u2190",Leftarrow:"\u21d0",leftarrow:"\u2190",LeftArrowBar:"\u21e4",LeftArrowRightArrow:"\u21c6",leftarrowtail:"\u21a2",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27e6",LeftDownTeeVector:"\u2961",LeftDownVector:"\u21c3",LeftDownVectorBar:"\u2959",LeftFloor:"\u230a",leftharpoondown:"\u21bd",leftharpoonup:"\u21bc",leftleftarrows:"\u21c7",LeftRightArrow:"\u2194",Leftrightarrow:"\u21d4",leftrightarrow:"\u2194",leftrightarrows:"\u21c6",leftrightharpoons:"\u21cb",leftrightsquigarrow:"\u21ad",LeftRightVector:"\u294e",LeftTee:"\u22a3",LeftTeeArrow:"\u21a4",LeftTeeVector:"\u295a",leftthreetimes:"\u22cb",LeftTriangle:"\u22b2",LeftTriangleBar:"\u29cf",LeftTriangleEqual:"\u22b4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVector:"\u21bf",LeftUpVectorBar:"\u2958",LeftVector:"\u21bc",LeftVectorBar:"\u2952",lEg:"\u2a8b",leg:"\u22da",leq:"\u2264",leqq:"\u2266",leqslant:"\u2a7d",les:"\u2a7d",lescc:"\u2aa8",lesdot:"\u2a7f",lesdoto:"\u2a81",lesdotor:"\u2a83",lesg:"\u22da\ufe00",lesges:"\u2a93",lessapprox:"\u2a85",lessdot:"\u22d6",lesseqgtr:"\u22da",lesseqqgtr:"\u2a8b",LessEqualGreater:"\u22da",LessFullEqual:"\u2266",LessGreater:"\u2276",lessgtr:"\u2276",LessLess:"\u2aa1",lesssim:"\u2272",LessSlantEqual:"\u2a7d",LessTilde:"\u2272",lfisht:"\u297c",lfloor:"\u230a",Lfr:"\ud835\udd0f",lfr:"\ud835\udd29",lg:"\u2276",lgE:"\u2a91",lHar:"\u2962",lhard:"\u21bd",lharu:"\u21bc",lharul:"\u296a",lhblk:"\u2584",LJcy:"\u0409",ljcy:"\u0459",Ll:"\u22d8",ll:"\u226a",llarr:"\u21c7",llcorner:"\u231e",Lleftarrow:"\u21da",llhard:"\u296b",lltri:"\u25fa",Lmidot:"\u013f",lmidot:"\u0140",lmoust:"\u23b0",lmoustache:"\u23b0",lnap:"\u2a89",lnapprox:"\u2a89",lnE:"\u2268",lne:"\u2a87",lneq:"\u2a87",lneqq:"\u2268",lnsim:"\u22e6",loang:"\u27ec",loarr:"\u21fd",lobrk:"\u27e6",LongLeftArrow:"\u27f5",Longleftarrow:"\u27f8",longleftarrow:"\u27f5",LongLeftRightArrow:"\u27f7",Longleftrightarrow:"\u27fa",longleftrightarrow:"\u27f7",longmapsto:"\u27fc",LongRightArrow:"\u27f6",Longrightarrow:"\u27f9",longrightarrow:"\u27f6",looparrowleft:"\u21ab",looparrowright:"\u21ac",lopar:"\u2985",Lopf:"\ud835\udd43",lopf:"\ud835\udd5d",loplus:"\u2a2d",lotimes:"\u2a34",lowast:"\u2217",lowbar:"_",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",loz:"\u25ca",lozenge:"\u25ca",lozf:"\u29eb",lpar:"(",lparlt:"\u2993",lrarr:"\u21c6",lrcorner:"\u231f",lrhar:"\u21cb",lrhard:"\u296d",lrm:"\u200e",lrtri:"\u22bf",lsaquo:"\u2039",Lscr:"\u2112",lscr:"\ud835\udcc1",Lsh:"\u21b0",lsh:"\u21b0",lsim:"\u2272",lsime:"\u2a8d",lsimg:"\u2a8f",lsqb:"[",lsquo:"\u2018",lsquor:"\u201a",Lstrok:"\u0141",lstrok:"\u0142",Lt:"\u226a",LT:"<",lt:"<",ltcc:"\u2aa6",ltcir:"\u2a79",ltdot:"\u22d6",lthree:"\u22cb",ltimes:"\u22c9",ltlarr:"\u2976",ltquest:"\u2a7b",ltri:"\u25c3",ltrie:"\u22b4",ltrif:"\u25c2",ltrPar:"\u2996",lurdshar:"\u294a",luruhar:"\u2966",lvertneqq:"\u2268\ufe00",lvnE:"\u2268\ufe00",macr:"\xaf",male:"\u2642",malt:"\u2720",maltese:"\u2720",Map:"\u2905",map:"\u21a6",mapsto:"\u21a6",mapstodown:"\u21a7",mapstoleft:"\u21a4",mapstoup:"\u21a5",marker:"\u25ae",mcomma:"\u2a29",Mcy:"\u041c",mcy:"\u043c",mdash:"\u2014",mDDot:"\u223a",measuredangle:"\u2221",MediumSpace:"\u205f",Mellintrf:"\u2133",Mfr:"\ud835\udd10",mfr:"\ud835\udd2a",mho:"\u2127",micro:"\xb5",mid:"\u2223",midast:"*",midcir:"\u2af0",middot:"\xb7",minus:"\u2212",minusb:"\u229f",minusd:"\u2238",minusdu:"\u2a2a",MinusPlus:"\u2213",mlcp:"\u2adb",mldr:"\u2026",mnplus:"\u2213",models:"\u22a7",Mopf:"\ud835\udd44",mopf:"\ud835\udd5e",mp:"\u2213",Mscr:"\u2133",mscr:"\ud835\udcc2",mstpos:"\u223e",Mu:"\u039c",mu:"\u03bc",multimap:"\u22b8",mumap:"\u22b8",nabla:"\u2207",Nacute:"\u0143",nacute:"\u0144",nang:"\u2220\u20d2",nap:"\u2249",napE:"\u2a70\u0338",napid:"\u224b\u0338",napos:"\u0149",napprox:"\u2249",natur:"\u266e",natural:"\u266e",naturals:"\u2115",nbsp:"\xa0",nbump:"\u224e\u0338",nbumpe:"\u224f\u0338",ncap:"\u2a43",Ncaron:"\u0147",ncaron:"\u0148",Ncedil:"\u0145",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2a6d\u0338",ncup:"\u2a42",Ncy:"\u041d",ncy:"\u043d",ndash:"\u2013",ne:"\u2260",nearhk:"\u2924",neArr:"\u21d7",nearr:"\u2197",nearrow:"\u2197",nedot:"\u2250\u0338",NegativeMediumSpace:"\u200b",NegativeThickSpace:"\u200b",NegativeThinSpace:"\u200b",NegativeVeryThinSpace:"\u200b",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",NestedGreaterGreater:"\u226b",NestedLessLess:"\u226a",NewLine:"\n",nexist:"\u2204",nexists:"\u2204",Nfr:"\ud835\udd11",nfr:"\ud835\udd2b",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2a7e\u0338",nges:"\u2a7e\u0338",nGg:"\u22d9\u0338",ngsim:"\u2275",nGt:"\u226b\u20d2",ngt:"\u226f",ngtr:"\u226f",nGtv:"\u226b\u0338",nhArr:"\u21ce",nharr:"\u21ae",nhpar:"\u2af2",ni:"\u220b",nis:"\u22fc",nisd:"\u22fa",niv:"\u220b",NJcy:"\u040a",njcy:"\u045a",nlArr:"\u21cd",nlarr:"\u219a",nldr:"\u2025",nlE:"\u2266\u0338",nle:"\u2270",nLeftarrow:"\u21cd",nleftarrow:"\u219a",nLeftrightarrow:"\u21ce",nleftrightarrow:"\u21ae",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2a7d\u0338",nles:"\u2a7d\u0338",nless:"\u226e",nLl:"\u22d8\u0338",nlsim:"\u2274",nLt:"\u226a\u20d2",nlt:"\u226e",nltri:"\u22ea",nltrie:"\u22ec",nLtv:"\u226a\u0338",nmid:"\u2224",NoBreak:"\u2060",NonBreakingSpace:"\xa0",Nopf:"\u2115",nopf:"\ud835\udd5f",Not:"\u2aec",not:"\xac",NotCongruent:"\u2262",NotCupCap:"\u226d",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226f",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226b\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2a7e\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224e\u0338",NotHumpEqual:"\u224f\u0338",notin:"\u2209",notindot:"\u22f5\u0338",notinE:"\u22f9\u0338",notinva:"\u2209",notinvb:"\u22f7",notinvc:"\u22f6",NotLeftTriangle:"\u22ea",NotLeftTriangleBar:"\u29cf\u0338",NotLeftTriangleEqual:"\u22ec",NotLess:"\u226e",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226a\u0338",NotLessSlantEqual:"\u2a7d\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2aa2\u0338",NotNestedLessLess:"\u2aa1\u0338",notni:"\u220c",notniva:"\u220c",notnivb:"\u22fe",notnivc:"\u22fd",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2aaf\u0338",NotPrecedesSlantEqual:"\u22e0",NotReverseElement:"\u220c",NotRightTriangle:"\u22eb",NotRightTriangleBar:"\u29d0\u0338",NotRightTriangleEqual:"\u22ed",NotSquareSubset:"\u228f\u0338",NotSquareSubsetEqual:"\u22e2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22e3",NotSubset:"\u2282\u20d2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2ab0\u0338",NotSucceedsSlantEqual:"\u22e1",NotSucceedsTilde:"\u227f\u0338",NotSuperset:"\u2283\u20d2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",npar:"\u2226",nparallel:"\u2226",nparsl:"\u2afd\u20e5",npart:"\u2202\u0338",npolint:"\u2a14",npr:"\u2280",nprcue:"\u22e0",npre:"\u2aaf\u0338",nprec:"\u2280",npreceq:"\u2aaf\u0338",nrArr:"\u21cf",nrarr:"\u219b",nrarrc:"\u2933\u0338",nrarrw:"\u219d\u0338",nRightarrow:"\u21cf",nrightarrow:"\u219b",nrtri:"\u22eb",nrtrie:"\u22ed",nsc:"\u2281",nsccue:"\u22e1",nsce:"\u2ab0\u0338",Nscr:"\ud835\udca9",nscr:"\ud835\udcc3",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22e2",nsqsupe:"\u22e3",nsub:"\u2284",nsubE:"\u2ac5\u0338",nsube:"\u2288",nsubset:"\u2282\u20d2",nsubseteq:"\u2288",nsubseteqq:"\u2ac5\u0338",nsucc:"\u2281",nsucceq:"\u2ab0\u0338",nsup:"\u2285",nsupE:"\u2ac6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20d2",nsupseteq:"\u2289",nsupseteqq:"\u2ac6\u0338",ntgl:"\u2279",Ntilde:"\xd1",ntilde:"\xf1",ntlg:"\u2278",ntriangleleft:"\u22ea",ntrianglelefteq:"\u22ec",ntriangleright:"\u22eb",ntrianglerighteq:"\u22ed",Nu:"\u039d",nu:"\u03bd",num:"#",numero:"\u2116",numsp:"\u2007",nvap:"\u224d\u20d2",nVDash:"\u22af",nVdash:"\u22ae",nvDash:"\u22ad",nvdash:"\u22ac",nvge:"\u2265\u20d2",nvgt:">\u20d2",nvHarr:"\u2904",nvinfin:"\u29de",nvlArr:"\u2902",nvle:"\u2264\u20d2",nvlt:"<\u20d2",nvltrie:"\u22b4\u20d2",nvrArr:"\u2903",nvrtrie:"\u22b5\u20d2",nvsim:"\u223c\u20d2",nwarhk:"\u2923",nwArr:"\u21d6",nwarr:"\u2196",nwarrow:"\u2196",nwnear:"\u2927",Oacute:"\xd3",oacute:"\xf3",oast:"\u229b",ocir:"\u229a",Ocirc:"\xd4",ocirc:"\xf4",Ocy:"\u041e",ocy:"\u043e",odash:"\u229d",Odblac:"\u0150",odblac:"\u0151",odiv:"\u2a38",odot:"\u2299",odsold:"\u29bc",OElig:"\u0152",oelig:"\u0153",ofcir:"\u29bf",Ofr:"\ud835\udd12",ofr:"\ud835\udd2c",ogon:"\u02db",Ograve:"\xd2",ograve:"\xf2",ogt:"\u29c1",ohbar:"\u29b5",ohm:"\u03a9",oint:"\u222e",olarr:"\u21ba",olcir:"\u29be",olcross:"\u29bb",oline:"\u203e",olt:"\u29c0",Omacr:"\u014c",omacr:"\u014d",Omega:"\u03a9",omega:"\u03c9",Omicron:"\u039f",omicron:"\u03bf",omid:"\u29b6",ominus:"\u2296",Oopf:"\ud835\udd46",oopf:"\ud835\udd60",opar:"\u29b7",OpenCurlyDoubleQuote:"\u201c",OpenCurlyQuote:"\u2018",operp:"\u29b9",oplus:"\u2295",Or:"\u2a54",or:"\u2228",orarr:"\u21bb",ord:"\u2a5d",order:"\u2134",orderof:"\u2134",ordf:"\xaa",ordm:"\xba",origof:"\u22b6",oror:"\u2a56",orslope:"\u2a57",orv:"\u2a5b",oS:"\u24c8",Oscr:"\ud835\udcaa",oscr:"\u2134",Oslash:"\xd8",oslash:"\xf8",osol:"\u2298",Otilde:"\xd5",otilde:"\xf5",Otimes:"\u2a37",otimes:"\u2297",otimesas:"\u2a36",Ouml:"\xd6",ouml:"\xf6",ovbar:"\u233d",OverBar:"\u203e",OverBrace:"\u23de",OverBracket:"\u23b4",OverParenthesis:"\u23dc",par:"\u2225",para:"\xb6",parallel:"\u2225",parsim:"\u2af3",parsl:"\u2afd",part:"\u2202",PartialD:"\u2202",Pcy:"\u041f",pcy:"\u043f",percnt:"%",period:".",permil:"\u2030",perp:"\u22a5",pertenk:"\u2031",Pfr:"\ud835\udd13",pfr:"\ud835\udd2d",Phi:"\u03a6",phi:"\u03c6",phiv:"\u03d5",phmmat:"\u2133",phone:"\u260e",Pi:"\u03a0",pi:"\u03c0",pitchfork:"\u22d4",piv:"\u03d6",planck:"\u210f",planckh:"\u210e",plankv:"\u210f",plus:"+",plusacir:"\u2a23",plusb:"\u229e",pluscir:"\u2a22",plusdo:"\u2214",plusdu:"\u2a25",pluse:"\u2a72",PlusMinus:"\xb1",plusmn:"\xb1",plussim:"\u2a26",plustwo:"\u2a27",pm:"\xb1",Poincareplane:"\u210c",pointint:"\u2a15",Popf:"\u2119",popf:"\ud835\udd61",pound:"\xa3",Pr:"\u2abb",pr:"\u227a",prap:"\u2ab7",prcue:"\u227c",prE:"\u2ab3",pre:"\u2aaf",prec:"\u227a",precapprox:"\u2ab7",preccurlyeq:"\u227c",Precedes:"\u227a",PrecedesEqual:"\u2aaf",PrecedesSlantEqual:"\u227c",PrecedesTilde:"\u227e",preceq:"\u2aaf",precnapprox:"\u2ab9",precneqq:"\u2ab5",precnsim:"\u22e8",precsim:"\u227e",Prime:"\u2033",prime:"\u2032",primes:"\u2119",prnap:"\u2ab9",prnE:"\u2ab5",prnsim:"\u22e8",prod:"\u220f",Product:"\u220f",profalar:"\u232e",profline:"\u2312",profsurf:"\u2313",prop:"\u221d",Proportion:"\u2237",Proportional:"\u221d",propto:"\u221d",prsim:"\u227e",prurel:"\u22b0",Pscr:"\ud835\udcab",pscr:"\ud835\udcc5",Psi:"\u03a8",psi:"\u03c8",puncsp:"\u2008",Qfr:"\ud835\udd14",qfr:"\ud835\udd2e",qint:"\u2a0c",Qopf:"\u211a",qopf:"\ud835\udd62",qprime:"\u2057",Qscr:"\ud835\udcac",qscr:"\ud835\udcc6",quaternions:"\u210d",quatint:"\u2a16",quest:"?",questeq:"\u225f",QUOT:'"',quot:'"',rAarr:"\u21db",race:"\u223d\u0331",Racute:"\u0154",racute:"\u0155",radic:"\u221a",raemptyv:"\u29b3",Rang:"\u27eb",rang:"\u27e9",rangd:"\u2992",range:"\u29a5",rangle:"\u27e9",raquo:"\xbb",Rarr:"\u21a0",rArr:"\u21d2",rarr:"\u2192",rarrap:"\u2975",rarrb:"\u21e5",rarrbfs:"\u2920",rarrc:"\u2933",rarrfs:"\u291e",rarrhk:"\u21aa",rarrlp:"\u21ac",rarrpl:"\u2945",rarrsim:"\u2974",Rarrtl:"\u2916",rarrtl:"\u21a3",rarrw:"\u219d",rAtail:"\u291c",ratail:"\u291a",ratio:"\u2236",rationals:"\u211a",RBarr:"\u2910",rBarr:"\u290f",rbarr:"\u290d",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298c",rbrksld:"\u298e",rbrkslu:"\u2990",Rcaron:"\u0158",rcaron:"\u0159",Rcedil:"\u0156",rcedil:"\u0157",rceil:"\u2309",rcub:"}",Rcy:"\u0420",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201d",rdquor:"\u201d",rdsh:"\u21b3",Re:"\u211c",real:"\u211c",realine:"\u211b",realpart:"\u211c",reals:"\u211d",rect:"\u25ad",REG:"\xae",reg:"\xae",ReverseElement:"\u220b",ReverseEquilibrium:"\u21cb",ReverseUpEquilibrium:"\u296f",rfisht:"\u297d",rfloor:"\u230b",Rfr:"\u211c",rfr:"\ud835\udd2f",rHar:"\u2964",rhard:"\u21c1",rharu:"\u21c0",rharul:"\u296c",Rho:"\u03a1",rho:"\u03c1",rhov:"\u03f1",RightAngleBracket:"\u27e9",RightArrow:"\u2192",Rightarrow:"\u21d2",rightarrow:"\u2192",RightArrowBar:"\u21e5",RightArrowLeftArrow:"\u21c4",rightarrowtail:"\u21a3",RightCeiling:"\u2309",RightDoubleBracket:"\u27e7",RightDownTeeVector:"\u295d",RightDownVector:"\u21c2",RightDownVectorBar:"\u2955",RightFloor:"\u230b",rightharpoondown:"\u21c1",rightharpoonup:"\u21c0",rightleftarrows:"\u21c4",rightleftharpoons:"\u21cc",rightrightarrows:"\u21c9",rightsquigarrow:"\u219d",RightTee:"\u22a2",RightTeeArrow:"\u21a6",RightTeeVector:"\u295b",rightthreetimes:"\u22cc",RightTriangle:"\u22b3",RightTriangleBar:"\u29d0",RightTriangleEqual:"\u22b5",RightUpDownVector:"\u294f",RightUpTeeVector:"\u295c",RightUpVector:"\u21be",RightUpVectorBar:"\u2954",RightVector:"\u21c0",RightVectorBar:"\u2953",ring:"\u02da",risingdotseq:"\u2253",rlarr:"\u21c4",rlhar:"\u21cc",rlm:"\u200f",rmoust:"\u23b1",rmoustache:"\u23b1",rnmid:"\u2aee",roang:"\u27ed",roarr:"\u21fe",robrk:"\u27e7",ropar:"\u2986",Ropf:"\u211d",ropf:"\ud835\udd63",roplus:"\u2a2e",rotimes:"\u2a35",RoundImplies:"\u2970",rpar:")",rpargt:"\u2994",rppolint:"\u2a12",rrarr:"\u21c9",Rrightarrow:"\u21db",rsaquo:"\u203a",Rscr:"\u211b",rscr:"\ud835\udcc7",Rsh:"\u21b1",rsh:"\u21b1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22cc",rtimes:"\u22ca",rtri:"\u25b9",rtrie:"\u22b5",rtrif:"\u25b8",rtriltri:"\u29ce",RuleDelayed:"\u29f4",ruluhar:"\u2968",rx:"\u211e",Sacute:"\u015a",sacute:"\u015b",sbquo:"\u201a",Sc:"\u2abc",sc:"\u227b",scap:"\u2ab8",Scaron:"\u0160",scaron:"\u0161",sccue:"\u227d",scE:"\u2ab4",sce:"\u2ab0",Scedil:"\u015e",scedil:"\u015f",Scirc:"\u015c",scirc:"\u015d",scnap:"\u2aba",scnE:"\u2ab6",scnsim:"\u22e9",scpolint:"\u2a13",scsim:"\u227f",Scy:"\u0421",scy:"\u0441",sdot:"\u22c5",sdotb:"\u22a1",sdote:"\u2a66",searhk:"\u2925",seArr:"\u21d8",searr:"\u2198",searrow:"\u2198",sect:"\xa7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",Sfr:"\ud835\udd16",sfr:"\ud835\udd30",sfrown:"\u2322",sharp:"\u266f",SHCHcy:"\u0429",shchcy:"\u0449",SHcy:"\u0428",shcy:"\u0448",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",shortmid:"\u2223",shortparallel:"\u2225",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",shy:"\xad",Sigma:"\u03a3",sigma:"\u03c3",sigmaf:"\u03c2",sigmav:"\u03c2",sim:"\u223c",simdot:"\u2a6a",sime:"\u2243",simeq:"\u2243",simg:"\u2a9e",simgE:"\u2aa0",siml:"\u2a9d",simlE:"\u2a9f",simne:"\u2246",simplus:"\u2a24",simrarr:"\u2972",slarr:"\u2190",SmallCircle:"\u2218",smallsetminus:"\u2216",smashp:"\u2a33",smeparsl:"\u29e4",smid:"\u2223",smile:"\u2323",smt:"\u2aaa",smte:"\u2aac",smtes:"\u2aac\ufe00",SOFTcy:"\u042c",softcy:"\u044c",sol:"/",solb:"\u29c4",solbar:"\u233f",Sopf:"\ud835\udd4a",sopf:"\ud835\udd64",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\ufe00",sqcup:"\u2294",sqcups:"\u2294\ufe00",Sqrt:"\u221a",sqsub:"\u228f",sqsube:"\u2291",sqsubset:"\u228f",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",squ:"\u25a1",Square:"\u25a1",square:"\u25a1",SquareIntersection:"\u2293",SquareSubset:"\u228f",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",squarf:"\u25aa",squf:"\u25aa",srarr:"\u2192",Sscr:"\ud835\udcae",sscr:"\ud835\udcc8",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22c6",Star:"\u22c6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03f5",straightphi:"\u03d5",strns:"\xaf",Sub:"\u22d0",sub:"\u2282",subdot:"\u2abd",subE:"\u2ac5",sube:"\u2286",subedot:"\u2ac3",submult:"\u2ac1",subnE:"\u2acb",subne:"\u228a",subplus:"\u2abf",subrarr:"\u2979",Subset:"\u22d0",subset:"\u2282",subseteq:"\u2286",subseteqq:"\u2ac5",SubsetEqual:"\u2286",subsetneq:"\u228a",subsetneqq:"\u2acb",subsim:"\u2ac7",subsub:"\u2ad5",subsup:"\u2ad3",succ:"\u227b",succapprox:"\u2ab8",succcurlyeq:"\u227d",Succeeds:"\u227b",SucceedsEqual:"\u2ab0",SucceedsSlantEqual:"\u227d",SucceedsTilde:"\u227f",succeq:"\u2ab0",succnapprox:"\u2aba",succneqq:"\u2ab6",succnsim:"\u22e9",succsim:"\u227f",SuchThat:"\u220b",Sum:"\u2211",sum:"\u2211",sung:"\u266a",Sup:"\u22d1",sup:"\u2283",sup1:"\xb9",sup2:"\xb2",sup3:"\xb3",supdot:"\u2abe",supdsub:"\u2ad8",supE:"\u2ac6",supe:"\u2287",supedot:"\u2ac4",Superset:"\u2283",SupersetEqual:"\u2287",suphsol:"\u27c9",suphsub:"\u2ad7",suplarr:"\u297b",supmult:"\u2ac2",supnE:"\u2acc",supne:"\u228b",supplus:"\u2ac0",Supset:"\u22d1",supset:"\u2283",supseteq:"\u2287",supseteqq:"\u2ac6",supsetneq:"\u228b",supsetneqq:"\u2acc",supsim:"\u2ac8",supsub:"\u2ad4",supsup:"\u2ad6",swarhk:"\u2926",swArr:"\u21d9",swarr:"\u2199",swarrow:"\u2199",swnwar:"\u292a",szlig:"\xdf",Tab:"\t",target:"\u2316",Tau:"\u03a4",tau:"\u03c4",tbrk:"\u23b4",Tcaron:"\u0164",tcaron:"\u0165",Tcedil:"\u0162",tcedil:"\u0163",Tcy:"\u0422",tcy:"\u0442",tdot:"\u20db",telrec:"\u2315",Tfr:"\ud835\udd17",tfr:"\ud835\udd31",there4:"\u2234",Therefore:"\u2234",therefore:"\u2234",Theta:"\u0398",theta:"\u03b8",thetasym:"\u03d1",thetav:"\u03d1",thickapprox:"\u2248",thicksim:"\u223c",ThickSpace:"\u205f\u200a",thinsp:"\u2009",ThinSpace:"\u2009",thkap:"\u2248",thksim:"\u223c",THORN:"\xde",thorn:"\xfe",Tilde:"\u223c",tilde:"\u02dc",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",times:"\xd7",timesb:"\u22a0",timesbar:"\u2a31",timesd:"\u2a30",tint:"\u222d",toea:"\u2928",top:"\u22a4",topbot:"\u2336",topcir:"\u2af1",Topf:"\ud835\udd4b",topf:"\ud835\udd65",topfork:"\u2ada",tosa:"\u2929",tprime:"\u2034",TRADE:"\u2122",trade:"\u2122",triangle:"\u25b5",triangledown:"\u25bf",triangleleft:"\u25c3",trianglelefteq:"\u22b4",triangleq:"\u225c",triangleright:"\u25b9",trianglerighteq:"\u22b5",tridot:"\u25ec",trie:"\u225c",triminus:"\u2a3a",TripleDot:"\u20db",triplus:"\u2a39",trisb:"\u29cd",tritime:"\u2a3b",trpezium:"\u23e2",Tscr:"\ud835\udcaf",tscr:"\ud835\udcc9",TScy:"\u0426",tscy:"\u0446",TSHcy:"\u040b",tshcy:"\u045b",Tstrok:"\u0166",tstrok:"\u0167",twixt:"\u226c",twoheadleftarrow:"\u219e",twoheadrightarrow:"\u21a0",Uacute:"\xda",uacute:"\xfa",Uarr:"\u219f",uArr:"\u21d1",uarr:"\u2191",Uarrocir:"\u2949",Ubrcy:"\u040e",ubrcy:"\u045e",Ubreve:"\u016c",ubreve:"\u016d",Ucirc:"\xdb",ucirc:"\xfb",Ucy:"\u0423",ucy:"\u0443",udarr:"\u21c5",Udblac:"\u0170",udblac:"\u0171",udhar:"\u296e",ufisht:"\u297e",Ufr:"\ud835\udd18",ufr:"\ud835\udd32",Ugrave:"\xd9",ugrave:"\xf9",uHar:"\u2963",uharl:"\u21bf",uharr:"\u21be",uhblk:"\u2580",ulcorn:"\u231c",ulcorner:"\u231c",ulcrop:"\u230f",ultri:"\u25f8",Umacr:"\u016a",umacr:"\u016b",uml:"\xa8",UnderBar:"_",UnderBrace:"\u23df",UnderBracket:"\u23b5",UnderParenthesis:"\u23dd",Union:"\u22c3",UnionPlus:"\u228e",Uogon:"\u0172",uogon:"\u0173",Uopf:"\ud835\udd4c",uopf:"\ud835\udd66",UpArrow:"\u2191",Uparrow:"\u21d1",uparrow:"\u2191",UpArrowBar:"\u2912",UpArrowDownArrow:"\u21c5",UpDownArrow:"\u2195",Updownarrow:"\u21d5",updownarrow:"\u2195",UpEquilibrium:"\u296e",upharpoonleft:"\u21bf",upharpoonright:"\u21be",uplus:"\u228e",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",Upsi:"\u03d2",upsi:"\u03c5",upsih:"\u03d2",Upsilon:"\u03a5",upsilon:"\u03c5",UpTee:"\u22a5",UpTeeArrow:"\u21a5",upuparrows:"\u21c8",urcorn:"\u231d",urcorner:"\u231d",urcrop:"\u230e",Uring:"\u016e",uring:"\u016f",urtri:"\u25f9",Uscr:"\ud835\udcb0",uscr:"\ud835\udcca",utdot:"\u22f0",Utilde:"\u0168",utilde:"\u0169",utri:"\u25b5",utrif:"\u25b4",uuarr:"\u21c8",Uuml:"\xdc",uuml:"\xfc",uwangle:"\u29a7",vangrt:"\u299c",varepsilon:"\u03f5",varkappa:"\u03f0",varnothing:"\u2205",varphi:"\u03d5",varpi:"\u03d6",varpropto:"\u221d",vArr:"\u21d5",varr:"\u2195",varrho:"\u03f1",varsigma:"\u03c2",varsubsetneq:"\u228a\ufe00",varsubsetneqq:"\u2acb\ufe00",varsupsetneq:"\u228b\ufe00",varsupsetneqq:"\u2acc\ufe00",vartheta:"\u03d1",vartriangleleft:"\u22b2",vartriangleright:"\u22b3",Vbar:"\u2aeb",vBar:"\u2ae8",vBarv:"\u2ae9",Vcy:"\u0412",vcy:"\u0432",VDash:"\u22ab",Vdash:"\u22a9",vDash:"\u22a8",vdash:"\u22a2",Vdashl:"\u2ae6",Vee:"\u22c1",vee:"\u2228",veebar:"\u22bb",veeeq:"\u225a",vellip:"\u22ee",Verbar:"\u2016",verbar:"|",Vert:"\u2016",vert:"|",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200a",Vfr:"\ud835\udd19",vfr:"\ud835\udd33",vltri:"\u22b2",vnsub:"\u2282\u20d2",vnsup:"\u2283\u20d2",Vopf:"\ud835\udd4d",vopf:"\ud835\udd67",vprop:"\u221d",vrtri:"\u22b3",Vscr:"\ud835\udcb1",vscr:"\ud835\udccb",vsubnE:"\u2acb\ufe00",vsubne:"\u228a\ufe00",vsupnE:"\u2acc\ufe00",vsupne:"\u228b\ufe00",Vvdash:"\u22aa",vzigzag:"\u299a",Wcirc:"\u0174",wcirc:"\u0175",wedbar:"\u2a5f",Wedge:"\u22c0",wedge:"\u2227",wedgeq:"\u2259",weierp:"\u2118",Wfr:"\ud835\udd1a",wfr:"\ud835\udd34",Wopf:"\ud835\udd4e",wopf:"\ud835\udd68",wp:"\u2118",wr:"\u2240",wreath:"\u2240",Wscr:"\ud835\udcb2",wscr:"\ud835\udccc",xcap:"\u22c2",xcirc:"\u25ef",xcup:"\u22c3",xdtri:"\u25bd",Xfr:"\ud835\udd1b",xfr:"\ud835\udd35",xhArr:"\u27fa",xharr:"\u27f7",Xi:"\u039e",xi:"\u03be",xlArr:"\u27f8",xlarr:"\u27f5",xmap:"\u27fc",xnis:"\u22fb",xodot:"\u2a00",Xopf:"\ud835\udd4f",xopf:"\ud835\udd69",xoplus:"\u2a01",xotime:"\u2a02",xrArr:"\u27f9",xrarr:"\u27f6",Xscr:"\ud835\udcb3",xscr:"\ud835\udccd",xsqcup:"\u2a06",xuplus:"\u2a04",xutri:"\u25b3",xvee:"\u22c1",xwedge:"\u22c0",Yacute:"\xdd",yacute:"\xfd",YAcy:"\u042f",yacy:"\u044f",Ycirc:"\u0176",ycirc:"\u0177",Ycy:"\u042b",ycy:"\u044b",yen:"\xa5",Yfr:"\ud835\udd1c",yfr:"\ud835\udd36",YIcy:"\u0407",yicy:"\u0457",Yopf:"\ud835\udd50",yopf:"\ud835\udd6a",Yscr:"\ud835\udcb4",yscr:"\ud835\udcce",YUcy:"\u042e",yucy:"\u044e",Yuml:"\u0178",yuml:"\xff",Zacute:"\u0179",zacute:"\u017a",Zcaron:"\u017d",zcaron:"\u017e",Zcy:"\u0417",zcy:"\u0437",Zdot:"\u017b",zdot:"\u017c",zeetrf:"\u2128",ZeroWidthSpace:"\u200b",Zeta:"\u0396",zeta:"\u03b6",Zfr:"\u2128",zfr:"\ud835\udd37",ZHcy:"\u0416",zhcy:"\u0436",zigrarr:"\u21dd",Zopf:"\u2124",zopf:"\ud835\udd6b",Zscr:"\ud835\udcb5",zscr:"\ud835\udccf",zwj:"\u200d",zwnj:"\u200c"}),t.entityMap=t.HTML_ENTITIES},530:()=>{},542:()=>{},545:function(e,t,n){var i;!function(e,r){function s(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),i==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new s(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=o:n.amdD&&n.amdO?void 0===(i=function(){return o}.call(t,n,t,r))||(r.exports=i):this.xorwow=o}(0,e=n.nmd(e),n.amdD)},551:()=>{},583:function(e,t,n){var i;!function(r,s,a){var o,l=256,c=a.pow(l,6),u=a.pow(2,52),h=2*u,d=255;function p(e,t,n){var i=[],d=y(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,b(s)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(l):(e=new Uint8Array(l),(r.crypto||r.msCrypto).getRandomValues(e)),b(e)}catch(i){var t=r.navigator,n=t&&t.plugins;return[+new Date,r,n,r.screen,b(s)]}}():e,3),i),p=new f(i),v=function(){for(var e=p.g(6),t=c,n=0;e<u;)e=(e+n)*l,t*=l,n=p.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|p.g(4)},v.quick=function(){return p.g(4)/4294967296},v.double=v,y(b(p.S),s),(t.pass||n||function(e,t,n,i){return i&&(i.S&&g(i,p),e.state=function(){return g(p,{})}),n?(a.random=e,t):e})(v,d,"global"in t?t.global:this==a,t.state)}function f(e){var t,n=e.length,i=this,r=0,s=i.i=i.j=0,a=i.S=[];for(n||(e=[n++]);r<l;)a[r]=r++;for(r=0;r<l;r++)a[r]=a[s=d&s+e[r%n]+(t=a[r])],a[s]=t;(i.g=function(e){for(var t,n=0,r=i.i,s=i.j,a=i.S;e--;)t=a[r=d&r+1],n=n*l+a[d&(a[r]=a[s=d&s+t])+(a[s]=t)];return i.i=r,i.j=s,n})(l)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,i=[],r=typeof e;if(t&&"object"==r)for(n in e)try{i.push(m(e[n],t-1))}catch(s){}return i.length?i:"string"==r?e:e+"\0"}function y(e,t){for(var n,i=e+"",r=0;r<i.length;)t[d&r]=d&(n^=19*t[d&r])+i.charCodeAt(r++);return b(t)}function b(e){return String.fromCharCode.apply(0,e)}if(y(a.random(),s),e.exports){e.exports=p;try{o=n(234)}catch(v){}}else void 0===(i=function(){return p}.call(t,n,t,e))||(e.exports=i)}("undefined"!==typeof self?self:this,[],Math)},590:()=>{},601:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Ma});var i=n(626),r=n.n(i),s=n(63),a=n.n(s),o=n(938),l=n.n(o),c=n(974),u=n.n(c);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},h.apply(null,arguments)}var d="https://example.com";const p=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=r().location&&r().location.href||"");var n=/^\/\//.test(e),i=!r().location&&!/\/\//i.test(e);e=new(r().URL)(e,r().location||d);var s=new URL(t,e);return i?s.href.slice(19):n?s.href.slice(s.protocol.length):s.href};var f=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();function g(e){for(var t,n=(t=e,r().atob?r().atob(t):Buffer.from(t,"base64").toString("binary")),i=new Uint8Array(n.length),s=0;s<n.length;s++)i[s]=n.charCodeAt(s);return i}class m extends f{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const y=String.fromCharCode(9),b=function(e){const t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),n={};return t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),n},v=function(e){const t={};if(!e)return t;const n=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))'));let i,r=n.length;for(;r--;)""!==n[r]&&(i=/([^=]*)=(.*)/.exec(n[r]).slice(1),i[0]=i[0].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^['"](.*)['"]$/g,"$1"),t[i[0]]=i[1]);return t},_=e=>{const t=e.split("x"),n={};return t[0]&&(n.width=parseInt(t[0],10)),t[1]&&(n.height=parseInt(t[1],10)),n};class x extends f{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;if(0===(e=e.trim()).length)return;if("#"!==e[0])return void this.trigger("data",{type:"uri",uri:e});this.tagMappers.reduce((t,n)=>{const i=n(e);return i===e?t:t.concat([i])},[e]).forEach(e=>{for(let t=0;t<this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e),t)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void this.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void this.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e),t)return n=h(b(t[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e),t)return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-MAP:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"map"},t[1]){const e=v(t[1]);e.URI&&(n.uri=e.URI),e.BYTERANGE&&(n.byterange=b(e.BYTERANGE))}this.trigger("data",n)}else{if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(e),t)return n={type:"tag",tagType:"stream-inf"},t[1]&&(n.attributes=v(t[1]),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=_(n.attributes.RESOLUTION)),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA:(.*)$/.exec(e),t)return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=v(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e),t)this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e),t)return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-KEY:(.*)$/.exec(e),t)return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=v(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void this.trigger("data",n);if(t=/^#EXT-X-START:(.*)$/.exec(e),t)return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=v(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-SKIP:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"skip"},n.attributes=v(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(y)),void this.trigger("data",n);if(t=/^#EXT-X-PART:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part"},n.attributes=v(t[1]),["DURATION"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["INDEPENDENT","GAP"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))}),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=b(n.attributes.BYTERANGE)),void this.trigger("data",n);if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"server-control"},n.attributes=v(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))}),void this.trigger("data",n);if(t=/^#EXT-X-PART-INF:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part-inf"},n.attributes=v(t[1]),["PART-TARGET"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),void this.trigger("data",n);if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"preload-hint"},n.attributes=v(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(e){if(n.attributes.hasOwnProperty(e)){n.attributes[e]=parseInt(n.attributes[e],10);const t="BYTERANGE-LENGTH"===e?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[t]=n.attributes[e],delete n.attributes[e]}}),void this.trigger("data",n);if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"rendition-report"},n.attributes=v(t[1]),["LAST-MSN","LAST-PART"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseInt(n.attributes[e],10))}),void this.trigger("data",n);if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(e),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=v(t[1]),["ID","CLASS"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=String(n.attributes[e]))}),["START-DATE","END-DATE"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=new Date(n.attributes[e]))}),["DURATION","PLANNED-DURATION"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["END-ON-NEXT"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/i.test(n.attributes[e]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=n.attributes[e].toString(16))});const e=/^X-([A-Z]+-)+[A-Z]+$/;for(const t in n.attributes){if(!e.test(t))continue;const i=/[0-9A-Fa-f]{6}/g.test(n.attributes[t]),r=/^\d+(\.\d+)?$/.test(n.attributes[t]);n.attributes[t]=i?n.attributes[t].toString(16):r?parseFloat(n.attributes[t]):String(n.attributes[t])}return void this.trigger("data",n)}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(e),t)this.trigger("data",{type:"tag",tagType:"independent-segments"});else if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"i-frames-only"});else{if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(e),t)return n={type:"tag",tagType:"content-steering"},n.attributes=v(t[1]),void this.trigger("data",n);if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(e),t)return n={type:"tag",tagType:"i-frame-playlist"},n.attributes=v(t[1]),n.attributes.URI&&(n.uri=n.attributes.URI),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=_(n.attributes.RESOLUTION)),n.attributes["AVERAGE-BANDWIDTH"]&&(n.attributes["AVERAGE-BANDWIDTH"]=parseInt(n.attributes["AVERAGE-BANDWIDTH"],10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),void this.trigger("data",n);if(t=/^#EXT-X-DEFINE:(.*)$/.exec(e),t)return n={type:"tag",tagType:"define"},n.attributes=v(t[1]),void this.trigger("data",n);this.trigger("data",{type:"tag",data:e.slice(4)})}}}}else this.trigger("data",{type:"comment",text:e.slice(1)})})}addParser(e){let{expression:t,customType:n,dataParser:i,segment:r}=e;"function"!==typeof i&&(i=e=>e),this.customParsers.push(e=>{if(t.exec(e))return this.trigger("data",{type:"custom",data:i(e),customType:n,segment:r}),!0})}addTagMapper(e){let{expression:t,map:n}=e;this.tagMappers.push(e=>t.test(e)?n(e):e)}}const w=function(e){const t={};return Object.keys(e).forEach(function(n){var i;t[(i=n,i.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()))]=e[n]}),t},T=function(e){const{serverControl:t,targetDuration:n,partTargetDuration:i}=e;if(!t)return;const r="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",o=n&&3*n,l=i&&2*i;n&&!t.hasOwnProperty(s)&&(t[s]=o,this.trigger("info",{message:"".concat(r," defaulting HOLD-BACK to targetDuration * 3 (").concat(o,").")})),o&&t[s]<o&&(this.trigger("warn",{message:"".concat(r," clamping HOLD-BACK (").concat(t[s],") to targetDuration * 3 (").concat(o,")")}),t[s]=o),i&&!t.hasOwnProperty(a)&&(t[a]=3*i,this.trigger("info",{message:"".concat(r," defaulting PART-HOLD-BACK to partTargetDuration * 3 (").concat(t[a],").")})),i&&t[a]<l&&(this.trigger("warn",{message:"".concat(r," clamping PART-HOLD-BACK (").concat(t[a],") to partTargetDuration * 2 (").concat(l,").")}),t[a]=l)};class k extends f{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.lineStream=new m,this.parseStream=new x,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const t=this,n=[];let i,r,s={},a=!1;const o=function(){},l={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};let c=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let u=0,d=0;const p={};this.on("end",()=>{s.uri||!s.parts&&!s.preloadHints||(!s.map&&i&&(s.map=i),!s.key&&r&&(s.key=r),s.timeline||"number"!==typeof c||(s.timeline=c),this.manifest.preloadSegment=s)}),this.parseStream.on("data",function(e){let f,m;if(t.manifest.definitions)for(const n in t.manifest.definitions)if(e.uri&&(e.uri=e.uri.replace("{$".concat(n,"}"),t.manifest.definitions[n])),e.attributes)for(const i in e.attributes)"string"===typeof e.attributes[i]&&(e.attributes[i]=e.attributes[i].replace("{$".concat(n,"}"),t.manifest.definitions[n]));({tag(){({version(){e.version&&(this.manifest.version=e.version)},"allow-cache"(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const t={};"length"in e&&(s.byterange=t,t.length=e.length,"offset"in e||(e.offset=u)),"offset"in e&&(s.byterange=t,t.offset=e.offset),u=t.offset+t.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.title&&(s.title=e.title),e.duration>0&&(s.duration=e.duration),0===e.duration&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("com.apple.streamingkeydelivery"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:e.attributes});if("com.microsoft.playready"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:e.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:g(e.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},"undefined"!==typeof e.attributes.IV&&(r.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence"(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,c=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type"(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map(){i={},e.uri&&(i.uri=e.uri),e.byterange&&(i.byterange=e.byterange),r&&(i.key=r)},"stream-inf"(){this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||l,e.attributes?(s.attributes||(s.attributes={}),h(s.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||l,!(e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const t=this.manifest.mediaGroups[e.attributes.TYPE];t[e.attributes["GROUP-ID"]]=t[e.attributes["GROUP-ID"]]||{},f=t[e.attributes["GROUP-ID"]],m={default:/yes/i.test(e.attributes.DEFAULT)},m.default?m.autoselect=!0:m.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(m.language=e.attributes.LANGUAGE),e.attributes.URI&&(m.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(m.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(m.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(m.forced=/yes/i.test(e.attributes.FORCED)),f[e.attributes.NAME]=m},discontinuity(){c+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time"(){"undefined"===typeof this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),s.dateTimeString=e.dateTimeString,s.dateTimeObject=e.dateTimeObject;const{lastProgramDateTime:t}=this;this.lastProgramDateTime=new Date(e.dateTimeString).getTime(),null===t&&this.manifest.segments.reduceRight((e,t)=>(t.programDateTime=e-1e3*t.duration,t.programDateTime),this.lastProgramDateTime)},targetduration(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):(this.manifest.targetDuration=e.duration,T.call(this,this.manifest))},start(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){s.cueOut=e.data},"cue-out-cont"(){s.cueOutCont=e.data},"cue-in"(){s.cueIn=e.data},skip(){this.manifest.skip=w(e.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",e.attributes,["SKIPPED-SEGMENTS"])},part(){a=!0;const t=this.manifest.segments.length,n=w(e.attributes);s.parts=s.parts||[],s.parts.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=d),d=n.byterange.offset+n.byterange.length);const i=s.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #".concat(i," for segment #").concat(t),e.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((e,t)=>{e.hasOwnProperty("lastPart")||this.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #".concat(t," lacks required attribute(s): LAST-PART")})})},"server-control"(){const t=this.manifest.serverControl=w(e.attributes);t.hasOwnProperty("canBlockReload")||(t.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),T.call(this,this.manifest),t.canSkipDateranges&&!t.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const t=this.manifest.segments.length,n=w(e.attributes),i=n.type&&"PART"===n.type;s.preloadHints=s.preloadHints||[],s.preloadHints.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=i?d:0,i&&(d=n.byterange.offset+n.byterange.length)));const r=s.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #".concat(r," for segment #").concat(t),e.attributes,["TYPE","URI"]),n.type)for(let e=0;e<s.preloadHints.length-1;e++){const i=s.preloadHints[e];i.type&&(i.type===n.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #".concat(r," for segment #").concat(t," has the same TYPE ").concat(n.type," as preload hint #").concat(e)}))}},"rendition-report"(){const t=w(e.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(t);const n=this.manifest.renditionReports.length-1,i=["LAST-MSN","URI"];a&&i.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #".concat(n),e.attributes,i)},"part-inf"(){this.manifest.partInf=w(e.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",e.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),T.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(w(e.attributes));const t=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_("#EXT-X-DATERANGE #".concat(t),e.attributes,["ID","START-DATE"]);const n=this.manifest.dateRanges[t];n.endDate&&n.startDate&&new Date(n.endDate)<new Date(n.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),n.duration&&n.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),n.plannedDuration&&n.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const i=!!n.endOnNext;if(i&&!n.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),i&&(n.duration||n.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),n.duration&&n.endDate){const e=n.startDate.getTime()+1e3*n.duration;this.manifest.dateRanges[t].endDate=new Date(e)}if(p[n.id]){for(const t in p[n.id])if(n[t]&&JSON.stringify(p[n.id][t])!==JSON.stringify(n[t])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const e=this.manifest.dateRanges.findIndex(e=>e.id===n.id);this.manifest.dateRanges[e]=h(this.manifest.dateRanges[e],n),p[n.id]=h(p[n.id],n),this.manifest.dateRanges.pop()}else p[n.id]=n},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=w(e.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",e.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const t=(e,t)=>{e in this.manifest.definitions?this.trigger("error",{message:"EXT-X-DEFINE: Duplicate name ".concat(e)}):this.manifest.definitions[e]=t};if("QUERYPARAM"in e.attributes){if("NAME"in e.attributes||"IMPORT"in e.attributes)return void this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});const n=this.params.get(e.attributes.QUERYPARAM);return n?void t(e.attributes.QUERYPARAM,decodeURIComponent(n)):void this.trigger("error",{message:"EXT-X-DEFINE: No query param ".concat(e.attributes.QUERYPARAM)})}return"NAME"in e.attributes?"IMPORT"in e.attributes?void this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"}):"VALUE"in e.attributes&&"string"===typeof e.attributes.VALUE?void t(e.attributes.NAME,e.attributes.VALUE):void this.trigger("error",{message:"EXT-X-DEFINE: No value for ".concat(e.attributes.NAME)}):"IMPORT"in e.attributes?this.mainDefinitions[e.attributes.IMPORT]?void t(e.attributes.IMPORT,this.mainDefinitions[e.attributes.IMPORT]):void this.trigger("error",{message:"EXT-X-DEFINE: No value ".concat(e.attributes.IMPORT," to import, or IMPORT used on main playlist")}):void this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:e.attributes,uri:e.uri,timeline:c}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",e.attributes,["BANDWIDTH","URI"])}}[e.tagType]||o).call(t)},uri(){s.uri=e.uri,n.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),r&&(s.key=r),s.timeline=c,i&&(s.map=i),d=0,null!==this.lastProgramDateTime&&(s.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=1e3*s.duration),s={}},comment(){},custom(){e.segment?(s.custom=s.custom||{},s.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(t)})}requiredCompatibilityversion(e,t){(e<t||!e)&&this.trigger("warn",{message:"manifest must be at least version ".concat(t)})}warnOnMissingAttributes_(e,t,n){const i=[];n.forEach(function(e){t.hasOwnProperty(e)||i.push(e)}),i.length&&this.trigger("warn",{message:"".concat(e," lacks required attribute(s): ").concat(i.join(", "))})}push(e){this.lineStream.push(e)}end(){this.lineStream.push("\n"),this.manifest.dateRanges.length&&null===this.lastProgramDateTime&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var S={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},C=["video","audio","text"],I=["Video","Audio","Text"],E=function(e){return e?e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,n){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(n).toString(16)).slice(-2)}):e},N=function(e){void 0===e&&(e="");var t=e.split(","),n=[];return t.forEach(function(e){var t;e=e.trim(),C.forEach(function(i){var r=S[i].exec(e.toLowerCase());if(r&&!(r.length<=1)){t=i;var s=e.substring(0,r[1].length),a=e.replace(s,"");n.push({type:s,details:a,mediaType:i})}}),t||n.push({type:e,details:"",mediaType:"unknown"})}),n},A=function(e){return void 0===e&&(e=""),S.audio.test(e.trim().toLowerCase())},R=function(e){if(e&&"string"===typeof e){var t,n=e.toLowerCase().split(",").map(function(e){return E(e.trim())}),i="video";1===n.length&&A(n[0])?i="audio":1===n.length&&(void 0===(t=n[0])&&(t=""),S.text.test(t.trim().toLowerCase()))&&(i="application");var r="mp4";return n.every(function(e){return S.mp4.test(e)})?r="mp4":n.every(function(e){return S.webm.test(e)})?r="webm":n.every(function(e){return S.ogg.test(e)})&&(r="ogg"),i+"/"+r+';codecs="'+e+'"'}},D=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=!1),r().MediaSource&&r().MediaSource.isTypeSupported&&r().MediaSource.isTypeSupported(R(e))||t&&r().ManagedMediaSource&&r().ManagedMediaSource.isTypeSupported&&r().ManagedMediaSource.isTypeSupported(R(e))||!1},O=function(e){return void 0===e&&(e=""),e.toLowerCase().split(",").every(function(e){e=e.trim();for(var t=0;t<I.length;t++){if(S["muxer"+I[t]].test(e))return!0}return!1})},L="mp4a.40.2",P=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,F=/^application\/dash\+xml/i,M=function(e){return P.test(e)?"hls":F.test(e)?"dash":"application/vnd.videojs.vhs+json"===e?"vhs-json":null},U=function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},B=function(e){return e instanceof Uint8Array?e:(Array.isArray(e)||U(e)||e instanceof ArrayBuffer||(e="number"!==typeof e||"number"===typeof e&&e!==e?0:[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},z=r().BigInt||Number,V=[z("0x1"),z("0x100"),z("0x10000"),z("0x1000000"),z("0x100000000"),z("0x10000000000"),z("0x1000000000000"),z("0x100000000000000"),z("0x10000000000000000")],j=(function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}(),function(e,t){var n=void 0===t?{}:t,i=n.signed,r=void 0!==i&&i,s=n.le,a=void 0!==s&&s;e=B(e);var o=a?"reduce":"reduceRight",l=(e[o]?e[o]:Array.prototype[o]).call(e,function(t,n,i){var r=a?i:Math.abs(i+1-e.length);return t+z(n)*V[r]},z(0));if(r){var c=V[e.length]/z(2)-z(1);(l=z(l))>c&&(l-=c,l-=c,l-=z(2))}return Number(l)}),W=function(e,t){var n=(void 0===t?{}:t).le,i=void 0!==n&&n;("bigint"!==typeof e&&"number"!==typeof e||"number"===typeof e&&e!==e)&&(e=0),e=z(e);for(var r,s=(r=e,Math.ceil(function(e){return e.toString(2).length}(r)/8)),a=new Uint8Array(new ArrayBuffer(s)),o=0;o<s;o++){var l=i?o:Math.abs(o+1-a.length);a[l]=Number(e/V[o]&z(255)),e<0&&(a[l]=Math.abs(~a[l]),a[l]-=0===o?1:2)}return a},H=function(e,t){if("string"!==typeof e&&e&&"function"===typeof e.toString&&(e=e.toString()),"string"!==typeof e)return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n},G=function(e,t,n){var i=void 0===n?{}:n,r=i.offset,s=void 0===r?0:r,a=i.mask,o=void 0===a?[]:a;e=B(e);var l=(t=B(t)).every?t.every:Array.prototype.every;return t.length&&e.length-s>=t.length&&l.call(t,function(t,n){return t===(o[n]?o[n]&e[s+n]:e[s+n])})},q=n(820);const X=e=>!!e&&"object"===typeof e,K=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>("object"!==typeof t||Object.keys(t).forEach(n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):X(e[n])&&X(t[n])?e[n]=K(e[n],t[n]):e[n]=t[n]}),e),{})},Y=e=>Object.keys(e).map(t=>e[t]),Q=e=>e.reduce((e,t)=>e.concat(t),[]),$=e=>{if(!e.length)return[];const t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t};var J="INVALID_NUMBER_OF_PERIOD",Z="DASH_EMPTY_MANIFEST",ee="DASH_INVALID_XML",te="NO_BASE_URL",ne="SEGMENT_TIME_UNSPECIFIED",ie="UNSUPPORTED_UTC_TIMING_SCHEME";const re=e=>{let{baseUrl:t="",source:n="",range:i="",indexRange:s=""}=e;const a={uri:n,resolvedUri:p(t||"",n)};if(i||s){const e=(i||s).split("-");let t,n=r().BigInt?r().BigInt(e[0]):parseInt(e[0],10),o=r().BigInt?r().BigInt(e[1]):parseInt(e[1],10);n<Number.MAX_SAFE_INTEGER&&"bigint"===typeof n&&(n=Number(n)),o<Number.MAX_SAFE_INTEGER&&"bigint"===typeof o&&(o=Number(o)),t="bigint"===typeof o||"bigint"===typeof n?r().BigInt(o)-r().BigInt(n)+r().BigInt(1):o-n+1,"bigint"===typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),a.byterange={length:t,offset:n}}return a},se=e=>(e&&"number"!==typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e),ae={static(e){const{duration:t,timescale:n=1,sourceDuration:i,periodDuration:r}=e,s=se(e.endNumber),a=t/n;return"number"===typeof s?{start:0,end:s}:"number"===typeof r?{start:0,end:r/a}:{start:0,end:i/a}},dynamic(e){const{NOW:t,clientOffset:n,availabilityStartTime:i,timescale:r=1,duration:s,periodStart:a=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:l=1/0}=e,c=se(e.endNumber),u=(t+n)/1e3,h=i+a,d=u+o-h,p=Math.ceil(d*r/s),f=Math.floor((u-h-l)*r/s),g=Math.floor((u-h)*r/s);return{start:Math.max(0,f),end:"number"===typeof c?c:Math.min(p,g)}}},oe=e=>{const{type:t,duration:n,timescale:i=1,periodDuration:r,sourceDuration:s}=e,{start:a,end:o}=ae[t](e),l=((e,t)=>{const n=[];for(let i=e;i<t;i++)n.push(i);return n})(a,o).map((e=>t=>{const{duration:n,timescale:i=1,periodStart:r,startNumber:s=1}=e;return{number:s+t,duration:n/i,timeline:r,time:t*n}})(e));if("static"===t){const e=l.length-1,t="number"===typeof r?r:s;l[e].duration=t-n/i*e}return l},le=e=>{const{baseUrl:t,initialization:n={},sourceDuration:i,indexRange:r="",periodStart:s,presentationTime:a,number:o=0,duration:l}=e;if(!t)throw new Error(te);const c=re({baseUrl:t,source:n.sourceURL,range:n.range}),u=re({baseUrl:t,source:t,indexRange:r});if(u.map=c,l){const t=oe(e);t.length&&(u.duration=t[0].duration,u.timeline=t[0].timeline)}else i&&(u.duration=i,u.timeline=s);return u.presentationTime=a||s,u.number=o,[u]},ce=(e,t,n)=>{const i=e.sidx.map?e.sidx.map:null,s=e.sidx.duration,a=e.timeline||0,o=e.sidx.byterange,l=o.offset+o.length,c=t.timescale,u=t.references.filter(e=>1!==e.referenceType),h=[],d=e.endList?"static":"dynamic",p=e.sidx.timeline;let f,g=p,m=e.mediaSequence||0;f="bigint"===typeof t.firstOffset?r().BigInt(l)+t.firstOffset:l+t.firstOffset;for(let y=0;y<u.length;y++){const e=t.references[y],o=e.referencedSize,l=e.subsegmentDuration;let u;u="bigint"===typeof f?f+r().BigInt(o)-r().BigInt(1):f+o-1;const b="".concat(f,"-").concat(u),v=le({baseUrl:n,timescale:c,timeline:a,periodStart:p,presentationTime:g,number:m,duration:l,sourceDuration:s,indexRange:b,type:d})[0];i&&(v.map=i),h.push(v),f+="bigint"===typeof f?r().BigInt(o):o,g+=l/c,m++}return e.segments=h,e},ue=["AUDIO","SUBTITLES"],he=1/60,de=e=>{return(t=e,n=e=>{let{timeline:t}=e;return t},Y(t.reduce((e,t)=>(t.forEach(t=>{e[n(t)]=t}),e),{}))).sort((e,t)=>e.timeline>t.timeline?1:-1);var t,n},pe=e=>{let t=[];var n,i;return n=e,i=(e,n,i,r)=>{t=t.concat(e.playlists||[])},ue.forEach(function(e){for(var t in n.mediaGroups[e])for(var r in n.mediaGroups[e][t]){var s=n.mediaGroups[e][t][r];i(s,e,t,r)}}),t},fe=e=>{let{playlist:t,mediaSequence:n}=e;t.mediaSequence=n,t.segments.forEach((e,n)=>{e.number=t.mediaSequence+n})},ge=e=>{let{oldManifest:t,newManifest:n}=e;const i=t.playlists.concat(pe(t)),r=n.playlists.concat(pe(n));return n.timelineStarts=de([t.timelineStarts,n.timelineStarts]),(e=>{let{oldPlaylists:t,newPlaylists:n,timelineStarts:i}=e;n.forEach(e=>{e.discontinuitySequence=i.findIndex(function(t){let{timeline:n}=t;return n===e.timeline});const n=((e,t)=>{for(let n=0;n<e.length;n++)if(e[n].attributes.NAME===t)return e[n];return null})(t,e.attributes.NAME);if(!n)return;if(e.sidx)return;const r=e.segments[0],s=n.segments.findIndex(function(e){return Math.abs(e.presentationTime-r.presentationTime)<he});if(-1===s)return fe({playlist:e,mediaSequence:n.mediaSequence+n.segments.length}),e.segments[0].discontinuity=!0,e.discontinuityStarts.unshift(0),void((!n.segments.length&&e.timeline>n.timeline||n.segments.length&&e.timeline>n.segments[n.segments.length-1].timeline)&&e.discontinuitySequence--);n.segments[s].discontinuity&&!r.discontinuity&&(r.discontinuity=!0,e.discontinuityStarts.unshift(0),e.discontinuitySequence--),fe({playlist:e,mediaSequence:n.segments[s].number})})})({oldPlaylists:i,newPlaylists:r,timelineStarts:n.timelineStarts}),n},me=e=>e&&e.uri+"-"+(e=>{let t;return t="bigint"===typeof e.offset||"bigint"===typeof e.length?r().BigInt(e.offset)+r().BigInt(e.length)-r().BigInt(1):e.offset+e.length-1,"".concat(e.offset,"-").concat(t)})(e.byterange),ye=e=>{const t=e.reduce(function(e,t){return e[t.attributes.baseUrl]||(e[t.attributes.baseUrl]=[]),e[t.attributes.baseUrl].push(t),e},{});let n=[];return Object.values(t).forEach(e=>{const t=Y(e.reduce((e,t)=>{const n=t.attributes.id+(t.attributes.lang||"");return e[n]?(t.segments&&(t.segments[0]&&(t.segments[0].discontinuity=!0),e[n].segments.push(...t.segments)),t.attributes.contentProtection&&(e[n].attributes.contentProtection=t.attributes.contentProtection)):(e[n]=t,e[n].attributes.timelineStarts=[]),e[n].attributes.timelineStarts.push({start:t.attributes.periodStart,timeline:t.attributes.periodStart}),e},{}));n=n.concat(t)}),n.map(e=>{var t,n;return e.discontinuityStarts=(t=e.segments||[],n="discontinuity",t.reduce((e,t,i)=>(t[n]&&e.push(i),e),[])),e})},be=(e,t)=>{const n=me(e.sidx),i=n&&t[n]&&t[n].sidx;return i&&ce(e,i,e.sidx.resolvedUri),e},ve=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Object.keys(t).length)return e;for(const n in e)e[n]=be(e[n],t);return e},_e=e=>{let{attributes:t,segments:n,sidx:i,discontinuityStarts:r}=e;const s={attributes:{NAME:t.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:t.width,height:t.height},CODECS:t.codecs,BANDWIDTH:t.bandwidth,"PROGRAM-ID":1},uri:"",endList:"static"===t.type,timeline:t.periodStart,resolvedUri:t.baseUrl||"",targetDuration:t.duration,discontinuityStarts:r,timelineStarts:t.timelineStarts,segments:n};return t.frameRate&&(s.attributes["FRAME-RATE"]=t.frameRate),t.contentProtection&&(s.contentProtection=t.contentProtection),t.serviceLocation&&(s.attributes.serviceLocation=t.serviceLocation),i&&(s.sidx=i),s},xe=e=>{let{attributes:t}=e;return"video/mp4"===t.mimeType||"video/webm"===t.mimeType||"video"===t.contentType},we=e=>{let{attributes:t}=e;return"audio/mp4"===t.mimeType||"audio/webm"===t.mimeType||"audio"===t.contentType},Te=e=>{let{attributes:t}=e;return"text/vtt"===t.mimeType||"text"===t.contentType},ke=e=>e?Object.keys(e).reduce((t,n)=>{const i=e[n];return t.concat(i.playlists)},[]):[],Se=e=>{let{dashPlaylists:t,locations:n,contentSteering:i,sidxMapping:r={},previousManifest:s,eventStream:a}=e;if(!t.length)return{};const{sourceDuration:o,type:l,suggestedPresentationDelay:c,minimumUpdatePeriod:u}=t[0].attributes,h=ye(t.filter(xe)).map(_e),d=ye(t.filter(we)),p=ye(t.filter(Te)),f=t.map(e=>e.attributes.captionServices).filter(Boolean),g={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:o,playlists:ve(h,r)};u>=0&&(g.minimumUpdatePeriod=1e3*u),n&&(g.locations=n),i&&(g.contentSteering=i),"dynamic"===l&&(g.suggestedPresentationDelay=c),a&&a.length>0&&(g.eventStream=a);const m=0===g.playlists.length,y=d.length?function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.reduce((e,r)=>{const s=r.attributes.role&&r.attributes.role.value||"",a=r.attributes.lang||"";let o=r.attributes.label||"main";if(a&&!r.attributes.label){const e=s?" (".concat(s,")"):"";o="".concat(r.attributes.lang).concat(e)}e[o]||(e[o]={language:a,autoselect:!0,default:"main"===s,playlists:[],uri:""});const l=be(((e,t)=>{let{attributes:n,segments:i,sidx:r,mediaSequence:s,discontinuitySequence:a,discontinuityStarts:o}=e;const l={attributes:{NAME:n.id,BANDWIDTH:n.bandwidth,CODECS:n.codecs,"PROGRAM-ID":1},uri:"",endList:"static"===n.type,timeline:n.periodStart,resolvedUri:n.baseUrl||"",targetDuration:n.duration,discontinuitySequence:a,discontinuityStarts:o,timelineStarts:n.timelineStarts,mediaSequence:s,segments:i};return n.contentProtection&&(l.contentProtection=n.contentProtection),n.serviceLocation&&(l.attributes.serviceLocation=n.serviceLocation),r&&(l.sidx=r),t&&(l.attributes.AUDIO="audio",l.attributes.SUBTITLES="subs"),l})(r,i),n);return e[o].playlists.push(l),"undefined"===typeof t&&"main"===s&&(t=r,t.default=!0),e},{});t||(r[Object.keys(r)[0]].default=!0);return r}(d,r,m):null,b=p.length?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.reduce((e,n)=>{const i=n.attributes.label||n.attributes.lang||"text",r=n.attributes.lang||"und";return e[i]||(e[i]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),e[i].playlists.push(be((e=>{let{attributes:t,segments:n,mediaSequence:i,discontinuityStarts:r,discontinuitySequence:s}=e;"undefined"===typeof n&&(n=[{uri:t.baseUrl,timeline:t.periodStart,resolvedUri:t.baseUrl||"",duration:t.sourceDuration,number:0}],t.duration=t.sourceDuration);const a={NAME:t.id,BANDWIDTH:t.bandwidth,"PROGRAM-ID":1};t.codecs&&(a.CODECS=t.codecs);const o={attributes:a,uri:"",endList:"static"===t.type,timeline:t.periodStart,resolvedUri:t.baseUrl||"",targetDuration:t.duration,timelineStarts:t.timelineStarts,discontinuityStarts:r,discontinuitySequence:s,mediaSequence:i,segments:n};return t.serviceLocation&&(o.attributes.serviceLocation=t.serviceLocation),o})(n),t)),e},{})}(p,r):null,v=h.concat(ke(y),ke(b)),_=v.map(e=>{let{timelineStarts:t}=e;return t});var x,w;return g.timelineStarts=de(_),x=v,w=g.timelineStarts,x.forEach(e=>{e.mediaSequence=0,e.discontinuitySequence=w.findIndex(function(t){let{timeline:n}=t;return n===e.timeline}),e.segments&&e.segments.forEach((e,t)=>{e.number=t})}),y&&(g.mediaGroups.AUDIO.audio=y),b&&(g.mediaGroups.SUBTITLES.subs=b),f.length&&(g.mediaGroups["CLOSED-CAPTIONS"].cc=f.reduce((e,t)=>t?(t.forEach(t=>{const{channel:n,language:i}=t;e[i]={autoselect:!1,default:!1,instreamId:n,language:i},t.hasOwnProperty("aspectRatio")&&(e[i].aspectRatio=t.aspectRatio),t.hasOwnProperty("easyReader")&&(e[i].easyReader=t.easyReader),t.hasOwnProperty("3D")&&(e[i]["3D"]=t["3D"])}),e):e,{})),s?ge({oldManifest:s,newManifest:g}):g},Ce=(e,t,n)=>{const{NOW:i,clientOffset:r,availabilityStartTime:s,timescale:a=1,periodStart:o=0,minimumUpdatePeriod:l=0}=e,c=(i+r)/1e3+l-(s+o);return Math.ceil((c*a-t)/n)},Ie=(e,t)=>{const{type:n,minimumUpdatePeriod:i=0,media:r="",sourceDuration:s,timescale:a=1,startNumber:o=1,periodStart:l}=e,c=[];let u=-1;for(let h=0;h<t.length;h++){const d=t[h],p=d.d,f=d.r||0,g=d.t||0;let m;if(u<0&&(u=g),g&&g>u&&(u=g),f<0){const o=h+1;m=o===t.length?"dynamic"===n&&i>0&&r.indexOf("$Number$")>0?Ce(e,u,p):(s*a-u)/p:(t[o].t-u)/p}else m=f+1;const y=o+c.length+m;let b=o+c.length;for(;b<y;)c.push({number:b,duration:p/a,time:u,timeline:l}),u+=p,b++}return c},Ee=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,Ne=(e,t)=>e.replace(Ee,(e=>(t,n,i,r)=>{if("$$"===t)return"$";if("undefined"===typeof e[n])return t;const s=""+e[n];return"RepresentationID"===n?s:(r=i?parseInt(r,10):1,s.length>=r?s:"".concat(new Array(r-s.length+1).join("0")).concat(s))})(t)),Ae=(e,t)=>{const n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},{initialization:i={sourceURL:"",range:""}}=e,r=re({baseUrl:e.baseUrl,source:Ne(i.sourceURL,n),range:i.range}),s=((e,t)=>e.duration||t?e.duration?oe(e):Ie(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}])(e,t);return s.map(t=>{n.Number=t.number,n.Time=t.time;const i=Ne(e.media||"",n),s=e.timescale||1,a=e.presentationTimeOffset||0,o=e.periodStart+(t.time-a)/s;return{uri:i,timeline:t.timeline,duration:t.duration,resolvedUri:p(e.baseUrl||"",i),map:r,number:t.number,presentationTime:o}})},Re=(e,t)=>{const{duration:n,segmentUrls:i=[],periodStart:r}=e;if(!n&&!t||n&&t)throw new Error(ne);const s=i.map(t=>((e,t)=>{const{baseUrl:n,initialization:i={}}=e,r=re({baseUrl:n,source:i.sourceURL,range:i.range}),s=re({baseUrl:n,source:t.media,range:t.mediaRange});return s.map=r,s})(e,t));let a;n&&(a=oe(e)),t&&(a=Ie(e,t));return a.map((t,n)=>{if(s[n]){const i=s[n],a=e.timescale||1,o=e.presentationTimeOffset||0;return i.timeline=t.timeline,i.duration=t.duration,i.number=t.number,i.presentationTime=r+(t.time-o)/a,i}}).filter(e=>e)},De=e=>{let t,n,{attributes:i,segmentInfo:r}=e;r.template?(n=Ae,t=K(i,r.template)):r.base?(n=le,t=K(i,r.base)):r.list&&(n=Re,t=K(i,r.list));const s={attributes:i};if(!n)return s;const a=n(t,r.segmentTimeline);if(t.duration){const{duration:e,timescale:n=1}=t;t.duration=e/n}else a.length?t.duration=a.reduce((e,t)=>Math.max(e,Math.ceil(t.duration)),0):t.duration=0;return s.attributes=t,s.segments=a,r.base&&t.indexRange&&(s.sidx=a[0],s.segments=[]),s},Oe=(e,t)=>$(e.childNodes).filter(e=>{let{tagName:n}=e;return n===t}),Le=e=>e.textContent.trim(),Pe=e=>{const t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;const[n,i,r,s,a,o]=t.slice(1);return 31536e3*parseFloat(n||0)+2592e3*parseFloat(i||0)+86400*parseFloat(r||0)+3600*parseFloat(s||0)+60*parseFloat(a||0)+parseFloat(o||0)},Fe={mediaPresentationDuration:e=>Pe(e),availabilityStartTime(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:e=>Pe(e),suggestedPresentationDelay:e=>Pe(e),type:e=>e,timeShiftBufferDepth:e=>Pe(e),start:e=>Pe(e),width:e=>parseInt(e,10),height:e=>parseInt(e,10),bandwidth:e=>parseInt(e,10),frameRate:e=>(e=>parseFloat(e.split("/").reduce((e,t)=>e/t)))(e),startNumber:e=>parseInt(e,10),timescale:e=>parseInt(e,10),presentationTimeOffset:e=>parseInt(e,10),duration(e){const t=parseInt(e,10);return isNaN(t)?Pe(e):t},d:e=>parseInt(e,10),t:e=>parseInt(e,10),r:e=>parseInt(e,10),presentationTime:e=>parseInt(e,10),DEFAULT:e=>e},Me=e=>e&&e.attributes?$(e.attributes).reduce((e,t)=>{const n=Fe[t.name]||Fe.DEFAULT;return e[t.name]=n(t.value),e},{}):{},Ue={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},Be=(e,t)=>t.length?Q(e.map(function(e){return t.map(function(t){const n=Le(t),i=p(e.baseUrl,n),r=K(Me(t),{baseUrl:i});return i!==n&&!r.serviceLocation&&e.serviceLocation&&(r.serviceLocation=e.serviceLocation),r})})):e,ze=e=>{const t=Oe(e,"SegmentTemplate")[0],n=Oe(e,"SegmentList")[0],i=n&&Oe(n,"SegmentURL").map(e=>K({tag:"SegmentURL"},Me(e))),r=Oe(e,"SegmentBase")[0],s=n||t,a=s&&Oe(s,"SegmentTimeline")[0],o=n||r||t,l=o&&Oe(o,"Initialization")[0],c=t&&Me(t);c&&l?c.initialization=l&&Me(l):c&&c.initialization&&(c.initialization={sourceURL:c.initialization});const u={template:c,segmentTimeline:a&&Oe(a,"S").map(e=>Me(e)),list:n&&K(Me(n),{segmentUrls:i,initialization:Me(l)}),base:r&&K(Me(r),{initialization:Me(l)})};return Object.keys(u).forEach(e=>{u[e]||delete u[e]}),u},Ve=e=>Q(Oe(e.node,"EventStream").map(t=>{const n=Me(t),i=n.schemeIdUri;return Oe(t,"Event").map(t=>{const r=Me(t),s=r.presentationTime||0,a=n.timescale||1,o=r.duration||0,l=s/a+e.attributes.start;return{schemeIdUri:i,value:n.value,id:r.id,start:l,end:l+o/a,messageData:Le(t)||r.messageData,contentEncoding:n.contentEncoding,presentationTimeOffset:n.presentationTimeOffset||0}})})),je=(e,t,n)=>i=>{const r=Me(i),s=Be(t,Oe(i,"BaseURL")),a=Oe(i,"Role")[0],o={role:Me(a)};let l=K(e,r,o);const c=Oe(i,"Accessibility")[0],u=(e=>{if("urn:scte:dash:cc:cea-608:2015"===e.schemeIdUri)return("string"!==typeof e.value?[]:e.value.split(";")).map(e=>{let t,n;return n=e,/^CC\d=/.test(e)?[t,n]=e.split("="):/^CC\d$/.test(e)&&(t=e),{channel:t,language:n}});if("urn:scte:dash:cc:cea-708:2015"===e.schemeIdUri)return("string"!==typeof e.value?[]:e.value.split(";")).map(e=>{const t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){const[n,i=""]=e.split("=");t.channel=n,t.language=e,i.split(",").forEach(e=>{const[n,i]=e.split(":");"lang"===n?t.language=i:"er"===n?t.easyReader=Number(i):"war"===n?t.aspectRatio=Number(i):"3D"===n&&(t["3D"]=Number(i))})}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t})})(Me(c));u&&(l=K(l,{captionServices:u}));const h=Oe(i,"Label")[0];if(h&&h.childNodes.length){const e=h.childNodes[0].nodeValue.trim();l=K(l,{label:e})}const d=Oe(i,"ContentProtection").reduce((e,t)=>{const n=Me(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const i=Ue[n.schemeIdUri];if(i){e[i]={attributes:n};const r=Oe(t,"cenc:pssh")[0];if(r){const t=Le(r);e[i].pssh=t&&g(t)}}return e},{});Object.keys(d).length&&(l=K(l,{contentProtection:d}));const p=ze(i),f=Oe(i,"Representation"),m=K(n,p);return Q(f.map(((e,t,n)=>i=>{const r=Oe(i,"BaseURL"),s=Be(t,r),a=K(e,Me(i)),o=ze(i);return s.map(e=>({segmentInfo:K(n,o),attributes:K(a,e)}))})(l,s,m)))},We=(e,t)=>(n,i)=>{const r=Be(t,Oe(n.node,"BaseURL")),s=K(e,{periodStart:n.attributes.start});"number"===typeof n.attributes.duration&&(s.periodDuration=n.attributes.duration);const a=Oe(n.node,"AdaptationSet"),o=ze(n.node);return Q(a.map(je(s,r,o)))},He=(e,t)=>{if(e.length>1&&t({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!e.length)return null;const n=K({serverURL:Le(e[0])},Me(e[0]));return n.queryBeforeStart="true"===n.queryBeforeStart,n},Ge=e=>{if(""===e)throw new Error(Z);const t=new q.DOMParser;let n,i;try{n=t.parseFromString(e,"application/xml"),i=n&&"MPD"===n.documentElement.tagName?n.documentElement:null}catch(r){}if(!i||i&&i.getElementsByTagName("parsererror").length>0)throw new Error(ee);return i},qe=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{manifestUri:n="",NOW:i=Date.now(),clientOffset:r=0,eventHandler:s=function(){}}=t,a=Oe(e,"Period");if(!a.length)throw new Error(J);const o=Oe(e,"Location"),l=Me(e),c=Be([{baseUrl:n}],Oe(e,"BaseURL")),u=Oe(e,"ContentSteering");l.type=l.type||"static",l.sourceDuration=l.mediaPresentationDuration||0,l.NOW=i,l.clientOffset=r,o.length&&(l.locations=o.map(Le));const h=[];return a.forEach((e,t)=>{const n=Me(e),i=h[t-1];n.start=(e=>{let{attributes:t,priorPeriodAttributes:n,mpdType:i}=e;return"number"===typeof t.start?t.start:n&&"number"===typeof n.start&&"number"===typeof n.duration?n.start+n.duration:n||"static"!==i?null:0})({attributes:n,priorPeriodAttributes:i?i.attributes:null,mpdType:l.type}),h.push({node:e,attributes:n})}),{locations:l.locations,contentSteeringInfo:He(u,s),representationInfo:Q(h.map(We(l,c))),eventStream:Q(h.map(Ve))}}(Ge(e),t),i=n.representationInfo.map(De);return Se({dashPlaylists:i,locations:n.locations,contentSteering:n.contentSteeringInfo,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest,eventStream:n.eventStream})},Xe=e=>(e=>{const t=Oe(e,"UTCTiming")[0];if(!t)return null;const n=Me(t);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;default:throw new Error(ie)}return n})(Ge(e));var Ke,Ye=n(24),Qe=n.n(Ye),$e=B([73,68,51]),Je=function e(t,n){return void 0===n&&(n=0),(t=B(t)).length-n<10||!G(t,$e,{offset:n})?n:(n+=function(e,t){void 0===t&&(t=0);var n=(e=B(e))[t+5],i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&n)>>4?i+20:i+10}(t,n),e(t,n))},Ze=(new Uint8Array([79,112,117,115,72,101,97,100]),function(e){return"string"===typeof e?H(e):e}),et=function(e){e=B(e);for(var t=[],n=0;e.length>n;){var i=e[n],r=0,s=0,a=e[++s];for(s++;128&a;)r=(127&a)<<7,a=e[s],s++;r+=127&a;for(var o=0;o<Ke.length;o++){var l=Ke[o],c=l.id,u=l.parser;if(i===c){t.push(u(e.subarray(s,s+r)));break}}n+=r+s}return t};Ke=[{id:3,parser:function(e){var t={tag:3,id:e[0]<<8|e[1],flags:e[2],size:3,dependsOnEsId:0,ocrEsId:0,descriptors:[],url:""};if(128&t.flags&&(t.dependsOnEsId=e[t.size]<<8|e[t.size+1],t.size+=2),64&t.flags){var n=e[t.size];t.url=function(e){if(!e)return"";e=Array.prototype.slice.call(e);var t=String.fromCharCode.apply(null,B(e));try{return decodeURIComponent(escape(t))}catch(n){}return t}(e.subarray(t.size+1,t.size+1+n)),t.size+=n}return 32&t.flags&&(t.ocrEsId=e[t.size]<<8|e[t.size+1],t.size+=2),t.descriptors=et(e.subarray(t.size))||[],t}},{id:4,parser:function(e){return{tag:4,oti:e[0],streamType:e[1],bufferSize:e[2]<<16|e[3]<<8|e[4],maxBitrate:e[5]<<24|e[6]<<16|e[7]<<8|e[8],avgBitrate:e[9]<<24|e[10]<<16|e[11]<<8|e[12],descriptors:et(e.subarray(13))}}},{id:5,parser:function(e){return{tag:5,bytes:e}}},{id:6,parser:function(e){return{tag:6,bytes:e}}}];var tt=function e(t,n,i){void 0===i&&(i=!1),n=function(e){return Array.isArray(e)?e.map(function(e){return Ze(e)}):[Ze(e)]}(n),t=B(t);var r=[];if(!n.length)return r;for(var s=0;s<t.length;){var a=(t[s]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3])>>>0,o=t.subarray(s+4,s+8);if(0===a)break;var l=s+a;if(l>t.length){if(i)break;l=t.length}var c=t.subarray(s+8,l);G(o,n[0])&&(1===n.length?r.push(c):r.push.apply(r,e(c,n.slice(1),i))),s=l}return r},nt={EBML:B([26,69,223,163]),DocType:B([66,130]),Segment:B([24,83,128,103]),SegmentInfo:B([21,73,169,102]),Tracks:B([22,84,174,107]),Track:B([174]),TrackNumber:B([215]),DefaultDuration:B([35,227,131]),TrackEntry:B([174]),TrackType:B([131]),FlagDefault:B([136]),CodecID:B([134]),CodecPrivate:B([99,162]),VideoTrack:B([224]),AudioTrack:B([225]),Cluster:B([31,67,182,117]),Timestamp:B([231]),TimestampScale:B([42,215,177]),BlockGroup:B([160]),BlockDuration:B([155]),Block:B([161]),SimpleBlock:B([163])},it=[128,64,32,16,8,4,2,1],rt=function(e,t,n,i){void 0===n&&(n=!0),void 0===i&&(i=!1);var r=function(e){for(var t=1,n=0;n<it.length&&!(e&it[n]);n++)t++;return t}(e[t]),s=e.subarray(t,t+r);return n&&((s=Array.prototype.slice.call(e,t,t+r))[0]^=it[r-1]),{length:r,value:j(s,{signed:i}),bytes:s}},st=function e(t){return"string"===typeof t?t.match(/.{1,2}/g).map(function(t){return e(t)}):"number"===typeof t?W(t):t},at=function e(t,n,i){if(i>=n.length)return n.length;var r=rt(n,i,!1);if(G(t.bytes,r.bytes))return i;var s=rt(n,i+r.length);return e(t,n,i+s.length+s.value+r.length)},ot=function e(t,n){n=function(e){return Array.isArray(e)?e.map(function(e){return st(e)}):[st(e)]}(n),t=B(t);var i=[];if(!n.length)return i;for(var r=0;r<t.length;){var s=rt(t,r,!1),a=rt(t,r+s.length),o=r+s.length+a.length;127===a.value&&(a.value=at(s,t,o),a.value!==t.length&&(a.value-=o));var l=o+a.value>t.length?t.length:o+a.value,c=t.subarray(o,l);G(n[0],s.bytes)&&(1===n.length?i.push(c):i=i.concat(e(c,n.slice(1)))),r+=s.length+a.length+c.length}return i},lt=B([0,0,0,1]),ct=B([0,0,1]),ut=B([0,0,3]),ht=function(e){for(var t=[],n=1;n<e.length-2;)G(e.subarray(n,n+3),ut)&&(t.push(n+2),n++),n++;if(0===t.length)return e;var i=e.length-t.length,r=new Uint8Array(i),s=0;for(n=0;n<i;s++,n++)s===t[0]&&(s++,t.shift()),r[n]=e[s];return r},dt=function(e,t,n,i){void 0===i&&(i=1/0),e=B(e),n=[].concat(n);for(var r,s=0,a=0;s<e.length&&(a<i||r);){var o=void 0;if(G(e.subarray(s),lt)?o=4:G(e.subarray(s),ct)&&(o=3),o){if(a++,r)return ht(e.subarray(r,s));var l=void 0;"h264"===t?l=31&e[s+o]:"h265"===t&&(l=e[s+o]>>1&63),-1!==n.indexOf(l)&&(r=s+o),s+=o+("h264"===t?1:2)}else s++}return e.subarray(0,0)},pt={webm:B([119,101,98,109]),matroska:B([109,97,116,114,111,115,107,97]),flac:B([102,76,97,67]),ogg:B([79,103,103,83]),ac3:B([11,119]),riff:B([82,73,70,70]),avi:B([65,86,73]),wav:B([87,65,86,69]),"3gp":B([102,116,121,112,51,103]),mp4:B([102,116,121,112]),fmp4:B([115,116,121,112]),mov:B([102,116,121,112,113,116]),moov:B([109,111,111,118]),moof:B([109,111,111,102])},ft={aac:function(e){var t=Je(e);return G(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Je(e);return G(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=ot(e,[nt.EBML,nt.DocType])[0];return G(t,pt.webm)},mkv:function(e){var t=ot(e,[nt.EBML,nt.DocType])[0];return G(t,pt.matroska)},mp4:function(e){return!ft["3gp"](e)&&!ft.mov(e)&&(!(!G(e,pt.mp4,{offset:4})&&!G(e,pt.fmp4,{offset:4}))||(!(!G(e,pt.moof,{offset:4})&&!G(e,pt.moov,{offset:4}))||void 0))},mov:function(e){return G(e,pt.mov,{offset:4})},"3gp":function(e){return G(e,pt["3gp"],{offset:4})},ac3:function(e){var t=Je(e);return G(e,pt.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return 71===e[0];for(var t=0;t+188<e.length&&t<188;){if(71===e[t]&&71===e[t+188])return!0;t+=1}return!1},flac:function(e){var t=Je(e);return G(e,pt.flac,{offset:t})},ogg:function(e){return G(e,pt.ogg)},avi:function(e){return G(e,pt.riff)&&G(e,pt.avi,{offset:8})},wav:function(e){return G(e,pt.riff)&&G(e,pt.wav,{offset:8})},h264:function(e){return function(e,t,n){return dt(e,"h264",t,n)}(e,7,3).length},h265:function(e){return function(e,t,n){return dt(e,"h265",t,n)}(e,[32,33],3).length}},gt=Object.keys(ft).filter(function(e){return"ts"!==e&&"h264"!==e&&"h265"!==e}).concat(["ts","h264","h265"]);gt.forEach(function(e){var t=ft[e];ft[e]=function(e){return t(B(e))}});var mt=ft,yt=function(e){e=B(e);for(var t=0;t<gt.length;t++){var n=gt[t];if(mt[n](e))return n}return""},bt=n(356),vt="8.23.4";const _t={},xt=function(e,t){return _t[e]=_t[e]||[],t&&(_t[e]=_t[e].concat(t)),_t[e]},wt=function(e,t){const n=xt(e).indexOf(t);return!(n<=-1)&&(_t[e]=_t[e].slice(),_t[e].splice(n,1),!0)},Tt={prefixed:!0},kt=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],St=kt[0];let Ct;for(let Cu=0;Cu<kt.length;Cu++)if(kt[Cu][1]in a()){Ct=kt[Cu];break}if(Ct){for(let e=0;e<Ct.length;e++)Tt[St[e]]=Ct[e];Tt.prefixed=Ct[0]!==St[0]}let It=[];const Et=function e(t){let n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a="info";function o(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n("log",a,t)}return n=((e,t,n)=>(i,s,a)=>{const o=t.levels[s],l=new RegExp("^(".concat(o,")$"));let c=e;if("log"!==i&&a.unshift(i.toUpperCase()+":"),n&&(c="%c".concat(e),a.unshift(n)),a.unshift(c+":"),It){It.push([].concat(a));const e=It.length-1e3;It.splice(0,e>0?e:0)}if(!r().console)return;let u=r().console[i];u||"debug"!==i||(u=r().console.info||r().console.log),u&&o&&l.test(i)&&u[Array.isArray(a)?"apply":"call"](r().console,a)})(t,o,s),o.createLogger=(n,r,a)=>{const o=void 0!==r?r:i,l=void 0!==a?a:s;return e("".concat(t," ").concat(o," ").concat(n),o,l)},o.createNewLogger=(t,n,i)=>e(t,n,i),o.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:a},o.level=e=>{if("string"===typeof e){if(!o.levels.hasOwnProperty(e))throw new Error('"'.concat(e,'" in not a valid log level'));a=e}return a},o.history=()=>It?[].concat(It):[],o.history.filter=e=>(It||[]).filter(t=>new RegExp(".*".concat(e,".*")).test(t[0])),o.history.clear=()=>{It&&(It.length=0)},o.history.disable=()=>{null!==It&&(It.length=0,It=null)},o.history.enable=()=>{null===It&&(It=[])},o.error=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n("error",a,t)},o.warn=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n("warn",a,t)},o.debug=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n("debug",a,t)},o}("VIDEOJS"),Nt=Et.createLogger,At=Object.prototype.toString,Rt=function(e){return Lt(e)?Object.keys(e):[]};function Dt(e,t){Rt(e).forEach(n=>t(e[n],n))}function Ot(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Rt(e).reduce((n,i)=>t(n,e[i],i),n)}function Lt(e){return!!e&&"object"===typeof e}function Pt(e){return Lt(e)&&"[object Object]"===At.call(e)&&e.constructor===Object}function Ft(){const e={};for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(t=>{t&&Dt(t,(t,n)=>{Pt(t)?(Pt(e[n])||(e[n]={}),e[n]=Ft(e[n],t)):e[n]=t})}),e}function Mt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=[];for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];t.push(i)}return t}function Ut(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=n=>Object.defineProperty(e,t,{value:n,enumerable:!0,writable:!0}),s={configurable:!0,enumerable:!0,get(){const e=n();return r(e),e}};return i&&(s.set=r),Object.defineProperty(e,t,s)}var Bt=Object.freeze({__proto__:null,each:Dt,reduce:Ot,isObject:Lt,isPlain:Pt,merge:Ft,values:Mt,defineLazyProperty:Ut});let zt,Vt=!1,jt=null,Wt=!1,Ht=!1,Gt=!1,qt=!1,Xt=!1,Kt=null,Yt=null;const Qt=Boolean(r().cast&&r().cast.framework&&r().cast.framework.CastReceiverContext);let $t=null,Jt=!1,Zt=!1,en=!1,tn=!1,nn=!1,rn=!1,sn=!1;const an=Boolean(dn()&&("ontouchstart"in r()||r().navigator.maxTouchPoints||r().DocumentTouch&&r().document instanceof r().DocumentTouch)),on=r().navigator&&r().navigator.userAgentData;if(on&&on.platform&&on.brands&&(Wt="Android"===on.platform,Gt=Boolean(on.brands.find(e=>"Microsoft Edge"===e.brand)),qt=Boolean(on.brands.find(e=>"Chromium"===e.brand)),Xt=!Gt&&qt,Kt=Yt=(on.brands.find(e=>"Chromium"===e.brand)||{}).version||null,Zt="Windows"===on.platform),!qt){const e=r().navigator&&r().navigator.userAgent||"";Vt=/iPod/i.test(e),jt=function(){const t=e.match(/OS (\d+)_/i);return t&&t[1]?t[1]:null}(),Wt=/Android/i.test(e),zt=function(){const t=e.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const n=t[1]&&parseFloat(t[1]),i=t[2]&&parseFloat(t[2]);return n&&i?parseFloat(t[1]+"."+t[2]):n||null}(),Ht=/Firefox/i.test(e),Gt=/Edg/i.test(e),qt=/Chrome/i.test(e)||/CriOS/i.test(e),Xt=!Gt&&qt,Kt=Yt=function(){const t=e.match(/(Chrome|CriOS)\/(\d+)/);return t&&t[2]?parseFloat(t[2]):null}(),$t=function(){const t=/MSIE\s(\d+)\.\d/.exec(e);let n=t&&parseFloat(t[1]);return!n&&/Trident\/7.0/i.test(e)&&/rv:11.0/.test(e)&&(n=11),n}(),nn=/Tizen/i.test(e),rn=/Web0S/i.test(e),sn=nn||rn,Jt=/Safari/i.test(e)&&!Xt&&!Wt&&!Gt&&!sn,Zt=/Windows/i.test(e),en=/iPad/i.test(e)||Jt&&an&&!/iPhone/i.test(e),tn=/iPhone/i.test(e)&&!en}const ln=tn||en||Vt,cn=(Jt||ln)&&!Xt;var un=Object.freeze({__proto__:null,get IS_IPOD(){return Vt},get IOS_VERSION(){return jt},get IS_ANDROID(){return Wt},get ANDROID_VERSION(){return zt},get IS_FIREFOX(){return Ht},get IS_EDGE(){return Gt},get IS_CHROMIUM(){return qt},get IS_CHROME(){return Xt},get CHROMIUM_VERSION(){return Kt},get CHROME_VERSION(){return Yt},IS_CHROMECAST_RECEIVER:Qt,get IE_VERSION(){return $t},get IS_SAFARI(){return Jt},get IS_WINDOWS(){return Zt},get IS_IPAD(){return en},get IS_IPHONE(){return tn},get IS_TIZEN(){return nn},get IS_WEBOS(){return rn},get IS_SMART_TV(){return sn},TOUCH_ENABLED:an,IS_IOS:ln,IS_ANY_SAFARI:cn});function hn(e){return"string"===typeof e&&Boolean(e.trim())}function dn(){return a()===r().document}function pn(e){return Lt(e)&&1===e.nodeType}function fn(){try{return r().parent!==r().self}catch(e){return!0}}function gn(e){return function(t,n){if(!hn(t))return a()[e](null);hn(n)&&(n=a().querySelector(n));const i=pn(n)?n:a();return i[e]&&i[e](t)}}function mn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const r=a().createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){const n=t[e];"textContent"===e?yn(r,n):r[e]===n&&"tabIndex"!==e||(r[e]=n)}),Object.getOwnPropertyNames(n).forEach(function(e){r.setAttribute(e,n[e])}),i&&Fn(r,i),r}function yn(e,t){return"undefined"===typeof e.textContent?e.innerText=t:e.textContent=t,e}function bn(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function vn(e,t){return function(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}(t),e.classList.contains(t)}function _n(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.classList.add(...n.reduce((e,t)=>e.concat(t.split(/\s+/)),[])),e}function xn(e){if(!e)return Et.warn("removeClass was called with an element that doesn't exist"),null;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.classList.remove(...n.reduce((e,t)=>e.concat(t.split(/\s+/)),[])),e}function wn(e,t,n){return"function"===typeof n&&(n=n(e,t)),"boolean"!==typeof n&&(n=void 0),t.split(/\s+/).forEach(t=>e.classList.toggle(t,n)),e}function Tn(e,t){Object.getOwnPropertyNames(t).forEach(function(n){const i=t[n];null===i||"undefined"===typeof i||!1===i?e.removeAttribute(n):e.setAttribute(n,!0===i?"":i)})}function kn(e){const t={},n=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(e&&e.attributes&&e.attributes.length>0){const i=e.attributes;for(let e=i.length-1;e>=0;e--){const r=i[e].name;let s=i[e].value;n.includes(r)&&(s=null!==s),t[r]=s}}return t}function Sn(e,t){return e.getAttribute(t)}function Cn(e,t,n){e.setAttribute(t,n)}function In(e,t){e.removeAttribute(t)}function En(){a().body.focus(),a().onselectstart=function(){return!1}}function Nn(){a().onselectstart=function(){return!0}}function An(e){if(e&&e.getBoundingClientRect&&e.parentNode){const t=e.getBoundingClientRect(),n={};return["bottom","height","left","right","top","width"].forEach(e=>{void 0!==t[e]&&(n[e]=t[e])}),n.height||(n.height=parseFloat(Vn(e,"height"))),n.width||(n.width=parseFloat(Vn(e,"width"))),n}}function Rn(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};const t=e.offsetWidth,n=e.offsetHeight;let i=0,r=0;for(;e.offsetParent&&e!==a()[Tt.fullscreenElement];)i+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{left:i,top:r,width:t,height:n}}function Dn(e,t){const n={x:0,y:0};if(ln){let t=e;for(;t&&"html"!==t.nodeName.toLowerCase();){const e=Vn(t,"transform");if(/^matrix/.test(e)){const t=e.slice(7,-1).split(/,\s/).map(Number);n.x+=t[4],n.y+=t[5]}else if(/^matrix3d/.test(e)){const t=e.slice(9,-1).split(/,\s/).map(Number);n.x+=t[12],n.y+=t[13]}if(t.assignedSlot&&t.assignedSlot.parentElement&&r().WebKitCSSMatrix){const e=r().getComputedStyle(t.assignedSlot.parentElement).transform,i=new(r().WebKitCSSMatrix)(e);n.x+=i.m41,n.y+=i.m42}t=t.parentNode||t.host}}const i={},s=Rn(t.target),a=Rn(e),o=a.width,l=a.height;let c=t.offsetY-(a.top-s.top),u=t.offsetX-(a.left-s.left);return t.changedTouches&&(u=t.changedTouches[0].pageX-a.left,c=t.changedTouches[0].pageY+a.top,ln&&(u-=n.x,c-=n.y)),i.y=1-Math.max(0,Math.min(1,c/l)),i.x=Math.max(0,Math.min(1,u/o)),i}function On(e){return Lt(e)&&3===e.nodeType}function Ln(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function Pn(e){return"function"===typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(e=>("function"===typeof e&&(e=e()),pn(e)||On(e)?e:"string"===typeof e&&/\S/.test(e)?a().createTextNode(e):void 0)).filter(e=>e)}function Fn(e,t){return Pn(t).forEach(t=>e.appendChild(t)),e}function Mn(e,t){return Fn(Ln(e),t)}function Un(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||("mouseup"===e.type&&0===e.button&&0===e.buttons||("mousedown"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons)))}const Bn=gn("querySelector"),zn=gn("querySelectorAll");function Vn(e,t){if(!e||!t)return"";if("function"===typeof r().getComputedStyle){let i;try{i=r().getComputedStyle(e)}catch(n){return""}return i?i.getPropertyValue(t)||i[t]:""}return""}function jn(e){[...a().styleSheets].forEach(t=>{try{const n=[...t.cssRules].map(e=>e.cssText).join(""),i=a().createElement("style");i.textContent=n,e.document.head.appendChild(i)}catch(n){const i=a().createElement("link");i.rel="stylesheet",i.type=t.type,i.media=t.media.mediaText,i.href=t.href,e.document.head.appendChild(i)}})}var Wn=Object.freeze({__proto__:null,isReal:dn,isEl:pn,isInFrame:fn,createEl:mn,textContent:yn,prependTo:bn,hasClass:vn,addClass:_n,removeClass:xn,toggleClass:wn,setAttributes:Tn,getAttributes:kn,getAttribute:Sn,setAttribute:Cn,removeAttribute:In,blockTextSelection:En,unblockTextSelection:Nn,getBoundingClientRect:An,findPosition:Rn,getPointerPosition:Dn,isTextNode:On,emptyEl:Ln,normalizeContent:Pn,appendContent:Fn,insertContent:Mn,isSingleLeftClick:Un,$:Bn,$$:zn,computedStyle:Vn,copyStyleSheetsToWindow:jn});let Hn,Gn=!1;const qn=function(){if(!1===Hn.options.autoSetup)return;const e=Array.prototype.slice.call(a().getElementsByTagName("video")),t=Array.prototype.slice.call(a().getElementsByTagName("audio")),n=Array.prototype.slice.call(a().getElementsByTagName("video-js")),i=e.concat(t,n);if(i&&i.length>0)for(let r=0,s=i.length;r<s;r++){const e=i[r];if(!e||!e.getAttribute){Xn(1);break}if(void 0===e.player){null!==e.getAttribute("data-setup")&&Hn(e)}}else Gn||Xn(1)};function Xn(e,t){dn()&&(t&&(Hn=t),r().setTimeout(qn,e))}function Kn(){Gn=!0,r().removeEventListener("load",Kn)}dn()&&("complete"===a().readyState?Kn():r().addEventListener("load",Kn));const Yn=function(e){const t=a().createElement("style");return t.className=e,t},Qn=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t};var $n=new WeakMap;let Jn,Zn=3;function ei(){return Zn++}function ti(e,t){if(!$n.has(e))return;const n=$n.get(e);0===n.handlers[t].length&&(delete n.handlers[t],e.removeEventListener?e.removeEventListener(t,n.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,n.dispatcher)),Object.getOwnPropertyNames(n.handlers).length<=0&&(delete n.handlers,delete n.dispatcher,delete n.disabled),0===Object.getOwnPropertyNames(n).length&&$n.delete(e)}function ni(e,t,n,i){n.forEach(function(n){e(t,n,i)})}function ii(e){if(e.fixed_)return e;function t(){return!0}function n(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){const i=e||r().event;e={};const s=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const t in i)s.includes(t)||"returnValue"===t&&i.preventDefault||(e[t]=i[t]);if(e.target||(e.target=e.srcElement||a()),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){i.preventDefault&&i.preventDefault(),e.returnValue=!1,i.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){i.stopPropagation&&i.stopPropagation(),e.cancelBubble=!0,i.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=n,e.stopImmediatePropagation=function(){i.stopImmediatePropagation&&i.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=n,null!==e.clientX&&void 0!==e.clientX){const t=a().documentElement,n=a().body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}const ri=["touchstart","touchmove"];function si(e,t,n){if(Array.isArray(t))return ni(si,e,t,n);$n.has(e)||$n.set(e,{});const i=$n.get(e);if(i.handlers||(i.handlers={}),i.handlers[t]||(i.handlers[t]=[]),n.guid||(n.guid=ei()),i.handlers[t].push(n),i.dispatcher||(i.disabled=!1,i.dispatcher=function(t,n){if(i.disabled)return;t=ii(t);const r=i.handlers[t.type];if(r){const i=r.slice(0);for(let r=0,a=i.length;r<a&&!t.isImmediatePropagationStopped();r++)try{i[r].call(e,t,n)}catch(s){Et.error(s)}}}),1===i.handlers[t].length)if(e.addEventListener){let n=!1;(function(){if("boolean"!==typeof Jn){Jn=!1;try{const e=Object.defineProperty({},"passive",{get(){Jn=!0}});r().addEventListener("test",null,e),r().removeEventListener("test",null,e)}catch(e){}}return Jn})()&&ri.indexOf(t)>-1&&(n={passive:!0}),e.addEventListener(t,i.dispatcher,n)}else e.attachEvent&&e.attachEvent("on"+t,i.dispatcher)}function ai(e,t,n){if(!$n.has(e))return;const i=$n.get(e);if(!i.handlers)return;if(Array.isArray(t))return ni(ai,e,t,n);const r=function(e,t){i.handlers[t]=[],ti(e,t)};if(void 0===t){for(const t in i.handlers)Object.prototype.hasOwnProperty.call(i.handlers||{},t)&&r(e,t);return}const s=i.handlers[t];if(s)if(n){if(n.guid)for(let e=0;e<s.length;e++)s[e].guid===n.guid&&s.splice(e--,1);ti(e,t)}else r(e,t)}function oi(e,t,n){const i=$n.has(e)?$n.get(e):{},r=e.parentNode||e.ownerDocument;if("string"===typeof t?t={type:t,target:e}:t.target||(t.target=e),t=ii(t),i.dispatcher&&i.dispatcher.call(e,t,n),r&&!t.isPropagationStopped()&&!0===t.bubbles)oi.call(null,r,t,n);else if(!r&&!t.defaultPrevented&&t.target&&t.target[t.type]){$n.has(t.target)||$n.set(t.target,{});const e=$n.get(t.target);t.target[t.type]&&(e.disabled=!0,"function"===typeof t.target[t.type]&&t.target[t.type](),e.disabled=!1)}return!t.defaultPrevented}function li(e,t,n){if(Array.isArray(t))return ni(li,e,t,n);const i=function(){ai(e,t,i),n.apply(this,arguments)};i.guid=n.guid=n.guid||ei(),si(e,t,i)}function ci(e,t,n){const i=function(){ai(e,t,i),n.apply(this,arguments)};i.guid=n.guid=n.guid||ei(),si(e,t,i)}var ui=Object.freeze({__proto__:null,fixEvent:ii,on:si,off:ai,trigger:oi,one:li,any:ci});const hi=30,di=function(e,t,n){t.guid||(t.guid=ei());const i=t.bind(e);return i.guid=n?n+"_"+t.guid:t.guid,i},pi=function(e,t){let n=r().performance.now();return function(){const i=r().performance.now();i-n>=t&&(e(...arguments),n=i)}},fi=function(e,t,n){let i,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r();const a=function(){const r=this,a=arguments;let o=function(){i=null,o=null,n||e.apply(r,a)};!i&&n&&e.apply(r,a),s.clearTimeout(i),i=s.setTimeout(o,t)};return a.cancel=()=>{s.clearTimeout(i),i=null},a};var gi=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:hi,bind_:di,throttle:pi,debounce:fi});let mi;class yi{on(e,t){const n=this.addEventListener;this.addEventListener=()=>{},si(this,e,t),this.addEventListener=n}off(e,t){ai(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=()=>{},li(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=()=>{},ci(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;"string"===typeof e&&(e={type:t}),e=ii(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),oi(this,e)}queueTrigger(e){mi||(mi=new Map);const t=e.type||e;let n=mi.get(this);n||(n=new Map,mi.set(this,n));const i=n.get(t);n.delete(t),r().clearTimeout(i);const s=r().setTimeout(()=>{n.delete(t),0===n.size&&(n=null,mi.delete(this)),this.trigger(e)},0);n.set(t,s)}}yi.prototype.allowedEvents_={},yi.prototype.addEventListener=yi.prototype.on,yi.prototype.removeEventListener=yi.prototype.off,yi.prototype.dispatchEvent=yi.prototype.trigger;const bi=e=>"function"===typeof e.name?e.name():"string"===typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e,vi=e=>e instanceof yi||!!e.eventBusEl_&&["on","one","off","trigger"].every(t=>"function"===typeof e[t]),_i=e=>"string"===typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length,xi=(e,t,n)=>{if(!e||!e.nodeName&&!vi(e))throw new Error("Invalid target for ".concat(bi(t),"#").concat(n,"; must be a DOM node or evented object."))},wi=(e,t,n)=>{if(!_i(e))throw new Error("Invalid event type for ".concat(bi(t),"#").concat(n,"; must be a non-empty string or array."))},Ti=(e,t,n)=>{if("function"!==typeof e)throw new Error("Invalid listener for ".concat(bi(t),"#").concat(n,"; must be a function."))},ki=(e,t,n)=>{const i=t.length<3||t[0]===e||t[0]===e.eventBusEl_;let r,s,a;return i?(r=e.eventBusEl_,t.length>=3&&t.shift(),[s,a]=t):(r=t[0],s=t[1],a=t[2]),xi(r,e,n),wi(s,e,n),Ti(a,e,n),a=di(e,a),{isTargetingSelf:i,target:r,type:s,listener:a}},Si=(e,t,n,i)=>{xi(e,e,t),e.nodeName?ui[t](e,n,i):e[t](n,i)},Ci={on(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const{isTargetingSelf:i,target:r,type:s,listener:a}=ki(this,t,"on");if(Si(r,"on",s,a),!i){const e=()=>this.off(r,s,a);e.guid=a.guid;const t=()=>this.off("dispose",e);t.guid=a.guid,Si(this,"on","dispose",e),Si(r,"on","dispose",t)}},one(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];const{isTargetingSelf:r,target:s,type:a,listener:o}=ki(this,n,"one");if(r)Si(s,"one",a,o);else{const t=function(){e.off(s,a,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];o.apply(null,i)};t.guid=o.guid,Si(s,"one",a,t)}},any(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];const{isTargetingSelf:r,target:s,type:a,listener:o}=ki(this,n,"any");if(r)Si(s,"any",a,o);else{const t=function(){e.off(s,a,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];o.apply(null,i)};t.guid=o.guid,Si(s,"any",a,t)}},off(e,t,n){if(!e||_i(e))ai(this.eventBusEl_,e,t);else{const i=e,r=t;xi(i,this,"off"),wi(r,this,"off"),Ti(n,this,"off"),n=di(this,n),this.off("dispose",n),i.nodeName?(ai(i,r,n),ai(i,"dispose",n)):vi(i)&&(i.off(r,n),i.off("dispose",n))}},trigger(e,t){xi(this.eventBusEl_,this,"trigger");const n=e&&"string"!==typeof e?e.type:e;if(!_i(n))throw new Error("Invalid event type for ".concat(bi(this),"#trigger; ")+"must be a non-empty string or object with a type key that has a non-empty value.");return oi(this.eventBusEl_,e,t)}};function Ii(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{eventBusKey:n}=t;if(n){if(!e[n].nodeName)throw new Error('The eventBusKey "'.concat(n,'" does not refer to an element.'));e.eventBusEl_=e[n]}else e.eventBusEl_=mn("span",{className:"vjs-event-bus"});return Object.assign(e,Ci),e.eventedCallbacks&&e.eventedCallbacks.forEach(e=>{e()}),e.on("dispose",()=>{e.off(),[e,e.el_,e.eventBusEl_].forEach(function(e){e&&$n.has(e)&&$n.delete(e)}),r().setTimeout(()=>{e.eventBusEl_=null},0)}),e}const Ei={state:{},setState(e){let t;return"function"===typeof e&&(e=e()),Dt(e,(e,n)=>{this.state[n]!==e&&(t=t||{},t[n]={from:this.state[n],to:e}),this.state[n]=e}),t&&vi(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function Ni(e,t){return Object.assign(e,Ei),e.state=Object.assign({},e.state,t),"function"===typeof e.handleStateChanged&&vi(e)&&e.on("statechanged",e.handleStateChanged),e}const Ai=function(e){return"string"!==typeof e?e:e.replace(/./,e=>e.toLowerCase())},Ri=function(e){return"string"!==typeof e?e:e.replace(/./,e=>e.toUpperCase())},Di=function(e,t){return Ri(e)===Ri(t)};var Oi=Object.freeze({__proto__:null,toLowerCase:Ai,toTitleCase:Ri,titleCaseEquals:Di});class Li{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Ft({},this.options_),t=this.options_=Ft(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const t=e&&e.id&&e.id()||"no_player";this.id_="".concat(t,"_component_").concat(ei())}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(e=>this.addClass(e)),["on","off","one","any","trigger"].forEach(e=>{this[e]=void 0}),!1!==t.evented&&(Ii(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),Ni(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(n),!1!==t.reportTouchActivity&&this.enableTouchActivity()}dispose(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=Ft(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return mn(e,t,n)}localize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;const i=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),s=r&&r[i],a=i&&i.split("-")[0],o=r&&r[a];let l=n;return s&&s[e]?l=s[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,function(e,n){const i=t[n-1];let r=i;return"undefined"===typeof i&&(r=e),r})),l}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t=t.reduce((e,t)=>e.concat(t),[]);let i=this;for(let r=0;r<t.length;r++)if(i=i.getChild(t[r]),!i||!i.getChild)return;return i}setIcon(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.el();if(!this.player_.options_.experimentalSvgIcons)return;const n="http://www.w3.org/2000/svg",i=mn("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),r=a().createElementNS(n,"svg");r.setAttributeNS(null,"viewBox","0 0 512 512");const s=a().createElementNS(n,"use");return r.appendChild(s),s.setAttributeNS(null,"href","#vjs-icon-".concat(e)),i.appendChild(r),this.iconIsSet_?t.replaceChild(i,t.querySelector(".vjs-icon-placeholder")):t.appendChild(i),this.iconIsSet_=!0,i}addChild(e){let t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.children_.length;if("string"===typeof e){n=Ri(e);const r=i.componentClass||n;i.name=n;const s=Li.getComponent(r);if(!s)throw new Error("Component ".concat(r," does not exist"));if("function"!==typeof s)return null;t=new s(this.player_||this,i)}else t=e;if(t.parentComponent_&&t.parentComponent_.removeChild(t),this.children_.splice(r,0,t),t.parentComponent_=this,"function"===typeof t.id&&(this.childIndex_[t.id()]=t),n=n||t.name&&Ri(t.name()),n&&(this.childNameIndex_[n]=t,this.childNameIndex_[Ai(n)]=t),"function"===typeof t.el&&t.el()){let e=null;this.children_[r+1]&&(this.children_[r+1].el_?e=this.children_[r+1].el_:pn(this.children_[r+1])&&(e=this.children_[r+1])),this.contentEl().insertBefore(t.el(),e)}return t}removeChild(e){if("string"===typeof e&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let i=this.children_.length-1;i>=0;i--)if(this.children_[i]===e){t=!0,this.children_.splice(i,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[Ri(e.name())]=null,this.childNameIndex_[Ai(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=e=>{const n=e.name;let i=e.opts;if(void 0!==t[n]&&(i=t[n]),!1===i)return;!0===i&&(i={}),i.playerOptions=this.options_.playerOptions;const r=this.addChild(n,i);r&&(this[n]=r)};let i;const r=Li.getComponent("Tech");i=Array.isArray(e)?e:Object.keys(e),i.concat(Object.keys(this.options_).filter(function(e){return!i.some(function(t){return"string"===typeof t?e===t:e===t.name})})).map(t=>{let n,i;return"string"===typeof t?(n=t,i=e[n]||this.options_[n]||{}):(n=t.name,i=t),{name:n,opts:i}}).filter(e=>{const t=Li.getComponent(e.opts.componentClass||Ri(e.name));return t&&!r.isTech(t)}).forEach(n)}}buildCSSClass(){return""}ready(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)}$(e,t){return Bn(e,t||this.contentEl())}$$(e,t){return zn(e,t||this.contentEl())}hasClass(e){return vn(this.el_,e)}addClass(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];_n(this.el_,...t)}removeClass(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];xn(this.el_,...t)}toggleClass(e,t){wn(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return Sn(this.el_,e)}setAttribute(e,t){Cn(this.el_,e,t)}removeAttribute(e){In(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(void 0!==t)return null!==t&&t===t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(n||this.trigger("componentresize"));if(!this.el_)return 0;const i=this.el_.style[e],r=i.indexOf("px");return-1!==r?parseInt(i.slice(0,r),10):parseInt(this.el_["offset"+Ri(e)],10)}currentDimension(e){let t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=Vn(this.el_,e),t=parseFloat(t),0===t||isNaN(t)){const n="offset".concat(Ri(e));t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect();return{boundingClientRect:{x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},center:{x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2}}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&("Tab"===e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;let n;this.on("touchstart",function(i){1===i.touches.length&&(t={pageX:i.touches[0].pageX,pageY:i.touches[0].pageY},e=r().performance.now(),n=!0)}),this.on("touchmove",function(e){if(e.touches.length>1)n=!1;else if(t){const i=e.touches[0].pageX-t.pageX,r=e.touches[0].pageY-t.pageY;Math.sqrt(i*i+r*r)>10&&(n=!1)}});const i=function(){n=!1};this.on("touchleave",i),this.on("touchcancel",i),this.on("touchend",function(i){if(t=null,!0===n){r().performance.now()-e<200&&(i.preventDefault(),this.trigger("tap"))}})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=di(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const n=function(n){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=di(this,e),this.clearTimersOnDispose_(),n=r().setTimeout(()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()},t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),r().clearTimeout(e)),e}setInterval(e,t){e=di(this,e),this.clearTimersOnDispose_();const n=r().setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),r().clearInterval(e)),e}requestAnimationFrame(e){var t;return this.clearTimersOnDispose_(),e=di(this,e),t=r().requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),t=di(this,t);const n=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),r().cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(e=>{let[t,n]=e;this[t].forEach((e,t)=>this[n](t))}),this.clearingTimersOnDispose_=!1}))}getIsDisabled(){return Boolean(this.el_.disabled)}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){return(e||this.el_).tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function t(e){const t=r().getComputedStyle(e,null),n=t.getPropertyValue("visibility");return"none"!==t.getPropertyValue("display")&&!["hidden","collapse"].includes(n)}return e||(e=this.el()),!!(function(e){if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(a().documentElement.clientWidth||r().innerWidth))return!1;if(t.y<0)return!1;if(t.y>(a().documentElement.clientHeight||r().innerHeight))return!1;let n=a().elementFromPoint(t.x,t.y);for(;n;){if(n===e)return!0;if(!n.parentNode)return!1;n=n.parentNode}}(e)&&(n=e,t(n.parentElement)&&t(n)&&"0"!==n.style.opacity&&"0px"!==r().getComputedStyle(n).height&&"0px"!==r().getComputedStyle(n).width)&&(!e.parentElement||e.tabIndex>=0));var n}static registerComponent(e,t){if("string"!==typeof e||!e)throw new Error('Illegal component name, "'.concat(e,'"; must be a non-empty string.'));const n=Li.getComponent("Tech"),i=n&&n.isTech(t),r=Li===t||Li.prototype.isPrototypeOf(t.prototype);if(i||!r){let t;throw t=i?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error('Illegal component, "'.concat(e,'"; ').concat(t,"."))}e=Ri(e),Li.components_||(Li.components_={});const s=Li.getComponent("Player");if("Player"===e&&s&&s.players){const e=s.players,t=Object.keys(e);if(e&&t.length>0)for(let n=0;n<t.length;n++)if(null!==e[t[n]])throw new Error("Can not register Player component after player has been created.")}return Li.components_[e]=t,Li.components_[Ai(e)]=t,t}static getComponent(e){if(e&&Li.components_)return Li.components_[e]}}function Pi(e,t,n,i){return function(e,t,n){if("number"!==typeof t||t<0||t>n)throw new Error("Failed to execute '".concat(e,"' on 'TimeRanges': The index provided (").concat(t,") is non-numeric or out of bounds (0-").concat(n,")."))}(e,i,n.length-1),n[i][t]}function Fi(e){let t;return t=void 0===e||0===e.length?{length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:Pi.bind(null,"start",0,e),end:Pi.bind(null,"end",1,e)},r().Symbol&&r().Symbol.iterator&&(t[r().Symbol.iterator]=()=>(e||[]).values()),t}function Mi(e,t){return Array.isArray(e)?Fi(e):void 0===e||void 0===t?Fi():Fi([[e,t]])}Li.registerComponent("Component",Li);const Ui=function(e,t){e=e<0?0:e;let n=Math.floor(e%60),i=Math.floor(e/60%60),r=Math.floor(e/3600);const s=Math.floor(t/60%60),a=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=i=n="-"),r=r>0||a>0?r+":":"",i=((r||s>=10)&&i<10?"0"+i:i)+":",n=n<10?"0"+n:n,r+i+n};let Bi=Ui;function zi(e){Bi=e}function Vi(){Bi=Ui}function ji(e){return Bi(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e)}var Wi=Object.freeze({__proto__:null,createTimeRanges:Mi,createTimeRange:Mi,setFormatTime:zi,resetFormatTime:Vi,formatTime:ji});function Hi(e,t){let n,i,r=0;if(!t)return 0;e&&e.length||(e=Mi(0,0));for(let s=0;s<e.length;s++)n=e.start(s),i=e.end(s),i>t&&(i=t),r+=i-n;return r/t}function Gi(e){if(e instanceof Gi)return e;"number"===typeof e?this.code=e:"string"===typeof e?this.message=e:Lt(e)&&("number"===typeof e.code&&(this.code=e.code),Object.assign(this,e)),this.message||(this.message=Gi.defaultMessages[this.code]||"")}function qi(e){return void 0!==e&&null!==e&&"function"===typeof e.then}function Xi(e){qi(e)&&e.then(null,e=>{})}Gi.prototype.code=0,Gi.prototype.message="",Gi.prototype.status=null,Gi.prototype.metadata=null,Gi.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Gi.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."},Gi.MEDIA_ERR_CUSTOM=0,Gi.prototype.MEDIA_ERR_CUSTOM=0,Gi.MEDIA_ERR_ABORTED=1,Gi.prototype.MEDIA_ERR_ABORTED=1,Gi.MEDIA_ERR_NETWORK=2,Gi.prototype.MEDIA_ERR_NETWORK=2,Gi.MEDIA_ERR_DECODE=3,Gi.prototype.MEDIA_ERR_DECODE=3,Gi.MEDIA_ERR_SRC_NOT_SUPPORTED=4,Gi.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4,Gi.MEDIA_ERR_ENCRYPTED=5,Gi.prototype.MEDIA_ERR_ENCRYPTED=5;const Ki=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,n,i)=>(e[n]&&(t[n]=e[n]),t),{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})})};var Yi=function(e){const t=e.$$("track"),n=Array.prototype.map.call(t,e=>e.track);return Array.prototype.map.call(t,function(e){const t=Ki(e.track);return e.src&&(t.src=e.src),t}).concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===n.indexOf(e)}).map(Ki))},Qi=function(e,t){return e.forEach(function(e){const n=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(e=>n.addCue(e))}),t.textTracks()},$i=Ki;const Ji="vjs-modal-dialog";class Zi extends Li{constructor(e,t){super(e,t),this.handleKeyDown_=e=>this.handleKeyDown(e),this.close_=e=>this.close(e),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=mn("div",{className:"".concat(Ji,"-content")},{role:"document"}),this.descEl_=mn("p",{className:"".concat(Ji,"-description vjs-control-text"),id:this.el().getAttribute("aria-describedby")}),yn(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":"".concat(this.id(),"_description"),"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return"".concat(Ji," vjs-hidden ").concat(super.buildCSSClass())}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_)return void(this.options_.fillAlways&&this.fill());const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return"boolean"===typeof e&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if("boolean"===typeof e){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const e=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=e,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,i=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),Mn(t,e),this.trigger("modalfill"),i?n.insertBefore(t,i):n.appendChild(t);const r=this.getChild("closeButton");r&&n.appendChild(r.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),Ln(this.contentEl()),this.trigger("modalempty")}content(e){return"undefined"!==typeof e&&(this.content_=e),this.content_}conditionalFocus_(){const e=a().activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),"Escape"===e.key&&this.closeable())return e.preventDefault(),void this.close();if("Tab"!==e.key)return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let i;for(let r=0;r<t.length;r++)if(n===t[r]){i=r;break}a().activeElement===this.el_&&(i=0),e.shiftKey&&0===i?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||i!==t.length-1||(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,e=>(e instanceof r().HTMLAnchorElement||e instanceof r().HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof r().HTMLInputElement||e instanceof r().HTMLSelectElement||e instanceof r().HTMLTextAreaElement||e instanceof r().HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof r().HTMLIFrameElement||e instanceof r().HTMLObjectElement||e instanceof r().HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable"))}}Zi.prototype.options_={pauseOnOpen:!0,temporary:!0},Li.registerComponent("ModalDialog",Zi);class er extends yi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},vi(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,i=this.length;n<i;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,i=this.length;n<i;n++){const i=this[n];if(i.id===e){t=i;break}}return t}}er.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const Cu in er.prototype.allowedEvents_)er.prototype["on"+Cu]=null;const tr=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].enabled=!1)};class nr extends er{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=e.length-1;t>=0;t--)if(e[t].enabled){tr(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&tr(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,tr(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const ir=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].selected=!1)};class rr extends er{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=e.length-1;t>=0;t--)if(e[t].selected){ir(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set(){}})}addTrack(e){e.selected&&ir(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,ir(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class sr extends er{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_);-1===["metadata","chapters"].indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}toJSON(){return this.tracks_.map(e=>e.toJSON())}}class ar{constructor(e){ar.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const i=e.length;this.cues_=e,this.length_=e.length;const r=function(e){""+e in this||Object.defineProperty(this,""+e,{get(){return this.cues_[e]}})};if(t<i)for(n=t;n<i;n++)r.call(this,n)}getCueById(e){let t=null;for(let n=0,i=this.length;n<i;n++){const i=this[n];if(i.id===e){t=i;break}}return t}}const or={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},lr={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},cr={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},ur={disabled:"disabled",hidden:"hidden",showing:"showing"};class hr extends yi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const t={id:e.id||"vjs_track_"+ei(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const i in t)Object.defineProperty(this,i,{get:()=>t[i],set(){}});Object.defineProperty(this,"label",{get:()=>n,set(e){e!==n&&(n=e,this.trigger("labelchange"))}})}}const dr=function(e){return new URL(e,a().baseURI)},pr=function(e){return new URL(e,a().baseURI).href},fr=function(e){if("string"===typeof e){const t=e.split("?")[0].replace(/\/+$/,"").match(/\.([^.\/]+)$/);return t?t[1].toLowerCase():""}return""},gr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r().location;return dr(e).origin!==t.origin};var mr=Object.freeze({__proto__:null,parseUrl:dr,getAbsoluteURL:pr,getFileExtension:fr,isCrossOrigin:gr});const yr=function(e,t){const n=new(r().WebVTT.Parser)(r(),r().vttjs,r().WebVTT.StringDecoder()),i=[];n.oncue=function(e){t.addCue(e)},n.onparsingerror=function(e){i.push(e)},n.onflush=function(){t.trigger({type:"loadeddata",target:t})},n.parse(e),i.length>0&&(r().console&&r().console.groupCollapsed&&r().console.groupCollapsed("Text Track parsing errors for ".concat(t.src)),i.forEach(e=>Et.error(e)),r().console&&r().console.groupEnd&&r().console.groupEnd()),n.flush()},br=function(e,t){const n={uri:e},i=gr(e);i&&(n.cors=i);const s="use-credentials"===t.tech_.crossOrigin();s&&(n.withCredentials=s),l()(n,di(this,function(e,n,i){if(e)return Et.error(e,n);t.loaded_=!0,"function"!==typeof r().WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],e=>{if("vttjserror"!==e.type)return yr(i,t);Et.error("vttjs failed to load, stopping trying to process ".concat(t.src))}):yr(i,t)}))};class vr extends hr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.tech)throw new Error("A tech was not provided.");const t=Ft(e,{kind:cr[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=ur[t.mode]||"disabled";const i=t.default;"metadata"!==t.kind&&"chapters"!==t.kind||(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=!1!==this.tech_.preloadTextTracks;const r=new ar(this.cues_),s=new ar(this.activeCues_);let a=!1;this.timeupdateHandler=di(this,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.tech_.isDisposed()||(this.tech_.isReady_?(this.activeCues=this.activeCues,a&&(this.trigger("cuechange"),a=!1),"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))):"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))});this.tech_.one("dispose",()=>{this.stopTracking()}),"disabled"!==n&&this.startTracking(),Object.defineProperties(this,{default:{get:()=>i,set(){}},mode:{get:()=>n,set(e){ur[e]&&n!==e&&(n=e,this.preload_||"disabled"===n||0!==this.cues.length||br(this.src,this),this.stopTracking(),"disabled"!==n&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?r:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(0===this.cues.length)return s;const e=this.tech_.currentTime(),t=[];for(let n=0,i=this.cues.length;n<i;n++){const i=this.cues[n];i.startTime<=e&&i.endTime>=e&&t.push(i)}if(a=!1,t.length!==this.activeCues_.length)a=!0;else for(let n=0;n<t.length;n++)-1===this.activeCues_.indexOf(t[n])&&(a=!0);return this.activeCues_=t,s.setCues_(this.activeCues_),s},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||"subtitles"!==t.kind&&"captions"!==t.kind)&&br(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new(r().vttjs.VTTCue)(e.startTime,e.endTime,e.text);for(const n in e)n in t||(t[n]=e[n]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let i=0;i<n.length;i++)n[i]!==this&&n[i].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}toJSON(){return $i(this)}removeCue(e){let t=this.cues_.length;for(;t--;){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}vr.prototype.allowedEvents_={cuechange:"cuechange"};class _r extends hr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Ft(e,{kind:lr[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get:()=>n,set(e){"boolean"===typeof e&&e!==n&&(n=e,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class xr extends hr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Ft(e,{kind:or[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get:()=>n,set(e){"boolean"===typeof e&&e!==n&&(n=e,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class wr extends yi{constructor(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const n=new vr(t);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get:()=>e},track:{get:()=>n}}),e=wr.NONE,n.addEventListener("loadeddata",()=>{e=wr.LOADED,this.trigger({type:"load",target:this})})}}wr.prototype.allowedEvents_={load:"load"},wr.NONE=0,wr.LOADING=1,wr.LOADED=2,wr.ERROR=3;const Tr={audio:{ListClass:nr,TrackClass:_r,capitalName:"Audio"},video:{ListClass:rr,TrackClass:xr,capitalName:"Video"},text:{ListClass:sr,TrackClass:vr,capitalName:"Text"}};Object.keys(Tr).forEach(function(e){Tr[e].getterName="".concat(e,"Tracks"),Tr[e].privateName="".concat(e,"Tracks_")});const kr={remoteText:{ListClass:sr,TrackClass:vr,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,i=this.trackElements_.length;n<i;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"===typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"===typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}},TrackClass:wr,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Sr=Object.assign({},Tr,kr);kr.names=Object.keys(kr),Tr.names=Object.keys(Tr),Sr.names=[].concat(kr.names).concat(Tr.names);class Cr extends Li{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=e=>this.onDurationChange(e),this.trackProgress_=e=>this.trackProgress(e),this.trackCurrentTime_=e=>this.trackCurrentTime(e),this.stopTrackingCurrentTime_=e=>this.stopTrackingCurrentTime(e),this.disposeSourceHandler_=e=>this.disposeSourceHandler(e),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),Sr.names.forEach(t=>{const n=Sr[t];e&&e[n.getterName]&&(this[n.privateName]=e[n.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(t=>{!1===e["native".concat(t,"Tracks")]&&(this["featuresNative".concat(t,"Tracks")]=!1)}),!1===e.nativeCaptions||!1===e.nativeTextTracks?this.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=!1!==e.preloadTextTracks,this.autoRemoteTextTracks_=new Sr.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(di(this,function(){const e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return Mi(0,0)}bufferedPercent(){return Hi(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(Tr.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){(e=[].concat(e)).forEach(e=>{const t=this["".concat(e,"Tracks")]()||[];let n=t.length;for(;n--;){const i=t[n];"text"===e&&this.removeRemoteTextTrack(i),t.removeTrack(i)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return void 0!==e&&(this.error_=new Gi(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?Mi(0,0):Mi()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){Tr.names.forEach(e=>{const t=Tr[e],n=()=>{this.trigger("".concat(e,"trackchange"))},i=this[t.getterName]();i.addEventListener("removetrack",n),i.addEventListener("addtrack",n),this.on("dispose",()=>{i.removeEventListener("removetrack",n),i.removeEventListener("addtrack",n)})})}addWebVttScript_(){if(!r().WebVTT)if(a().body.contains(this.el())){if(!this.options_["vtt.js"]&&Pt(u())&&Object.keys(u()).length>0)return void this.trigger("vttjsloaded");const e=a().createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),r().WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=t=>e.addTrack(t.track),i=t=>e.removeTrack(t.track);t.on("addtrack",n),t.on("removetrack",i),this.addWebVttScript_();const r=()=>this.trigger("texttrackchange"),s=()=>{r();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("cuechange",r),"showing"===n.mode&&n.addEventListener("cuechange",r)}};s(),e.addEventListener("change",s),e.addEventListener("addtrack",s),e.addEventListener("removetrack",s),this.on("dispose",function(){t.off("addtrack",n),t.off("removetrack",i),e.removeEventListener("change",s),e.removeEventListener("addtrack",s),e.removeEventListener("removetrack",s);for(let t=0;t<e.length;t++){e[t].removeEventListener("cuechange",r)}})}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s=e.textTracks();r.kind=t,n&&(r.label=n),i&&(r.language=i),r.tech=e;const a=new Sr.text.TrackClass(r);return s.addTrack(a),a}(this,e,t,n)}createRemoteTextTrack(e){const t=Ft(e,{tech:this});return new kr.remoteTextEl.TrackClass(t)}addRemoteTextTrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const n=this.createRemoteTextTrack(e);return"boolean"!==typeof t&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!1===t&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(n.track)),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=ei();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return Cr.canPlayType(e.type)}static isTech(e){return e.prototype instanceof Cr||e instanceof Cr||e===Cr}static registerTech(e,t){if(Cr.techs_||(Cr.techs_={}),!Cr.isTech(t))throw new Error("Tech ".concat(e," must be a Tech"));if(!Cr.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!Cr.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=Ri(e),Cr.techs_[e]=t,Cr.techs_[Ai(e)]=t,"Tech"!==e&&Cr.defaultTechOrder_.push(e),t}static getTech(e){if(e)return Cr.techs_&&Cr.techs_[e]?Cr.techs_[e]:(e=Ri(e),r()&&r().videojs&&r().videojs[e]?(Et.warn("The ".concat(e," tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)")),r().videojs[e]):void 0)}}Sr.names.forEach(function(e){const t=Sr[e];Cr.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),Cr.prototype.featuresVolumeControl=!0,Cr.prototype.featuresMuteControl=!0,Cr.prototype.featuresFullscreenResize=!1,Cr.prototype.featuresPlaybackRate=!1,Cr.prototype.featuresProgressEvents=!1,Cr.prototype.featuresSourceset=!1,Cr.prototype.featuresTimeupdateEvents=!1,Cr.prototype.featuresNativeTextTracks=!1,Cr.prototype.featuresVideoFrameCallback=!1,Cr.withSourceHandlers=function(e){e.registerSourceHandler=function(t,n){let i=e.sourceHandlers;i||(i=e.sourceHandlers=[]),void 0===n&&(n=i.length),i.splice(n,0,t)},e.canPlayType=function(t){const n=e.sourceHandlers||[];let i;for(let e=0;e<n.length;e++)if(i=n[e].canPlayType(t),i)return i;return""},e.selectSourceHandler=function(t,n){const i=e.sourceHandlers||[];let r;for(let e=0;e<i.length;e++)if(r=i[e].canHandleSource(t,n),r)return i[e];return null},e.canPlaySource=function(t,n){const i=e.selectSourceHandler(t,n);return i?i.canHandleSource(t,n):""};["seekable","seeking","duration"].forEach(function(e){const t=this[e];"function"===typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},e.prototype),e.prototype.setSource=function(t){let n=e.selectSourceHandler(t,this.options_);n||(e.nativeSourceHandler?n=e.nativeSourceHandler:Et.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},Li.registerComponent("Tech",Cr),Cr.registerTech("Tech",Cr),Cr.defaultTechOrder_=[];const Ir={},Er={},Nr={};function Ar(e,t,n){e.setTimeout(()=>Fr(t,Ir[t.type],n,e),1)}function Rr(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r="call"+Ri(n),s=e.reduce(Pr(r),i),a=s===Nr,o=a?null:t[n](s);return function(e,t,n,i){for(let r=e.length-1;r>=0;r--){const s=e[r];s[t]&&s[t](i,n)}}(e,n,o,a),o}const Dr={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},Or={setCurrentTime:1,setMuted:1,setVolume:1},Lr={play:1,pause:1};function Pr(e){return(t,n)=>t===Nr?Nr:n[e]?n[e](t):t}function Fr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const[a,...o]=t;if("string"===typeof a)Fr(e,Ir[a],n,i,r,s);else if(a){const t=function(e,t){const n=Er[e.id()];let i=null;if(void 0===n||null===n)return i=t(e),Er[e.id()]=[[t,i]],i;for(let r=0;r<n.length;r++){const[e,s]=n[r];e===t&&(i=s)}return null===i&&(i=t(e),n.push([t,i])),i}(i,a);if(!t.setSource)return r.push(t),Fr(e,o,n,i,r,s);t.setSource(Object.assign({},e),function(a,l){if(a)return Fr(e,o,n,i,r,s);r.push(t),Fr(l,e.type===l.type?o:Ir[l.type],n,i,r,s)})}else o.length?Fr(e,o,n,i,r,s):s?n(e,r):Fr(e,Ir["*"],n,i,r,!0)}const Mr={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Ur=function(){const e=fr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");return Mr[e.toLowerCase()]||""},Br=function(e){if(Array.isArray(e)){let t=[];e.forEach(function(e){e=Br(e),Array.isArray(e)?t=t.concat(e):Lt(e)&&t.push(e)}),e=t}else e="string"===typeof e&&e.trim()?[zr({src:e})]:Lt(e)&&"string"===typeof e.src&&e.src&&e.src.trim()?[zr(e)]:[];return e};function zr(e){if(!e.type){const t=Ur(e.src);t&&(e.type=t)}return e}const Vr=nn?10009:rn?461:8,jr={codes:{play:415,pause:19,ff:417,rw:412,back:Vr},names:{415:"play",19:"pause",417:"ff",412:"rw",[Vr]:"back"},isEventKey(e,t){return t=t.toLowerCase(),!(!this.names[e.keyCode]||this.names[e.keyCode]!==t)},getEventName(e){if(this.names[e.keyCode])return this.names[e.keyCode];if(this.codes[e.code]){const t=this.codes[e.code];return this.names[t]}return null}};class Wr extends yi{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",()=>{this.focus(this.updateFocusableComponents()[0])}),this.player_.on("modalclose",()=>{this.refocusComponent()}),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())}))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const t=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(this.isPaused_)return;t.preventDefault();const e=t.key.substring(5).toLowerCase();this.move(e)}else if(jr.isEventKey(t,"play")||jr.isEventKey(t,"pause")||jr.isEventKey(t,"ff")||jr.isEventKey(t,"rw")){t.preventDefault();const e=jr.getEventName(t);this.performMediaAction_(e)}else jr.isEventKey(t,"Back")&&e.target&&"function"===typeof e.target.closeable&&e.target.closeable()&&(t.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+5);break;case"rw":this.userSeek_(this.player_.currentTime()-5)}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const t=e.relatedTarget;let n=null;const i=this.getCurrentComponent(e.target);t&&(n=Boolean(t.closest(".video-js")),t.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(e.currentTarget.contains(e.relatedTarget)||n)&&t||(i&&"CloseButton"===i.name()?this.refocusComponent():(this.pause(),i&&i.el()&&(this.lastFocusedComponent_=i)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,t=[];function n(e){for(const i of e)i.hasOwnProperty("el_")&&i.getIsFocusable()&&i.getIsAvailableToBeFocused(i.el())&&t.push(i),i.hasOwnProperty("children_")&&i.children_.length>0&&n(i.children_)}return e.children_.forEach(e=>{if(e.hasOwnProperty("el_")){if(e.getIsFocusable&&e.getIsAvailableToBeFocused&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el()))return void t.push(e);e.hasOwnProperty("children_")&&e.children_.length>0?n(e.children_):e.hasOwnProperty("items")&&e.items.length>0?n(e.items):this.findSuitableDOMChild(e)&&t.push(e)}if("ErrorDisplay"===e.name_&&e.opened_){const n=e.el_.querySelector(".vjs-errors-ok-button-container");if(n){n.querySelectorAll("button").forEach((e,n)=>{t.push({name:()=>"ModalButton"+(n+1),el:()=>e,getPositions:()=>{const t=e.getBoundingClientRect();return{boundingClientRect:{x:t.x,y:t.y,width:t.width,height:t.height,top:t.top,right:t.right,bottom:t.bottom,left:t.left},center:{x:t.left+t.width/2,y:t.top+t.height/2,width:0,height:0,top:t.top+t.height/2,right:t.left+t.width/2,bottom:t.top+t.height/2,left:t.left+t.width/2}}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:e=>!0,focus:()=>e.focus()})})}}}),this.focusableComponents=t,this.focusableComponents}findSuitableDOMChild(e){return e.el()?function t(n){if(e.getIsFocusable(n)&&e.getIsAvailableToBeFocused(n))return n;for(let e=0;e<n.children.length;e++){const i=t(n.children[e]);if(i)return i}return null}(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const t=e||document.activeElement;if(this.focusableComponents.length)for(const n of this.focusableComponents)if(n.el()===t)return n}add(e){const t=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&t.push(e),this.focusableComponents=t,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let t=0;t<this.focusableComponents.length;t++)if(this.focusableComponents[t].name()===e.name())return this.focusableComponents.splice(t,1),void this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const t=this.getCurrentComponent();if(!t)return;const n=t.getPositions(),i=this.focusableComponents.filter(i=>i!==t&&this.isInDirection_(n.boundingClientRect,i.getPositions().boundingClientRect,e)),r=this.findBestCandidate_(n.center,i,e);r?this.focus(r):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:t})}findBestCandidate_(e,t,n){let i=1/0,r=null;for(const s of t){const t=s.getPositions().center,a=this.calculateDistance_(e,t,n);a<i&&(i=a,r=s)}return r}isInDirection_(e,t,n){switch(n){case"right":return t.left>=e.right;case"left":return t.right<=e.left;case"down":return t.top>=e.bottom;case"up":return t.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name())return void this.focus(this.focusableComponents[e])}else this.focus(this.updateFocusableComponents()[0])}focus(e){"object"===typeof e&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,t,n){const i=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);let s;switch(n){case"right":case"left":s=i+100*r;break;case"up":s=2*r+.5*i;break;case"down":s=5*r+i;break;default:s=i+r}return s}searchForTrackSelect_(){const e=this;for(const t of e.updateFocusableComponents())if("TextTrackSelect"===t.constructor.name){e.focus(t);break}}}Li.registerComponent("MediaLoader",class extends Li{constructor(e,t,n){if(super(e,Ft({createEl:!1},t),n),t.playerOptions.sources&&0!==t.playerOptions.sources.length)e.src(t.playerOptions.sources);else for(let i=0,r=t.playerOptions.techOrder;i<r.length;i++){const t=Ri(r[i]);let n=Cr.getTech(t);if(t||(n=Li.getComponent(t)),n&&n.isSupported()){e.loadTech_(t);break}}}});class Hr extends Li{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=e=>this.handleMouseOver(e),this.handleMouseOut_=e=>this.handleMouseOut(e),this.handleClick_=e=>this.handleClick(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.emitTapEvents(),this.enable()}createEl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&Et.error("Creating a ClickableComponent with an HTML element of ".concat(e," is not supported; use a Button instead.")),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const i=mn(e,t,n);return this.player_.options_.experimentalSvgIcons||i.appendChild(mn("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=mn("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.el();if(void 0===e)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,yn(this.controlTextEl_,n),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",n)}buildCSSClass(){return"vjs-control vjs-button ".concat(super.buildCSSClass())}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),"undefined"!==typeof this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),"undefined"!==typeof this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){" "===e.key||"Enter"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}Li.registerComponent("ClickableComponent",Hr);class Gr extends Hr{constructor(e,t){super(e,t),this.update(),this.update_=e=>this.update(e),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return mn("div",{className:"vjs-poster"})}crossOrigin(e){if("undefined"===typeof e)return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;null===e||"anonymous"===e||"use-credentials"===e?this.$("img")&&(this.$("img").crossOrigin=e):this.player_.log.warn('crossOrigin must be null,  "anonymous" or "use-credentials", given "'.concat(e,'"'))}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){e?(this.$("img")||this.el_.appendChild(mn("picture",{className:"vjs-poster",tabIndex:-1},{},mn("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e):this.el_.textContent=""}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?Xi(this.player_.play()):this.player_.pause())}}Gr.prototype.crossorigin=Gr.prototype.crossOrigin,Li.registerComponent("PosterImage",Gr);const qr="#222",Xr="#ccc",Kr={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Yr(e,t){let n;if(4===e.length)n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");n=e.slice(1)}return"rgba("+parseInt(n.slice(0,2),16)+","+parseInt(n.slice(2,4),16)+","+parseInt(n.slice(4,6),16)+","+t+")"}function Qr(e,t,n){try{e.style[t]=n}catch(i){return}}function $r(e){return e?"".concat(e,"px"):""}Li.registerComponent("TextTrackDisplay",class extends Li{constructor(e,t,n){super(e,t,n);const i=e=>this.updateDisplay(e),s=e=>{this.updateDisplayOverlay(),this.updateDisplay(e)};e.on("loadstart",e=>this.toggleDisplay(e)),e.on("useractive",i),e.on("userinactive",i),e.on("texttrackchange",i),e.on("loadedmetadata",e=>{this.updateDisplayOverlay(),this.preselectTrack(e)}),e.ready(di(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks)return void this.hide();e.on("fullscreenchange",s),e.on("playerresize",s);const t=r().screen.orientation||r(),n=r().screen.orientation?"change":"orientationchange";t.addEventListener(n,s),e.on("dispose",()=>t.removeEventListener(n,s));const i=this.options_.playerOptions.tracks||[];for(let e=0;e<i.length;e++)this.player_.addRemoteTextTrack(i[e],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let i,r,s;for(let a=0;a<t.length;a++){const o=t[a];n&&n.enabled&&n.language&&n.language===o.language&&o.kind in e?o.kind===n.kind?s=o:s||(s=o):n&&!n.enabled?(s=null,i=null,r=null):o.default&&("descriptions"!==o.kind||i?o.kind in e&&!r&&(r=o):i=o)}s?s.mode="showing":r?r.mode="showing":i&&(i.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){"function"===typeof r().WebVTT&&r().WebVTT.processCues(r(),[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const t=[];for(let n=0;n<e.length;++n){const i=e[n];"showing"===i.mode&&t.push(i)}return void this.updateForTrack(t)}let n=null,i=null,s=e.length;for(;s--;){const t=e[s];"showing"===t.mode&&("descriptions"===t.kind?n=t:i=t)}if(i?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(i)):n&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n)),!r().CSS.supports("inset","10px")){const e=this.el_,t=e.querySelectorAll(".vjs-text-track-cue"),n=this.player_.controlBar.el_.getBoundingClientRect().height,i=this.player_.el_.getBoundingClientRect().height;e.style="",Qr(e,"position","relative"),Qr(e,"height",i-n+"px"),Qr(e,"top","unset"),Qr(e,"bottom",sn?i+"px":"0px"),t.length>0&&t.forEach(e=>{if(e.style.inset){const t=e.style.inset.split(" ");3===t.length&&Object.assign(e.style,{top:t[0],right:t[1],bottom:t[2],left:"unset"})}})}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!r().CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),n=e/t,i=this.player_.videoWidth()/this.player_.videoHeight();let s=0,a=0;Math.abs(n-i)>.1&&(n>i?s=Math.round((e-t*i)/2):a=Math.round((t-e/i)/2)),Qr(this.el_,"insetInline",$r(s)),Qr(this.el_,"insetBlock",$r(a))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let i=n.length;for(;i--;){const e=n[i];if(!e)continue;const s=e.displayState;if(t.color&&(s.firstChild.style.color=t.color),t.textOpacity&&Qr(s.firstChild,"color",Yr(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(s.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Qr(s.firstChild,"backgroundColor",Yr(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Qr(s,"backgroundColor",Yr(t.windowColor,t.windowOpacity)):s.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?s.firstChild.style.textShadow="2px 2px 3px ".concat(qr,", 2px 2px 4px ").concat(qr,", 2px 2px 5px ").concat(qr):"raised"===t.edgeStyle?s.firstChild.style.textShadow="1px 1px ".concat(qr,", 2px 2px ").concat(qr,", 3px 3px ").concat(qr):"depressed"===t.edgeStyle?s.firstChild.style.textShadow="1px 1px ".concat(Xr,", 0 1px ").concat(Xr,", -1px -1px ").concat(qr,", 0 -1px ").concat(qr):"uniform"===t.edgeStyle&&(s.firstChild.style.textShadow="0 0 4px ".concat(qr,", 0 0 4px ").concat(qr,", 0 0 4px ").concat(qr,", 0 0 4px ").concat(qr))),t.fontPercent&&1!==t.fontPercent){const e=r().parseFloat(s.style.fontSize);s.style.fontSize=e*t.fontPercent+"px",s.style.height="auto",s.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?s.firstChild.style.fontVariant="small-caps":s.firstChild.style.fontFamily=Kr[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),"function"!==typeof r().WebVTT||e.every(e=>!e.activeCues))return;const t=[];for(let n=0;n<e.length;++n){const i=e[n];for(let e=0;e<i.activeCues.length;++e)t.push(i.activeCues[e])}r().WebVTT.processCues(r(),t,this.el_);for(let n=0;n<e.length;++n){const t=e[n];for(let e=0;e<t.activeCues.length;++e){const i=t.activeCues[e].displayState;_n(i,"vjs-text-track-cue","vjs-text-track-cue-"+(t.language?t.language:n)),t.language&&Cn(i,"lang",t.language)}this.player_.textTrackSettings&&this.updateDisplayState(t)}}});Li.registerComponent("LoadingSpinner",class extends Li{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=mn("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),i=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return i.appendChild(n),i}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}});class Jr extends Hr{createEl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e="button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n);const i=mn(e,t,n);return this.player_.options_.experimentalSvgIcons||i.appendChild(mn("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i}addChild(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.constructor.name;return Et.warn("Adding an actionable (user controllable) child to a Button (".concat(n,") is not supported; use a ClickableComponent instead.")),Li.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){" "!==e.key&&"Enter"!==e.key?super.handleKeyDown(e):e.stopPropagation()}}Li.registerComponent("Button",Jr);class Zr extends Jr{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",e=>this.handleMouseDown(e))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if("tap"===e.type||this.mouseused_&&"clientX"in e&&"clientY"in e)return Xi(t),void(this.player_.tech(!0)&&this.player_.tech(!0).focus());const n=this.player_.getChild("controlBar"),i=n&&n.getChild("playToggle");if(!i)return void this.player_.tech(!0).focus();const r=()=>i.focus();qi(t)?t.then(r,()=>{}):this.setTimeout(r,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}Zr.prototype.controlText_="Play Video",Li.registerComponent("BigPlayButton",Zr);Li.registerComponent("CloseButton",class extends Jr{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return"vjs-close-button ".concat(super.buildCSSClass())}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){"Escape"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}});class es extends Jr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),t.replay=void 0===t.replay||t.replay,this.setIcon("play"),this.on(e,"play",e=>this.handlePlay(e)),this.on(e,"pause",e=>this.handlePause(e)),t.replay&&this.on(e,"ended",e=>this.handleEnded(e))}buildCSSClass(){return"vjs-play-control ".concat(super.buildCSSClass())}handleClick(e){this.player_.paused()?Xi(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",e=>this.handleSeeked(e))}}es.prototype.controlText_="Play",Li.registerComponent("PlayToggle",es);class ts extends Li{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],e=>this.update(e)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:"".concat(e," vjs-time-control vjs-control")}),n=mn("span",{className:"vjs-control-text",textContent:"".concat(this.localize(this.labelText_),"\xa0")},{role:"presentation"});return t.appendChild(n),this.contentEl_=mn("span",{className:"".concat(e,"-display")},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){(this.player_.options_.enableSmoothSeeking||"seeking"!==e.type)&&this.updateContent(e)}updateTextNode_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e=ji(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let e=this.textNode_;e&&this.contentEl_.firstChild!==e&&(e=null,Et.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=a().createTextNode(this.formattedTime_),this.textNode_&&(e?this.contentEl_.replaceChild(this.textNode_,e):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}ts.prototype.labelText_="Time",ts.prototype.controlText_="Time",Li.registerComponent("TimeDisplay",ts);class ns extends ts{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;t=this.player_.ended()?this.player_.duration():e&&e.target&&"function"===typeof e.target.pendingSeekTime?e.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}ns.prototype.labelText_="Current Time",ns.prototype.controlText_="Current Time",Li.registerComponent("CurrentTimeDisplay",ns);class is extends ts{constructor(e,t){super(e,t);const n=e=>this.updateContent(e);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}is.prototype.labelText_="Duration",is.prototype.controlText_="Duration",Li.registerComponent("DurationDisplay",is);Li.registerComponent("TimeDivider",class extends Li{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}});class rs extends ts{constructor(e,t){super(e,t),this.on(e,"durationchange",e=>this.updateContent(e))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return!1!==this.options_.displayNegative&&e.insertBefore(mn("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if("number"!==typeof this.player_.duration())return;let t;t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t)}}rs.prototype.labelText_="Remaining Time",rs.prototype.controlText_="Remaining Time",Li.registerComponent("RemainingTimeDisplay",rs);Li.registerComponent("LiveDisplay",class extends Li{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",e=>this.updateShowing(e))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=mn("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(mn("span",{className:"vjs-control-text",textContent:"".concat(this.localize("Stream Type"),"\xa0")})),this.contentEl_.appendChild(a().createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}});class ss extends Jr{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=e=>this.updateLiveEdgeStatus(e),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=mn("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}function as(e,t,n){return e=Number(e),Math.min(n,Math.max(t,isNaN(e)?t:e))}ss.prototype.controlText_="Seek to live, currently playing live",Li.registerComponent("SeekToLive",ss);var os=Object.freeze({__proto__:null,clamp:as});class ls extends Li{constructor(e,t){super(e,t),this.handleMouseDown_=e=>this.handleMouseDown(e),this.handleMouseUp_=e=>this.handleMouseUp(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.handleClick_=e=>this.handleClick(e),this.handleMouseMove_=e=>this.handleMouseMove(e),this.update_=e=>this.update(e),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||Xt||e.preventDefault(),En(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;Nn(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(100*e).toFixed(2)+"%"})),e}getProgress(){return Number(as(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=Dn(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){const t=this.options_.playerOptions.spatialNavigation,n=t&&t.enabled,i=t&&t.horizontalSeek;n?i&&"ArrowLeft"===e.key||!i&&"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):i&&"ArrowRight"===e.key||!i&&"ArrowUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(this.pendingSeekTime()&&(this.pendingSeekTime(null),this.userSeek_(this.player_.currentTime())),super.handleKeyDown(e)):"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):"ArrowUp"===e.key||"ArrowRight"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}Li.registerComponent("Slider",ls);const cs=(e,t)=>as(e/t*100,0,100).toFixed(2)+"%";Li.registerComponent("LoadProgressBar",class extends Li{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",e=>this.update(e))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=mn("span",{className:"vjs-control-text"}),n=mn("span",{textContent:this.localize("Loaded")}),i=a().createTextNode(": ");return this.percentageEl_=mn("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(i),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const e=this.player_.liveTracker,t=this.player_.buffered(),n=e&&e.isLive()?e.seekableEnd():this.player_.duration(),i=this.player_.bufferedEnd(),r=this.partEls_,s=cs(i,n);this.percent_!==s&&(this.el_.style.width=s,yn(this.percentageEl_,s),this.percent_=s);for(let a=0;a<t.length;a++){const e=t.start(a),n=t.end(a);let s=r[a];s||(s=this.el_.appendChild(mn()),r[a]=s),s.dataset.start===e&&s.dataset.end===n||(s.dataset.start=e,s.dataset.end=n,s.style.left=cs(e,i),s.style.width=cs(n-e,i))}for(let a=r.length;a>t.length;a--)this.el_.removeChild(r[a-1]);r.length=t.length})}});Li.registerComponent("TimeTooltip",class extends Li{constructor(e,t){super(e,t),this.update=pi(di(this,this.update),hi)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const i=Rn(this.el_),r=An(this.player_.el()),s=e.width*t;if(!r||!i)return;let a=e.left-r.left+s,o=e.width-s+(r.right-e.right);o||(o=e.width-s,a=s);let l=i.width/2;a<l?l+=l-a:o<l&&(l=o),l<0?l=0:l>i.width&&(l=i.width),l=Math.round(l),this.el_.style.right="-".concat(l,"px"),this.write(n)}write(e){yn(this.el_,e)}updateTime(e,t,n,i){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let r;const s=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const e=this.player_.liveTracker.liveWindow(),n=e-t*e;r=(n<1?"":"-")+ji(n,e)}else r=ji(n,s);this.update(e,t,r),i&&i()})}});class us extends Li{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=pi(di(this,this.update),hi)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t,n){const i=this.getChild("timeTooltip");if(!i)return;const r=n&&n.target&&"function"===typeof n.target.pendingSeekTime?n.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();i.updateTime(e,t,r)}}us.prototype.options_={children:[]},ln||Wt||us.prototype.options_.children.push("timeTooltip"),Li.registerComponent("PlayProgressBar",us);class hs extends Li{constructor(e,t){super(e,t),this.update=pi(di(this,this.update),hi)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,()=>{this.el_.style.left="".concat(e.width*t,"px")})}}hs.prototype.options_={children:["timeTooltip"]},Li.registerComponent("MouseTimeDisplay",hs);class ds extends ls{constructor(e,t){(t=Ft(ds.prototype.options_,t)).children=[...t.children];const n=e.options_.disableSeekWhileScrubbingOnMobile&&(ln||Wt)||e.options_.disableSeekWhileScrubbingOnSTV;(!ln&&!Wt||n)&&t.children.splice(1,0,"mouseTimeDisplay"),super(e,t),this.shouldDisableSeekWhileScrubbing_=n,this.pendingSeekTime_=null,this.setEventHandlers_()}setEventHandlers_(){this.update_=di(this,this.update),this.update=pi(this.update_,hi),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in a()&&"visibilityState"in a()&&this.on(a(),"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){"hidden"===a().visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,hi))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if("hidden"===a().visibilityState)return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const n=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),i=this.player_.liveTracker;let r=this.player_.duration();i&&i.isLive()&&(r=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.percent_=t),this.currentTime_===n&&this.duration_===r||(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[ji(n,r),ji(r,r)],"{1} of {2}")),this.currentTime_=n,this.duration_=r),this.bar&&this.bar.update(An(this.el()),this.getProgress(),e)}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}pendingSeekTime(e){if(void 0!==e)if(null!==e){const t=this.player_.duration();this.pendingSeekTime_=Math.max(0,Math.min(e,t))}else this.pendingSeekTime_=null;return this.pendingSeekTime_}getPercent(){if(null!==this.pendingSeekTime())return this.pendingSeekTime()/this.player_.duration();const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){Un(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.shouldDisableSeekWhileScrubbing_||this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Un(e)||isNaN(this.player_.duration()))return;n||this.player_.scrubbing()||this.player_.scrubbing(!0);const i=this.calculateDistance(e),r=this.player_.liveTracker;if(r&&r.isLive()){if(i>=.99)return void r.seekToLiveEdge();const e=r.seekableStart(),n=r.liveCurrentTime();if(t=e+i*r.liveWindow(),t>=n&&(t=n),t<=e&&(t=e+.1),t===1/0)return}else t=i*this.player_.duration(),t===this.player_.duration()&&(t-=.1);this.shouldDisableSeekWhileScrubbing_?this.pendingSeekTime(t):this.userSeek_(t),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),null!==this.pendingSeekTime()&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?Xi(this.player_.play()):this.update_()}handlePendingSeek_(e){this.player_.paused()||this.player_.pause();const t=null!==this.pendingSeekTime()?this.pendingSeekTime():this.player_.currentTime();this.pendingSeekTime(t+e),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}stepForward(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(this.options().stepSeconds):this.userSeek_(this.player_.currentTime()+this.options().stepSeconds)}stepBack(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(-this.options().stepSeconds):this.userSeek_(this.player_.currentTime()-this.options().stepSeconds)}handleAction(e){null!==this.pendingSeekTime()&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if("Home"===e.key)e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if("End"===e.key)e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const n=.1*parseInt(e.key,10);t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else"PageDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-this.options().stepSeconds*this.options().pageMultiplier)):"PageUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+this.options().stepSeconds*this.options().pageMultiplier)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in a()&&"visibilityState"in a()&&this.off(a(),"visibilitychange",this.toggleVisibility_),super.dispose()}}ds.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar",stepSeconds:5,pageMultiplier:12},Li.registerComponent("SeekBar",ds);class ps extends Li{constructor(e,t){super(e,t),this.handleMouseMove=pi(di(this,this.handleMouseMove),hi),this.throttledHandleMouseSeek=pi(di(this,this.handleMouseSeek),hi),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.handleMouseDownHandler_=e=>this.handleMouseDown(e),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),i=t.getChild("mouseTimeDisplay");if(!n&&!i)return;const r=t.el(),s=Rn(r);let a=Dn(r,e).x;a=as(a,0,1),i&&i.update(s,a),n&&n.update(s,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&Xi(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}ps.prototype.options_={children:["seekBar"]},Li.registerComponent("ProgressControl",ps);class fs extends Jr{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],e=>this.handlePictureInPictureChange(e)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],e=>this.handlePictureInPictureEnabledChange(e)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return"vjs-picture-in-picture-control vjs-hidden ".concat(super.buildCSSClass())}handlePictureInPictureAudioModeChange(){"audio"===this.player_.currentType().substring(0,5)||this.player_.audioPosterMode()||this.player_.audioOnlyMode()?(this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()):this.show()}handlePictureInPictureEnabledChange(){a().pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in r()?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){"function"===typeof a().exitPictureInPicture&&super.show()}}fs.prototype.controlText_="Picture-in-Picture",Li.registerComponent("PictureInPictureToggle",fs);class gs extends Jr{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",e=>this.handleFullscreenChange(e)),!1===a()[e.fsApi_.fullscreenEnabled]&&this.disable()}buildCSSClass(){return"vjs-fullscreen-control ".concat(super.buildCSSClass())}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}gs.prototype.controlText_="Fullscreen",Li.registerComponent("FullscreenToggle",gs);Li.registerComponent("VolumeLevel",class extends Li{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}});Li.registerComponent("VolumeLevelTooltip",class extends Li{constructor(e,t){super(e,t),this.update=pi(di(this,this.update),hi)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,i){if(!n){const n=An(this.el_),i=An(this.player_.el()),r=e.width*t;if(!i||!n)return;const s=e.left-i.left+r,a=e.width-r+(i.right-e.right);let o=n.width/2;s<o?o+=o-s:a<o&&(o=a),o<0?o=0:o>n.width&&(o=n.width),this.el_.style.right="-".concat(o,"px")}this.write("".concat(i,"%"))}write(e){yn(this.el_,e)}updateVolume(e,t,n,i,r){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,n,i.toFixed(0)),r&&r()})}});class ms extends Li{constructor(e,t){super(e,t),this.update=pi(di(this,this.update),hi)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const i=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,i,()=>{n?this.el_.style.bottom="".concat(e.height*t,"px"):this.el_.style.left="".concat(e.width*t,"px")})}}ms.prototype.options_={children:["volumeLevelTooltip"]},Li.registerComponent("MouseVolumeLevelDisplay",ms);class ys extends ls{constructor(e,t){super(e,t),this.on("slideractive",e=>this.updateLastVolume_(e)),this.on(e,"volumechange",e=>this.updateARIAAttributes(e)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){Un(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),i=An(n),r=this.vertical();let s=Dn(n,e);s=r?s.y:s.x,s=as(s,0,1),t.update(i,s,r)}Un(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(100*this.player_.volume())}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{0===this.player_.volume()&&this.player_.lastVolume_(e)})}}ys.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},ln||Wt||ys.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),ys.prototype.playerEvent="volumechange",Li.registerComponent("VolumeBar",ys);class bs extends Li{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.vertical=t.vertical||!1,("undefined"===typeof t.volumeBar||Pt(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})}(this,e),this.throttledHandleMouseMove=pi(di(this,this.handleMouseMove),hi),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.on("mousedown",e=>this.handleMouseDown(e)),this.on("touchstart",e=>this.handleMouseDown(e)),this.on("mousemove",e=>this.handleMouseMove(e)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:"vjs-volume-control vjs-control ".concat(e)})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}bs.prototype.options_={children:["volumeBar"]},Li.registerComponent("VolumeControl",bs);class vs extends Jr{constructor(e,t){super(e,t),function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})}(this,e),this.on(e,["loadstart","volumechange"],e=>this.update(e))}buildCSSClass(){return"vjs-mute-control ".concat(super.buildCSSClass())}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(0===t){const e=n<.1?.1:n;this.player_.volume(e),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),ln&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),xn(this.el_,[0,1,2,3].reduce((e,t)=>e+"".concat(t?" ":"","vjs-vol-").concat(t),"")),_n(this.el_,"vjs-vol-".concat(t))}updateControlText_(){const e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)}}vs.prototype.controlText_="Mute",Li.registerComponent("MuteToggle",vs);class _s extends Li{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"undefined"!==typeof t.inline?t.inline=t.inline:t.inline=!0,("undefined"===typeof t.volumeControl||Pt(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=e=>this.handleKeyPress(e),this.on(e,["loadstart"],e=>this.volumePanelState_(e)),this.on(this.muteToggle,"keyup",e=>this.handleKeyPress(e)),this.on(this.volumeControl,"keyup",e=>this.handleVolumeControlKeyUp(e)),this.on("keydown",e=>this.handleKeyPress(e)),this.on("mouseover",e=>this.handleMouseOver(e)),this.on("mouseout",e=>this.handleMouseOut(e)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:"vjs-volume-panel vjs-control ".concat(e)})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){"Escape"===e.key&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),si(a(),"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),ai(a(),"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){"Escape"===e.key&&this.handleMouseOut()}}_s.prototype.options_={children:["muteToggle","volumeControl"]},Li.registerComponent("VolumePanel",_s);class xs extends Jr{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon("forward-".concat(this.skipTime)),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return"vjs-skip-forward-".concat(this.getSkipForwardTime()," ").concat(super.buildCSSClass())}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),n=this.player_.liveTracker,i=n&&n.isLive()?n.seekableEnd():this.player_.duration();let r;r=t+this.skipTime<=i?t+this.skipTime:i,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}xs.prototype.controlText_="Skip Forward",Li.registerComponent("SkipForward",xs);class ws extends Jr{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon("replay-".concat(this.skipTime)),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return"vjs-skip-backward-".concat(this.getSkipBackwardTime()," ").concat(super.buildCSSClass())}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,i=n&&n.isLive()&&n.seekableStart();let r;r=i&&t-this.skipTime<=i?i:t>=this.skipTime?t-this.skipTime:0,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}ws.prototype.controlText_="Skip Backward",Li.registerComponent("SkipBackward",ws);class Ts extends Li{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",e=>this.handleKeyDown(e)),this.boundHandleBlur_=e=>this.handleBlur(e),this.boundHandleTapClick_=e=>this.handleTapClick(e)}addEventListenerForItem(e){e instanceof Li&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof Li&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){"string"===typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=mn(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),si(t,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||a().activeElement;if(!this.children().some(e=>e.el()===t)){const e=this.menuButton_;e&&e.buttonPressed_&&t!==e.el().firstChild&&e.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter(t=>t.el()===e.target)[0];if(!n)return;"CaptionSettingsMenuItem"!==n.name()&&this.menuButton_.focus()}}handleKeyDown(e){"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):"ArrowRight"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)}focus(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}Li.registerComponent("Menu",Ts);class ks extends Li{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.menuButton_=new Jr(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=Jr.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const i=e=>this.handleClick(e);this.handleMenuKeyUp_=e=>this.handleMenuKeyUp(e),this.on(this.menuButton_,"tap",i),this.on(this.menuButton_,"click",i),this.on(this.menuButton_,"keydown",e=>this.handleKeyDown(e)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),si(a(),"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",e=>this.handleMouseLeave(e)),this.on("keydown",e=>this.handleSubmenuKeyDown(e))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new Ts(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=mn("li",{className:"vjs-menu-title",textContent:Ri(this.options_.title),tabIndex:-1}),n=new Li(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";!0===this.options_.inline?e+="-inline":e+="-popup";const t=Jr.prototype.buildCSSClass();return"vjs-menu-button ".concat(e," ").concat(t," ").concat(super.buildCSSClass())}buildCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup","vjs-menu-button ".concat(e," ").concat(super.buildCSSClass())}controlText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.menuButton_.el();return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),ai(a(),"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){"Escape"===e.key||"Tab"===e.key?(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus())):"Up"!==e.key&&("Down"!==e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)||this.buttonPressed_||(e.preventDefault(),this.pressButton())}handleMenuKeyUp(e){"Escape"!==e.key&&"Tab"!==e.key||this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){"Escape"!==e.key&&"Tab"!==e.key||(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),ln&&fn())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}Li.registerComponent("MenuButton",ks);class Ss extends ks{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const i=di(this,this.update);n.addEventListener("removetrack",i),n.addEventListener("addtrack",i),n.addEventListener("labelchange",i),this.player_.on("ready",i),this.player_.on("dispose",function(){n.removeEventListener("removetrack",i),n.removeEventListener("addtrack",i),n.removeEventListener("labelchange",i)})}}Li.registerComponent("TrackButton",Ss);class Cs extends Hr{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const i=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n),r=mn("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?i.appendChild(r):i.replaceChild(r,i.querySelector(".vjs-icon-placeholder")),i}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}Li.registerComponent("MenuItem",Cs);class Is extends Cs{constructor(e,t){var n;const i=t.track,s=e.textTracks();t.label=i.label||i.language||"Unknown",t.selected="showing"===i.mode,super(e,t),n=this,this.track=i,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const o=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleTracksChange.apply(n,t)},l=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleSelectedLanguageChange.apply(n,t)};if(e.on(["loadstart","texttrackchange"],o),s.addEventListener("change",o),s.addEventListener("selectedlanguagechange",l),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],o),s.removeEventListener("change",o),s.removeEventListener("selectedlanguagechange",l)}),void 0===s.onchange){let e;this.on(["tap","click"],function(){if("object"!==typeof r().Event)try{e=new(r().Event)("change")}catch(t){}e||(e=a().createEvent("Event"),e.initEvent("change",!0,!0)),s.dispatchEvent(e)})}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),n)for(let i=0;i<n.length;i++){const e=n[i];-1!==this.kinds.indexOf(e.kind)&&(e===t?"showing"!==e.mode&&(e.mode="showing"):"disabled"!==e.mode&&(e.mode="disabled"))}}handleTracksChange(e){const t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if("showing"===this.track.mode){const e=this.player_.cache_.selectedLanguage;if(e&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}Li.registerComponent("TextTrackMenuItem",Is);class Es extends Is{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(this.options_.kinds.indexOf(e.kind)>-1&&"showing"===e.mode){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(["captions","descriptions","subtitles"].indexOf(e.kind)>-1&&"showing"===e.mode){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}Li.registerComponent("OffTextTrackMenuItem",Es);class Ns extends Ss{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.tracks=e.textTracks(),super(e,t)}createItems(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Is;this.label_&&(e="".concat(this.label_," off")),t.push(new Es(this.player_,{kinds:this.kinds_,kind:this.kind_,label:e})),this.hideThreshold_+=1;const i=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let r=0;r<i.length;r++){const e=i[r];if(this.kinds_.indexOf(e.kind)>-1){const i=new n(this.player_,{track:e,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});i.addClass("vjs-".concat(e.kind,"-menu-item")),t.push(i)}}return t}}Li.registerComponent("TextTrackButton",Ns);class As extends Cs{constructor(e,t){const n=t.track,i=t.cue,r=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=i.text,t.selected=i.startTime<=r&&r<i.endTime,super(e,t),this.track=n,this.cue=i}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}Li.registerComponent("ChaptersTrackMenuItem",As);class Rs extends Ns{constructor(e,t,n){super(e,t,n),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach(e=>{e.selected(this.track_.activeCues[0]===e.cue)})}}buildCSSClass(){return"vjs-chapters-button ".concat(super.buildCSSClass())}buildWrapperCSSClass(){return"vjs-chapters-button ".concat(super.buildWrapperCSSClass())}update(e){if(e&&e.track&&"chapters"!==e.track.kind)return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(Ri(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new As(this.player_,{track:this.track_,cue:i});e.push(r)}return e}}Rs.prototype.kind_="chapters",Rs.prototype.controlText_="Chapters",Li.registerComponent("ChaptersButton",Rs);class Ds extends Ns{constructor(e,t,n){super(e,t,n),this.setIcon("audio-description");const i=e.textTracks(),r=di(this,this.handleTracksChange);i.addEventListener("change",r),this.on("dispose",function(){i.removeEventListener("change",r)})}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(e.kind!==this.kind_&&"showing"===e.mode){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return"vjs-descriptions-button ".concat(super.buildCSSClass())}buildWrapperCSSClass(){return"vjs-descriptions-button ".concat(super.buildWrapperCSSClass())}}Ds.prototype.kind_="descriptions",Ds.prototype.controlText_="Descriptions",Li.registerComponent("DescriptionsButton",Ds);class Os extends Ns{constructor(e,t,n){super(e,t,n),this.setIcon("subtitles")}buildCSSClass(){return"vjs-subtitles-button ".concat(super.buildCSSClass())}buildWrapperCSSClass(){return"vjs-subtitles-button ".concat(super.buildWrapperCSSClass())}}Os.prototype.kind_="subtitles",Os.prototype.controlText_="Subtitles",Li.registerComponent("SubtitlesButton",Os);class Ls extends Is{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}Li.registerComponent("CaptionSettingsMenuItem",Ls);class Ps extends Ns{constructor(e,t,n){super(e,t,n),this.setIcon("captions")}buildCSSClass(){return"vjs-captions-button ".concat(super.buildCSSClass())}buildWrapperCSSClass(){return"vjs-captions-button ".concat(super.buildWrapperCSSClass())}createItems(){const e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new Ls(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}Ps.prototype.kind_="captions",Ps.prototype.controlText_="Captions",Li.registerComponent("CaptionsButton",Ps);class Fs extends Is{createEl(e,t,n){const i=super.createEl(e,t,n),r=i.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",i):r.appendChild(mn("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(mn("span",{className:"vjs-control-text",textContent:" ".concat(this.localize("Captions"))}))),i}}Li.registerComponent("SubsCapsMenuItem",Fs);class Ms extends Ns{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(Ri(this.label_))}buildCSSClass(){return"vjs-subs-caps-button ".concat(super.buildCSSClass())}buildWrapperCSSClass(){return"vjs-subs-caps-button ".concat(super.buildWrapperCSSClass())}createItems(){let e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new Ls(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,Fs),e}}Ms.prototype.kinds_=["captions","subtitles"],Ms.prototype.controlText_="Subtitles",Li.registerComponent("SubsCapsButton",Ms);class Us extends Cs{constructor(e,t){var n;const i=t.track,r=e.audioTracks();t.label=i.label||i.language||"Unknown",t.selected=i.enabled,super(e,t),n=this,this.track=i,this.addClass("vjs-".concat(i.kind,"-menu-item"));const s=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleTracksChange.apply(n,t)};r.addEventListener("change",s),this.on("dispose",()=>{r.removeEventListener("change",s)})}createEl(e,t,n){const i=super.createEl(e,t,n),r=i.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(r.appendChild(mn("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(mn("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),i}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const e=this.player_.audioTracks();for(let t=0;t<e.length;t++){const n=e[t];n!==this.track&&(n.enabled=n===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}Li.registerComponent("AudioTrackMenuItem",Us);class Bs extends Ss{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return"vjs-audio-button ".concat(super.buildCSSClass())}buildWrapperCSSClass(){return"vjs-audio-button ".concat(super.buildWrapperCSSClass())}createItems(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const i=t[n];e.push(new Us(this.player_,{track:i,selectable:!0,multiSelectable:!1}))}return e}}Bs.prototype.controlText_="Audio Track",Li.registerComponent("AudioTrackButton",Bs);class zs extends Cs{constructor(e,t){const n=t.rate,i=parseFloat(n,10);t.label=n,t.selected=i===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=i,this.on(e,"ratechange",e=>this.update(e))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}zs.prototype.contentElType="button",Li.registerComponent("PlaybackRateMenuItem",zs);class Vs extends ks{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",e=>this.updateVisibility(e)),this.on(e,"ratechange",e=>this.updateLabel(e)),this.on(e,"playbackrateschange",e=>this.handlePlaybackRateschange(e))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=mn("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return"vjs-playback-rate ".concat(super.buildCSSClass())}buildWrapperCSSClass(){return"vjs-playback-rate ".concat(super.buildWrapperCSSClass())}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new zs(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}Vs.prototype.controlText_="Playback Rate",Li.registerComponent("PlaybackRateMenuButton",Vs);class js extends Li{buildCSSClass(){return"vjs-spacer ".concat(super.buildCSSClass())}createEl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}Li.registerComponent("Spacer",js);Li.registerComponent("CustomControlSpacer",class extends js{buildCSSClass(){return"vjs-custom-control-spacer ".concat(super.buildCSSClass())}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:"\xa0"})}});class Ws extends Li{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}Ws.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]},Li.registerComponent("ControlBar",Ws);class Hs extends Zi{constructor(e,t){super(e,t),this.on(e,"error",e=>{this.open(e)})}buildCSSClass(){return"vjs-error-display ".concat(super.buildCSSClass())}content(){const e=this.player().error();return e?this.localize(e.message):""}}Hs.prototype.options_=Object.assign({},Zi.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),Li.registerComponent("ErrorDisplay",Hs);class Gs extends Li{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim();return mn("select",{id:this.options_.id},{},this.options_.SelectOptions.map(e=>{const t=(this.options_.labelId?this.options_.labelId:"vjs-track-option-".concat(ei()))+"-"+e[1].replace(/\W+/g,""),n=mn("option",{id:t,value:this.localize(e[0]),textContent:this.localize(e[1])});return n.setAttribute("aria-labelledby","".concat(this.selectLabelledbyIds," ").concat(t)),n}))}}Li.registerComponent("TextTrackSelect",Gs);class qs extends Li{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});const t=mn("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(t);const n=this.options_.selects;for(const i of n){const t=this.options_.selectConfigs[i],n=t.className,r=t.id.replace("%s",this.options_.id_);let s=null;const a="vjs_select_".concat(ei());if("colors"===this.options_.type){s=mn("span",{className:n});const e=mn("label",{id:r,className:"vjs-label",textContent:this.localize(t.label)});e.setAttribute("for",a),s.appendChild(e)}const o=new Gs(e,{SelectOptions:t.options,legendId:this.options_.legendId,id:a,labelId:r});this.addChild(o),"colors"===this.options_.type&&(s.appendChild(o.el()),this.el().appendChild(s))}}createEl(){return mn("fieldset",{className:this.options_.className})}}Li.registerComponent("TextTrackFieldset",qs);class Xs extends Li{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});const t=this.options_.textTrackComponentid,n=new qs(e,{id_:t,legendId:"captions-text-legend-".concat(t),legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(n);const i=new qs(e,{id_:t,legendId:"captions-background-".concat(t),legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(i);const r=new qs(e,{id_:t,legendId:"captions-window-".concat(t),legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(r)}createEl(){return mn("div",{className:"vjs-track-settings-colors"})}}Li.registerComponent("TextTrackSettingsColors",Xs);class Ks extends Li{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});const t=this.options_.textTrackComponentid,n=new qs(e,{id_:t,legendId:"captions-font-size-".concat(t),legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(n);const i=new qs(e,{id_:t,legendId:"captions-edge-style-".concat(t),legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(i);const r=new qs(e,{id_:t,legendId:"captions-font-family-".concat(t),legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(r)}createEl(){return mn("div",{className:"vjs-track-settings-font"})}}Li.registerComponent("TextTrackSettingsFont",Ks);class Ys extends Li{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});const t=new Jr(e,{controlText:this.localize("restore all settings to the default values"),className:"vjs-default-button"});t.el().classList.remove("vjs-control","vjs-button"),t.el().textContent=this.localize("Reset"),this.addChild(t);const n=this.localize("Done"),i=new Jr(e,{controlText:n,className:"vjs-done-button"});i.el().classList.remove("vjs-control","vjs-button"),i.el().textContent=n,this.addChild(i)}createEl(){return mn("div",{className:"vjs-track-settings-controls"})}}Li.registerComponent("TrackSettingsControls",Ys);const Qs="vjs-text-track-settings",$s=["#000","Black"],Js=["#00F","Blue"],Zs=["#0FF","Cyan"],ea=["#0F0","Green"],ta=["#F0F","Magenta"],na=["#F00","Red"],ia=["#FFF","White"],ra=["#FF0","Yellow"],sa=["1","Opaque"],aa=["0.5","Semi-Transparent"],oa=["0","Transparent"],la={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[$s,ia,na,ea,Js,ra,ta,Zs],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[sa,aa,oa],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[ia,$s,na,ea,Js,ra,ta,Zs],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:e=>"1.00"===e?null:Number(e)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[sa,aa],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[oa,aa,sa],className:"vjs-window-opacity vjs-opacity"}};function ca(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}la.windowColor.options=la.backgroundColor.options;Li.registerComponent("TextTrackSettings",class extends Zi{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=mn("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),void 0===t.persistTextTrackSettings&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const t=new Xs(e,{textTrackComponentid:this.id_,selectConfigs:la,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(t);const n=new Ks(e,{textTrackComponentid:this.id_,selectConfigs:la,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(n);const i=new Ys(e);this.addChild(i)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),["click","tap"],()=>{this.setDefaults(),this.updateDisplay()}),Dt(la,e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return Ot(la,(e,t,n)=>{const i=(r=this.$(t.selector),s=t.parser,ca(r.options[r.options.selectedIndex].value,s));var r,s;return void 0!==i&&(e[n]=i),e},{})}setValues(e){Dt(la,(t,n)=>{!function(e,t,n){if(t)for(let i=0;i<e.options.length;i++)if(ca(e.options[i].value,n)===t){e.selectedIndex=i;break}}(this.$(t.selector),e[n],t.parser)})}setDefaults(){Dt(la,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(r().localStorage.getItem(Qs))}catch(t){Et.warn(t)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?r().localStorage.setItem(Qs,JSON.stringify(e)):r().localStorage.removeItem(Qs)}catch(t){Et.warn(t)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}});Li.registerComponent("ResizeManager",class extends Li{constructor(e,t){let n=t.ResizeObserver||r().ResizeObserver;null===t.ResizeObserver&&(n=!1);super(e,Ft({createEl:!n,reportTouchActivity:!1},t)),this.ResizeObserver=t.ResizeObserver||r().ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=fi(()=>{this.resizeHandler()},100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const e=this.debouncedHandler_;let t=this.unloadListener_=function(){ai(this,"resize",e),ai(this,"unload",t),t=null};si(this.el_.contentWindow,"unload",t),si(this.el_.contentWindow,"resize",e)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}});const ua={trackingThreshold:20,liveTolerance:15};Li.registerComponent("LiveTracker",class extends Li{constructor(e,t){super(e,Ft(ua,t,{createEl:!1})),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=e=>this.handlePlay(e),this.handleFirstTimeupdate_=e=>this.handleFirstTimeupdate(e),this.handleSeeked_=e=>this.handleSeeked(e),this.seekToLiveEdge_=e=>this.seekToLiveEdge(e),this.reset_(),this.on(this.player_,"durationchange",e=>this.handleDurationchange(e)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(r().performance.now().toFixed(4)),n=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const i=this.liveCurrentTime(),s=this.player_.currentTime();let a=this.player_.paused()||this.seekedBehindLive_||Math.abs(i-s)>this.options_.liveTolerance;this.timeupdateSeen_&&i!==1/0||(a=!1),a!==this.behindLiveEdge_&&(this.behindLiveEdge_=a,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,hi),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return"number"===typeof this.trackingInterval_}seekToLiveEdge(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}});Li.registerComponent("TitleBar",class extends Li{constructor(e,t){super(e,t),this.on("statechanged",e=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:mn("div",{className:"vjs-title-bar-title",id:"vjs-title-bar-title-".concat(ei())}),description:mn("div",{className:"vjs-title-bar-description",id:"vjs-title-bar-description-".concat(ei())})},mn("div",{className:"vjs-title-bar"},{},Mt(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(e=>{const i=this.state[e],r=this.els[e],s=n[e];Ln(r),i&&yn(r,i),t&&(t.removeAttribute(s),i&&t.setAttribute(s,r.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}});const ha={initialDisplay:4e3,position:[],takeFocus:!1};Li.registerComponent("TransientButton",class extends Jr{constructor(e,t){super(e,t=Ft(ha,t)),this.controlText(t.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],e=>{this.removeClass("force-display")})}buildCSSClass(){return"vjs-transient-button focus-visible ".concat(this.options_.position.map(e=>"vjs-".concat(e)).join(" "))}createEl(){const e=mn("button",{},{type:"button",class:this.buildCSSClass()},mn("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout(()=>{this.removeClass("force-display")},this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}});const da=e=>{const t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;const n=e.$$("source"),i=[];let r="";if(!n.length)return!1;for(let s=0;s<n.length;s++){const e=n[s].src;e&&-1===i.indexOf(e)&&i.push(e)}return!!i.length&&(1===i.length&&(r=i[0]),e.triggerSourceset(r),!0)},pa=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(e){const t=a().createElement(this.nodeName.toLowerCase());t.innerHTML=e;const n=a().createDocumentFragment();for(;t.childNodes.length;)n.appendChild(t.childNodes[0]);return this.innerText="",r().Element.prototype.appendChild.call(this,n),this.innerHTML}}),fa=(e,t)=>{let n={};for(let i=0;i<e.length&&(n=Object.getOwnPropertyDescriptor(e[i],t),!(n&&n.set&&n.get));i++);return n.enumerable=!0,n.configurable=!0,n},ga=function(e){const t=e.el();if(t.resetSourceWatch_)return;const n={},i=(e=>fa([e.el(),r().HTMLMediaElement.prototype,r().Element.prototype,pa],"innerHTML"))(e),s=n=>function(){for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];const a=n.apply(t,r);return da(e),a};["append","appendChild","insertAdjacentHTML"].forEach(e=>{t[e]&&(n[e]=t[e],t[e]=s(n[e]))}),Object.defineProperty(t,"innerHTML",Ft(i,{set:s(i.set)})),t.resetSourceWatch_=()=>{t.resetSourceWatch_=null,Object.keys(n).forEach(e=>{t[e]=n[e]}),Object.defineProperty(t,"innerHTML",i)},e.one("sourceset",t.resetSourceWatch_)},ma=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?pr(r().Element.prototype.getAttribute.call(this,"src")):""},set(e){return r().Element.prototype.setAttribute.call(this,"src",e),e}}),ya=function(e){if(!e.featuresSourceset)return;const t=e.el();if(t.resetSourceset_)return;const n=(e=>fa([e.el(),r().HTMLMediaElement.prototype,ma],"src"))(e),i=t.setAttribute,s=t.load;Object.defineProperty(t,"src",Ft(n,{set:i=>{const r=n.set.call(t,i);return e.triggerSourceset(t.src),r}})),t.setAttribute=(n,r)=>{const s=i.call(t,n,r);return/src/i.test(n)&&e.triggerSourceset(t.src),s},t.load=()=>{const n=s.call(t);return da(e)||(e.triggerSourceset(""),ga(e)),n},t.currentSrc?e.triggerSourceset(t.currentSrc):da(e)||ga(e),t.resetSourceset_=()=>{t.resetSourceset_=null,t.load=s,t.setAttribute=i,Object.defineProperty(t,"src",n),t.resetSourceWatch_&&t.resetSourceWatch_()}};class ba extends Cr{constructor(e,t){super(e,t);const n=e.source;let i=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&"VIDEO"===this.el_.tagName,n&&(this.el_.currentSrc!==n.src||e.tag&&3===e.tag.initNetworkState_)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const e=this.el_.childNodes;let t=e.length;const n=[];for(;t--;){const r=e[t];"track"===r.nodeName.toLowerCase()&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(r),this.remoteTextTracks().addTrack(r.track),this.textTracks().addTrack(r.track),i||this.el_.hasAttribute("crossorigin")||!gr(r.src)||(i=!0)):n.push(r))}for(let i=0;i<n.length;i++)this.el_.removeChild(n[i])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&i&&Et.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),this.restoreMetadataTracksInIOSNativePlayer_(),(an||tn)&&!0===e.nativeControlsForTouch&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),ba.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){ya(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let n=0;n<e.length;n++){const i=e[n];"metadata"===i.kind&&t.push({track:i,storedMode:i.mode})}};n(),e.addEventListener("change",n),this.on("dispose",()=>e.removeEventListener("change",n));const i=()=>{for(let e=0;e<t.length;e++){const n=t[e];"disabled"===n.track.mode&&n.track.mode!==n.storedMode&&(n.track.mode=n.storedMode)}e.removeEventListener("change",i)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",n),e.removeEventListener("change",i),e.addEventListener("change",i)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",i)})}overrideNative_(e,t){if(t!==this["featuresNative".concat(e,"Tracks")])return;const n=e.toLowerCase();this["".concat(n,"TracksListeners_")]&&Object.keys(this["".concat(n,"TracksListeners_")]).forEach(e=>{this.el()["".concat(n,"Tracks")].removeEventListener(e,this["".concat(n,"TracksListeners_")][e])}),this["featuresNative".concat(e,"Tracks")]=!t,this["".concat(n,"TracksListeners_")]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=Tr[e],n=this.el()[t.getterName],i=this[t.getterName]();if(!this["featuresNative".concat(t.capitalName,"Tracks")]||!n||!n.addEventListener)return;const r={change:t=>{const n={type:"change",target:i,currentTarget:i,srcElement:i};i.trigger(n),"text"===e&&this[kr.remoteText.getterName]().trigger(n)},addtrack(e){i.addTrack(e.track)},removetrack(e){i.removeTrack(e.track)}},s=function(){const e=[];for(let t=0;t<i.length;t++){let r=!1;for(let e=0;e<n.length;e++)if(n[e]===i[t]){r=!0;break}r||e.push(i[t])}for(;e.length;)i.removeTrack(e.shift())};this[t.getterName+"Listeners_"]=r,Object.keys(r).forEach(e=>{const t=r[e];n.addEventListener(e,t),this.on("dispose",i=>n.removeEventListener(e,t))}),this.on("loadstart",s),this.on("dispose",e=>this.off("loadstart",s))}proxyNativeTracks_(){Tr.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){const t=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(t,e),ba.disposeMediaElement(e),e=t}else{e=a().createElement("video");const t=Ft({},this.options_.tag&&kn(this.options_.tag));an&&!0===this.options_.nativeControlsForTouch||delete t.controls,Tn(e,Object.assign(t,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}"undefined"!==typeof this.options_.preload&&Cn(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const i=t[n],r=this.options_[i];"undefined"!==typeof r&&(r?Cn(e,i,i):In(e,i),e[i]=r)}return e}handleLateInit_(e){if(0===e.networkState||3===e.networkState)return;if(0===e.readyState){let e=!1;const t=function(){e=!0};this.on("loadstart",t);const n=function(){e||this.trigger("loadstart")};return this.on("loadedmetadata",n),void this.ready(function(){this.off("loadstart",t),this.off("loadedmetadata",n),e||this.trigger("loadstart")})}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(e){this.trigger(e)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&cn?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){Et(t,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&Wt&&Xt&&0===this.el_.currentTime){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return"function"===typeof this.el_.webkitEnterFullScreen}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)Xi(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}exitFullScreen(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(void 0===e)return this.el_.src;this.setSrc(e)}addSourceElement(e,t){if(!e)return Et.error("Invalid source URL."),!1;const n={src:e};t&&(n.type=t);const i=mn("source",{},n);return this.el_.appendChild(i),!0}removeSourceElement(e){if(!e)return Et.error("Source URL is required to remove the source element."),!1;const t=this.el_.querySelectorAll("source");for(const n of t)if(n.src===e)return this.el_.removeChild(n),!0;return Et.warn("No matching source element found with src: ".concat(e)),!1}reset(){ba.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=a().createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;for(;n--;)e!==t[n]&&e!==t[n].track||this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if("function"===typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();const e={};return"undefined"!==typeof this.el().webkitDroppedFrameCount&&"undefined"!==typeof this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),r().performance&&(e.creationTime=r().performance.now()),e}}Ut(ba,"TEST_VID",function(){if(!dn())return;const e=a().createElement("video"),t=a().createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e}),ba.isSupported=function(){try{ba.TEST_VID.volume=.5}catch(e){return!1}return!(!ba.TEST_VID||!ba.TEST_VID.canPlayType)},ba.canPlayType=function(e){return ba.TEST_VID.canPlayType(e)},ba.canPlaySource=function(e,t){return ba.canPlayType(e.type)},ba.canControlVolume=function(){try{const e=ba.TEST_VID.volume;ba.TEST_VID.volume=e/2+.1;const t=e!==ba.TEST_VID.volume;return t&&ln?(r().setTimeout(()=>{ba&&ba.prototype&&(ba.prototype.featuresVolumeControl=e!==ba.TEST_VID.volume)}),!1):t}catch(e){return!1}},ba.canMuteVolume=function(){try{const e=ba.TEST_VID.muted;return ba.TEST_VID.muted=!e,ba.TEST_VID.muted?Cn(ba.TEST_VID,"muted","muted"):In(ba.TEST_VID,"muted"),e!==ba.TEST_VID.muted}catch(e){return!1}},ba.canControlPlaybackRate=function(){if(Wt&&Xt&&Yt<58)return!1;try{const e=ba.TEST_VID.playbackRate;return ba.TEST_VID.playbackRate=e/2+.1,e!==ba.TEST_VID.playbackRate}catch(e){return!1}},ba.canOverrideAttributes=function(){try{const e=()=>{};Object.defineProperty(a().createElement("video"),"src",{get:e,set:e}),Object.defineProperty(a().createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(a().createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(a().createElement("audio"),"innerHTML",{get:e,set:e})}catch(e){return!1}return!0},ba.supportsNativeTextTracks=function(){return cn||ln&&Xt},ba.supportsNativeVideoTracks=function(){return!(!ba.TEST_VID||!ba.TEST_VID.videoTracks)},ba.supportsNativeAudioTracks=function(){return!(!ba.TEST_VID||!ba.TEST_VID.audioTracks)},ba.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(e){let[t,n]=e;Ut(ba.prototype,t,()=>ba[n](),!0)}),ba.prototype.featuresVolumeControl=ba.canControlVolume(),ba.prototype.movingMediaElementInDOM=!ln,ba.prototype.featuresFullscreenResize=!0,ba.prototype.featuresProgressEvents=!0,ba.prototype.featuresTimeupdateEvents=!0,ba.prototype.featuresVideoFrameCallback=!(!ba.TEST_VID||!ba.TEST_VID.requestVideoFrameCallback),ba.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"===typeof e.load&&function(){try{e.load()}catch(t){}}()}},ba.resetMediaElement=function(e){if(!e)return;const t=e.querySelectorAll("source");let n=t.length;for(;n--;)e.removeChild(t[n]);e.removeAttribute("src"),"function"===typeof e.load&&function(){try{e.load()}catch(t){}}()},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(e){ba.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){ba.prototype["set"+Ri(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(e){ba.prototype[e]=function(){return this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(e){ba.prototype["set"+Ri(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(e){ba.prototype[e]=function(){return this.el_[e]()}}),Cr.withSourceHandlers(ba),ba.nativeSourceHandler={},ba.nativeSourceHandler.canPlayType=function(e){try{return ba.TEST_VID.canPlayType(e)}catch(t){return""}},ba.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return ba.nativeSourceHandler.canPlayType(e.type);if(e.src){const t=fr(e.src);return ba.nativeSourceHandler.canPlayType("video/".concat(t))}return""},ba.nativeSourceHandler.handleSource=function(e,t,n){t.setSrc(e.src)},ba.nativeSourceHandler.dispose=function(){},ba.registerSourceHandler(ba.nativeSourceHandler),Cr.registerTech("Html5",ba);const va=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],_a={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},xa=["tiny","xsmall","small","medium","large","xlarge","huge"],wa={};xa.forEach(e=>{const t="x"===e.charAt(0)?"x-".concat(e.substring(1)):e;wa[e]="vjs-layout-".concat(t)});const Ta={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class ka extends Li{constructor(e,t,n){if(e.id=e.id||t.id||"vjs_video_".concat(ei()),(t=Object.assign(ka.getTagSettings(e),t)).initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const n=e.closest("[lang]");n&&(t.language=n.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=e=>this.documentFullscreenChange_(e),this.boundFullWindowOnEscKey_=e=>this.fullWindowOnEscKey(e),this.boundUpdateStyleEl_=e=>this.updateStyleEl_(e),this.boundApplyInitTime_=e=>this.applyInitTime_(e),this.boundUpdateCurrentBreakpoint_=e=>this.updateCurrentBreakpoint_(e),this.boundHandleTechClick_=e=>this.handleTechClick_(e),this.boundHandleTechDoubleClick_=e=>this.handleTechDoubleClick_(e),this.boundHandleTechTouchStart_=e=>this.handleTechTouchStart_(e),this.boundHandleTechTouchMove_=e=>this.handleTechTouchMove_(e),this.boundHandleTechTouchEnd_=e=>this.handleTechTouchEnd_(e),this.boundHandleTechTap_=e=>this.handleTechTap_(e),this.boundUpdatePlayerHeightOnAudioOnlyMode_=e=>this.updatePlayerHeightOnAudioOnlyMode_(e),this.isFullscreen_=!1,this.log=Nt(this.id_),this.fsApi_=Tt,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&kn(e),this.language(this.options_.language),t.languages){const e={};Object.getOwnPropertyNames(t.languages).forEach(function(n){e[n.toLowerCase()]=t.languages[n]}),this.languages_=e}else this.languages_=ka.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(e=>{if("function"!==typeof this[e])throw new Error('plugin "'.concat(e,'" does not exist'))}),this.scrubbing_=!1,this.el_=this.createEl(),Ii(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(si(a(),this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const i=Ft(this.options_);if(t.plugins&&Object.keys(t.plugins).forEach(e=>{this[e](t.plugins[e])}),t.debug&&this.debug(!0),this.options_.playerOptions=i,this.middleware_=[],this.playbackRates(t.playbackRates),t.experimentalSvgIcons){const e=(new(r().DOMParser)).parseFromString('<svg xmlns="http://www.w3.org/2000/svg">\n  <defs>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play">\n      <path d="M16 10v28l22-14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">\n      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">\n      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">\n      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">\n      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">\n      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">\n      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">\n      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">\n      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">\n      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">\n      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">\n      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">\n      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>\n    </symbol>\n    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">\n      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">\n      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">\n      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">\n      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">\n      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">\n      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-share">\n      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">\n      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-square">\n      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">\n      <circle cx="24" cy="24" r="20"></circle>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">\n      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">\n      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">\n      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">\n      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">\n      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">\n      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">\n      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">\n      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">\n      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>\n    </symbol>\n    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">\n      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">\n      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">\n      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">\n      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">\n      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">\n      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">\n      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>\n      <path fill="none" d="M-1-3h24v24H-1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">\n      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">\n      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">\n      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">\n      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">\n      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>\n    </symbol>\n  </defs>\n</svg>',"image/svg+xml");if(e.querySelector("parsererror"))Et.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const t=e.documentElement;t.style.display="none",this.el_.appendChild(t),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio("audio"===e.nodeName.toLowerCase()),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),t.spatialNavigation&&t.spatialNavigation.enabled&&(this.spatialNavigation=new Wr(this),this.addClass("vjs-spatial-navigation-enabled")),an&&this.addClass("vjs-touch-enabled"),ln||this.addClass("vjs-workinghover"),ka.players[this.id_]=this;const s=vt.split(".")[0];this.addClass("vjs-v".concat(s)),this.userActive(!0),this.reportUserActivity(),this.one("play",e=>this.listenForUserActivity_(e)),this.on("keydown",e=>this.handleKeyDown(e)),this.on("languagechange",e=>this.handleLanguagechange(e)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){var e;this.trigger("dispose"),this.off("dispose"),ai(a(),this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),ai(a(),"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),ka.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),e=this,Er.hasOwnProperty(e.id())&&delete Er[e.id()],Sr.names.forEach(e=>{const t=this[Sr[e].getterName]();t&&t.off&&t.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e,t=this.tag,n=this.playerElIngest_=t.parentNode&&t.parentNode.hasAttribute&&t.parentNode.hasAttribute("data-vjs-player");const i="video-js"===this.tag.tagName.toLowerCase();n?e=this.el_=t.parentNode:i||(e=this.el_=super.createEl("div"));const s=kn(t);if(i){for(e=this.el_=t,t=this.tag=a().createElement("video");e.children.length;)t.appendChild(e.firstChild);vn(e,"video-js")||_n(e,"video-js"),e.appendChild(t),n=this.playerElIngest_=e,Object.keys(e).forEach(n=>{try{t[n]=e[n]}catch(i){}})}t.setAttribute("tabindex","-1"),s.tabindex="-1",Xt&&Zt&&(t.setAttribute("role","application"),s.role="application"),t.removeAttribute("width"),t.removeAttribute("height"),"width"in s&&delete s.width,"height"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(n){i&&"class"===n||e.setAttribute(n,s[n]),i&&t.setAttribute(n,s[n])}),t.playerId=t.id,t.id+="_html5_api",t.className="vjs-tech",t.player=e.player=this,this.addClass("vjs-paused");const o=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter(e=>un[e]).map(e=>"vjs-device-"+e.substring(3).toLowerCase().replace(/\_/g,"-"));if(this.addClass(...o),!0!==r().VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=Yn("vjs-styles-dimensions");const e=Bn(".vjs-styles-defaults"),t=Bn("head");t.insertBefore(this.styleEl_,e?e.nextSibling:t.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const l=t.getElementsByTagName("a");for(let r=0;r<l.length;r++){const e=l.item(r);_n(e,"vjs-hidden"),e.setAttribute("hidden","hidden")}return t.initNetworkState_=t.networkState,t.parentNode&&!n&&t.parentNode.insertBefore(e,t),bn(t,e),this.children_.unshift(t),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=e,e}crossOrigin(e){if("undefined"===typeof e)return this.techGet_("crossOrigin");null===e||"anonymous"===e||"use-credentials"===e?(this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)):Et.warn('crossOrigin must be null,  "anonymous" or "use-credentials", given "'.concat(e,'"'))}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(void 0===t)return this[n]||0;if(""===t||"auto"===t)return this[n]=void 0,void this.updateStyleEl_();const i=parseFloat(t);isNaN(i)?Et.error('Improper value "'.concat(t,'" supplied for for ').concat(e)):(this[n]=i,this.updateStyleEl_())}fluid(e){if(void 0===e)return!!this.fluid_;var t,n;this.fluid_=!!e,vi(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),n=()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)},vi(t=this)?n():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(n))):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(!0===r().VIDEOJS_NO_DYNAMIC_STYLE){const e="number"===typeof this.width_?this.width_:this.options_.width,t="number"===typeof this.height_?this.height_:this.options_.height,n=this.tech_&&this.tech_.el();return void(n&&(e>=0&&(n.width=e),t>=0&&(n.height=t)))}let e,t,n,i;n=void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9";const s=n.split(":"),a=s[1]/s[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/a:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*a,i=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(i),Qn(this.styleEl_,"\n      .".concat(i," {\n        width: ").concat(e,"px;\n        height: ").concat(t,"px;\n      }\n\n      .").concat(i,".vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: ").concat(100*a,"%;\n      }\n    "))}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=Ri(e),i=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==n&&this.tag&&(Cr.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let r=this.autoplay();("string"===typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(r=!1);const s={source:t,autoplay:r,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:"".concat(this.id(),"_").concat(i,"_api"),playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};Sr.names.forEach(e=>{const t=Sr[e];s[t.getterName]=this[t.privateName]}),Object.assign(s,this.options_[n]),Object.assign(s,this.options_[i]),Object.assign(s,this.options_[e.toLowerCase()]),this.tag&&(s.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(s.startTime=this.cache_.currentTime);const a=Cr.getTech(e);if(!a)throw new Error("No Tech named '".concat(n,"' exists! '").concat(n,"' should be registered using videojs.registerTech()'"));this.tech_=new a(s),this.tech_.ready(di(this,this.handleTechReady_),!0),Qi(this.textTracksJson_||[],this.tech_),va.forEach(e=>{this.on(this.tech_,e,t=>this["handleTech".concat(Ri(e),"_")](t))}),Object.keys(_a).forEach(e=>{this.on(this.tech_,e,t=>{0===this.tech_.playbackRate()&&this.tech_.seeking()?this.queuedCallbacks_.push({callback:this["handleTech".concat(_a[e],"_")].bind(this),event:t}):this["handleTech".concat(_a[e],"_")](t)})}),this.on(this.tech_,"loadstart",e=>this.handleTechLoadStart_(e)),this.on(this.tech_,"sourceset",e=>this.handleTechSourceset_(e)),this.on(this.tech_,"waiting",e=>this.handleTechWaiting_(e)),this.on(this.tech_,"ended",e=>this.handleTechEnded_(e)),this.on(this.tech_,"seeking",e=>this.handleTechSeeking_(e)),this.on(this.tech_,"play",e=>this.handleTechPlay_(e)),this.on(this.tech_,"pause",e=>this.handleTechPause_(e)),this.on(this.tech_,"durationchange",e=>this.handleTechDurationChange_(e)),this.on(this.tech_,"fullscreenchange",(e,t)=>this.handleTechFullscreenChange_(e,t)),this.on(this.tech_,"fullscreenerror",(e,t)=>this.handleTechFullscreenError_(e,t)),this.on(this.tech_,"enterpictureinpicture",e=>this.handleTechEnterPictureInPicture_(e)),this.on(this.tech_,"leavepictureinpicture",e=>this.handleTechLeavePictureInPicture_(e)),this.on(this.tech_,"error",e=>this.handleTechError_(e)),this.on(this.tech_,"posterchange",e=>this.handleTechPosterChange_(e)),this.on(this.tech_,"textdata",e=>this.handleTechTextData_(e)),this.on(this.tech_,"ratechange",e=>this.handleTechRateChange_(e)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===n&&this.tag||bn(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){Sr.names.forEach(e=>{const t=Sr[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=Yi(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return void 0===e&&Et.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_}version(){return{"video.js":vt}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||"string"!==typeof e)return;const t=()=>{const e=this.muted();this.muted(!0);const t=()=>{this.muted(e)};this.playTerminatedQueue_.push(t);const n=this.play();if(qi(n))return n.catch(e=>{throw t(),new Error("Rejection at manualAutoplay. Restoring muted value. ".concat(e||""))})};let n;return"any"!==e||this.muted()?n="muted"!==e||this.muted()?this.play():t():(n=this.play(),qi(n)&&(n=n.catch(t))),qi(n)?n.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})}):void 0}updateSourceCaches_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e,n="";"string"!==typeof t&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=((e,t)=>{if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;const n=e.cache_.sources.filter(e=>e.src===t);if(n.length)return n[0].type;const i=e.$$("source");for(let r=0;r<i.length;r++){const e=i[r];if(e.type&&e.src&&e.src===t)return e.type}return Ur(t)})(this,t)),this.cache_.source=Ft({},e,{src:t,type:n});const i=this.cache_.sources.filter(e=>e.src&&e.src===t),r=[],s=this.$$("source"),a=[];for(let o=0;o<s.length;o++){const e=kn(s[o]);r.push(e),e.src&&e.src===t&&a.push(e.src)}a.length&&!i.length?this.cache_.sources=r:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=e=>this.updateSourceCaches_(e);const n=this.currentSource().src,i=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(i)&&(!this.lastSource_||this.lastSource_.tech!==i&&this.lastSource_.player!==n)&&(t=()=>{}),t(i),e.src||this.tech_.any(["sourceset","loadstart"],e=>{if("sourceset"===e.type)return;const t=this.techGet_("currentSrc");this.lastSource_.tech=t,this.updateSourceCaches_(t)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"===typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?Xi(this.play()):this.pause()))}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),t=>t.contains(e.target))||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"===typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isInPictureInPicture()&&!a().pictureInPictureElement?this.exitPictureInPicture():this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let i=a()[this.fsApi_.fullscreenElement]===n;!i&&n.matches&&(i=n.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(i)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in Or)return function(e,t,n,i){return t[n](e.reduce(Pr(n),i))}(this.middleware_,this.tech_,e,t);if(e in Lr)return Rr(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(n){throw Et(n),n}},!0)}techGet_(e){if(this.tech_&&this.tech_.isReady_){if(e in Dr)return function(e,t,n){return e.reduceRight(Pr(n),t[n]())}(this.middleware_,this.tech_,e);if(e in Lr)return Rr(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw Et("Video.js: ".concat(e," method not defined for ").concat(this.techName_," playback technology."),t),t;if("TypeError"===t.name)throw Et("Video.js: ".concat(e," unavailable on ").concat(this.techName_," playback technology element."),t),this.tech_.isReady_=!1,t;throw Et(t),t}}}play(){return new Promise(e=>{this.play_(e)})}play_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xi;this.playCallbacks_.push(e);const t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),n=Boolean(cn||ln);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t)return this.waitToPlay_=e=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!t&&n&&this.load());const i=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),null===i?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(i)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(e){e()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(t){t(e)})}pause(){this.techCall_("pause")}paused(){return!1!==this.techGet_("paused")}played(){return this.techGet_("played")||Mi(0,0)}scrubbing(e){if("undefined"===typeof e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){return void 0===e?(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime):(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),this.cache_.initTime=0,void(isFinite(e)&&(this.cache_.currentTime=Number(e)))):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_)))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return e&&e.length||(e=Mi(0,0)),e}seekable(){let e=this.techGet_("seekable");return e&&e.length||(e=Mi(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return Hi(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;return void 0!==e?(t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)}muted(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)}defaultMuted(e){return void 0!==e&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(void 0!==e){const t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((n,i)=>{function r(){t.off("fullscreenerror",a),t.off("fullscreenchange",s)}function s(){r(),n()}function a(e,t){r(),i(t)}t.one("fullscreenchange",s),t.one("fullscreenerror",a);const o=t.requestFullscreenHelper_(e);o&&(o.then(r,r),o.then(n,i))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){const e=this.el_[this.fsApi_.requestFullscreen](t);return e&&e.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),e}this.tech_.supportsFullScreen()&&!0===!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,n)=>{function i(){e.off("fullscreenerror",s),e.off("fullscreenchange",r)}function r(){i(),t()}function s(e,t){i(),n(t)}e.one("fullscreenchange",r),e.one("fullscreenerror",s);const a=e.exitFullscreenHelper_();a&&(a.then(i,i),a.then(t,n))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=a()[this.fsApi_.exitFullscreen]();return e&&Xi(e.then(()=>this.isFullscreen(!1))),e}this.tech_.supportsFullScreen()&&!0===!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=a().documentElement.style.overflow,si(a(),"keydown",this.boundFullWindowOnEscKey_),a().documentElement.style.overflow="hidden",_n(a().body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){"Escape"===e.key&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,ai(a(),"keydown",this.boundFullWindowOnEscKey_),a().documentElement.style.overflow=this.docOrigOverflow,xn(a().body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&r().documentPictureInPicture){const e=a().createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(mn("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),r().documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(t=>(jn(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",t=>{const n=t.target.querySelector(".video-js");e.parentNode.replaceChild(n,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in a()&&!1===this.disablePictureInPicture()?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){return r().documentPictureInPicture&&r().documentPictureInPicture.window?(r().documentPictureInPicture.window.close(),Promise.resolve()):"pictureInPictureEnabled"in a()?a().exitPictureInPicture():void 0}handleKeyDown(e){const{userActions:t}=this.options_;if(!t||!t.hotkeys)return;(e=>{const t=e.tagName.toLowerCase();if(e.isContentEditable)return!0;if("input"===t)return-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type);return-1!==["textarea"].indexOf(t)})(this.el_.ownerDocument.activeElement)||("function"===typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=t=>"f"===e.key.toLowerCase(),muteKey:i=t=>"m"===e.key.toLowerCase(),playPauseKey:r=t=>"k"===e.key.toLowerCase()||" "===e.key.toLowerCase()}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const t=Li.getComponent("FullscreenToggle");!1!==a()[this.fsApi_.fullscreenEnabled]&&t.prototype.handleClick.call(this,e)}else if(i.call(this,e)){e.preventDefault(),e.stopPropagation();Li.getComponent("MuteToggle").prototype.handleClick.call(this,e)}else if(r.call(this,e)){e.preventDefault(),e.stopPropagation();Li.getComponent("PlayToggle").prototype.handleClick.call(this,e)}}canPlayType(e){let t;for(let n=0,i=this.options_.techOrder;n<i.length;n++){const r=i[n];let s=Cr.getTech(r);if(s||(s=Li.getComponent(r)),s){if(s.isSupported()&&(t=s.canPlayType(e),t))return t}else Et.error('The "'.concat(r,'" tech is undefined. Skipped browser support check for that tech.'))}return""}selectSource(e){const t=this.options_.techOrder.map(e=>[e,Cr.getTech(e)]).filter(e=>{let[t,n]=e;return n?n.isSupported():(Et.error('The "'.concat(t,'" tech is undefined. Skipped browser support check for that tech.')),!1)}),n=function(e,t,n){let i;return e.some(e=>t.some(t=>{if(i=n(e,t),i)return!0})),i};let i;const r=(e,t)=>{let[n,i]=e;if(i.canPlaySource(t,this.options_[n.toLowerCase()]))return{source:t,tech:n}};var s;return i=this.options_.sourceOrder?n(e,t,(s=r,(e,t)=>s(t,e))):n(t,e,r),i||!1}handleSrc_(e,t){if("undefined"===typeof e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=Br(e);if(n.length){if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),Ar(this,n[0],(e,i)=>{this.middleware_=i,t||(this.cache_.sources=n),this.updateSourceCaches_(e);if(this.src_(e))return n.length>1?this.handleSrc_(n.slice(1)):(this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),void this.triggerReady());var r,s;r=i,s=this.tech_,r.forEach(e=>e.setTech&&e.setTech(s))}),n.length>1){const e=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},t=()=>{this.off("error",e)};this.one("error",e),this.one("playing",t),this.resetRetryOnError_=()=>{this.off("error",e),this.off("playing",t)}}}else this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0)}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return!t||(Di(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1))}addSourceElement(e,t){return!!this.tech_&&this.tech_.addSourceElement(e,t)}removeSourceElement(e){return!!this.tech_&&this.tech_.removeSourceElement(e)}load(){this.tech_&&this.tech_.vhs?this.src(this.currentSource()):this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{Xi(this.play().then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),vi(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:i}=this.controlBar||{},{seekBar:r}=n||{};e&&e.updateContent(),t&&t.updateContent(),i&&i.updateContent(),r&&(r.update(),r.loadProgressBar&&r.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")}autoplay(e){if(void 0===e)return this.options_.autoplay||!1;let t;"string"===typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"===typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t="undefined"===typeof t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return void 0!==e&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")}poster(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(void 0===e)return this.error_||null;if(xt("beforeerror").forEach(t=>{const n=t(this,e);Lt(n)&&!Array.isArray(n)||"string"===typeof n||"number"===typeof n||null===n?e=n:this.log.error("please return a value that MediaError expects in beforeerror hooks")}),this.options_.suppressNotSupportedError&&e&&4===e.code){const t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",function(){this.off(["click","touchstart"],t)})}if(null===e)return this.error_=null,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new Gi(e),this.addClass("vjs-error"),Et.error("(CODE:".concat(this.error_.code," ").concat(Gi.errorTypes[this.error_.code],")"),this.error_.message,this.error_),this.trigger("error"),xt("error").forEach(e=>e(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const i=di(this,this.reportUserActivity),r=function(t){i(),this.clearInterval(e)};this.on("mousedown",function(){i(),this.clearInterval(e),e=this.setInterval(i,250)}),this.on("mousemove",function(e){e.screenX===t&&e.screenY===n||(t=e.screenX,n=e.screenY,i())}),this.on("mouseup",r),this.on("mouseleave",r);const s=this.getChild("controlBar");let a;!s||ln||Wt||(s.on("mouseenter",function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),s.on("mouseleave",function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",i),this.on("keyup",i);this.setInterval(function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(a);const e=this.options_.inactivityTimeout;e<=0||(a=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))},250)}playbackRate(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)}defaultPlaybackRate(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");e&&this.audioOnlyCache_.controlBarHeight!==e.currentHeight()&&(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach(e=>{e!==t&&e.el_&&!e.hasClass("vjs-hidden")&&(e.hide(),this.audioOnlyCache_.hiddenChildren.push(e))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=n,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if("boolean"!==typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const e=[];return this.isInPictureInPicture()&&e.push(this.exitPictureInPicture()),this.isFullscreen()&&e.push(this.exitFullscreen()),this.audioPosterMode()&&e.push(this.audioPosterMode(!1)),Promise.all(e).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){if("boolean"!==typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;if(this.audioPosterMode_=e,e){if(this.audioOnlyMode()){return this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()})}return Promise.resolve().then(()=>{this.enablePosterModeUI_()})}return Promise.resolve().then(()=>{this.disablePosterModeUI_()})}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),vi(this)&&this.trigger("languagechange"))}languages(){return Ft(ka.prototype.options_.languages,this.languages_)}toJSON(){const e=Ft(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let i=t[n];i=Ft(i),i.player=void 0,e.tracks[n]=i}return e}createModal(e,t){(t=t||{}).content=e||"";const n=new Zi(this,t);return this.addChild(n),n.on("dispose",()=>{this.removeChild(n)}),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<xa.length;n++){const i=xa[n];if(t<=this.breakpoints_[i]){if(e===i)return;e&&this.removeClass(wa[e]),this.addClass(wa[i]),this.breakpoint_=i;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=Object.assign({},Ta,e),this.updateCurrentBreakpoint_()),Object.assign(this.breakpoints_)}responsive(e){if(void 0===e)return this.responsive_;return(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return wa[this.breakpoint_]||""}loadMedia(e,t){if(!e||"object"!==typeof e)return;const n=this.crossOrigin();this.reset(),this.cache_.media=Ft(e);const{artist:i,artwork:r,description:s,poster:a,src:o,textTracks:l,title:c}=this.cache_.media;!r&&a&&(this.cache_.media.artwork=[{src:a,type:Ur(a)}]),n&&this.crossOrigin(n),o&&this.src(o),a&&this.poster(a),Array.isArray(l)&&l.forEach(e=>this.addRemoteTextTrack(e,!1)),this.titleBar&&this.titleBar.update({title:c,description:s||i||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),e=>({kind:e.kind,label:e.label,language:e.language,src:e.src}))};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:Ur(t.poster)}]),t}return Ft(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=kn(e),i=n["data-setup"];if(vn(e,"vjs-fill")&&(n.fill=!0),vn(e,"vjs-fluid")&&(n.fluid=!0),null!==i)try{Object.assign(n,JSON.parse(i||"{}"))}catch(r){Et.error("data-setup",r)}if(Object.assign(t,n),e.hasChildNodes()){const n=e.childNodes;for(let e=0,i=n.length;e<i;e++){const i=n[e],r=i.nodeName.toLowerCase();"source"===r?t.sources.push(kn(i)):"track"===r&&t.tracks.push(kn(i))}}return t}debug(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every(e=>"number"===typeof e)&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}ka.prototype.videoTracks=()=>{},ka.prototype.audioTracks=()=>{},ka.prototype.textTracks=()=>{},ka.prototype.remoteTextTracks=()=>{},ka.prototype.remoteTextTrackEls=()=>{},Sr.names.forEach(function(e){const t=Sr[e];ka.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),ka.prototype.crossorigin=ka.prototype.crossOrigin,ka.players={};const Sa=r().navigator;ka.prototype.options_={techOrder:Cr.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:Sa&&(Sa.languages&&Sa.languages[0]||Sa.userLanguage||Sa.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1,disableSeekWhileScrubbingOnMobile:!1,disableSeekWhileScrubbingOnSTV:!1},va.forEach(function(e){ka.prototype["handleTech".concat(Ri(e),"_")]=function(){return this.trigger(e)}}),Li.registerComponent("Player",ka);const Ca="plugin",Ia="activePlugins_",Ea={},Na=e=>Ea.hasOwnProperty(e),Aa=e=>Na(e)?Ea[e]:void 0,Ra=(e,t)=>{e[Ia]=e[Ia]||{},e[Ia][t]=!0},Da=(e,t,n)=>{const i=(n?"before":"")+"pluginsetup";e.trigger(i,t),e.trigger(i+":"+t.name,t)},Oa=(e,t)=>(t.prototype.name=e,function(){Da(this,{name:e,plugin:t,instance:null},!0);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];const s=new t(...[this,...i]);return this[e]=()=>s,Da(this,s.getEventHash()),s});class La{constructor(e){if(this.constructor===La)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),Ii(this),delete this.trigger,Ni(this,this.constructor.defaultState),Ra(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oi(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[Ia][e]=!1,this.player=this.state=null,t[e]=Oa(e,Ea[e])}static isBasic(e){const t="string"===typeof e?Aa(e):e;return"function"===typeof t&&!La.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if("string"!==typeof e)throw new Error('Illegal plugin name, "'.concat(e,'", must be a string, was ').concat(typeof e,"."));if(Na(e))Et.warn('A plugin named "'.concat(e,'" already exists. You may want to avoid re-registering plugins!'));else if(ka.prototype.hasOwnProperty(e))throw new Error('Illegal plugin name, "'.concat(e,'", cannot share a name with an existing player method!'));if("function"!==typeof t)throw new Error('Illegal plugin for "'.concat(e,'", must be a function, was ').concat(typeof t,"."));return Ea[e]=t,e!==Ca&&(La.isBasic(t)?ka.prototype[e]=function(e,t){const n=function(){Da(this,{name:e,plugin:t,instance:null},!0);const n=t.apply(this,arguments);return Ra(this,e),Da(this,{name:e,plugin:t,instance:n}),n};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}(e,t):ka.prototype[e]=Oa(e,t)),t}static deregisterPlugin(e){if(e===Ca)throw new Error("Cannot de-register base plugin.");Na(e)&&(delete Ea[e],delete ka.prototype[e])}static getPlugins(){let e;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(Ea)).forEach(t=>{const n=Aa(t);n&&(e=e||{},e[t]=n)}),e}static getPluginVersion(e){const t=Aa(e);return t&&t.VERSION||""}}function Pa(e,t,n,i){return function(e,t){let n=!1;return function(){n||Et.warn(e),n=!0;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return t.apply(this,r)}}("".concat(t," is deprecated and will be removed in ").concat(e,".0; please use ").concat(n," instead."),i)}La.getPlugin=Aa,La.BASE_PLUGIN_NAME=Ca,La.registerPlugin(Ca,La),ka.prototype.usingPlugin=function(e){return!!this[Ia]&&!0===this[Ia][e]},ka.prototype.hasPlugin=function(e){return!!Na(e)};const Fa=e=>0===e.indexOf("#")?e.slice(1):e;function Ma(e,t,n){let i=Ma.getPlayer(e);if(i)return t&&Et.warn('Player "'.concat(e,'" is already initialised. Options will not be applied.')),n&&i.ready(n),i;const s="string"===typeof e?Bn("#"+Fa(e)):e;if(!pn(s))throw new TypeError("The element or ID supplied is not valid. (videojs)");const a="getRootNode"in s&&s.getRootNode()instanceof r().ShadowRoot?s.getRootNode():s.ownerDocument.body;s.ownerDocument.defaultView&&a.contains(s)||Et.warn("The element supplied is not included in the DOM"),!0===(t=t||{}).restoreEl&&(t.restoreEl=(s.parentNode&&s.parentNode.hasAttribute&&s.parentNode.hasAttribute("data-vjs-player")?s.parentNode:s).cloneNode(!0)),xt("beforesetup").forEach(e=>{const n=e(s,Ft(t));Lt(n)&&!Array.isArray(n)?t=Ft(t,n):Et.error("please return an object in beforesetup hooks")});const o=Li.getComponent("Player");return i=new o(s,t,n),xt("setup").forEach(e=>e(i)),i}if(Ma.hooks_=_t,Ma.hooks=xt,Ma.hook=function(e,t){xt(e,t)},Ma.hookOnce=function(e,t){xt(e,[].concat(t).map(t=>{const n=function(){return wt(e,n),t(...arguments)};return n}))},Ma.removeHook=wt,!0!==r().VIDEOJS_NO_DYNAMIC_STYLE&&dn()){let e=Bn(".vjs-styles-defaults");if(!e){e=Yn("vjs-styles-defaults");const t=Bn("head");t&&t.insertBefore(e,t.firstChild),Qn(e,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}Xn(1,Ma),Ma.VERSION=vt,Ma.options=ka.prototype.options_,Ma.getPlayers=()=>ka.players,Ma.getPlayer=e=>{const t=ka.players;let n;if("string"===typeof e){const i=Fa(e),r=t[i];if(r)return r;n=Bn("#"+i)}else n=e;if(pn(n)){const{player:e,playerId:i}=n;if(e||t[i])return e||t[i]}},Ma.getAllPlayers=()=>Object.keys(ka.players).map(e=>ka.players[e]).filter(Boolean),Ma.players=ka.players,Ma.getComponent=Li.getComponent,Ma.registerComponent=(e,t)=>(Cr.isTech(t)&&Et.warn("The ".concat(e," tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)")),Li.registerComponent.call(Li,e,t)),Ma.getTech=Cr.getTech,Ma.registerTech=Cr.registerTech,Ma.use=function(e,t){Ir[e]=Ir[e]||[],Ir[e].push(t)},Object.defineProperty(Ma,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(Ma.middleware,"TERMINATOR",{value:Nr,writeable:!1,enumerable:!0}),Ma.browser=un,Ma.obj=Bt,Ma.mergeOptions=Pa(9,"videojs.mergeOptions","videojs.obj.merge",Ft),Ma.defineLazyProperty=Pa(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",Ut),Ma.bind=Pa(9,"videojs.bind","native Function.prototype.bind",di),Ma.registerPlugin=La.registerPlugin,Ma.deregisterPlugin=La.deregisterPlugin,Ma.plugin=(e,t)=>(Et.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),La.registerPlugin(e,t)),Ma.getPlugins=La.getPlugins,Ma.getPlugin=La.getPlugin,Ma.getPluginVersion=La.getPluginVersion,Ma.addLanguage=function(e,t){return e=(""+e).toLowerCase(),Ma.options.languages=Ft(Ma.options.languages,{[e]:t}),Ma.options.languages[e]},Ma.log=Et,Ma.createLogger=Nt,Ma.time=Wi,Ma.createTimeRange=Pa(9,"videojs.createTimeRange","videojs.time.createTimeRanges",Mi),Ma.createTimeRanges=Pa(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",Mi),Ma.formatTime=Pa(9,"videojs.formatTime","videojs.time.formatTime",ji),Ma.setFormatTime=Pa(9,"videojs.setFormatTime","videojs.time.setFormatTime",zi),Ma.resetFormatTime=Pa(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",Vi),Ma.parseUrl=Pa(9,"videojs.parseUrl","videojs.url.parseUrl",dr),Ma.isCrossOrigin=Pa(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",gr),Ma.EventTarget=yi,Ma.any=ci,Ma.on=si,Ma.one=li,Ma.off=ai,Ma.trigger=oi,Ma.xhr=l(),Ma.TrackList=er,Ma.TextTrack=vr,Ma.TextTrackList=sr,Ma.AudioTrack=_r,Ma.AudioTrackList=nr,Ma.VideoTrack=xr,Ma.VideoTrackList=rr,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(e=>{Ma[e]=function(){return Et.warn("videojs.".concat(e,"() is deprecated; use videojs.dom.").concat(e,"() instead")),Wn[e].apply(null,arguments)}}),Ma.computedStyle=Pa(9,"videojs.computedStyle","videojs.dom.computedStyle",Vn),Ma.dom=Wn,Ma.fn=gi,Ma.num=os,Ma.str=Oi,Ma.url=mr,Ma.Error={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"};class Ua{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get:()=>t.enabled_(),set(e){t.enabled_(e)}}),t}}class Ba extends Ma.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get:()=>e.selectedIndex_}),Object.defineProperty(e,"length",{get:()=>e.levels_.length}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new Ua(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,i=this.length;n<i;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const n=this[t];if(n.id===e)return n}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}Ba.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const Cu in Ba.prototype.allowedEvents_)Ba.prototype["on"+Cu]=null;var za="4.1.0";const Va=function(e){return function(e){const t=e.qualityLevels,n=new Ba,i=function(){n.dispose(),e.qualityLevels=t,e.off("dispose",i)};return e.on("dispose",i),e.qualityLevels=()=>n,e.qualityLevels.VERSION=za,n}(this,Ma.obj.merge({},e))};Ma.registerPlugin("qualityLevels",Va),Va.VERSION=za;const ja=p,Wa=(e,t)=>t&&t.responseURL&&e!==t.responseURL?t.responseURL:e,Ha=e=>Ma.log.debug?Ma.log.debug.bind(Ma,"VHS:","".concat(e," >")):function(){};function Ga(){const e=Ma.obj||Ma,t=e.merge||e.mergeOptions;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return t.apply(e,i)}function qa(){const e=Ma.time||Ma,t=e.createTimeRanges||e.createTimeRanges;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return t.apply(e,i)}const Xa=1/30,Ka=.1,Ya=function(e,t){const n=[];let i;if(e&&e.length)for(i=0;i<e.length;i++)t(e.start(i),e.end(i))&&n.push([e.start(i),e.end(i)]);return qa(n)},Qa=function(e,t){return Ya(e,function(e,n){return e-Ka<=t&&n+Ka>=t})},$a=function(e,t){return Ya(e,function(e){return e-Xa>=t})},Ja=e=>{const t=[];if(!e||!e.length)return"";for(let n=0;n<e.length;n++)t.push(e.start(n)+" => "+e.end(n));return t.join(", ")},Za=e=>{const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t},eo=function(e){if(e&&e.length&&e.end)return e.end(e.length-1)},to=function(e,t){let n=0;if(!e||!e.length)return n;for(let i=0;i<e.length;i++){const r=e.start(i),s=e.end(i);t>s||(n+=t>r&&t<=s?s-t:s-r)}return n},no=(e,t)=>{if(!t.preload)return t.duration;let n=0;return(t.parts||[]).forEach(function(e){n+=e.duration}),(t.preloadHints||[]).forEach(function(t){"PART"===t.type&&(n+=e.partTargetDuration)}),n},io=e=>(e.segments||[]).reduce((e,t,n)=>(t.parts?t.parts.forEach(function(i,r){e.push({duration:i.duration,segmentIndex:n,partIndex:r,part:i,segment:t})}):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e),[]),ro=e=>{const t=e.segments&&e.segments.length&&e.segments[e.segments.length-1];return t&&t.parts||[]},so=e=>{let{preloadSegment:t}=e;if(!t)return;const{parts:n,preloadHints:i}=t;let r=(i||[]).reduce((e,t)=>e+("PART"===t.type?1:0),0);return r+=n&&n.length?n.length:0,r},ao=(e,t)=>{if(t.endList)return 0;if(e&&e.suggestedPresentationDelay)return e.suggestedPresentationDelay;const n=ro(t).length>0;return n&&t.serverControl&&t.serverControl.partHoldBack?t.serverControl.partHoldBack:n&&t.partTargetDuration?3*t.partTargetDuration:t.serverControl&&t.serverControl.holdBack?t.serverControl.holdBack:t.targetDuration?3*t.targetDuration:0},oo=function(e,t,n){if("undefined"===typeof t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)return 0;const i=function(e,t){let n=0,i=t-e.mediaSequence,r=e.segments[i];if(r){if("undefined"!==typeof r.start)return{result:r.start,precise:!0};if("undefined"!==typeof r.end)return{result:r.end-r.duration,precise:!0}}for(;i--;){if(r=e.segments[i],"undefined"!==typeof r.end)return{result:n+r.end,precise:!0};if(n+=no(e,r),"undefined"!==typeof r.start)return{result:n+r.start,precise:!0}}return{result:n,precise:!1}}(e,t);if(i.precise)return i.result;const r=function(e,t){let n,i=0,r=t-e.mediaSequence;for(;r<e.segments.length;r++){if(n=e.segments[r],"undefined"!==typeof n.start)return{result:n.start-i,precise:!0};if(i+=no(e,n),"undefined"!==typeof n.end)return{result:n.end-i,precise:!0}}return{result:-1,precise:!1}}(e,t);return r.precise?r.result:i.result+n},lo=function(e,t,n){if(!e)return 0;if("number"!==typeof n&&(n=0),"undefined"===typeof t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return r()[1/0]}return oo(e,t,n)},co=function(e){let{defaultDuration:t,durationList:n,startIndex:i,endIndex:r}=e,s=0;if(i>r&&([i,r]=[r,i]),i<0){for(let e=i;e<Math.min(0,r);e++)s+=t;i=0}for(let a=i;a<r;a++)s+=n[a].duration;return s},uo=function(e,t,n,i){if(!e||!e.segments)return null;if(e.endList)return lo(e);if(null===t)return null;t=t||0;let r=oo(e,e.mediaSequence+e.segments.length,t);return n&&(r-=i="number"===typeof i?i:ao(null,e)),Math.max(0,r)},ho=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},po=function(e){return e.excludeUntil&&e.excludeUntil===1/0},fo=function(e){const t=ho(e);return!e.disabled&&!t},go=function(e,t){return t.attributes&&t.attributes[e]},mo=(e,t)=>{if(1===e.playlists.length)return!0;const n=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(e=>!!fo(e)&&(e.attributes.BANDWIDTH||0)<n).length},yo=(e,t)=>!(!e&&!t||!e&&t||e&&!t)&&(e===t||(!(!e.id||!t.id||e.id!==t.id)||(!(!e.resolvedUri||!t.resolvedUri||e.resolvedUri!==t.resolvedUri)||!(!e.uri||!t.uri||e.uri!==t.uri)))),bo=function(e,t){const n=e&&e.mediaGroups&&e.mediaGroups.AUDIO||{};let i=!1;for(const r in n){for(const e in n[r])if(i=t(n[r][e]),i)break;if(i)break}return!!i},vo=e=>{if(!e||!e.playlists||!e.playlists.length){return bo(e,e=>e.playlists&&e.playlists.length||e.uri)}for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t],i=n.attributes&&n.attributes.CODECS;if(i&&i.split(",").every(e=>A(e)))continue;if(!bo(e,e=>yo(n,e)))return!1}return!0};var _o={liveEdgeDelay:ao,duration:lo,seekable:function(e,t,n){const i=t||0;let r=uo(e,t,!0,n);return null===r?qa():(r<i&&(r=i),qa(i,r))},getMediaInfoForTime:function(e){let{playlist:t,currentTime:n,startingSegmentIndex:i,startingPartIndex:r,startTime:s,exactManifestTimings:a}=e,o=n-s;const l=io(t);let c=0;for(let u=0;u<l.length;u++){const e=l[u];if(i===e.segmentIndex&&("number"!==typeof r||"number"!==typeof e.partIndex||r===e.partIndex)){c=u;break}}if(o<0){if(c>0)for(let e=c-1;e>=0;e--){const n=l[e];if(o+=n.duration,a){if(o<0)continue}else if(o+Xa<=0)continue;return{partIndex:n.partIndex,segmentIndex:n.segmentIndex,startTime:s-co({defaultDuration:t.targetDuration,durationList:l,startIndex:c,endIndex:e})}}return{partIndex:l[0]&&l[0].partIndex||null,segmentIndex:l[0]&&l[0].segmentIndex||0,startTime:n}}if(c<0){for(let e=c;e<0;e++)if(o-=t.targetDuration,o<0)return{partIndex:l[0]&&l[0].partIndex||null,segmentIndex:l[0]&&l[0].segmentIndex||0,startTime:n};c=0}for(let u=c;u<l.length;u++){const e=l[u];o-=e.duration;const n=e.duration>Xa;if(!(0===o)&&!(n&&o+Xa>=0)||u===l.length-1){if(a){if(o>0)continue}else if(o-Xa>=0)continue;return{partIndex:e.partIndex,segmentIndex:e.segmentIndex,startTime:s+co({defaultDuration:t.targetDuration,durationList:l,startIndex:c,endIndex:u})}}}return{segmentIndex:l[l.length-1].segmentIndex,partIndex:l[l.length-1].partIndex,startTime:n}},isEnabled:fo,isDisabled:function(e){return e.disabled},isExcluded:ho,isIncompatible:po,playlistEnd:uo,isAes:function(e){for(let t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},hasAttribute:go,estimateSegmentRequestTime:function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!go("BANDWIDTH",n))return NaN;return(e*n.attributes.BANDWIDTH-8*i)/t},isLowestEnabledRendition:mo,isAudioOnly:vo,playlistMatch:yo,segmentDurationWithParts:no};const{log:xo}=Ma,wo=(e,t)=>"".concat(e,"-").concat(t),To=(e,t,n)=>"placeholder-uri-".concat(e,"-").concat(t,"-").concat(n),ko=(e,t)=>{e.mediaGroups&&["AUDIO","SUBTITLES"].forEach(n=>{if(e.mediaGroups[n])for(const i in e.mediaGroups[n])for(const r in e.mediaGroups[n][i]){const s=e.mediaGroups[n][i][r];t(s,n,i,r)}})},So=e=>{let{playlist:t,uri:n,id:i}=e;t.id=i,t.playlistErrors_=0,n&&(t.uri=n),t.attributes=t.attributes||{}},Co=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:To;e.uri=t;for(let r=0;r<e.playlists.length;r++)if(!e.playlists[r].uri){const t="placeholder-uri-".concat(r);e.playlists[r].uri=t}const i=vo(e);ko(e,(t,r,s,a)=>{if(!t.playlists||!t.playlists.length){if(i&&"AUDIO"===r&&!t.uri)for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t];if(n.attributes&&n.attributes.AUDIO&&n.attributes.AUDIO===s)return}t.playlists=[h({},t)]}t.playlists.forEach(function(t,i){const o=n(r,s,a,t),l=wo(i,o);t.uri?t.resolvedUri=t.resolvedUri||ja(e.uri,t.uri):(t.uri=0===i?o:l,t.resolvedUri=t.uri),t.id=t.id||l,t.attributes=t.attributes||{},e.playlists[t.id]=t,e.playlists[t.uri]=t})}),(e=>{let t=e.playlists.length;for(;t--;){const n=e.playlists[t];So({playlist:n,id:wo(t,n.uri)}),n.resolvedUri=ja(e.uri,n.uri),e.playlists[n.id]=n,e.playlists[n.uri]=n,n.attributes.BANDWIDTH||xo.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}})(e),(e=>{ko(e,t=>{t.uri&&(t.resolvedUri=ja(e.uri,t.uri))})})(e)};class Io{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(null!==this.offset_)return;if(!e.length)return;const[t]=e;void 0!==t.programDateTime&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return;const[t]=e,n=t.startDate.getTime();this.trimProcessedDateRanges_(n),this.pendingDateRanges_=e.reduce((e,t)=>(e.set(t.id,t),e),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(null===this.offset_)return[];const e={},t=[];this.pendingDateRanges_.forEach((n,i)=>{if(!this.processedDateRanges_.has(i)&&(n.startTime=n.startDate.getTime()/1e3-this.offset_,n.processDateRange=()=>this.processDateRange(n),t.push(n),n.class))if(e[n.class]){const t=e[n.class].push(n);n.classListIndex=t-1}else e[n.class]=[n],n.classListIndex=0});for(const n of t){const t=e[n.class]||[];n.endDate?n.endTime=n.endDate.getTime()/1e3-this.offset_:n.endOnNext&&t[n.classListIndex+1]?n.endTime=t[n.classListIndex+1].startTime:n.duration?n.endTime=n.startTime+n.duration:n.plannedDuration?n.endTime=n.startTime+n.plannedDuration:n.endTime=n.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((t,n)=>{t.startDate.getTime()<e&&this.processedDateRanges_.delete(n)})}}const Eo=e=>{let{requestType:t,request:n,error:i,parseFailure:r}=e;const s=n.status<200||n.status>299,a=n.status>=400&&n.status<=499,o={uri:n.uri,requestType:t},l=s&&!a||r;if(i&&a)o.error=h({},i),o.errorType=Ma.Error.NetworkRequestFailed;else if(n.aborted)o.errorType=Ma.Error.NetworkRequestAborted;else if(n.timedout)o.errorType=Ma.Error.NetworkRequestTimeout;else if(l){const e=r?Ma.Error.NetworkBodyParserFailed:Ma.Error.NetworkBadStatus;o.errorType=e,o.status=n.status,o.headers=n.headers}return o},No=Ha("CodecUtils"),Ao=function(e){const t=e.attributes||{};if(t.CODECS)return N(t.CODECS)},Ro=(e,t)=>{const n=t.attributes||{};return e&&e.mediaGroups&&e.mediaGroups.AUDIO&&n.AUDIO&&e.mediaGroups.AUDIO[n.AUDIO]},Do=function(e){const t={};return e.forEach(e=>{let{mediaType:n,type:i,details:r}=e;t[n]=t[n]||[],t[n].push(E("".concat(i).concat(r)))}),Object.keys(t).forEach(function(e){if(t[e].length>1)return No("multiple ".concat(e," codecs found as attributes: ").concat(t[e].join(", "),". Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.")),void(t[e]=null);t[e]=t[e][0]}),t},Oo=function(e){let t=0;return e.audio&&t++,e.video&&t++,t},Lo=function(e,t){const n=t.attributes||{},i=Do(Ao(t)||[]);if(Ro(e,t)&&!i.audio&&!((e,t)=>{if(!Ro(e,t))return!0;const n=t.attributes||{},i=e.mediaGroups.AUDIO[n.AUDIO];for(const r in i)if(!i[r].uri&&!i[r].playlists)return!0;return!1})(e,t)){const t=Do(function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var i in n){var r=n[i];if(r.default&&r.playlists)return N(r.playlists[0].attributes.CODECS)}return null}(e,n.AUDIO)||[]);t.audio&&(i.audio=t.audio)}return i},{EventTarget:Po}=Ma,Fo=(e,t)=>{if(!e)return t;const n=Ga(e,t);if(e.preloadHints&&!t.preloadHints&&delete n.preloadHints,e.parts&&!t.parts)delete n.parts;else if(e.parts&&t.parts)for(let i=0;i<t.parts.length;i++)e.parts&&e.parts[i]&&(n.parts[i]=Ga(e.parts[i],t.parts[i]));return!e.skipped&&t.skipped&&(n.skipped=!1),e.preload&&!t.preload&&(n.preload=!1),n},Mo=(e,t)=>{!e.resolvedUri&&e.uri&&(e.resolvedUri=ja(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=ja(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=ja(t,e.map.uri)),e.map&&e.map.key&&!e.map.key.resolvedUri&&(e.map.key.resolvedUri=ja(t,e.map.key.uri)),e.parts&&e.parts.length&&e.parts.forEach(e=>{e.resolvedUri||(e.resolvedUri=ja(t,e.uri))}),e.preloadHints&&e.preloadHints.length&&e.preloadHints.forEach(e=>{e.resolvedUri||(e.resolvedUri=ja(t,e.uri))})},Uo=function(e){const t=e.segments||[],n=e.preloadSegment;if(n&&n.parts&&n.parts.length){if(n.preloadHints)for(let e=0;e<n.preloadHints.length;e++)if("MAP"===n.preloadHints[e].type)return t;n.duration=e.targetDuration,n.preload=!0,t.push(n)}return t},Bo=(e,t)=>e===t||e.segments&&t.segments&&e.segments.length===t.segments.length&&e.endList===t.endList&&e.mediaSequence===t.mediaSequence&&e.preloadSegment===t.preloadSegment,zo=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bo;const i=Ga(e,{}),r=i.playlists[t.id];if(!r)return null;if(n(r,t))return null;t.segments=Uo(t);const s=Ga(r,t);if(s.preloadSegment&&!t.preloadSegment&&delete s.preloadSegment,r.segments){if(t.skip){t.segments=t.segments||[];for(let e=0;e<t.skip.skippedSegments;e++)t.segments.unshift({skipped:!0})}s.segments=((e,t,n)=>{const i=e.slice(),r=t.slice();n=n||0;const s=[];let a;for(let o=0;o<r.length;o++){const e=i[o+n],t=r[o];e?(a=e.map||a,s.push(Fo(e,t))):(a&&!t.map&&(t.map=a),s.push(t))}return s})(r.segments,t.segments,t.mediaSequence-r.mediaSequence)}s.segments.forEach(e=>{Mo(e,s.resolvedUri)});for(let a=0;a<i.playlists.length;a++)i.playlists[a].id===t.id&&(i.playlists[a]=s);return i.playlists[t.id]=s,i.playlists[t.uri]=s,ko(e,(e,n,i,r)=>{if(e.playlists)for(let a=0;a<e.playlists.length;a++)t.id===e.playlists[a].id&&(e.playlists[a]=s)}),i},Vo=(e,t)=>{const n=e.segments||[],i=n[n.length-1],r=i&&i.parts&&i.parts[i.parts.length-1],s=r&&r.duration||i&&i.duration;return t&&s?1e3*s:500*(e.partTargetDuration||e.targetDuration||10)},jo=(e,t,n)=>{if(!e)return;const i=[];return e.forEach(e=>{if(!e.attributes)return;const{BANDWIDTH:t,RESOLUTION:n,CODECS:r}=e.attributes;i.push({id:e.id,bandwidth:t,resolution:n,codecs:r})}),{type:t,isLive:n,renditions:i}};class Wo extends Po{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=Ha("PlaylistLoader");const{withCredentials:i=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=i,this.addDateRangesToTextTrack_=n.addDateRangesToTextTrack;const r=t.options_;this.customTagParsers=r&&r.customTagParsers||[],this.customTagMappers=r&&r.customTagMappers||[],this.llhls=r&&r.llhls,this.dateRangesStorage_=new Io,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();t.length&&this.addDateRangesToTextTrack_&&this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if("HAVE_METADATA"!==this.state)return;const e=this.media();let t=ja(this.main.uri,e.uri);this.llhls&&(t=((e,t)=>{if(t.endList||!t.serverControl)return e;const n={};if(t.serverControl.canBlockReload){const{preloadSegment:e}=t;let i=t.mediaSequence+t.segments.length;if(e){const r=e.parts||[],s=so(t)-1;s>-1&&s!==r.length-1&&(n._HLS_part=s),(s>-1||r.length)&&i--}n._HLS_msn=i}if(t.serverControl&&t.serverControl.canSkipUntil&&(n._HLS_skip=t.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(n).length){const t=new(r().URL)(e);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(e){n.hasOwnProperty(e)&&t.searchParams.set(e,n[e])}),e=t.toString()}return e})(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(e,t)=>{if(this.request)return e?this.playlistRequestError(this.request,this.media(),"HAVE_METADATA"):void this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})})}playlistRequestError(e,t,n){const{uri:i,id:r}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[r],status:e.status,message:"HLS playlist request error at URL: ".concat(i,"."),responseText:e.responseText,code:e.status>=500?4:2,metadata:Eo({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_(e){let{url:t,manifestString:n}=e;try{const e=(e=>{let{onwarn:t,oninfo:n,manifestString:i,customTagParsers:r=[],customTagMappers:s=[],llhls:a}=e;const o=new k;t&&o.on("warn",t),n&&o.on("info",n),r.forEach(e=>o.addParser(e)),s.forEach(e=>o.addTagMapper(e)),o.push(i),o.end();const l=o.manifest;if(a||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(e){l.hasOwnProperty(e)&&delete l[e]}),l.segments&&l.segments.forEach(function(e){["parts","preloadHints"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})})),!l.targetDuration){let e=10;l.segments&&l.segments.length&&(e=l.segments.reduce((e,t)=>Math.max(e,t.duration),0)),t&&t({message:"manifest has no targetDuration defaulting to ".concat(e)}),l.targetDuration=e}const c=ro(l);if(c.length&&!l.partTargetDuration){const e=c.reduce((e,t)=>Math.max(e,t.duration),0);t&&(t({message:"manifest has no partTargetDuration defaulting to ".concat(e)}),xo.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),l.partTargetDuration=e}return l})({onwarn:e=>{let{message:n}=e;return this.logger_("m3u8-parser warn for ".concat(t,": ").concat(n))},oninfo:e=>{let{message:n}=e;return this.logger_("m3u8-parser info for ".concat(t,": ").concat(n))},manifestString:n,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return e.playlists&&e.playlists.length?(this.excludeAudioOnlyVariants(e.playlists),e):e}catch(i){this.error=i,this.error.metadata={errorType:Ma.Error.StreamingHlsPlaylistParserError,error:i}}}excludeAudioOnlyVariants(e){const t=e=>{const t=e.attributes||{},{width:n,height:i}=t.RESOLUTION||{};if(n&&i)return!0;const r=Ao(e)||[],s=Do(r);return Boolean(s.video)};e.some(t)&&e.forEach(e=>{t(e)||(e.excludeUntil=1/0)})}haveMetadata(e){let{playlistString:t,playlistObject:n,url:i,id:r}=e;this.request=null,this.state="HAVE_METADATA";const s={playlistInfo:{type:"media",uri:i}};this.trigger({type:"playlistparsestart",metadata:s});const a=n||this.parseManifest_({url:i,manifestString:t});a.lastRequest=Date.now(),So({playlist:a,uri:i,id:r});const o=zo(this.main,a);this.targetDuration=a.partTargetDuration||a.targetDuration,this.pendingMedia_=null,o?(this.main=o,this.media_=this.main.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(Vo(this.media(),!!o)),s.parsedPlaylist=jo(this.main.playlists,s.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:s}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),r().clearTimeout(this.mediaUpdateTimeout),r().clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new Io,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"===typeof e){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(r().clearTimeout(this.finalRenditionTimeout),t){const t=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;return void(this.finalRenditionTimeout=r().setTimeout(this.media.bind(this,e,!1),t))}const n=this.state,i=!this.media_||e.id!==this.media_.id,s=this.main.playlists[e.id];if(s&&s.endList||e.endList&&e.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(i&&(this.trigger("mediachanging"),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(this.updateMediaUpdateTimeout_(Vo(e,!0)),!i)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const a={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:a}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,i)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=Wa(e.resolvedUri,i),t)return this.playlistRequestError(this.request,e,n);this.trigger({type:"playlistrequestcomplete",metadata:a}),this.haveMetadata({playlistString:i.responseText,url:e.uri,id:e.id}),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(r().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(r().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const e=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;return void(this.mediaUpdateTimeout=r().setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},e))}this.started?t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(r().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=r().setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,"object"===typeof this.src)return this.src.uri||(this.src.uri=r().location.href),this.src.resolvedUri=this.src.uri,void setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,n)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:n.status,message:"HLS playlist request error at URL: ".concat(this.src,"."),responseText:n.responseText,code:2,metadata:Eo({requestType:n.requestType,request:n,error:t})},"HAVE_NOTHING"===this.state&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=Wa(this.src,n),this.trigger({type:"playlistparsestart",metadata:e});const i=this.parseManifest_({manifestString:n.responseText,url:this.src});e.parsedPlaylist=jo(i.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(i)})}srcUri(){return"string"===typeof this.src?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists)return this.main=e,Co(this.main,this.srcUri()),e.playlists.forEach(e=>{e.segments=Uo(e),e.segments.forEach(t=>{Mo(t,e.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.main.playlists[0]));const t=this.srcUri()||r().location.href;this.main=((e,t)=>{const n=wo(0,t),i={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:r().location.href,resolvedUri:r().location.href,playlists:[{uri:t,id:n,resolvedUri:t,attributes:{}}]};return i.playlists[n]=i.playlists[0],i.playlists[t]=i.playlists[0],i})(0,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const n=this.main,i=e.ID;let r=n.playlists.length;for(;r--;){const s=n.playlists[r];if(s.attributes["PATHWAY-ID"]===i){const a=s.resolvedUri,o=s.id;if(t){const t=this.createCloneURI_(s.resolvedUri,e),a=wo(i,t),o=this.createCloneAttributes_(i,s.attributes),l=this.createClonePlaylist_(s,a,e,o);n.playlists[r]=l,n.playlists[a]=l,n.playlists[t]=l}else n.playlists.splice(r,1);delete n.playlists[o],delete n.playlists[a]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const n=this.main,i=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{if(n.mediaGroups[e]&&n.mediaGroups[e][i])for(const t in n.mediaGroups[e])if(t===i){for(const i in n.mediaGroups[e][t]){n.mediaGroups[e][t][i].playlists.forEach((e,t)=>{const i=n.playlists[e.id],r=i.id,s=i.resolvedUri;delete n.playlists[r],delete n.playlists[s]})}delete n.mediaGroups[e][t]}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.main,i=n.playlists.length,r=this.createCloneURI_(t.resolvedUri,e),s=wo(e.ID,r),a=this.createCloneAttributes_(e.ID,t.attributes),o=this.createClonePlaylist_(t,s,e,a);n.playlists[i]=o,n.playlists[s]=o,n.playlists[r]=o,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,n=e["BASE-ID"],i=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{if(i.mediaGroups[r]&&!i.mediaGroups[r][t])for(const s in i.mediaGroups[r])if(s===n){i.mediaGroups[r][t]={};for(const n in i.mediaGroups[r][s]){const a=i.mediaGroups[r][s][n];i.mediaGroups[r][t][n]=h({},a);const o=i.mediaGroups[r][t][n],l=this.createCloneURI_(a.resolvedUri,e);o.resolvedUri=l,o.uri=l,o.playlists=[],a.playlists.forEach((s,a)=>{const l=i.playlists[s.id],c=To(r,t,n),u=wo(t,c);if(l&&!i.playlists[u]){const t=this.createClonePlaylist_(l,u,e),n=t.resolvedUri;i.playlists[u]=t,i.playlists[n]=t}o.playlists[a]=this.createClonePlaylist_(s,u,e)})}}})}createClonePlaylist_(e,t,n,i){const r=this.createCloneURI_(e.resolvedUri,n),s={resolvedUri:r,uri:r,id:t};return e.segments&&(s.segments=[]),i&&(s.attributes=i),Ga(e,s)}createCloneURI_(e,t){const n=new URL(e);n.hostname=t["URI-REPLACEMENT"].HOST;const i=t["URI-REPLACEMENT"].PARAMS;for(const r of Object.keys(i))n.searchParams.set(r,i[r]);return n.href}createCloneAttributes_(e,t){const n={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(i=>{t[i]&&(n[i]=e)}),n}getKeyIdSet(e){const t=new Set;if(!e||!e.contentProtection)return t;for(const n in e.contentProtection)if(e.contentProtection[n]&&e.contentProtection[n].attributes&&e.contentProtection[n].attributes.keyId){const i=e.contentProtection[n].attributes.keyId;t.add(i.toLowerCase())}return t}}const Ho=function(e,t,n,i){const r="arraybuffer"===e.responseType?e.response:e.responseText;!t&&r&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=r.byteLength||r.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3))),n.headers&&(e.responseHeaders=n.headers),t&&"ETIMEDOUT"===t.code&&(e.timedout=!0),t||e.aborted||200===n.statusCode||206===n.statusCode||0===n.statusCode||(t=new Error("XHR Failed with a response of: "+(e&&(r||e.responseText)))),i(t,e)},Go=function(){const e=function e(t,n){t=Ga({timeout:45e3},t);const i=e.beforeRequest||Ma.Vhs.xhr.beforeRequest,r=e._requestCallbackSet||Ma.Vhs.xhr._requestCallbackSet||new Set,s=e._responseCallbackSet||Ma.Vhs.xhr._responseCallbackSet;i&&"function"===typeof i&&(Ma.log.warn("beforeRequest is deprecated, use onRequest instead."),r.add(i));const a=!0===Ma.Vhs.xhr.original?Ma.xhr:Ma.Vhs.xhr,o=((e,t)=>{if(!e||!e.size)return;let n=t;return e.forEach(e=>{n=e(n)}),n})(r,t);r.delete(i);const l=a(o||t,function(e,t){return((e,t,n,i)=>{e&&e.size&&e.forEach(e=>{e(t,n,i)})})(s,l,e,t),Ho(l,e,t,n)}),c=l.abort;return l.abort=function(){return l.aborted=!0,c.apply(l,arguments)},l.uri=t.uri,l.requestType=t.requestType,l.requestTime=Date.now(),l};return e.original=!0,e},qo=function(e){const t={};return e.byterange&&(t.Range=function(e){let t;const n=e.offset;return t="bigint"===typeof e.offset||"bigint"===typeof e.length?r().BigInt(e.offset)+r().BigInt(e.length)-r().BigInt(1):e.offset+e.length-1,"bytes="+n+"-"+t}(e.byterange)),t},Xo=function(e,t){return e.start(t)+"-"+e.end(t)},Ko=function(e,t){const n=e.toString(16);return"00".substring(0,2-n.length)+n+(t%2?" ":"")},Yo=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},Qo=function(e){const t={};return Object.keys(e).forEach(n=>{const i=e[n];U(i)?t[n]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:t[n]=i}),t},$o=function(e){const t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},Jo=function(e){return e.resolvedUri},Zo=e=>{const t=Array.prototype.slice.call(e),n=16;let i,r,s="";for(let a=0;a<t.length/n;a++)i=t.slice(a*n,a*n+n).map(Ko).join(""),r=t.slice(a*n,a*n+n).map(Yo).join(""),s+=i+" "+r+"\n";return s};var el=Object.freeze({__proto__:null,createTransferableMessage:Qo,initSegmentId:$o,segmentKeyId:Jo,hexDump:Zo,tagDump:e=>{let{bytes:t}=e;return Zo(t)},textRanges:e=>{let t,n="";for(t=0;t<e.length;t++)n+=Xo(e,t)+" ";return n}});const tl=e=>{let{playlist:t,time:n,callback:i}=e;if(!i)throw new Error("getProgramTime: callback must be provided");if(!t||void 0===n)return i({message:"getProgramTime: playlist and time must be provided"});const r=((e,t)=>{if(!t||!t.segments||0===t.segments.length)return null;let n,i=0;for(let s=0;s<t.segments.length&&(n=t.segments[s],i=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:i+n.duration,!(e<=i));s++);const r=t.segments[t.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>i){if(e>i+.25*r.duration)return null;n=r}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:i-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}})(n,t);if(!r)return i({message:"valid programTime was not found"});if("estimate"===r.type)return i({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:r.estimatedStart});const s={mediaSeconds:n},a=((e,t)=>{if(!t.dateTimeObject)return null;const n=t.videoTimingInfo.transmuxerPrependedSeconds,i=e-(t.videoTimingInfo.transmuxedPresentationStart+n);return new Date(t.dateTimeObject.getTime()+1e3*i)})(n,r.segment);return a&&(s.programDateTime=a.toISOString()),i(null,s)},nl=e=>{let{programTime:t,playlist:n,retryCount:i=2,seekTo:r,pauseAfterSeek:s=!0,tech:a,callback:o}=e;if(!o)throw new Error("seekToProgramTime: callback must be provided");if("undefined"===typeof t||!n||!r)return o({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!n.endList&&!a.hasStarted_)return o({message:"player must be playing a live stream to start buffering"});if(!(e=>{if(!e.segments||0===e.segments.length)return!1;for(let t=0;t<e.segments.length;t++)if(!e.segments[t].dateTimeObject)return!1;return!0})(n))return o({message:"programDateTime tags must be provided in the manifest "+n.resolvedUri});const l=((e,t)=>{let n;try{n=new Date(e)}catch(l){return null}if(!t||!t.segments||0===t.segments.length)return null;let i=t.segments[0];if(n<new Date(i.dateTimeObject))return null;for(let c=0;c<t.segments.length-1&&(i=t.segments[c],!(n<new Date(t.segments[c+1].dateTimeObject)));c++);const r=t.segments[t.segments.length-1],s=r.dateTimeObject,a=r.videoTimingInfo?(o=r.videoTimingInfo).transmuxedPresentationEnd-o.transmuxedPresentationStart-o.transmuxerPrependedSeconds:r.duration+.25*r.duration;var o;return n>new Date(s.getTime()+1e3*a)?null:(n>new Date(s)&&(i=r),{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:_o.duration(t,t.mediaSequence+t.segments.indexOf(i)),type:i.videoTimingInfo?"accurate":"estimate"})})(t,n);if(!l)return o({message:"".concat(t," was not found in the stream")});const c=l.segment,u=((e,t)=>{let n,i;try{n=new Date(e),i=new Date(t)}catch(s){}const r=n.getTime();return(i.getTime()-r)/1e3})(c.dateTimeObject,t);if("estimate"===l.type)return 0===i?o({message:"".concat(t," is not buffered yet. Try again")}):(r(l.estimatedStart+u),void a.one("seeked",()=>{nl({programTime:t,playlist:n,retryCount:i-1,seekTo:r,pauseAfterSeek:s,tech:a,callback:o})}));const h=c.start+u;a.one("seeked",()=>o(null,a.currentTime())),s&&a.pause(),r(h)},il=(e,t)=>{if(4===e.readyState)return t()},rl=(e,t,n,i)=>{let r,s=[],a=!1;const o=function(e,t,i,r){return t.abort(),a=!0,n(e,t,i,r)},l=function(e,t){if(a)return;if(e)return e.metadata=Eo({requestType:i,request:t,error:e}),o(e,t,"",s);const n=t.responseText.substring(s&&s.byteLength||0,t.responseText.length);if(s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if((t=t.filter(function(e){return e&&(e.byteLength||e.length)&&"string"!==typeof e})).length<=1)return B(t[0]);var i=t.reduce(function(e,t,n){return e+(t.byteLength||t.length)},0),r=new Uint8Array(i),s=0;return t.forEach(function(e){e=B(e),r.set(e,s),s+=e.byteLength}),r}(s,H(n,!0)),r=r||Je(s),s.length<10||r&&s.length<r+2)return il(t,()=>o(e,t,"",s));const l=yt(s);return"ts"===l&&s.length<188||!l&&s.length<376?il(t,()=>o(e,t,"",s)):o(null,t,l,s)},c={uri:e,beforeSend(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",function(t){let{total:n,loaded:i}=t;return Ho(e,null,{statusCode:e.status},l)})}},u=t(c,function(e,t){return Ho(u,e,t,l)});return u},{EventTarget:sl}=Ma,al=function(e,t){if(!Bo(e,t))return!1;if(e.sidx&&t.sidx&&(e.sidx.offset!==t.sidx.offset||e.sidx.length!==t.sidx.length))return!1;if(!e.sidx&&t.sidx||e.sidx&&!t.sidx)return!1;if(e.segments&&!t.segments||!e.segments&&t.segments)return!1;if(!e.segments&&!t.segments)return!0;for(let n=0;n<e.segments.length;n++){const i=e.segments[n],r=t.segments[n];if(i.uri!==r.uri)return!1;if(!i.byterange&&!r.byterange)continue;const s=i.byterange,a=r.byterange;if(s&&!a||!s&&a)return!1;if(s.offset!==a.offset||s.length!==a.length)return!1}return!0},ol=(e,t,n,i)=>{const r=i.attributes.NAME||n;return"placeholder-uri-".concat(e,"-").concat(t,"-").concat(r)},ll=(e,t,n)=>{let i=!0,r=Ga(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod,timelineStarts:t.timelineStarts});for(let s=0;s<t.playlists.length;s++){const e=t.playlists[s];if(e.sidx){const t=me(e.sidx);n&&n[t]&&n[t].sidx&&ce(e,n[t].sidx,e.sidx.resolvedUri)}const a=zo(r,e,al);a&&(r=a,i=!1)}return ko(t,(e,t,n,s)=>{if(e.playlists&&e.playlists.length){const a=e.playlists[0].id,o=zo(r,e.playlists[0],al);o&&(r=o,s in r.mediaGroups[t][n]||(r.mediaGroups[t][n][s]=e),r.mediaGroups[t][n][s].playlists[0]=r.playlists[a],i=!1)}}),((e,t)=>{ko(e,(n,i,r,s)=>{t.mediaGroups[i][r]&&s in t.mediaGroups[i][r]||delete e.mediaGroups[i][r][s]})})(r,t),t.minimumUpdatePeriod!==e.minimumUpdatePeriod&&(i=!1),i?null:r},cl=(e,t)=>(Boolean(!e.map&&!t.map)||Boolean(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length))&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length,ul=(e,t)=>{const n={};for(const i in e){const r=e[i].sidx;if(r){const e=me(r);if(!t[e])break;const i=t[e].sidxInfo;cl(i,r)&&(n[e]=t[e])}}return n};class hl extends sl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;super(),this.isPaused_=!0,this.mainPlaylistLoader_=i||this,i||(this.isMain_=!0);const{withCredentials:r=!1}=n;if(this.vhs_=t,this.withCredentials=r,this.addMetadataToTextTrack=n.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=Ha("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,t,n){return!this.request||(this.request=null,e?(this.error="object"!==typeof e||e instanceof Error?{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata}:e,n&&(this.state=n),this.trigger("error"),!0):void 0)}addSidxSegments_(e,t,n){const i=e.sidx&&me(e.sidx);if(!e.sidx||!i||this.mainPlaylistLoader_.sidxMapping_[i])return r().clearTimeout(this.mediaRequest_),void(this.mediaRequest_=r().setTimeout(()=>n(!1),0));const s=Wa(e.sidx.resolvedUri),a=(r,s)=>{if(this.requestErrored_(r,s,t))return;const a=this.mainPlaylistLoader_.sidxMapping_,{requestType:o}=s;let l;try{l=Qe()(B(s.response).subarray(8))}catch(c){return c.metadata=Eo({requestType:o,request:s,parseFailure:!0}),void this.requestErrored_(c,s,t)}return a[i]={sidxInfo:e.sidx,sidx:l},ce(e,l,e.sidx.resolvedUri),n(!0)};this.request=rl(s,this.vhs_.xhr,(t,n,i,r)=>{if(t)return a(t,n);if(!i||"mp4"!==i){const t=i||"unknown";return a({status:n.status,message:"Unsupported ".concat(t," container type for sidx segment at URL: ").concat(s),response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},n)}const{offset:o,length:l}=e.sidx.byterange;if(r.length>=l+o)return a(t,{response:r.subarray(o,o+l),status:n.status,uri:n.uri});this.request=this.vhs_.xhr({uri:s,responseType:"arraybuffer",requestType:"dash-sidx",headers:qo({byterange:e.sidx.byterange})},a)},"dash-sidx")}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},r().clearTimeout(this.minimumUpdatePeriodTimeout_),r().clearTimeout(this.mediaRequest_),r().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if("string"===typeof e){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(n&&(this.trigger("mediachanging"),this.trigger("mediachange")));n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,n=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata(e){let{startingState:t,playlist:n}=e;this.state="HAVE_METADATA",this.loadedPlaylists_[n.id]=n,r().clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(n.id),"HAVE_MAIN_MANIFEST"===t?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),r().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(r().clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)}load(e){this.isPaused_=!1,r().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const e=t?t.targetDuration/2*1e3:5e3;return void(this.mediaUpdateTimeout=r().setTimeout(()=>this.load(),e))}this.started?t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()}start(){if(this.started=!0,!this.isMain_)return r().clearTimeout(this.mediaRequest_),void(this.mediaRequest_=r().setTimeout(()=>this.haveMain_(),0));this.requestMain_((e,t)=>{this.haveMain_(),this.hasPendingRequest()||this.media_||this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(n,i)=>{if(n){const{requestType:e}=i;n.metadata=Eo({requestType:e,request:i,error:n})}if(this.requestErrored_(n,i))return void("HAVE_NOTHING"===this.state&&(this.started=!1));this.trigger({type:"manifestrequestcomplete",metadata:t});const r=i.responseText!==this.mainPlaylistLoader_.mainXml_;return this.mainPlaylistLoader_.mainXml_=i.responseText,i.responseHeaders&&i.responseHeaders.date?this.mainLoaded_=Date.parse(i.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=Wa(this.mainPlaylistLoader_.srcUrl,i),r?(this.handleMain_(),void this.syncClientServerClock_(()=>e(i,r))):e(i,r)})}syncClientServerClock_(e){const t=Xe(this.mainPlaylistLoader_.mainXml_);return null===t?(this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()):"DIRECT"===t.method?(this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:ja(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(n,i)=>{if(!this.request)return;if(n){const{requestType:t}=i;return this.error.metadata=Eo({requestType:t,request:i,error:n}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let r;r="HEAD"===t.method?i.responseHeaders&&i.responseHeaders.date?Date.parse(i.responseHeaders.date):this.mainLoaded_:Date.parse(i.responseText),this.mainPlaylistLoader_.clientOffset_=r-Date.now(),e()}))}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){r().clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};let n;this.trigger({type:"manifestparsestart",metadata:t});try{n=(e=>{let{mainXml:t,srcUrl:n,clientOffset:i,sidxMapping:r,previousManifest:s}=e;const a=qe(t,{manifestUri:n,clientOffset:i,sidxMapping:r,previousManifest:s});return Co(a,n,ol),a})({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(s){this.error=s,this.error.metadata={errorType:Ma.Error.StreamingDashManifestParserError,error:s},this.trigger("error")}e&&(n=ll(e,n,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=n||e;const i=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(i&&i!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=i),(!e||n&&n.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(n),n){const{duration:e,endList:i}=n,r=[];n.playlists.forEach(e=>{r.push({id:e.id,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS})});const s={duration:e,isLive:!i,renditions:r};t.parsedManifest=s,this.trigger({type:"manifestparsecomplete",metadata:t})}return Boolean(n)}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(r().clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;0===t&&(e.media()?t=1e3*e.media().targetDuration:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),"number"!==typeof t||t<=0?t<0&&this.logger_("found invalid minimumUpdatePeriod of ".concat(t,", not setting a timeout")):this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=r().setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=((e,t)=>{let n=ul(e.playlists,t);return ko(e,(e,i,r,s)=>{if(e.playlists&&e.playlists.length){const i=e.playlists;n=Ga(n,ul(i,t))}}),n})(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,e=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const e=()=>{this.media().endList||(this.mediaUpdateTimeout=r().setTimeout(()=>{this.trigger("mediaupdatetimeout"),e()},Vo(this.media(),Boolean(n))))};e()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const e=this.mainPlaylistLoader_.main.eventStream.map(e=>({cueTime:e.start,frames:[{data:e.messageData}]}));this.addMetadataToTextTrack("EventStream",e,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const i=e.contentProtection[n].attributes["cenc:default_KID"];i&&t.add(i.replace(/-/g,"").toLowerCase())}return t}}}var dl={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const pl=function(e){return e.on=e.addEventListener,e.off=e.removeEventListener,e},fl=function(e){return function(){const t=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(t){const n=new BlobBuilder;return n.append(e),URL.createObjectURL(n.getBlob())}}(e),n=pl(new Worker(t));n.objURL=t;const i=n.terminate;return n.on=n.addEventListener,n.off=n.removeEventListener,n.terminate=function(){return URL.revokeObjectURL(t),i.call(this)},n}},gl=function(e){return"var browserWorkerPolyFill = ".concat(pl.toString(),";\n")+"browserWorkerPolyFill(self);\n"+e},ml=function(e){return e.toString().replace(/^function.+?{/,"").slice(0,-1)},yl=gl(ml(function(){var e="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},t=function(){this.init=function(){var e={};this.on=function(t,n){e[t]||(e[t]=[]),e[t]=e[t].concat(n)},this.off=function(t,n){var i;return!!e[t]&&(i=e[t].indexOf(n),e[t]=e[t].slice(),e[t].splice(i,1),i>-1)},this.trigger=function(t){var n,i,r,s;if(n=e[t])if(2===arguments.length)for(r=n.length,i=0;i<r;++i)n[i].call(this,arguments[1]);else{for(s=[],i=arguments.length,i=1;i<arguments.length;++i)s.push(arguments[i]);for(r=n.length,i=0;i<r;++i)n[i].apply(this,s)}},this.dispose=function(){e={}}}};t.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},t.prototype.push=function(e){this.trigger("data",e)},t.prototype.flush=function(e){this.trigger("done",e)},t.prototype.partialFlush=function(e){this.trigger("partialdone",e)},t.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},t.prototype.reset=function(e){this.trigger("reset",e)};var i,r,s,a,o,l,c,u,h,d,p,f,g,m,y,b,v,_,x,w,T,k,S,C,I,E,N,A,R,D,O,L,P,F,M,U,B=t,z=Math.pow(2,32),V={getUint64:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getBigUint64?(t=n.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(t):t:n.getUint32(0)*z+n.getUint32(4)},MAX_UINT32:z},j=V.MAX_UINT32;!function(){var e;if(S={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!==typeof Uint8Array){for(e in S)S.hasOwnProperty(e)&&(S[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);C=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),E=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),I=new Uint8Array([0,0,0,1]),N=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),R={video:N,audio:A},L=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),O=new Uint8Array([0,0,0,0,0,0,0,0]),P=new Uint8Array([0,0,0,0,0,0,0,0]),F=P,M=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),U=P,D=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),i=function(e){var t,n,i=[],r=0;for(t=1;t<arguments.length;t++)i.push(arguments[t]);for(t=i.length;t--;)r+=i[t].byteLength;for(n=new Uint8Array(r+8),new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,n.byteLength),n.set(e,4),t=0,r=8;t<i.length;t++)n.set(i[t],r),r+=i[t].byteLength;return n},r=function(){return i(S.dinf,i(S.dref,L))},s=function(e){return i(S.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},a=function(){return i(S.ftyp,C,I,C,E)},b=function(e){return i(S.hdlr,R[e])},o=function(e){return i(S.mdat,e)},y=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),i(S.mdhd,t)},m=function(e){return i(S.mdia,y(e),b(e.type),c(e))},l=function(e){return i(S.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},c=function(e){return i(S.minf,"video"===e.type?i(S.vmhd,D):i(S.smhd,O),r(),_(e))},u=function(e,t){for(var n=[],r=t.length;r--;)n[r]=w(t[r]);return i.apply(null,[S.moof,l(e)].concat(n))},h=function(e){for(var t=e.length,n=[];t--;)n[t]=f(e[t]);return i.apply(null,[S.moov,p(4294967295)].concat(n).concat(d(e)))},d=function(e){for(var t=e.length,n=[];t--;)n[t]=T(e[t]);return i.apply(null,[S.mvex].concat(n))},p=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return i(S.mvhd,t)},v=function(e){var t,n,r=e.samples||[],s=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)t=r[n].flags,s[n+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return i(S.sdtp,s)},_=function(e){return i(S.stbl,x(e),i(S.stts,U),i(S.stsc,F),i(S.stsz,M),i(S.stco,P))},function(){var e,t;x=function(n){return i(S.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===n.type?e(n):t(n))},e=function(e){var t,n,r=e.sps||[],s=e.pps||[],a=[],o=[];for(t=0;t<r.length;t++)a.push((65280&r[t].byteLength)>>>8),a.push(255&r[t].byteLength),a=a.concat(Array.prototype.slice.call(r[t]));for(t=0;t<s.length;t++)o.push((65280&s[t].byteLength)>>>8),o.push(255&s[t].byteLength),o=o.concat(Array.prototype.slice.call(s[t]));if(n=[S.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i(S.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([r.length],a,[s.length],o))),i(S.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],c=e.sarRatio[1];n.push(i(S.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&c)>>24,(16711680&c)>>16,(65280&c)>>8,255&c])))}return i.apply(null,n)},t=function(e){return i(S.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),s(e))}}(),g=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return i(S.tkhd,t)},w=function(e){var t,n,r,s,a,o;return t=i(S.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(e.baseMediaDecodeTime/j),o=Math.floor(e.baseMediaDecodeTime%j),n=i(S.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),"audio"===e.type?(r=k(e,92),i(S.traf,t,n,r)):(s=v(e),r=k(e,s.length+92),i(S.traf,t,n,r,s))},f=function(e){return e.duration=e.duration||4294967295,i(S.trak,g(e),m(e))},T=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),i(S.trex,t)},function(){var e,t,n;n=function(e,t){var n=0,i=0,r=0,s=0;return e.length&&(void 0!==e[0].duration&&(n=1),void 0!==e[0].size&&(i=2),void 0!==e[0].flags&&(r=4),void 0!==e[0].compositionTimeOffset&&(s=8)),[0,0,n|i|r|s,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},t=function(e,t){var r,s,a,o,l,c;for(t+=20+16*(o=e.samples||[]).length,a=n(o,t),(s=new Uint8Array(a.length+16*o.length)).set(a),r=a.length,c=0;c<o.length;c++)l=o[c],s[r++]=(4278190080&l.duration)>>>24,s[r++]=(16711680&l.duration)>>>16,s[r++]=(65280&l.duration)>>>8,s[r++]=255&l.duration,s[r++]=(4278190080&l.size)>>>24,s[r++]=(16711680&l.size)>>>16,s[r++]=(65280&l.size)>>>8,s[r++]=255&l.size,s[r++]=l.flags.isLeading<<2|l.flags.dependsOn,s[r++]=l.flags.isDependedOn<<6|l.flags.hasRedundancy<<4|l.flags.paddingValue<<1|l.flags.isNonSyncSample,s[r++]=61440&l.flags.degradationPriority,s[r++]=15&l.flags.degradationPriority,s[r++]=(4278190080&l.compositionTimeOffset)>>>24,s[r++]=(16711680&l.compositionTimeOffset)>>>16,s[r++]=(65280&l.compositionTimeOffset)>>>8,s[r++]=255&l.compositionTimeOffset;return i(S.trun,s)},e=function(e,t){var r,s,a,o,l,c;for(t+=20+8*(o=e.samples||[]).length,a=n(o,t),(r=new Uint8Array(a.length+8*o.length)).set(a),s=a.length,c=0;c<o.length;c++)l=o[c],r[s++]=(4278190080&l.duration)>>>24,r[s++]=(16711680&l.duration)>>>16,r[s++]=(65280&l.duration)>>>8,r[s++]=255&l.duration,r[s++]=(4278190080&l.size)>>>24,r[s++]=(16711680&l.size)>>>16,r[s++]=(65280&l.size)>>>8,r[s++]=255&l.size;return i(S.trun,r)},k=function(n,i){return"audio"===n.type?e(n,i):t(n,i)}}();var W,H,G,q,X,K,Y,Q,$={ftyp:a,mdat:o,moof:u,moov:h,initSegment:function(e){var t,n=a(),i=h(e);return(t=new Uint8Array(n.byteLength+i.byteLength)).set(n),t.set(i,n.byteLength),t}},J=function(e,t){var n={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return n.dataOffset=t,n.compositionTimeOffset=e.pts-e.dts,n.duration=e.duration,n.size=4*e.length,n.size+=e.byteLength,e.keyFrame&&(n.flags.dependsOn=2,n.flags.isNonSyncSample=0),n},Z={groupNalsIntoFrames:function(e){var t,n,i=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,i.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(n=e[t]).nalUnitType?(i.length&&(i.duration=n.dts-i.dts,r.byteLength+=i.byteLength,r.nalCount+=i.length,r.duration+=i.duration,r.push(i)),(i=[n]).byteLength=n.data.byteLength,i.pts=n.pts,i.dts=n.dts):("slice_layer_without_partitioning_rbsp_idr"===n.nalUnitType&&(i.keyFrame=!0),i.duration=n.dts-i.dts,i.byteLength+=n.data.byteLength,i.push(n));return r.length&&(!i.duration||i.duration<=0)&&(i.duration=r[r.length-1].duration),r.byteLength+=i.byteLength,r.nalCount+=i.length,r.duration+=i.duration,r.push(i),r},groupFramesIntoGops:function(e){var t,n,i=[],r=[];for(i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=e[0].pts,i.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,t=0;t<e.length;t++)(n=e[t]).keyFrame?(i.length&&(r.push(i),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration),(i=[n]).nalCount=n.length,i.byteLength=n.byteLength,i.pts=n.pts,i.dts=n.dts,i.duration=n.duration):(i.duration+=n.duration,i.nalCount+=n.length,i.byteLength+=n.byteLength,i.push(n));return r.length&&i.duration<=0&&(i.duration=r[r.length-1].duration),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration,r.push(i),r},extendFirstKeyFrame:function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},generateSampleTable:function(e,t){var n,i,r,s,a,o=t||0,l=[];for(n=0;n<e.length;n++)for(s=e[n],i=0;i<s.length;i++)a=s[i],o+=(r=J(a,o)).size,l.push(r);return l},concatenateNalData:function(e){var t,n,i,r,s,a,o=0,l=e.byteLength,c=e.nalCount,u=new Uint8Array(l+4*c),h=new DataView(u.buffer);for(t=0;t<e.length;t++)for(r=e[t],n=0;n<r.length;n++)for(s=r[n],i=0;i<s.length;i++)a=s[i],h.setUint32(o,a.data.byteLength),o+=4,u.set(a.data,o),o+=a.data.byteLength;return u},generateSampleTableForFrame:function(e,t){var n,i=[];return n=J(e,t||0),i.push(n),i},concatenateNalDataForFrame:function(e){var t,n,i=0,r=e.byteLength,s=e.length,a=new Uint8Array(r+4*s),o=new DataView(a.buffer);for(t=0;t<e.length;t++)n=e[t],o.setUint32(i,n.data.byteLength),i+=4,a.set(n.data,i),i+=n.data.byteLength;return a}},ee=[33,16,5,32,164,27],te=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ne=function(e){for(var t=[];e--;)t.push(0);return t},ie=9e4;K=function(e,t){return H(X(e,t))},Y=function(e,t){return G(q(e),t)},Q=function(e,t,n){return q(n?e:e-t)};var re={ONE_SECOND_IN_TS:ie,secondsToVideoTs:H=function(e){return e*ie},secondsToAudioTs:G=function(e,t){return e*t},videoTsToSeconds:q=function(e){return e/ie},audioTsToSeconds:X=function(e,t){return e/t},audioTsToVideoTs:K,videoTsToAudioTs:Y,metadataTsToSeconds:Q},se=function(){if(!W){var e={96e3:[ee,[227,64],ne(154),[56]],88200:[ee,[231],ne(170),[56]],64e3:[ee,[248,192],ne(240),[56]],48e3:[ee,[255,192],ne(268),[55,148,128],ne(54),[112]],44100:[ee,[255,192],ne(268),[55,163,128],ne(84),[112]],32e3:[ee,[255,192],ne(268),[55,234],ne(226),[112]],24e3:[ee,[255,192],ne(268),[55,255,128],ne(268),[111,112],ne(126),[224]],16e3:[ee,[255,192],ne(268),[55,255,128],ne(268),[111,255],ne(269),[223,108],ne(195),[1,192]],12e3:[te,ne(268),[3,127,248],ne(268),[6,255,240],ne(268),[13,255,224],ne(268),[27,253,128],ne(259),[56]],11025:[te,ne(268),[3,127,248],ne(268),[6,255,240],ne(268),[13,255,224],ne(268),[27,255,192],ne(268),[55,175,128],ne(108),[112]],8e3:[te,ne(268),[3,121,16],ne(47),[7]]};t=e,W=Object.keys(t).reduce(function(e,n){return e[n]=new Uint8Array(t[n].reduce(function(e,t){return e.concat(t)},[])),e},{})}var t;return W},ae=re,oe={prefixWithSilence:function(e,t,n,i){var r,s,a,o,l,c=0,u=0,h=0;if(t.length&&(r=ae.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),s=Math.ceil(ae.ONE_SECOND_IN_TS/(e.samplerate/1024)),n&&i&&(c=r-Math.max(n,i),h=(u=Math.floor(c/s))*s),!(u<1||h>ae.ONE_SECOND_IN_TS/2))){for((a=se()[e.samplerate])||(a=t[0].data),o=0;o<u;o++)l=t[0],t.splice(0,0,{data:a,dts:l.dts-s,pts:l.pts-s});return e.baseMediaDecodeTime-=Math.floor(ae.videoTsToAudioTs(h,e.samplerate)),h}},trimAdtsFramesByEarliestDts:function(e,t,n){return t.minSegmentDts>=n?e:(t.minSegmentDts=1/0,e.filter(function(e){return e.dts>=n&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))},generateSampleTable:function(e){var t,n,i=[];for(t=0;t<e.length;t++)n=e[t],i.push({size:n.data.byteLength,duration:1024});return i},concatenateFrameData:function(e){var t,n,i=0,r=new Uint8Array(function(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t].data.byteLength;return n}(e));for(t=0;t<e.length;t++)n=e[t],r.set(n.data,i),i+=n.data.byteLength;return r}},le=re.ONE_SECOND_IN_TS,ce={clearDtsInfo:function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(e,t){var n,i=e.minSegmentDts;return t||(i-=e.timelineStartInfo.dts),n=e.timelineStartInfo.baseMediaDecodeTime,n+=i,n=Math.max(0,n),"audio"===e.type&&(n*=e.samplerate/le,n=Math.floor(n)),n},collectDtsInfo:function(e,t){"number"===typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"===typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))}},ue={parseSei:function(e){for(var t=0,n={payloadType:-1,payloadSize:0},i=0,r=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)i+=255,t++;for(i+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!n.payload&&4===i){if("GA94"===String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6])){n.payloadType=i,n.payloadSize=r,n.payload=e.subarray(t,t+r);break}n.payload=void 0}t+=r,i=0,r=0}return n},parseUserData:function(e){return 181!==e.payload[0]||49!==(e.payload[1]<<8|e.payload[2])||"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])||3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},parseCaptionPackets:function(e,t){var n,i,r,s,a=[];if(!(64&t[0]))return a;for(i=31&t[0],n=0;n<i;n++)s={type:3&t[(r=3*n)+2],pts:e},4&t[r+2]&&(s.ccData=t[r+3]<<8|t[r+4],a.push(s));return a},discardEmulationPreventionBytes:function(e){for(var t,n,i=e.byteLength,r=[],s=1;s<i-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),n[s]=e[a];return n},USER_DATA_REGISTERED_ITU_T_T35:4},he=B,de=ue,pe=function(e){e=e||{},pe.prototype.init.call(this),this.parse708captions_="boolean"!==typeof e.parse708captions||e.parse708captions,this.captionPackets_=[],this.ccStreams_=[new Te(0,0),new Te(0,1),new Te(1,0),new Te(1,1)],this.parse708captions_&&(this.cc708Stream_=new be({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};pe.prototype=new he,pe.prototype.push=function(e){var t,n,i;if("sei_rbsp"===e.nalUnitType&&(t=de.parseSei(e.escapedRBSP)).payload&&t.payloadType===de.USER_DATA_REGISTERED_ITU_T_T35&&(n=de.parseUserData(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));i=de.parseCaptionPackets(e.pts,n),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},pe.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},pe.prototype.flushStream=function(e){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(e)):this.flushCCStreams(e)},pe.prototype.flush=function(){return this.flushStream("flush")},pe.prototype.partialFlush=function(){return this.flushStream("partialFlush")},pe.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},pe.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},pe.prototype.setsChannel1Active=function(e){return 4096===(30720&e.ccData)},pe.prototype.setsChannel2Active=function(e){return 6144===(30720&e.ccData)},pe.prototype.setsTextOrXDSActive=function(e){return 256===(28928&e.ccData)||4138===(30974&e.ccData)||6186===(30974&e.ccData)},pe.prototype.dispatchCea708Packet=function(e){this.parse708captions_&&this.cc708Stream_.push(e)};var fe={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},ge=function(e){return 32<=e&&e<=127||160<=e&&e<=255},me=function(e){this.windowNum=e,this.reset()};me.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},me.prototype.getText=function(){return this.rows.join("\n")},me.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},me.prototype.newLine=function(e){for(this.rows.length>=this.virtualRowCount&&"function"===typeof this.beforeRowOverflow&&this.beforeRowOverflow(e),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},me.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},me.prototype.addText=function(e){this.rows[this.rowIdx]+=e},me.prototype.backspace=function(){if(!this.isEmpty()){var e=this.rows[this.rowIdx];this.rows[this.rowIdx]=e.substr(0,e.length-1)}};var ye=function(e,t,n){this.serviceNum=e,this.text="",this.currentWindow=new me(-1),this.windows=[],this.stream=n,"string"===typeof t&&this.createTextDecoder(t)};ye.prototype.init=function(e,t){this.startPts=e;for(var n=0;n<8;n++)this.windows[n]=new me(n),"function"===typeof t&&(this.windows[n].beforeRowOverflow=t)},ye.prototype.setCurrentWindow=function(e){this.currentWindow=this.windows[e]},ye.prototype.createTextDecoder=function(e){if("undefined"===typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(e)}catch(t){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+e+" encoding. "+t})}};var be=function(e){e=e||{},be.prototype.init.call(this);var t,n=this,i=e.captionServices||{},r={};Object.keys(i).forEach(e=>{t=i[e],/^SERVICE/.test(e)&&(r[e]=t.encoding)}),this.serviceEncodings=r,this.current708Packet=null,this.services={},this.push=function(e){3===e.type?(n.new708Packet(),n.add708Bytes(e)):(null===n.current708Packet&&n.new708Packet(),n.add708Bytes(e))}};be.prototype=new he,be.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},be.prototype.add708Bytes=function(e){var t=e.ccData,n=t>>>8,i=255&t;this.current708Packet.ptsVals.push(e.pts),this.current708Packet.data.push(n),this.current708Packet.data.push(i)},be.prototype.push708Packet=function(){var e=this.current708Packet,t=e.data,n=null,i=null,r=0,s=t[r++];for(e.seq=s>>6,e.sizeCode=63&s;r<t.length;r++)i=31&(s=t[r++]),7===(n=s>>5)&&i>0&&(n=s=t[r++]),this.pushServiceBlock(n,r,i),i>0&&(r+=i-1)},be.prototype.pushServiceBlock=function(e,t,n){var i,r=t,s=this.current708Packet.data,a=this.services[e];for(a||(a=this.initService(e,r));r<t+n&&r<s.length;r++)i=s[r],ge(i)?r=this.handleText(r,a):24===i?r=this.multiByteCharacter(r,a):16===i?r=this.extendedCommands(r,a):128<=i&&i<=135?r=this.setCurrentWindow(r,a):152<=i&&i<=159?r=this.defineWindow(r,a):136===i?r=this.clearWindows(r,a):140===i?r=this.deleteWindows(r,a):137===i?r=this.displayWindows(r,a):138===i?r=this.hideWindows(r,a):139===i?r=this.toggleWindows(r,a):151===i?r=this.setWindowAttributes(r,a):144===i?r=this.setPenAttributes(r,a):145===i?r=this.setPenColor(r,a):146===i?r=this.setPenLocation(r,a):143===i?a=this.reset(r,a):8===i?a.currentWindow.backspace():12===i?a.currentWindow.clearText():13===i?a.currentWindow.pendingNewLine=!0:14===i?a.currentWindow.clearText():141===i&&r++},be.prototype.extendedCommands=function(e,t){var n=this.current708Packet.data[++e];return ge(n)&&(e=this.handleText(e,t,{isExtended:!0})),e},be.prototype.getPts=function(e){return this.current708Packet.ptsVals[Math.floor(e/2)]},be.prototype.initService=function(e,t){var n,i,r=this;return(n="SERVICE"+e)in this.serviceEncodings&&(i=this.serviceEncodings[n]),this.services[e]=new ye(e,i,r),this.services[e].init(this.getPts(t),function(t){r.flushDisplayed(t,r.services[e])}),this.services[e]},be.prototype.handleText=function(e,t,n){var i,r,s=n&&n.isExtended,a=n&&n.isMultiByte,o=this.current708Packet.data,l=s?4096:0,c=o[e],u=o[e+1],h=t.currentWindow;if(a?(r=[c,u],e++):r=[c],t.textDecoder_&&!s)i=t.textDecoder_.decode(new Uint8Array(r));else if(a){const e=r.map(e=>("0"+(255&e).toString(16)).slice(-2)).join("");i=String.fromCharCode(parseInt(e,16))}else i=function(e){var t=fe[e]||e;return 4096&e&&e===t?"":String.fromCharCode(t)}(l|c);return h.pendingNewLine&&!h.isEmpty()&&h.newLine(this.getPts(e)),h.pendingNewLine=!1,h.addText(i),e},be.prototype.multiByteCharacter=function(e,t){var n=this.current708Packet.data,i=n[e+1],r=n[e+2];return ge(i)&&ge(r)&&(e=this.handleText(++e,t,{isMultiByte:!0})),e},be.prototype.setCurrentWindow=function(e,t){var n=7&this.current708Packet.data[e];return t.setCurrentWindow(n),e},be.prototype.defineWindow=function(e,t){var n=this.current708Packet.data,i=n[e],r=7&i;t.setCurrentWindow(r);var s=t.currentWindow;return i=n[++e],s.visible=(32&i)>>5,s.rowLock=(16&i)>>4,s.columnLock=(8&i)>>3,s.priority=7&i,i=n[++e],s.relativePositioning=(128&i)>>7,s.anchorVertical=127&i,i=n[++e],s.anchorHorizontal=i,i=n[++e],s.anchorPoint=(240&i)>>4,s.rowCount=15&i,i=n[++e],s.columnCount=63&i,i=n[++e],s.windowStyle=(56&i)>>3,s.penStyle=7&i,s.virtualRowCount=s.rowCount+1,e},be.prototype.setWindowAttributes=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.winAttr;return i=n[++e],r.fillOpacity=(192&i)>>6,r.fillRed=(48&i)>>4,r.fillGreen=(12&i)>>2,r.fillBlue=3&i,i=n[++e],r.borderType=(192&i)>>6,r.borderRed=(48&i)>>4,r.borderGreen=(12&i)>>2,r.borderBlue=3&i,i=n[++e],r.borderType+=(128&i)>>5,r.wordWrap=(64&i)>>6,r.printDirection=(48&i)>>4,r.scrollDirection=(12&i)>>2,r.justify=3&i,i=n[++e],r.effectSpeed=(240&i)>>4,r.effectDirection=(12&i)>>2,r.displayEffect=3&i,e},be.prototype.flushDisplayed=function(e,t){for(var n=[],i=0;i<8;i++)t.windows[i].visible&&!t.windows[i].isEmpty()&&n.push(t.windows[i].getText());t.endPts=e,t.text=n.join("\n\n"),this.pushCaption(t),t.startPts=e},be.prototype.pushCaption=function(e){""!==e.text&&(this.trigger("data",{startPts:e.startPts,endPts:e.endPts,text:e.text,stream:"cc708_"+e.serviceNum}),e.text="",e.startPts=e.endPts)},be.prototype.displayWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&(t.windows[r].visible=1);return e},be.prototype.hideWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&(t.windows[r].visible=0);return e},be.prototype.toggleWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&(t.windows[r].visible^=1);return e},be.prototype.clearWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&t.windows[r].clearText();return e},be.prototype.deleteWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&t.windows[r].reset();return e},be.prototype.setPenAttributes=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penAttr;return i=n[++e],r.textTag=(240&i)>>4,r.offset=(12&i)>>2,r.penSize=3&i,i=n[++e],r.italics=(128&i)>>7,r.underline=(64&i)>>6,r.edgeType=(56&i)>>3,r.fontStyle=7&i,e},be.prototype.setPenColor=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penColor;return i=n[++e],r.fgOpacity=(192&i)>>6,r.fgRed=(48&i)>>4,r.fgGreen=(12&i)>>2,r.fgBlue=3&i,i=n[++e],r.bgOpacity=(192&i)>>6,r.bgRed=(48&i)>>4,r.bgGreen=(12&i)>>2,r.bgBlue=3&i,i=n[++e],r.edgeRed=(48&i)>>4,r.edgeGreen=(12&i)>>2,r.edgeBlue=3&i,e},be.prototype.setPenLocation=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penLoc;return t.currentWindow.pendingNewLine=!0,i=n[++e],r.row=15&i,i=n[++e],r.column=63&i,e},be.prototype.reset=function(e,t){var n=this.getPts(e);return this.flushDisplayed(n,t),this.initService(t.serviceNum,e)};var ve={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},_e=function(e){return null===e?"":(e=ve[e]||e,String.fromCharCode(e))},xe=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],we=function(){for(var e=[],t=15;t--;)e.push({text:"",indent:0,offset:0});return e},Te=function(e,t){Te.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,n,i,r,s;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096===(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),i=t>>>8,r=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),n=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=n,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=we();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=we();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=we()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(i,r))s=_e((i=(3&i)<<8)|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isExtCharacter(i,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),s=_e((i=(3&i)<<8)|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isMidRowCode(i,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14===(14&r)&&this.addFormatting(e.pts,["i"]),1===(1&r)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(i,r)){const e=3&r;this.nonDisplayed_[this.row_].offset=e,this.column_+=e}else if(this.isPAC(i,r)){var a=xe.indexOf(7968&t);if("rollUp"===this.mode_&&(a-this.rollUpRows_+1<0&&(a=this.rollUpRows_-1),this.setRollUp(e.pts,a)),a!==this.row_&&a>=0&&a<=14&&(this.clearFormatting(e.pts),this.row_=a),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16===(16&t)){const e=(14&t)>>1;this.column_=4*e,this.nonDisplayed_[this.row_].indent+=e}this.isColorPAC(r)&&14===(14&r)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(i)&&(0===r&&(r=null),s=_e(i),s+=_e(r),this[this.mode_](e.pts,s),this.column_+=s.length)}else this.lastControlCode_=null}};Te.prototype=new he,Te.prototype.flushDisplayed=function(e){const t=e=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+e+"."})},n=[];this.displayed_.forEach((e,i)=>{if(e&&e.text&&e.text.length){try{e.text=e.text.trim()}catch(r){t(i)}e.text.length&&n.push({text:e.text,line:i+1,position:10+Math.min(70,10*e.indent)+2.5*e.offset})}else void 0!==e&&null!==e||t(i)}),n.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,content:n,stream:this.name_})},Te.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=we(),this.nonDisplayed_=we(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Te.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Te.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},Te.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},Te.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},Te.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},Te.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},Te.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},Te.prototype.isNormalChar=function(e){return e>=32&&e<=127},Te.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=we(),this.displayed_=we()),void 0!==t&&t!==this.row_)for(var n=0;n<this.rollUpRows_;n++)this.displayed_[t-n]=this.displayed_[this.row_-n],this.displayed_[this.row_-n]={text:"",indent:0,offset:0};void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Te.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var n=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,n)},Te.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},Te.prototype.popOn=function(e,t){var n=this.nonDisplayed_[this.row_].text;n+=t,this.nonDisplayed_[this.row_].text=n},Te.prototype.rollUp=function(e,t){var n=this.displayed_[this.row_].text;n+=t,this.displayed_[this.row_].text=n},Te.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.row_+1;e<15;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Te.prototype.paintOn=function(e,t){var n=this.displayed_[this.row_].text;n+=t,this.displayed_[this.row_].text=n};var ke={CaptionStream:pe,Cea608Stream:Te,Cea708Stream:be},Se={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Ce=B,Ie="shared",Ee=function(e,t){var n=1;for(e>t&&(n=-1);Math.abs(t-e)>4294967296;)e+=8589934592*n;return e},Ne=function(e){var t,n;Ne.prototype.init.call(this),this.type_=e||Ie,this.push=function(e){"metadata"!==e.type?this.type_!==Ie&&e.type!==this.type_||(void 0===n&&(n=e.dts),e.dts=Ee(e.dts,n),e.pts=Ee(e.pts,n),t=e.dts,this.trigger("data",e)):this.trigger("data",e)},this.flush=function(){n=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Ne.prototype=new Ce;var Ae,Re={TimestampRolloverStream:Ne,handleRollover:Ee},De=(e,t,n)=>{if(!e)return-1;for(var i=n;i<e.length;i++)if(e[i]===t)return i;return-1},Oe=De,Le=3,Pe=function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r},Fe=function(e,t,n){return decodeURIComponent(Pe(e,t,n))},Me=function(e,t,n){return unescape(Pe(e,t,n))},Ue=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Be={APIC:function(e){var t,n,i=1;e.data[0]===Le&&((t=Oe(e.data,0,i))<0||(e.mimeType=Me(e.data,i,t),i=t+1,e.pictureType=e.data[i],i++,(n=Oe(e.data,0,i))<0||(e.description=Fe(e.data,i,n),i=n+1,"--\x3e"===e.mimeType?e.url=Me(e.data,i,e.data.length):e.pictureData=e.data.subarray(i,e.data.length))))},"T*":function(e){e.data[0]===Le&&(e.value=Fe(e.data,1,e.data.length).replace(/\0*$/,""),e.values=e.value.split("\0"))},TXXX:function(e){var t;e.data[0]===Le&&-1!==(t=Oe(e.data,0,1))&&(e.description=Fe(e.data,1,t),e.value=Fe(e.data,t+1,e.data.length).replace(/\0*$/,""),e.data=e.value)},"W*":function(e){e.url=Me(e.data,0,e.data.length).replace(/\0.*$/,"")},WXXX:function(e){var t;e.data[0]===Le&&-1!==(t=Oe(e.data,0,1))&&(e.description=Fe(e.data,1,t),e.url=Me(e.data,t+1,e.data.length).replace(/\0.*$/,""))},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=Me(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},ze={parseId3Frames:function(e){var t,n=10,i=0,r=[];if(!(e.length<10||e[0]!=="I".charCodeAt(0)||e[1]!=="D".charCodeAt(0)||e[2]!=="3".charCodeAt(0))){i=Ue(e.subarray(6,10)),i+=10,64&e[5]&&(n+=4,n+=Ue(e.subarray(10,14)),i-=Ue(e.subarray(16,20)));do{if((t=Ue(e.subarray(n+4,n+8)))<1)break;var s={id:String.fromCharCode(e[n],e[n+1],e[n+2],e[n+3]),data:e.subarray(n+10,n+t+10)};s.key=s.id,Be[s.id]?Be[s.id](s):"T"===s.id[0]?Be["T*"](s):"W"===s.id[0]&&Be["W*"](s),r.push(s),n+=10,n+=t}while(n<i);return r}},parseSyncSafeInteger:Ue,frameParsers:Be},Ve=Se,je=ze;(Ae=function(e){var t,n={descriptor:e&&e.descriptor},i=0,r=[],s=0;if(Ae.prototype.init.call(this),this.dispatchType=Ve.METADATA_STREAM_TYPE.toString(16),n.descriptor)for(t=0;t<n.descriptor.length;t++)this.dispatchType+=("00"+n.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,n,a,o,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(s=0,r.length=0),0===r.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(r.push(e),s+=e.data.byteLength,1===r.length&&(i=je.parseSyncSafeInteger(e.data.subarray(6,10)),i+=10),!(s<i)){for(t={data:new Uint8Array(i),frames:[],pts:r[0].pts,dts:r[0].dts},l=0;l<i;)t.data.set(r[0].data.subarray(0,i-l),l),l+=r[0].data.byteLength,s-=r[0].data.byteLength,r.shift();n=10,64&t.data[5]&&(n+=4,n+=je.parseSyncSafeInteger(t.data.subarray(10,14)),i-=je.parseSyncSafeInteger(t.data.subarray(16,20)));do{if((a=je.parseSyncSafeInteger(t.data.subarray(n+4,n+8)))<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if((o={id:String.fromCharCode(t.data[n],t.data[n+1],t.data[n+2],t.data[n+3]),data:t.data.subarray(n+10,n+a+10)}).key=o.id,je.frameParsers[o.id]?je.frameParsers[o.id](o):"T"===o.id[0]?je.frameParsers["T*"](o):"W"===o.id[0]&&je.frameParsers["W*"](o),"com.apple.streaming.transportStreamTimestamp"===o.owner){var c=o.data,u=(1&c[3])<<30|c[4]<<22|c[5]<<14|c[6]<<6|c[7]>>>2;u*=4,u+=3&c[7],o.timeStamp=u,void 0===t.pts&&void 0===t.dts&&(t.pts=o.timeStamp,t.dts=o.timeStamp),this.trigger("timestamp",o)}t.frames.push(o),n+=10,n+=a}while(n<i);this.trigger("data",t)}}}).prototype=new B;var We,He,Ge,qe=Ae,Xe=B,Ke=ke,Ye=Se,Qe=Re.TimestampRolloverStream,$e=188;(We=function(){var e=new Uint8Array($e),t=0;We.prototype.init.call(this),this.push=function(n){var i,r=0,s=$e;for(t?((i=new Uint8Array(n.byteLength+t)).set(e.subarray(0,t)),i.set(n,t),t=0):i=n;s<i.byteLength;)71!==i[r]||71!==i[s]?(r++,s++):(this.trigger("data",i.subarray(r,s)),r+=$e,s+=$e);r<i.byteLength&&(e.set(i.subarray(r),0),t=i.byteLength-r)},this.flush=function(){t===$e&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}}).prototype=new Xe,He=function(){var e,t,n,i;He.prototype.init.call(this),i=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,i){var r=0;i.payloadUnitStartIndicator&&(r+=e[r]+1),"pat"===i.type?t(e.subarray(r),i):n(e.subarray(r),i)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],i.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=i.pmtPid},n=function(e,t){var n,r;if(1&e[5]){for(i.programMapTable={video:null,audio:null,"timed-metadata":{}},n=3+((15&e[1])<<8|e[2])-4,r=12+((15&e[10])<<8|e[11]);r<n;){var s=e[r],a=(31&e[r+1])<<8|e[r+2];s===Ye.H264_STREAM_TYPE&&null===i.programMapTable.video?i.programMapTable.video=a:s===Ye.ADTS_STREAM_TYPE&&null===i.programMapTable.audio?i.programMapTable.audio=a:s===Ye.METADATA_STREAM_TYPE&&(i.programMapTable["timed-metadata"][a]=s),r+=5+((15&e[r+3])<<8|e[r+4])}t.programMapTable=i.programMapTable}},this.push=function(t){var n={},i=4;if(n.payloadUnitStartIndicator=!!(64&t[1]),n.pid=31&t[1],n.pid<<=8,n.pid|=t[2],(48&t[3])>>>4>1&&(i+=t[i]+1),0===n.pid)n.type="pat",e(t.subarray(i),n),this.trigger("data",n);else if(n.pid===this.pmtPid)for(n.type="pmt",e(t.subarray(i),n),this.trigger("data",n);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,n]):this.processPes_(t,i,n)},this.processPes_=function(e,t,n){n.pid===this.programMapTable.video?n.streamType=Ye.H264_STREAM_TYPE:n.pid===this.programMapTable.audio?n.streamType=Ye.ADTS_STREAM_TYPE:n.streamType=this.programMapTable["timed-metadata"][n.pid],n.type="pes",n.data=e.subarray(t),this.trigger("data",n)}},He.prototype=new Xe,He.STREAM_TYPES={h264:27,adts:15},Ge=function(){var e,t=this,n=!1,i={data:[],size:0},r={data:[],size:0},s={data:[],size:0},a=function(e,n,i){var r,s,a=new Uint8Array(e.size),o={type:n},l=0,c=0;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,l=0;l<e.data.length;l++)s=e.data[l],a.set(s.data,c),c+=s.data.byteLength;!function(e,t){var n;const i=e[0]<<16|e[1]<<8|e[2];t.data=new Uint8Array,1===i&&(t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=0!==(4&e[6]),192&(n=e[7])&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&n&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8]))}(a,o),r="video"===n||o.packetLength<=e.size,(i||r)&&(e.size=0,e.data.length=0),r&&t.trigger("data",o)}};Ge.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,t;switch(o.streamType){case Ye.H264_STREAM_TYPE:e=i,t="video";break;case Ye.ADTS_STREAM_TYPE:e=r,t="audio";break;case Ye.METADATA_STREAM_TYPE:e=s,t="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&a(e,t,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var i={type:"metadata",tracks:[]};null!==(e=o.programMapTable).video&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),n=!0,t.trigger("data",i)}})[o.type]()},this.reset=function(){i.size=0,i.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){a(i,"video"),a(r,"audio"),a(s,"timed-metadata")},this.flush=function(){if(!n&&e){var i={type:"metadata",tracks:[]};null!==e.video&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),t.trigger("data",i)}n=!1,this.flushStreams_(),this.trigger("done")}},Ge.prototype=new Xe;var Je={PAT_PID:0,MP2T_PACKET_LENGTH:$e,TransportPacketStream:We,TransportParseStream:He,ElementaryStream:Ge,TimestampRolloverStream:Qe,CaptionStream:Ke.CaptionStream,Cea608Stream:Ke.Cea608Stream,Cea708Stream:Ke.Cea708Stream,MetadataStream:qe};for(var Ze in Ye)Ye.hasOwnProperty(Ze)&&(Je[Ze]=Ye[Ze]);var et,tt=Je,nt=re.ONE_SECOND_IN_TS,it=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(et=function(e){var t,n=0;et.prototype.init.call(this),this.skipWarn_=function(e,t){this.trigger("log",{level:"warn",message:"adts skiping bytes ".concat(e," to ").concat(t," in frame ").concat(n," outside syncword")})},this.push=function(i){var r,s,a,o,l,c=0;if(e||(n=0),"audio"===i.type){var u;for(t&&t.length?(a=t,(t=new Uint8Array(a.byteLength+i.data.byteLength)).set(a),t.set(i.data,a.byteLength)):t=i.data;c+7<t.length;)if(255===t[c]&&240===(246&t[c+1])){if("number"===typeof u&&(this.skipWarn_(u,c),u=null),s=2*(1&~t[c+1]),r=(3&t[c+3])<<11|t[c+4]<<3|(224&t[c+5])>>5,l=(o=1024*(1+(3&t[c+6])))*nt/it[(60&t[c+2])>>>2],t.byteLength-c<r)break;this.trigger("data",{pts:i.pts+n*l,dts:i.dts+n*l,sampleCount:o,audioobjecttype:1+(t[c+2]>>>6&3),channelcount:(1&t[c+2])<<2|(192&t[c+3])>>>6,samplerate:it[(60&t[c+2])>>>2],samplingfrequencyindex:(60&t[c+2])>>>2,samplesize:16,data:t.subarray(c+7+s,c+r)}),n++,c+=r}else"number"!==typeof u&&(u=c),c++;"number"===typeof u&&(this.skipWarn_(u,c),u=null),t=t.subarray(c)}},this.flush=function(){n=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}}).prototype=new B;var rt,st,at,ot=et,lt=B,ct=function(e){var t=e.byteLength,n=0,i=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+i},this.loadWord=function(){var r=e.byteLength-t,s=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");s.set(e.subarray(r,r+a)),n=new DataView(s.buffer).getUint32(0),i=8*a,t-=a},this.skipBits=function(e){var r;i>e?(n<<=e,i-=e):(e-=i,e-=8*(r=Math.floor(e/8)),t-=r,this.loadWord(),n<<=e,i-=e)},this.readBits=function(e){var r=Math.min(i,e),s=n>>>32-r;return(i-=r)>0?n<<=r:t>0&&this.loadWord(),(r=e-r)>0?s<<r|this.readBits(r):s},this.skipLeadingZeros=function(){var e;for(e=0;e<i;++e)if(0!==(n&2147483648>>>e))return n<<=e,i-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(st=function(){var e,t,n=0;st.prototype.init.call(this),this.push=function(i){var r;t?((r=new Uint8Array(t.byteLength+i.data.byteLength)).set(t),r.set(i.data,t.byteLength),t=r):t=i.data;for(var s=t.byteLength;n<s-3;n++)if(1===t[n+2]){e=n+5;break}for(;e<s;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}n+3!==e-2&&this.trigger("data",t.subarray(n+3,e-2));do{e++}while(1!==t[e]&&e<s);n=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(n+3,e-2)),n=e-2,e+=3;break;default:e+=3}t=t.subarray(n),e-=n,n=0},this.reset=function(){t=null,n=0,this.trigger("reset")},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(n+3)),t=null,n=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new lt,at={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},rt=function(){var e,t,n,i,r,s,a,o=new st;rt.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,n=e.pts,i=e.dts,o.push(e))},o.on("data",function(a){var o={trackId:t,pts:n,dts:i,data:a,nalUnitTypeCode:31&a[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=r(a.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=r(a.subarray(1)),o.config=s(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)}),o.on("done",function(){e.trigger("done")}),o.on("partialdone",function(){e.trigger("partialdone")}),o.on("reset",function(){e.trigger("reset")}),o.on("endedtimeline",function(){e.trigger("endedtimeline")}),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},a=function(e,t){var n,i=8,r=8;for(n=0;n<e;n++)0!==r&&(r=(i+t.readExpGolomb()+256)%256),i=0===r?i:r},r=function(e){for(var t,n,i=e.byteLength,r=[],s=1;s<i-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),n[s]=e[a];return n},s=function(e){var t,n,i,r,s,o,l,c,u,h,d,p,f=0,g=0,m=0,y=0,b=[1,1];if(n=(t=new ct(e)).readUnsignedByte(),r=t.readUnsignedByte(),i=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),at[n]&&(3===(s=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(d=3!==s?8:12,p=0;p<d;p++)t.readBoolean()&&a(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),c=t.readUnsignedExpGolomb(),u=t.readUnsignedExpGolomb(),0===(h=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(f=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),m=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}b&&(b[0],b[1])}return{profileIdc:n,levelIdc:i,profileCompatibility:r,width:16*(c+1)-2*f-2*g,height:(2-h)*(u+1)*16-2*m-2*y,sarRatio:b}}},rt.prototype=new lt;var ut,ht={H264Stream:rt,NalByteStream:st},dt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],pt=function(e,t){var n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return n=n>=0?n:0,(16&e[t+5])>>4?n+20:n+10},ft=function(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=pt(e,t),ft(e,t))},gt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},mt=function(e,t,n){return unescape(function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r}(e,t,n))},yt={isLikelyAacData:function(e){var t=ft(e,0);return e.length>=t+2&&255===(255&e[t])&&240===(240&e[t+1])&&16===(22&e[t+1])},parseId3TagSize:pt,parseAdtsSize:function(e,t){var n=(224&e[t+5])>>5,i=e[t+4]<<3;return 6144&e[t+3]|i|n},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&240===(240&e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240===(246&e[t+1]))return dt[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,n,i;t=10,64&e[5]&&(t+=4,t+=gt(e.subarray(10,14)));do{if((n=gt(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){i=e.subarray(t+10,t+n+10);for(var r=0;r<i.byteLength;r++)if(0===i[r]){if("com.apple.streaming.transportStreamTimestamp"===mt(i,0,r)){var s=i.subarray(r+1),a=(1&s[3])<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2;return a*=4,a+=3&s[7]}break}}t+=10,t+=n}while(t<e.byteLength);return null}},bt=yt;(ut=function(){var e=new Uint8Array,t=0;ut.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(n){var i,r,s,a,o=0,l=0;for(e.length?(a=e.length,(e=new Uint8Array(n.byteLength+a)).set(e.subarray(0,a)),e.set(n,a)):e=n;e.length-l>=3;)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255!==(255&e[l])||240!==(240&e[l+1]))l++;else{if(e.length-l<7)break;if(l+(o=bt.parseAdtsSize(e,l))>e.length)break;s={type:"audio",data:e.subarray(l,l+o),pts:t,dts:t},this.trigger("data",s),l+=o}else{if(e.length-l<10)break;if(l+(o=bt.parseId3TagSize(e,l))>e.length)break;r={type:"timed-metadata",data:e.subarray(l,l+o)},this.trigger("data",r),l+=o}i=e.length-l,e=i>0?e.subarray(l):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new B;var vt,_t,xt,wt,Tt=B,kt=$,St=Z,Ct=oe,It=ce,Et=tt,Nt=re,At=ot,Rt=ht.H264Stream,Dt=ut,Ot=yt.isLikelyAacData,Lt=re.ONE_SECOND_IN_TS,Pt=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Ft=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Mt=function(e,t){t.stream=e,this.trigger("log",t)},Ut=function(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];"headOfPipeline"!==r&&t[r].on&&t[r].on("log",Mt.bind(e,r))}},Bt=function(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},zt=function(e,t,n,i,r,s){return{start:{dts:e,pts:e+(n-t)},end:{dts:e+(i-t),pts:e+(r-n)},prependedContentDuration:s,baseMediaDecodeTime:e}};_t=function(e,t){var n,i=[],r=0,s=0,a=1/0;n=(t=t||{}).firstSequenceNumber||0,_t.prototype.init.call(this),this.push=function(t){It.collectDtsInfo(e,t),e&&Pt.forEach(function(n){e[n]=t[n]}),i.push(t)},this.setEarliestDts=function(e){r=e},this.setVideoBaseMediaDecodeTime=function(e){a=e},this.setAudioAppendStart=function(e){s=e},this.flush=function(){var o,l,c,u,h,d,p;0!==i.length?(o=Ct.trimAdtsFramesByEarliestDts(i,e,r),e.baseMediaDecodeTime=It.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),p=Ct.prefixWithSilence(e,o,s,a),e.samples=Ct.generateSampleTable(o),c=kt.mdat(Ct.concatenateFrameData(o)),i=[],l=kt.moof(n,[e]),u=new Uint8Array(l.byteLength+c.byteLength),n++,u.set(l),u.set(c,l.byteLength),It.clearDtsInfo(e),h=Math.ceil(1024*Lt/e.samplerate),o.length&&(d=o.length*h,this.trigger("segmentTimingInfo",zt(Nt.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),o[0].dts,o[0].pts,o[0].dts+d,o[0].pts+d,p||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+d})),this.trigger("data",{track:e,boxes:u}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){It.clearDtsInfo(e),i=[],this.trigger("reset")}},_t.prototype=new Tt,vt=function(e,t){var n,i,r,s=[],a=[];n=(t=t||{}).firstSequenceNumber||0,vt.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){It.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.config,e.sps=[t.data],Ft.forEach(function(t){e[t]=i[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),s.push(t)},this.flush=function(){for(var i,r,o,l,c,u,h,d,p=0;s.length&&"access_unit_delimiter_rbsp"!==s[0].nalUnitType;)s.shift();if(0===s.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(i=St.groupNalsIntoFrames(s),(o=St.groupFramesIntoGops(i))[0][0].keyFrame||((r=this.getGopForFusion_(s[0],e))?(p=r.duration,o.unshift(r),o.byteLength+=r.byteLength,o.nalCount+=r.nalCount,o.pts=r.pts,o.dts=r.dts,o.duration+=r.duration):o=St.extendFirstKeyFrame(o)),a.length){var f;if(!(f=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");It.clearDtsInfo(e),o=f}It.collectDtsInfo(e,o),e.samples=St.generateSampleTable(o),c=kt.mdat(St.concatenateNalData(o)),e.baseMediaDecodeTime=It.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),h=o[0],d=o[o.length-1],this.trigger("segmentTimingInfo",zt(e.baseMediaDecodeTime,h.dts,h.pts,d.dts+d.duration,d.pts+d.duration,p)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=kt.moof(n,[e]),u=new Uint8Array(l.byteLength+c.byteLength),n++,u.set(l),u.set(c,l.byteLength),this.trigger("data",{track:e,boxes:u}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),s=[],this.gopCache_.length=0,a.length=0,this.trigger("reset")},this.resetStream_=function(){It.clearDtsInfo(e),i=void 0,r=void 0},this.getGopForFusion_=function(t){var n,i,r,s,a,o=1/0;for(a=0;a<this.gopCache_.length;a++)r=(s=this.gopCache_[a]).gop,e.pps&&Bt(e.pps[0],s.pps[0])&&e.sps&&Bt(e.sps[0],s.sps[0])&&(r.dts<e.timelineStartInfo.dts||(n=t.dts-r.dts-r.duration)>=-1e4&&n<=45e3&&(!i||o>n)&&(i=s,o=n));return i?i.gop:null},this.alignGopsAtStart_=function(e){var t,n,i,r,s,o,l,c;for(s=e.byteLength,o=e.nalCount,l=e.duration,t=n=0;t<a.length&&n<e.length&&(i=a[t],r=e[n],i.pts!==r.pts);)r.pts>i.pts?t++:(n++,s-=r.byteLength,o-=r.nalCount,l-=r.duration);return 0===n?e:n===e.length?null:((c=e.slice(n)).byteLength=s,c.duration=l,c.nalCount=o,c.pts=c[0].pts,c.dts=c[0].dts,c)},this.alignGopsAtEnd_=function(e){var t,n,i,r,s,o,l;for(t=a.length-1,n=e.length-1,s=null,o=!1;t>=0&&n>=0;){if(i=a[t],r=e[n],i.pts===r.pts){o=!0;break}i.pts>r.pts?t--:(t===a.length-1&&(s=n),n--)}if(!o&&null===s)return null;if(0===(l=o?n:s))return e;var c=e.slice(l),u=c.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return c.byteLength=u.byteLength,c.duration=u.duration,c.nalCount=u.nalCount,c.pts=c[0].pts,c.dts=c[0].dts,c},this.alignGopsWith=function(e){a=e}},vt.prototype=new Tt,wt=function(e,t){this.numberOfTracks=0,this.metadataStream=t,"undefined"!==typeof(e=e||{}).remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,"boolean"===typeof e.keepOriginalTimestamps?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,wt.prototype.init.call(this),this.push=function(e){return e.content||e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),void("audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes))))}},wt.prototype=new Tt,wt.prototype.flush=function(e){var t,n,i,r,s=0,a={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,Ft.forEach(function(e){a.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Pt.forEach(function(e){a.info[e]=this.audioTrack[e]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?a.type=this.pendingTracks[0].type:a.type="combined",this.emittedTracks+=this.pendingTracks.length,i=kt.initSegment(this.pendingTracks),a.initSegment=new Uint8Array(i.byteLength),a.initSegment.set(i),a.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)a.data.set(this.pendingBoxes[r],s),s+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(t=this.pendingCaptions[r]).startTime=Nt.metadataTsToSeconds(t.startPts,o,this.keepOriginalTimestamps),t.endTime=Nt.metadataTsToSeconds(t.endPts,o,this.keepOriginalTimestamps),a.captionStreams[t.stream]=!0,a.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)(n=this.pendingMetadata[r]).cueTime=Nt.metadataTsToSeconds(n.pts,o,this.keepOriginalTimestamps),a.metadata.push(n);for(a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),r=0;r<a.captions.length;r++)t=a.captions[r],this.trigger("caption",t);for(r=0;r<a.metadata.length;r++)n=a.metadata[r],this.trigger("id3Frame",n)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},wt.prototype.setRemux=function(e){this.remuxTracks=e},(xt=function(e){var t,n,i=this,r=!0;xt.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="aac",r.metadataStream=new Et.MetadataStream,r.aacStream=new Dt,r.audioTimestampRolloverStream=new Et.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new Et.TimestampRolloverStream("timed-metadata"),r.adtsStream=new At,r.coalesceStream=new wt(e,r.metadataStream),r.headOfPipeline=r.aacStream,r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.metadataStream.on("timestamp",function(e){r.aacStream.setTimestamp(e.timeStamp)}),r.aacStream.on("data",function(s){"timed-metadata"!==s.type&&"audio"!==s.type||r.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:i.baseMediaDecodeTime},codec:"adts",type:"audio"},r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new _t(n,e),r.audioSegmentStream.on("log",i.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",i.trigger.bind(i,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream),i.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t}))}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),Ut(this,r)},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new Et.MetadataStream,r.packetStream=new Et.TransportPacketStream,r.parseStream=new Et.TransportParseStream,r.elementaryStream=new Et.ElementaryStream,r.timestampRolloverStream=new Et.TimestampRolloverStream,r.adtsStream=new At,r.h264Stream=new Rt,r.captionStream=new Et.CaptionStream(e),r.coalesceStream=new wt(e,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(s){var a;if("metadata"===s.type){for(a=s.tracks.length;a--;)t||"video"!==s.tracks[a].type?n||"audio"!==s.tracks[a].type||((n=s.tracks[a]).timelineStartInfo.baseMediaDecodeTime=i.baseMediaDecodeTime):(t=s.tracks[a]).timelineStartInfo.baseMediaDecodeTime=i.baseMediaDecodeTime;t&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new vt(t,e),r.videoSegmentStream.on("log",i.getLogTrigger_("videoSegmentStream")),r.videoSegmentStream.on("timelineStartInfo",function(t){n&&!e.keepOriginalTimestamps&&(n.timelineStartInfo=t,r.audioSegmentStream.setEarliestDts(t.dts-i.baseMediaDecodeTime))}),r.videoSegmentStream.on("processedGopsInfo",i.trigger.bind(i,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",i.trigger.bind(i,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(e){n&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),r.videoSegmentStream.on("timingInfo",i.trigger.bind(i,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),n&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new _t(n,e),r.audioSegmentStream.on("log",i.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",i.trigger.bind(i,"audioTimingInfo")),r.audioSegmentStream.on("segmentTimingInfo",i.trigger.bind(i,"audioSegmentTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),i.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t})}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",function(e){e.dispatchType=r.metadataStream.dispatchType,i.trigger("id3Frame",e)}),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),Ut(this,r)},this.setBaseMediaDecodeTime=function(i){var r=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=i),n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,It.clearDtsInfo(n),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[]),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,It.clearDtsInfo(t),r.captionStream.reset()),r.timestampRolloverStream&&r.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var n=this.transmuxPipeline_;e.remux=t,n&&n.coalesceStream&&n.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.getLogTrigger_=function(e){var t=this;return function(n){n.stream=e,t.trigger("log",n)}},this.push=function(e){if(r){var t=Ot(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new Tt;var Vt,jt,Wt={Transmuxer:xt,VideoSegmentStream:vt,AudioSegmentStream:_t,AUDIO_PROPERTIES:Pt,VIDEO_PROPERTIES:Ft,generateSegmentTimingInfo:zt},Ht=function(e){return e>>>0},Gt=function(e){return("00"+e.toString(16)).slice(-2)},qt=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},Xt=Ht,Kt=qt,Yt=function(e,t){var n,i,r,s,a,o=[];if(!t.length)return null;for(n=0;n<e.byteLength;)i=Xt(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),r=Kt(e.subarray(n+4,n+8)),s=i>1?n+i:e.byteLength,r===t[0]&&(1===t.length?o.push(e.subarray(n+8,s)):(a=Yt(e.subarray(n+8,s),t.slice(1))).length&&(o=o.concat(a))),n=s;return o},Qt=Yt,$t=Ht,Jt=V.getUint64,Zt=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return 1===t.version?t.baseMediaDecodeTime=Jt(e.subarray(4)):t.baseMediaDecodeTime=$t(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},en=function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:n.getUint32(4)},r=1&i.flags[2],s=2&i.flags[2],a=8&i.flags[2],o=16&i.flags[2],l=32&i.flags[2],c=65536&i.flags[0],u=131072&i.flags[0];return t=8,r&&(t+=4,i.baseDataOffset=n.getUint32(12),t+=4),s&&(i.sampleDescriptionIndex=n.getUint32(t),t+=4),a&&(i.defaultSampleDuration=n.getUint32(t),t+=4),o&&(i.defaultSampleSize=n.getUint32(t),t+=4),l&&(i.defaultSampleFlags=n.getUint32(t)),c&&(i.durationIsEmpty=!0),!r&&u&&(i.baseDataOffsetIsMoof=!0),i},tn=V.getUint64,nn=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},rn=function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=1&n.flags[2],s=4&n.flags[2],a=1&n.flags[1],o=2&n.flags[1],l=4&n.flags[1],c=8&n.flags[1],u=i.getUint32(4),h=8;for(r&&(n.dataOffset=i.getInt32(h),h+=4),s&&u&&(t={flags:nn(e.subarray(h,h+4))},h+=4,a&&(t.duration=i.getUint32(h),h+=4),o&&(t.size=i.getUint32(h),h+=4),c&&(1===n.version?t.compositionTimeOffset=i.getInt32(h):t.compositionTimeOffset=i.getUint32(h),h+=4),n.samples.push(t),u--);u--;)t={},a&&(t.duration=i.getUint32(h),h+=4),o&&(t.size=i.getUint32(h),h+=4),l&&(t.flags=nn(e.subarray(h,h+4)),h+=4),c&&(1===n.version?t.compositionTimeOffset=i.getInt32(h):t.compositionTimeOffset=i.getUint32(h),h+=4),n.samples.push(t);return n},sn=V.getUint64,an=function(e){return new Date(1e3*e-20828448e5)},on=qt,ln=function(e){var t,n,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[];for(t=0;t+4<e.length;t+=n)if(n=i.getUint32(t),t+=4,n<=0)r.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&e[t]){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+e[t]&31)}return r},cn={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:Vt(e.subarray(78,e.byteLength))}},avcC:function(e){var t,n,i,r,s=new DataView(e.buffer,e.byteOffset,e.byteLength),a={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:3&e[4],sps:[],pps:[]},o=31&e[5];for(i=6,r=0;r<o;r++)n=s.getUint16(i),i+=2,a.sps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;for(t=e[i],i++,r=0;r<t;r++)n=s.getUint16(i),i+=2,a.pps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;return a},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},edts:function(e){return{boxes:Vt(e)}},elst:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),edits:[]},r=n.getUint32(4);for(t=8;r;r--)0===i.version?(i.edits.push({segmentDuration:n.getUint32(t),mediaTime:n.getInt32(t+4),mediaRate:n.getUint16(t+8)+n.getUint16(t+10)/65536}),t+=12):(i.edits.push({segmentDuration:sn(e.subarray(t)),mediaTime:sn(e.subarray(t+8)),mediaRate:n.getUint16(t+16)+n.getUint16(t+18)/65536}),t+=20);return i},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:31&e[8],decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(7&e[26])<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={majorBrand:on(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},i=8;i<e.byteLength;)n.compatibleBrands.push(on(e.subarray(i,i+4))),i+=4;return n},dinf:function(e){return{boxes:Vt(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:Vt(e.subarray(8))}},hdlr:function(e){var t={version:new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:on(e.subarray(8,12)),name:""},n=8;for(n=24;n<e.byteLength;n++){if(0===e[n]){n++;break}t.name+=String.fromCharCode(e[n])}return t.name=decodeURIComponent(escape(t.name)),t},mdat:function(e){return{byteLength:e.byteLength,nals:ln(e)}},mdhd:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return 1===r.version?(i+=4,r.creationTime=an(n.getUint32(i)),i+=8,r.modificationTime=an(n.getUint32(i)),i+=4,r.timescale=n.getUint32(i),i+=8,r.duration=n.getUint32(i)):(r.creationTime=an(n.getUint32(i)),i+=4,r.modificationTime=an(n.getUint32(i)),i+=4,r.timescale=n.getUint32(i),i+=4,r.duration=n.getUint32(i)),i+=4,t=n.getUint16(i),r.language+=String.fromCharCode(96+(t>>10)),r.language+=String.fromCharCode(96+((992&t)>>5)),r.language+=String.fromCharCode(96+(31&t)),r},mdia:function(e){return{boxes:Vt(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:Vt(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(n.streamDescriptor=Vt(e.subarray(28))[0]),n},moof:function(e){return{boxes:Vt(e)}},moov:function(e){return{boxes:Vt(e)}},mvex:function(e){return{boxes:Vt(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(n+=4,i.creationTime=an(t.getUint32(n)),n+=8,i.modificationTime=an(t.getUint32(n)),n+=4,i.timescale=t.getUint32(n),n+=8,i.duration=t.getUint32(n)):(i.creationTime=an(t.getUint32(n)),n+=4,i.modificationTime=an(t.getUint32(n)),n+=4,i.timescale=t.getUint32(n),n+=4,i.duration=t.getUint32(n)),n+=4,i.rate=t.getUint16(n)+t.getUint16(n+2)/16,n+=4,i.volume=t.getUint8(n)+t.getUint8(n+1)/8,n+=2,n+=2,n+=8,i.matrix=new Uint32Array(e.subarray(n,n+36)),n+=36,n+=24,i.nextTrackId=t.getUint32(n),i},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]};for(t=4;t<e.byteLength;t++)n.samples.push({dependsOn:(48&e[t])>>4,isDependedOn:(12&e[t])>>2,hasRedundancy:3&e[t]});return n},sidx:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},i=12;0===n.version?(n.earliestPresentationTime=t.getUint32(i),n.firstOffset=t.getUint32(i+4),i+=8):(n.earliestPresentationTime=tn(e.subarray(i)),n.firstOffset=tn(e.subarray(i+8)),i+=16),i+=2;var r=t.getUint16(i);for(i+=2;r>0;i+=12,r--)n.references.push({referenceType:(128&e[i])>>>7,referencedSize:2147483647&t.getUint32(i),subsegmentDuration:t.getUint32(i+4),startsWithSap:!!(128&e[i+8]),sapType:(112&e[i+8])>>>4,sapDeltaTime:268435455&t.getUint32(i+8)});return n},smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:Vt(e)}},ctts:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),compositionOffsets:[]},r=n.getUint32(4);for(t=8;r;t+=8,r--)i.compositionOffsets.push({sampleCount:n.getUint32(t),sampleOffset:n[0===i.version?"getUint32":"getInt32"](t+4)});return i},stss:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),syncSamples:[]},r=n.getUint32(4);for(t=8;r;t+=4,r--)i.syncSamples.push(n.getUint32(t));return i},stco:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},r=n.getUint32(4);for(t=8;r;t+=4,r--)i.chunkOffsets.push(n.getUint32(t));return i},stsc:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=n.getUint32(4),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]};for(t=8;i;t+=12,i--)r.sampleToChunks.push({firstChunk:n.getUint32(t),samplesPerChunk:n.getUint32(t+4),sampleDescriptionIndex:n.getUint32(t+8)});return r},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:Vt(e.subarray(8))}},stsz:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:n.getUint32(4),entries:[]};for(t=12;t<e.byteLength;t+=4)i.entries.push(n.getUint32(t));return i},stts:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},r=n.getUint32(4);for(t=8;r;t+=8,r--)i.timeToSamples.push({sampleCount:n.getUint32(t),sampleDelta:n.getUint32(t+4)});return i},styp:function(e){return cn.ftyp(e)},tfdt:Zt,tfhd:en,tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(n+=4,i.creationTime=an(t.getUint32(n)),n+=8,i.modificationTime=an(t.getUint32(n)),n+=4,i.trackId=t.getUint32(n),n+=4,n+=8,i.duration=t.getUint32(n)):(i.creationTime=an(t.getUint32(n)),n+=4,i.modificationTime=an(t.getUint32(n)),n+=4,i.trackId=t.getUint32(n),n+=4,n+=4,i.duration=t.getUint32(n)),n+=4,n+=8,i.layer=t.getUint16(n),n+=2,i.alternateGroup=t.getUint16(n),n+=2,i.volume=t.getUint8(n)+t.getUint8(n+1)/8,n+=2,n+=2,i.matrix=new Uint32Array(e.subarray(n,n+36)),n+=36,i.width=t.getUint16(n)+t.getUint16(n+2)/65536,n+=4,i.height=t.getUint16(n)+t.getUint16(n+2)/65536,i},traf:function(e){return{boxes:Vt(e)}},trak:function(e){return{boxes:Vt(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:3&e[20],sampleIsDependedOn:(192&e[21])>>6,sampleHasRedundancy:(48&e[21])>>4,samplePaddingValue:(14&e[21])>>1,sampleIsDifferenceSample:!!(1&e[21]),sampleDegradationPriority:t.getUint16(22)}},trun:rn,"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};Vt=function(e){for(var t,n,i,r,s,a=0,o=[],l=new ArrayBuffer(e.length),c=new Uint8Array(l),u=0;u<e.length;++u)c[u]=e[u];for(t=new DataView(l);a<e.byteLength;)n=t.getUint32(a),i=on(e.subarray(a+4,a+8)),r=n>1?a+n:e.byteLength,(s=(cn[i]||function(e){return{data:e}})(e.subarray(a+8,r))).size=n,s.type=i,o.push(s),a=r;return o},jt=function(e,t){var n;return t=t||0,n=new Array(2*t+1).join(" "),e.map(function(e,i){return n+e.type+"\n"+Object.keys(e).filter(function(e){return"type"!==e&&"boxes"!==e}).map(function(t){var i=n+"  "+t+": ",r=e[t];if(r instanceof Uint8Array||r instanceof Uint32Array){var s=Array.prototype.slice.call(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).map(function(e){return" "+("00"+e.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return s?1===s.length?i+"<"+s.join("").slice(1)+">":i+"<\n"+s.map(function(e){return n+"  "+e}).join("\n")+"\n"+n+"  >":i+"<>"}return i+JSON.stringify(r,null,2).split("\n").map(function(e,t){return 0===t?e:n+"  "+e}).join("\n")}).join("\n")+(e.boxes?"\n"+jt(e.boxes,t+1):"")}).join("\n")};var un,hn,dn,pn,fn,gn,mn,yn={inspect:Vt,textify:jt,parseType:on,findBox:Qt,parseTraf:cn.traf,parseTfdt:cn.tfdt,parseHdlr:cn.hdlr,parseTfhd:cn.tfhd,parseTrun:cn.trun,parseSidx:cn.sidx},bn=function(e){for(var t=0,n=String.fromCharCode(e[t]),i="";"\0"!==n;)i+=n,t++,n=String.fromCharCode(e[t]);return i+=n},vn=V.getUint64,_n=function(e,t){var n="\0"!==t.scheme_id_uri,i=0===e&&xn(t.presentation_time_delta)&&n,r=1===e&&xn(t.presentation_time)&&n;return!(e>1)&&i||r},xn=function(e){return void 0!==e||null!==e},wn={parseEmsgBox:function(e){var t,n,i,r,s,a,o,l=4,c=e[0];if(0===c)l+=(t=bn(e.subarray(l))).length,l+=(n=bn(e.subarray(l))).length,i=(u=new DataView(e.buffer)).getUint32(l),l+=4,s=u.getUint32(l),l+=4,a=u.getUint32(l),l+=4,o=u.getUint32(l),l+=4;else if(1===c){var u;i=(u=new DataView(e.buffer)).getUint32(l),l+=4,r=vn(e.subarray(l)),l+=8,a=u.getUint32(l),l+=4,o=u.getUint32(l),l+=4,l+=(t=bn(e.subarray(l))).length,l+=(n=bn(e.subarray(l))).length}var h={scheme_id_uri:t,value:n,timescale:i||1,presentation_time:r,presentation_time_delta:s,event_duration:a,id:o,message_data:new Uint8Array(e.subarray(l,e.byteLength))};return _n(c,h)?h:void 0},scaleTime:function(e,t,n,i){return e||0===e?e/t:i+n/t}},Tn="undefined"!==typeof window?window:"undefined"!==typeof e?e:"undefined"!==typeof self?self:{},kn=Ht,Sn=Gt,Cn=Qt,In=qt,En=wn,Nn=en,An=rn,Rn=Zt,Dn=V.getUint64,On=Tn,Ln=ze.parseId3Frames;un=function(e){return Cn(e,["moov","trak"]).reduce(function(e,t){var n,i,r,s,a;return(n=Cn(t,["tkhd"])[0])?(i=n[0],s=kn(n[r=0===i?12:20]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3]),(a=Cn(t,["mdia","mdhd"])[0])?(r=0===(i=a[0])?12:20,e[s]=kn(a[r]<<24|a[r+1]<<16|a[r+2]<<8|a[r+3]),e):null):null},{})},hn=function(e,t){var n=Cn(t,["moof","traf"]).reduce(function(t,n){var i,r=Cn(n,["tfhd"])[0],s=kn(r[4]<<24|r[5]<<16|r[6]<<8|r[7]),a=e[s]||9e4,o=Cn(n,["tfdt"])[0],l=new DataView(o.buffer,o.byteOffset,o.byteLength);let c;return"bigint"===typeof(i=1===o[0]?Dn(o.subarray(4,12)):l.getUint32(4))?c=i/On.BigInt(a):"number"!==typeof i||isNaN(i)||(c=i/a),c<Number.MAX_SAFE_INTEGER&&(c=Number(c)),c<t&&(t=c),t},1/0);return"bigint"===typeof n||isFinite(n)?n:0},dn=function(e,t){var n,i=Cn(t,["moof","traf"]),r=0,s=0;if(i&&i.length){var a=Cn(i[0],["tfhd"])[0],o=Cn(i[0],["trun"])[0],l=Cn(i[0],["tfdt"])[0];if(a)n=Nn(a).trackId;if(l)r=Rn(l).baseMediaDecodeTime;if(o){var c=An(o);c.samples&&c.samples.length&&(s=c.samples[0].compositionTimeOffset||0)}}var u=e[n]||9e4;"bigint"===typeof r&&(s=On.BigInt(s),u=On.BigInt(u));var h=(r+s)/u;return"bigint"===typeof h&&h<Number.MAX_SAFE_INTEGER&&(h=Number(h)),h},pn=function(e){var t=Cn(e,["moov","trak"]),n=[];return t.forEach(function(e){var t=Cn(e,["mdia","hdlr"]),i=Cn(e,["tkhd"]);t.forEach(function(e,t){var r,s,a=In(e.subarray(8,12)),o=i[t];"vide"===a&&(s=0===(r=new DataView(o.buffer,o.byteOffset,o.byteLength)).getUint8(0)?r.getUint32(12):r.getUint32(20),n.push(s))})}),n},gn=function(e){var t=0===e[0]?12:20;return kn(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])},fn=function(e){var t=Cn(e,["moov","trak"]),n=[];return t.forEach(function(e){var t,i,r={},s=Cn(e,["tkhd"])[0];s&&(i=(t=new DataView(s.buffer,s.byteOffset,s.byteLength)).getUint8(0),r.id=0===i?t.getUint32(12):t.getUint32(20));var a=Cn(e,["mdia","hdlr"])[0];if(a){var o=In(a.subarray(8,12));r.type="vide"===o?"video":"soun"===o?"audio":o}var l=Cn(e,["mdia","minf","stbl","stsd"])[0];if(l){var c=l.subarray(8);r.codec=In(c.subarray(4,8));var u,h=Cn(c,[r.codec])[0];h&&(/^[asm]vc[1-9]$/i.test(r.codec)?(u=h.subarray(78),"avcC"===In(u.subarray(4,8))&&u.length>11?(r.codec+=".",r.codec+=Sn(u[9]),r.codec+=Sn(u[10]),r.codec+=Sn(u[11])):r.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(r.codec)?(u=h.subarray(28),"esds"===In(u.subarray(4,8))&&u.length>20&&0!==u[19]?(r.codec+="."+Sn(u[19]),r.codec+="."+Sn(u[20]>>>2&63).replace(/^0/,"")):r.codec="mp4a.40.2"):r.codec=r.codec.toLowerCase())}var d=Cn(e,["mdia","mdhd"])[0];d&&(r.timescale=gn(d)),n.push(r)}),n},mn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Cn(e,["emsg"]).map(e=>{var n=En.parseEmsgBox(new Uint8Array(e)),i=Ln(n.message_data);return{cueTime:En.scaleTime(n.presentation_time,n.timescale,n.presentation_time_delta,t),duration:En.scaleTime(n.event_duration,n.timescale),frames:i}})};var Pn={findBox:Cn,parseType:In,timescale:un,startTime:hn,compositionStartTime:dn,videoTrackIds:pn,tracks:fn,getTimescaleFromMediaHeader:gn,getEmsgID3:mn};const{parseTrun:Fn}=yn,{findBox:Mn}=Pn;var Un=Tn,Bn={getMdatTrafPairs:function(e){var t=Mn(e,["moof","traf"]),n=Mn(e,["mdat"]),i=[];return n.forEach(function(e,n){var r=t[n];i.push({mdat:e,traf:r})}),i},parseSamples:function(e,t,n){var i=t,r=n.defaultSampleDuration||0,s=n.defaultSampleSize||0,a=n.trackId,o=[];return e.forEach(function(e){var t=Fn(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=r),void 0===e.size&&(e.size=s),e.trackId=a,e.dts=i,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),"bigint"===typeof i?(e.pts=i+Un.BigInt(e.compositionTimeOffset),i+=Un.BigInt(e.duration)):(e.pts=i+e.compositionTimeOffset,i+=e.duration)}),o=o.concat(t)}),o}},zn=ue.discardEmulationPreventionBytes,Vn=ke.CaptionStream,jn=Qt,Wn=Zt,Hn=en,{getMdatTrafPairs:Gn,parseSamples:qn}=Bn,Xn=function(e,t){for(var n=e,i=0;i<t.length;i++){var r=t[i];if(n<r.size)return r;n-=r.size}return null},Kn=function(e,t){var n={};return Gn(e).forEach(function(e){var i,r=e.mdat,s=e.traf,a=jn(s,["tfhd"]),o=Hn(a[0]),l=o.trackId,c=jn(s,["tfdt"]),u=c.length>0?Wn(c[0]).baseMediaDecodeTime:0,h=jn(s,["trun"]);t===l&&h.length>0&&(i=function(e,t,n){var i,r,s,a,o=new DataView(e.buffer,e.byteOffset,e.byteLength),l={logs:[],seiNals:[]};for(r=0;r+4<e.length;r+=s)if(s=o.getUint32(r),r+=4,!(s<=0))switch(31&e[r]){case 6:var c=e.subarray(r+1,r+1+s),u=Xn(r,t);if(i={nalUnitType:"sei_rbsp",size:s,data:c,escapedRBSP:zn(c),trackId:n},u)i.pts=u.pts,i.dts=u.dts,a=u;else{if(!a){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+r+" for trackId "+n+". See mux.js#223."});break}i.pts=a.pts,i.dts=a.dts}l.seiNals.push(i)}return l}(r,qn(h,u,o),l),n[l]||(n[l]={seiNals:[],logs:[]}),n[l].seiNals=n[l].seiNals.concat(i.seiNals),n[l].logs=n[l].logs.concat(i.logs))}),n},Yn=function(){var e,t,n,i,r,s,a=!1;this.isInitialized=function(){return a},this.init=function(t){e=new Vn,a=!0,s=!!t&&t.isPartial,e.on("data",function(e){e.startTime=e.startPts/i,e.endTime=e.endPts/i,r.captions.push(e),r.captionStreams[e.stream]=!0}),e.on("log",function(e){r.logs.push(e)})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"===typeof t&&0===Object.keys(t).length)&&(n!==e[0]||i!==t[n])},this.parse=function(e,s,a){var o;if(!this.isInitialized())return null;if(!s||!a)return null;if(this.isNewInit(s,a))n=s[0],i=a[n];else if(null===n||!i)return t.push(e),null;for(;t.length>0;){var l=t.shift();this.parse(l,s,a)}return o=function(e,t,n){if(null===t)return null;var i=Kn(e,t)[t]||{};return{seiNals:i.seiNals,logs:i.logs,timescale:n}}(e,n,i),o&&o.logs&&(r.logs=r.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):r.logs.length?{logs:r.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;s?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={},r.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],n=null,i=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()};const{parseTfdt:Qn}=yn,$n=Qt,{getTimescaleFromMediaHeader:Jn}=Pn,{parseSamples:Zn,getMdatTrafPairs:ei}=Bn;var ti=function(){let e=9e4;this.init=function(t){const n=$n(t,["moov","trak","mdia","mdhd"])[0];n&&(e=Jn(n))},this.parseSegment=function(t){const n=[],i=ei(t);let r=0;return i.forEach(function(t){const i=t.mdat,s=t.traf,a=$n(s,["tfdt"])[0],o=$n(s,["tfhd"])[0],l=$n(s,["trun"]);if(a){const e=Qn(a);r=e.baseMediaDecodeTime}if(l.length&&o){const t=Zn(l,r,o);let s=0;t.forEach(function(t){const r=new TextDecoder("utf-8"),a=i.slice(s,s+t.size);if($n(a,["vtte"])[0])return void(s+=t.size);$n(a,["vttc"]).forEach(function(i){const s=$n(i,["payl"])[0],a=$n(i,["sttg"])[0],o=t.pts/e,l=(t.pts+t.duration)/e;let c,u;if(s)try{c=r.decode(s)}catch(h){console.error(h)}if(a)try{u=r.decode(a)}catch(h){console.error(h)}t.duration&&c&&n.push({cueText:c,start:o,end:l,settings:u})}),s+=t.size})}}),n}},ni=Se,ii=function(e){var t=31&e[1];return t<<=8,t|=e[2]},ri=function(e){return!!(64&e[1])},si=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},ai=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},oi={parseType:function(e,t){var n=ii(e);return 0===n?"pat":n===t?"pmt":t?"pes":null},parsePat:function(e){var t=ri(e),n=4+si(e);return t&&(n+=e[n]+1),(31&e[n+10])<<8|e[n+11]},parsePmt:function(e){var t={},n=ri(e),i=4+si(e);if(n&&(i+=e[i]+1),1&e[i+5]){var r;r=3+((15&e[i+1])<<8|e[i+2])-4;for(var s=12+((15&e[i+10])<<8|e[i+11]);s<r;){var a=i+s;t[(31&e[a+1])<<8|e[a+2]]=e[a],s+=5+((15&e[a+3])<<8|e[a+4])}return t}},parsePayloadUnitStartIndicator:ri,parsePesType:function(e,t){switch(t[ii(e)]){case ni.H264_STREAM_TYPE:return"video";case ni.ADTS_STREAM_TYPE:return"audio";case ni.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!ri(e))return null;var t=4+si(e);if(t>=e.byteLength)return null;var n,i=null;return 192&(n=e[t+7])&&((i={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,i.pts*=4,i.pts+=(6&e[t+13])>>>1,i.dts=i.pts,64&n&&(i.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,i.dts*=4,i.dts+=(6&e[t+18])>>>1)),i},videoPacketContainsKeyFrame:function(e){for(var t=4+si(e),n=e.subarray(t),i=0,r=0,s=!1;r<n.byteLength-3;r++)if(1===n[r+2]){i=r+5;break}for(;i<n.byteLength;)switch(n[i]){case 0:if(0!==n[i-1]){i+=2;break}if(0!==n[i-2]){i++;break}r+3!==i-2&&"slice_layer_without_partitioning_rbsp_idr"===ai(31&n[r+3])&&(s=!0);do{i++}while(1!==n[i]&&i<n.length);r=i-2,i+=3;break;case 1:if(0!==n[i-1]||0!==n[i-2]){i+=3;break}"slice_layer_without_partitioning_rbsp_idr"===ai(31&n[r+3])&&(s=!0),r=i-2,i+=3;break;default:i+=3}return n=n.subarray(r),i-=r,r=0,n&&n.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===ai(31&n[r+3])&&(s=!0),s}},li=Se,ci=Re.handleRollover,ui={};ui.ts=oi,ui.aac=yt;var hi=re.ONE_SECOND_IN_TS,di=188,pi=71,fi=function(e,t,n){for(var i,r,s,a,o=0,l=di,c=!1;l<=e.byteLength;)if(e[o]!==pi||e[l]!==pi&&l!==e.byteLength)o++,l++;else{if(i=e.subarray(o,l),"pes"===ui.ts.parseType(i,t.pid))r=ui.ts.parsePesType(i,t.table),s=ui.ts.parsePayloadUnitStartIndicator(i),"audio"===r&&s&&(a=ui.ts.parsePesTime(i))&&(a.type="audio",n.audio.push(a),c=!0);if(c)break;o+=di,l+=di}for(o=(l=e.byteLength)-di,c=!1;o>=0;)if(e[o]!==pi||e[l]!==pi&&l!==e.byteLength)o--,l--;else{if(i=e.subarray(o,l),"pes"===ui.ts.parseType(i,t.pid))r=ui.ts.parsePesType(i,t.table),s=ui.ts.parsePayloadUnitStartIndicator(i),"audio"===r&&s&&(a=ui.ts.parsePesTime(i))&&(a.type="audio",n.audio.push(a),c=!0);if(c)break;o-=di,l-=di}},gi=function(e,t,n){for(var i,r,s,a,o,l,c,u=0,h=di,d=!1,p={data:[],size:0};h<e.byteLength;)if(e[u]!==pi||e[h]!==pi)u++,h++;else{if(i=e.subarray(u,h),"pes"===ui.ts.parseType(i,t.pid))if(r=ui.ts.parsePesType(i,t.table),s=ui.ts.parsePayloadUnitStartIndicator(i),"video"===r&&(s&&!d&&(a=ui.ts.parsePesTime(i))&&(a.type="video",n.video.push(a),d=!0),!n.firstKeyFrame)){if(s&&0!==p.size){for(o=new Uint8Array(p.size),l=0;p.data.length;)c=p.data.shift(),o.set(c,l),l+=c.byteLength;if(ui.ts.videoPacketContainsKeyFrame(o)){var f=ui.ts.parsePesTime(o);f?(n.firstKeyFrame=f,n.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}p.size=0}p.data.push(i),p.size+=i.byteLength}if(d&&n.firstKeyFrame)break;u+=di,h+=di}for(u=(h=e.byteLength)-di,d=!1;u>=0;)if(e[u]!==pi||e[h]!==pi)u--,h--;else{if(i=e.subarray(u,h),"pes"===ui.ts.parseType(i,t.pid))r=ui.ts.parsePesType(i,t.table),s=ui.ts.parsePayloadUnitStartIndicator(i),"video"===r&&s&&(a=ui.ts.parsePesTime(i))&&(a.type="video",n.video.push(a),d=!0);if(d)break;u-=di,h-=di}},mi=function(e){var t={pid:null,table:null},n={};for(var i in function(e,t){for(var n,i=0,r=di;r<e.byteLength;)if(e[i]!==pi||e[r]!==pi)i++,r++;else{switch(n=e.subarray(i,r),ui.ts.parseType(n,t.pid)){case"pat":t.pid=ui.ts.parsePat(n);break;case"pmt":var s=ui.ts.parsePmt(n);t.table=t.table||{},Object.keys(s).forEach(function(e){t.table[e]=s[e]})}i+=di,r+=di}}(e,t),t.table){if(t.table.hasOwnProperty(i))switch(t.table[i]){case li.H264_STREAM_TYPE:n.video=[],gi(e,t,n),0===n.video.length&&delete n.video;break;case li.ADTS_STREAM_TYPE:n.audio=[],fi(e,t,n),0===n.audio.length&&delete n.audio}}return n},yi=function(e,t){var n;return n=ui.aac.isLikelyAacData(e)?function(e){for(var t,n=!1,i=0,r=null,s=null,a=0,o=0;e.length-o>=3;){switch(ui.aac.parseType(e,o)){case"timed-metadata":if(e.length-o<10){n=!0;break}if((a=ui.aac.parseId3TagSize(e,o))>e.length){n=!0;break}null===s&&(t=e.subarray(o,o+a),s=ui.aac.parseAacTimestamp(t)),o+=a;break;case"audio":if(e.length-o<7){n=!0;break}if((a=ui.aac.parseAdtsSize(e,o))>e.length){n=!0;break}null===r&&(t=e.subarray(o,o+a),r=ui.aac.parseSampleRate(t)),i++,o+=a;break;default:o++}if(n)return null}if(null===r||null===s)return null;var l=hi/r;return{audio:[{type:"audio",dts:s,pts:s},{type:"audio",dts:s+1024*i*l,pts:s+1024*i*l}]}}(e):mi(e),n&&(n.audio||n.video)?(function(e,t){if(e.audio&&e.audio.length){var n=t;("undefined"===typeof n||isNaN(n))&&(n=e.audio[0].dts),e.audio.forEach(function(e){e.dts=ci(e.dts,n),e.pts=ci(e.pts,n),e.dtsTime=e.dts/hi,e.ptsTime=e.pts/hi})}if(e.video&&e.video.length){var i=t;if(("undefined"===typeof i||isNaN(i))&&(i=e.video[0].dts),e.video.forEach(function(e){e.dts=ci(e.dts,i),e.pts=ci(e.pts,i),e.dtsTime=e.dts/hi,e.ptsTime=e.pts/hi}),e.firstKeyFrame){var r=e.firstKeyFrame;r.dts=ci(r.dts,i),r.pts=ci(r.pts,i),r.dtsTime=r.dts/hi,r.ptsTime=r.pts/hi}}}(n,t),n):null};class bi{constructor(e,t){this.options=t||{},this.self=e,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new Wt.Transmuxer(this.options),function(e,t){t.on("data",function(t){const n=t.initSegment;t.initSegment={data:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength};const i=t.data;t.data=i.buffer,e.postMessage({action:"data",segment:t,byteOffset:i.byteOffset,byteLength:i.byteLength},[t.data])}),t.on("done",function(t){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){const n={start:{decode:re.videoTsToSeconds(t.start.dts),presentation:re.videoTsToSeconds(t.start.pts)},end:{decode:re.videoTsToSeconds(t.end.dts),presentation:re.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:re.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=re.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:n})}),t.on("audioSegmentTimingInfo",function(t){const n={start:{decode:re.videoTsToSeconds(t.start.dts),presentation:re.videoTsToSeconds(t.start.pts)},end:{decode:re.videoTsToSeconds(t.end.dts),presentation:re.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:re.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=re.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:n})}),t.on("id3Frame",function(t){e.postMessage({action:"id3Frame",id3Frame:t})}),t.on("caption",function(t){e.postMessage({action:"caption",caption:t})}),t.on("trackinfo",function(t){e.postMessage({action:"trackinfo",trackInfo:t})}),t.on("audioTimingInfo",function(t){e.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:re.videoTsToSeconds(t.start),end:re.videoTsToSeconds(t.end)}})}),t.on("videoTimingInfo",function(t){e.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:re.videoTsToSeconds(t.start),end:re.videoTsToSeconds(t.end)}})}),t.on("log",function(t){e.postMessage({action:"log",log:t})})}(this.self,this.transmuxer)}pushMp4Captions(e){this.captionParser||(this.captionParser=new Yn,this.captionParser.init());const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),n=this.captionParser.parse(t,e.trackIds,e.timescales);this.self.postMessage({action:"mp4Captions",captions:n&&n.captions||[],logs:n&&n.logs||[],data:t.buffer},[t.buffer])}initMp4WebVttParser(e){this.webVttParser||(this.webVttParser=new ti);const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.webVttParser.init(t)}getMp4WebVttText(e){this.webVttParser||(this.webVttParser=new ti);const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),n=this.webVttParser.parseSegment(t);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:n||[],data:t.buffer},[t.buffer])}probeMp4StartTime(e){let{timescales:t,data:n}=e;const i=Pn.startTime(t,n);this.self.postMessage({action:"probeMp4StartTime",startTime:i,data:n},[n.buffer])}probeMp4Tracks(e){let{data:t}=e;const n=Pn.tracks(t);this.self.postMessage({action:"probeMp4Tracks",tracks:n,data:t},[t.buffer])}probeEmsgID3(e){let{data:t,offset:n}=e;const i=Pn.getEmsgID3(t,n);this.self.postMessage({action:"probeEmsgID3",id3Frames:i,emsgData:t},[t.buffer])}probeTs(e){let{data:t,baseStartTime:n}=e;const i="number"!==typeof n||isNaN(n)?void 0:n*re.ONE_SECOND_IN_TS,r=yi(t,i);let s=null;r&&(s={hasVideo:r.video&&2===r.video.length||!1,hasAudio:r.audio&&2===r.audio.length||!1},s.hasVideo&&(s.videoStart=r.video[0].ptsTime),s.hasAudio&&(s.audioStart=r.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:s,data:t},[t.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(e){const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}reset(){this.transmuxer.reset()}setTimestampOffset(e){const t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(re.secondsToVideoTs(t)))}setAudioAppendStart(e){this.transmuxer.setAudioAppendStart(Math.ceil(re.secondsToVideoTs(e.appendStart)))}setRemux(e){this.transmuxer.setRemux(e.remux)}flush(e){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}self.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new bi(self,e.data.options):(this.messageHandlers||(this.messageHandlers=new bi(self)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}}));var bl=fl(yl);const vl=e=>{const{transmuxer:t,bytes:n,audioAppendStart:i,gopsToAlignWith:r,remux:s,onData:a,onTrackInfo:o,onAudioTimingInfo:l,onVideoTimingInfo:c,onVideoSegmentTimingInfo:u,onAudioSegmentTimingInfo:h,onId3:d,onCaptions:p,onDone:f,onEndedTimeline:g,onTransmuxerLog:m,isEndOfTimeline:y,segment:b,triggerSegmentEventFn:v}=e,_={buffer:[]};let x=y;if(t.onmessage=n=>{t.currentTransmux===e&&("data"===n.data.action&&((e,t,n)=>{const{type:i,initSegment:r,captions:s,captionStreams:a,metadata:o,videoFrameDtsTime:l,videoFramePtsTime:c}=e.data.segment;t.buffer.push({captions:s,captionStreams:a,metadata:o});const u=e.data.segment.boxes||{data:e.data.segment.data},h={type:i,data:new Uint8Array(u.data,u.data.byteOffset,u.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};"undefined"!==typeof l&&(h.videoFrameDtsTime=l),"undefined"!==typeof c&&(h.videoFramePtsTime=c),n(h)})(n,_,a),"trackinfo"===n.data.action&&o(n.data.trackInfo),"gopInfo"===n.data.action&&((e,t)=>{t.gopInfo=e.data.gopInfo})(n,_),"audioTimingInfo"===n.data.action&&l(n.data.audioTimingInfo),"videoTimingInfo"===n.data.action&&c(n.data.videoTimingInfo),"videoSegmentTimingInfo"===n.data.action&&u(n.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===n.data.action&&h(n.data.audioSegmentTimingInfo),"id3Frame"===n.data.action&&d([n.data.id3Frame],n.data.id3Frame.dispatchType),"caption"===n.data.action&&p(n.data.caption),"endedtimeline"===n.data.action&&(x=!1,g()),"log"===n.data.action&&m(n.data.log),"transmuxed"===n.data.type&&(x||(t.onmessage=null,(e=>{let{transmuxedData:t,callback:n}=e;t.buffer=[],n(t)})({transmuxedData:_,callback:f}),_l(t))))},t.onerror=()=>{const e={message:"Received an error message from the transmuxer worker",metadata:{errorType:Ma.Error.StreamingFailedToTransmuxSegment,segmentInfo:cc({segment:b})}};f(null,e)},i&&t.postMessage({action:"setAudioAppendStart",appendStart:i}),Array.isArray(r)&&t.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),"undefined"!==typeof s&&t.postMessage({action:"setRemux",remux:s}),n.byteLength){const e=n instanceof ArrayBuffer?n:n.buffer,i=n instanceof ArrayBuffer?0:n.byteOffset;v({type:"segmenttransmuxingstart",segment:b}),t.postMessage({action:"push",data:e,byteOffset:i,byteLength:n.byteLength},[e])}y&&t.postMessage({action:"endTimeline"}),t.postMessage({action:"flush"})},_l=e=>{e.currentTransmux=null,e.transmuxQueue.length&&(e.currentTransmux=e.transmuxQueue.shift(),"function"===typeof e.currentTransmux?e.currentTransmux():vl(e.currentTransmux))},xl=(e,t)=>{e.postMessage({action:t}),_l(e)},wl=(e,t)=>{if(!t.currentTransmux)return t.currentTransmux=e,void xl(t,e);t.transmuxQueue.push(xl.bind(null,t,e))},Tl=e=>{if(!e.transmuxer.currentTransmux)return e.transmuxer.currentTransmux=e,void vl(e);e.transmuxer.transmuxQueue.push(e)};var kl=e=>{wl("reset",e)},Sl=e=>{const t=new bl;t.currentTransmux=null,t.transmuxQueue=[];const n=t.terminate;return t.terminate=()=>(t.currentTransmux=null,t.transmuxQueue.length=0,n.call(t)),t.postMessage({action:"init",options:e}),t};const Cl=function(e){const t=e.transmuxer,n=e.endAction||e.action,i=e.callback,r=h({},e,{endAction:null,transmuxer:null,callback:null}),s=r=>{r.data.action===n&&(t.removeEventListener("message",s),r.data.data&&(r.data.data=new Uint8Array(r.data.data,e.byteOffset||0,e.byteLength||r.data.data.byteLength),e.data&&(e.data=r.data.data)),i(r.data))};if(t.addEventListener("message",s),e.data){const n=e.data instanceof ArrayBuffer;r.byteOffset=n?0:e.data.byteOffset,r.byteLength=e.data.byteLength;const i=[n?e.data:e.data.buffer];t.postMessage(r,i)}else t.postMessage(r)},Il=2,El=-101,Nl=-102,Al="wvtt",Rl=e=>{e.forEach(e=>{e.abort()})},Dl=(e,t)=>{const{requestType:n}=t,i=Eo({requestType:n,request:t,error:e});return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:El,xhr:t,metadata:i}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:Nl,xhr:t,metadata:i}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:Il,xhr:t,metadata:i}:"arraybuffer"===t.responseType&&0===t.response.byteLength?{status:t.status,message:"Empty HLS response at URL: "+t.uri,code:Il,xhr:t,metadata:i}:null},Ol=(e,t,n,i)=>(r,s)=>{const a=s.response,o=Dl(r,s);if(o)return n(o,e);if(16!==a.byteLength)return n({status:s.status,message:"Invalid HLS key at URL: "+s.uri,code:Il,xhr:s},e);const l=new DataView(a),c=new Uint32Array([l.getUint32(0),l.getUint32(4),l.getUint32(8),l.getUint32(12)]);for(let e=0;e<t.length;e++)t[e].bytes=c;const u={uri:s.uri};return i({type:"segmentkeyloadcomplete",segment:e,keyInfo:u}),n(null,e)},Ll=(e,t)=>{const n=yt(e.map.bytes);if("mp4"!==n){const i=e.map.resolvedUri||e.map.uri,r=n||"unknown";return t({internal:!0,message:"Found unsupported ".concat(r," container for initialization segment at URL: ").concat(i),code:Il,metadata:{mediaType:r}})}Cl({action:"probeMp4Tracks",data:e.map.bytes,transmuxer:e.transmuxer,callback:n=>{let{tracks:i,data:r}=n;return e.map.bytes=r,i.forEach(function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,"number"===typeof t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale),"text"===t.type&&((e,t)=>{t===Al&&e.transmuxer.postMessage({action:"initMp4WebVttParser",data:e.map.bytes})})(e,t.codec))}),t(null)}})},Pl=e=>{let{segment:t,finishProcessingFn:n,responseType:i,triggerSegmentEventFn:r}=e;return(e,s)=>{const a=Dl(e,s);if(a)return n(a,t);r({type:"segmentloaded",segment:t});const o="arraybuffer"!==i&&s.responseText?(e=>{const t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer})(s.responseText.substring(t.lastReachedChar||0)):s.response;return t.stats=(e=>({bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}))(s),t.key?t.encryptedBytes=new Uint8Array(o):t.bytes=new Uint8Array(o),n(null,t)}},Fl=e=>{let{segment:t,bytes:n,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:p,triggerSegmentEventFn:f}=e;const g=t.map&&t.map.tracks||{},m=Boolean(g.audio&&g.video);let y=r.bind(null,t,"audio","start");const b=r.bind(null,t,"audio","end");let v=r.bind(null,t,"video","start");const _=r.bind(null,t,"video","end");Cl({action:"probeTs",transmuxer:t.transmuxer,data:n,baseStartTime:t.baseStartTime,callback:e=>{t.bytes=n=e.data;const r=e.result;r&&(i(t,{hasAudio:r.hasAudio,hasVideo:r.hasVideo,isMuxed:m}),i=null),Tl({bytes:n,transmuxer:t.transmuxer,audioAppendStart:t.audioAppendStart,gopsToAlignWith:t.gopsToAlignWith,remux:m,onData:e=>{e.type="combined"===e.type?"video":e.type,h(t,e)},onTrackInfo:e=>{i&&(m&&(e.isMuxed=!0),i(t,e))},onAudioTimingInfo:e=>{y&&"undefined"!==typeof e.start&&(y(e.start),y=null),b&&"undefined"!==typeof e.end&&b(e.end)},onVideoTimingInfo:e=>{v&&"undefined"!==typeof e.start&&(v(e.start),v=null),_&&"undefined"!==typeof e.end&&_(e.end)},onVideoSegmentTimingInfo:e=>{const n={pts:{start:e.start.presentation,end:e.end.presentation},dts:{start:e.start.decode,end:e.end.decode}};f({type:"segmenttransmuxingtiminginfoavailable",segment:t,timingInfo:n}),s(e)},onAudioSegmentTimingInfo:e=>{const n={pts:{start:e.start.pts,end:e.end.pts},dts:{start:e.start.dts,end:e.end.dts}};f({type:"segmenttransmuxingtiminginfoavailable",segment:t,timingInfo:n}),a(e)},onId3:(e,n)=>{o(t,e,n)},onCaptions:e=>{l(t,[e])},isEndOfTimeline:c,onEndedTimeline:()=>{u()},onTransmuxerLog:p,onDone:(e,n)=>{d&&(e.type="combined"===e.type?"video":e.type,f({type:"segmenttransmuxingcomplete",segment:t}),d(n,t,e))},segment:t,triggerSegmentEventFn:f})}})},Ml=e=>{let{segment:t,bytes:n,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:p,triggerSegmentEventFn:f}=e,g=new Uint8Array(n);if(function(e){return tt(e,["moof"]).length>0}(g)){t.isFmp4=!0;const{tracks:e}=t.map;if(e.text&&(!e.audio||!e.video))return h(t,{data:g,type:"text"}),void((e,t,n)=>{t===Al&&Cl({action:"getMp4WebVttText",data:e.bytes,transmuxer:e.transmuxer,callback:t=>{let{data:i,mp4VttCues:r}=t;e.bytes=i,n(null,e,{mp4VttCues:r})}})})(t,e.text.codec,d);const s={isFmp4:!0,hasVideo:!!e.video,hasAudio:!!e.audio};e.audio&&e.audio.codec&&"enca"!==e.audio.codec&&(s.audioCodec=e.audio.codec),e.video&&e.video.codec&&"encv"!==e.video.codec&&(s.videoCodec=e.video.codec),e.video&&e.audio&&(s.isMuxed=!0),i(t,s);const a=(e,n)=>{h(t,{data:g,type:s.hasAudio&&!s.isMuxed?"audio":"video"}),n&&n.length&&o(t,n),e&&e.length&&l(t,e),d(null,t,{})};return void Cl({action:"probeMp4StartTime",timescales:t.map.timescales,data:g,transmuxer:t.transmuxer,callback:i=>{let{data:o,startTime:l}=i;n=o.buffer,t.bytes=g=o,s.hasAudio&&!s.isMuxed&&r(t,"audio","start",l),s.hasVideo&&r(t,"video","start",l),Cl({action:"probeEmsgID3",data:g,transmuxer:t.transmuxer,offset:l,callback:i=>{let{emsgData:r,id3Frames:s}=i;n=r.buffer,t.bytes=g=r,e.video&&r.byteLength&&t.transmuxer?Cl({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:t.transmuxer,data:g,timescales:t.map.timescales,trackIds:[e.video.id],callback:e=>{n=e.data.buffer,t.bytes=g=e.data,e.logs.forEach(function(e){p(Ga(e,{stream:"mp4CaptionParser"}))}),a(e.captions,s)}}):a(void 0,s)}})}})}if(t.transmuxer){if("undefined"===typeof t.container&&(t.container=yt(g)),"ts"!==t.container&&"aac"!==t.container)return i(t,{hasAudio:!1,hasVideo:!1}),void d(null,t,{});Fl({segment:t,bytes:n,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:p,triggerSegmentEventFn:f})}else d(null,t,{})},Ul=function(e,t){let{id:n,key:i,encryptedBytes:r,decryptionWorker:s,segment:a,doneFn:o}=e;const l=e=>{if(e.data.source===n){s.removeEventListener("message",l);const n=e.data.decrypted;t(new Uint8Array(n.bytes,n.byteOffset,n.byteLength))}};let c;s.onerror=()=>{const e="An error occurred in the decryption worker",t=cc({segment:a}),n={message:e,metadata:{error:new Error(e),errorType:Ma.Error.StreamingFailedToDecryptSegment,segmentInfo:t,keyInfo:{uri:a.key.resolvedUri||a.map.key.resolvedUri}}};o(n,a)},s.addEventListener("message",l),c=i.bytes.slice?i.bytes.slice():new Uint32Array(Array.prototype.slice.call(i.bytes)),s.postMessage(Qo({source:n,encrypted:r,key:c,iv:i.iv}),[r.buffer,c.buffer])},Bl=e=>{let{activeXhrs:t,decryptionWorker:n,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:p,triggerSegmentEventFn:f}=e,g=0,m=!1;return(e,y)=>{if(!m){if(e)return m=!0,Rl(t),d(e,y);if(g+=1,g===t.length){const e=function(){if(y.encryptedBytes)return(e=>{let{decryptionWorker:t,segment:n,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:p,triggerSegmentEventFn:f}=e;f({type:"segmentdecryptionstart"}),Ul({id:n.requestId,key:n.key,encryptedBytes:n.encryptedBytes,decryptionWorker:t,segment:n,doneFn:d},e=>{n.bytes=e,f({type:"segmentdecryptioncomplete",segment:n}),Ml({segment:n,bytes:n.bytes,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:p,triggerSegmentEventFn:f})})})({decryptionWorker:n,segment:y,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:p,triggerSegmentEventFn:f});Ml({segment:y,bytes:y.bytes,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:p,triggerSegmentEventFn:f})};if(y.endOfAllRequests=Date.now(),y.map&&y.map.encryptedBytes&&!y.map.bytes)return f({type:"segmentdecryptionstart",segment:y}),Ul({decryptionWorker:n,id:y.requestId+"-init",encryptedBytes:y.map.encryptedBytes,key:y.map.key,segment:y,doneFn:d},n=>{y.map.bytes=n,f({type:"segmentdecryptioncomplete",segment:y}),Ll(y,n=>{if(n)return Rl(t),d(n,y);e()})});e()}}}},zl=e=>{let{segment:t,progressFn:n,trackInfoFn:i,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:c,endedTimelineFn:u,dataFn:h}=e;return e=>{if(!e.target.aborted)return t.stats=Ga(t.stats,(e=>{const t=e.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return n.bytesReceived=e.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n})(e)),!t.stats.firstBytesReceivedAt&&t.stats.bytesReceived&&(t.stats.firstBytesReceivedAt=Date.now()),n(e,t)}},Vl=e=>{let{xhr:t,xhrOptions:n,decryptionWorker:i,segment:r,abortFn:s,progressFn:a,trackInfoFn:o,timingInfoFn:l,videoSegmentTimingInfoFn:c,audioSegmentTimingInfoFn:u,id3Fn:h,captionsFn:d,isEndOfTimeline:p,endedTimelineFn:f,dataFn:g,doneFn:m,onTransmuxerLog:y,triggerSegmentEventFn:b}=e;const v=[],_=Bl({activeXhrs:v,decryptionWorker:i,trackInfoFn:o,timingInfoFn:l,videoSegmentTimingInfoFn:c,audioSegmentTimingInfoFn:u,id3Fn:h,captionsFn:d,isEndOfTimeline:p,endedTimelineFn:f,dataFn:g,doneFn:m,onTransmuxerLog:y,triggerSegmentEventFn:b});if(r.key&&!r.key.bytes){const e=[r.key];r.map&&!r.map.bytes&&r.map.key&&r.map.key.resolvedUri===r.key.resolvedUri&&e.push(r.map.key);const i=Ga(n,{uri:r.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),s=Ol(r,e,_,b);b({type:"segmentkeyloadstart",segment:r,keyInfo:{uri:r.key.resolvedUri}});const a=t(i,s);v.push(a)}if(r.map&&!r.map.bytes){if(r.map.key&&(!r.key||r.key.resolvedUri!==r.map.key.resolvedUri)){const e=Ga(n,{uri:r.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),i=Ol(r,[r.map.key],_,b);b({type:"segmentkeyloadstart",segment:r,keyInfo:{uri:r.map.key.resolvedUri}});const s=t(e,i);v.push(s)}const e=Ga(n,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:qo(r.map),requestType:"segment-media-initialization"}),i=(e=>{let{segment:t,finishProcessingFn:n,triggerSegmentEventFn:i}=e;return(e,r)=>{const s=Dl(e,r);if(s)return n(s,t);const a=new Uint8Array(r.response);if(i({type:"segmentloaded",segment:t}),t.map.key)return t.map.encryptedBytes=a,n(null,t);t.map.bytes=a,Ll(t,function(e){if(e)return e.xhr=r,e.status=r.status,n(e,t);n(null,t)})}})({segment:r,finishProcessingFn:_,triggerSegmentEventFn:b});b({type:"segmentloadstart",segment:r});const s=t(e,i);v.push(s)}const x=Ga(n,{uri:r.part&&r.part.resolvedUri||r.resolvedUri,responseType:"arraybuffer",headers:qo(r),requestType:"segment"}),w=Pl({segment:r,finishProcessingFn:_,responseType:x.responseType,triggerSegmentEventFn:b});b({type:"segmentloadstart",segment:r});const T=t(x,w);T.addEventListener("progress",zl({segment:r,progressFn:a,trackInfoFn:o,timingInfoFn:l,videoSegmentTimingInfoFn:c,audioSegmentTimingInfoFn:u,id3Fn:h,captionsFn:d,isEndOfTimeline:p,endedTimelineFn:f,dataFn:g})),v.push(T);const k={};return v.forEach(e=>{e.addEventListener("loadend",(e=>{let{loadendState:t,abortFn:n}=e;return e=>{e.target.aborted&&n&&!t.calledAbortFn&&(n(),t.calledAbortFn=!0)}})({loadendState:k,abortFn:s}))}),()=>Rl(v)},jl=Ha("PlaylistSelector"),Wl=function(e){if(!e||!e.playlist)return;const t=e.playlist;return JSON.stringify({id:t.id,bandwidth:e.bandwidth,width:e.width,height:e.height,codecs:t.attributes&&t.attributes.CODECS||""})},Hl=function(e,t){if(!e)return"";const n=r().getComputedStyle(e);return n?n[t]:""},Gl=function(e,t){const n=e.slice();e.sort(function(e,i){const r=t(e,i);return 0===r?n.indexOf(e)-n.indexOf(i):r})},ql=function(e,t){let n,i;return e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||r().Number.MAX_VALUE,t.attributes.BANDWIDTH&&(i=t.attributes.BANDWIDTH),i=i||r().Number.MAX_VALUE,n-i};let Xl=function(e){const{main:t,bandwidth:n,playerWidth:i,playerHeight:s,playerObjectFit:a,limitRenditionByPlayerDimensions:o,playlistController:l}=e;if(!t)return;const c={bandwidth:n,width:i,height:s,limitRenditionByPlayerDimensions:o};let u=t.playlists;_o.isAudioOnly(t)&&(u=l.getAudioTrackPlaylists_(),c.audioOnly=!0);let h=u.map(e=>{let t;const n=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,i=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height;return t=e.attributes&&e.attributes.BANDWIDTH,t=t||r().Number.MAX_VALUE,{bandwidth:t,width:n,height:i,playlist:e}});Gl(h,(e,t)=>e.bandwidth-t.bandwidth),h=h.filter(e=>!_o.isIncompatible(e.playlist));let d=h.filter(e=>_o.isEnabled(e.playlist));d.length||(d=h.filter(e=>!_o.isDisabled(e.playlist)));const p=d.filter(e=>e.bandwidth*dl.BANDWIDTH_VARIANCE<n);let f=p[p.length-1];const g=p.filter(e=>e.bandwidth===f.bandwidth)[0];if(!1===o){const e=g||d[0]||h[0];if(e&&e.playlist){let t="sortedPlaylistReps";return g&&(t="bandwidthBestRep"),d[0]&&(t="enabledPlaylistReps"),jl("choosing ".concat(Wl(e)," using ").concat(t," with options"),c),e.playlist}return jl("could not choose a playlist with options",c),null}const m=p.filter(e=>e.width&&e.height);Gl(m,(e,t)=>e.width-t.width);const y=m.filter(e=>e.width===i&&e.height===s);f=y[y.length-1];const b=y.filter(e=>e.bandwidth===f.bandwidth)[0];let v,_,x,w;if(b||(v=m.filter(e=>"cover"===a?e.width>i&&e.height>s:e.width>i||e.height>s),_=v.filter(e=>e.width===v[0].width&&e.height===v[0].height),f=_[_.length-1],x=_.filter(e=>e.bandwidth===f.bandwidth)[0]),l.leastPixelDiffSelector){const e=m.map(e=>(e.pixelDiff=Math.abs(e.width-i)+Math.abs(e.height-s),e));Gl(e,(e,t)=>e.pixelDiff===t.pixelDiff?t.bandwidth-e.bandwidth:e.pixelDiff-t.pixelDiff),w=e[0]}const T=w||x||b||g||d[0]||h[0];if(T&&T.playlist){let e="sortedPlaylistReps";return w?e="leastPixelDiffRep":x?e="resolutionPlusOneRep":b?e="resolutionBestRep":g?e="bandwidthBestRep":d[0]&&(e="enabledPlaylistReps"),jl("choosing ".concat(Wl(T)," using ").concat(e," with options"),c),T.playlist}return jl("could not choose a playlist with options",c),null};const Kl=function(){let e=this.useDevicePixelRatio&&r().devicePixelRatio||1;return isNaN(this.customPixelRatio)||(e=this.customPixelRatio),Xl({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(Hl(this.tech_.el(),"width"),10)*e,playerHeight:parseInt(Hl(this.tech_.el(),"height"),10)*e,playerObjectFit:this.usePlayerObjectFit?Hl(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})};function Yl(e){try{return new URL(e).pathname.split("/").slice(-2).join("/")}catch(t){return""}}const Ql=e=>{let{inbandTextTracks:t,metadataArray:n,timestampOffset:i,videoDuration:s}=e;if(!n)return;const a=r().WebKitDataCue||r().VTTCue,o=t.metadataTrack_;if(!o)return;if(n.forEach(e=>{const t=e.cueTime+i;!("number"!==typeof t||r().isNaN(t)||t<0)&&t<1/0&&e.frames&&e.frames.length&&e.frames.forEach(e=>{const n=new a(t,t,e.value||e.url||e.data||"");n.frame=e,n.value=e,function(e){Object.defineProperties(e.frame,{id:{get:()=>(Ma.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key)},value:{get:()=>(Ma.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data)},privateData:{get:()=>(Ma.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data)}})}(n),o.addCue(n)})}),!o.cues||!o.cues.length)return;const l=o.cues,c=[];for(let r=0;r<l.length;r++)l[r]&&c.push(l[r]);const u=c.reduce((e,t)=>{const n=e[t.startTime]||[];return n.push(t),e[t.startTime]=n,e},{}),h=Object.keys(u).sort((e,t)=>Number(e)-Number(t));h.forEach((e,t)=>{const n=u[e],i=isFinite(s)?s:e,r=Number(h[t+1])||i;n.forEach(e=>{e.endTime=r})})},$l={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},Jl=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),Zl=(e,t,n)=>{e.metadataTrack_||(e.metadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,Ma.browser.IS_ANY_SAFARI||(e.metadataTrack_.inBandMetadataTrackDispatchType=t))},ec=function(e,t,n){let i,r;if(n&&n.cues)for(i=n.cues.length;i--;)r=n.cues[i],r.startTime>=e&&r.endTime<=t&&n.removeCue(r)},tc=e=>"number"===typeof e&&isFinite(e),nc=1/60,ic=e=>{const{startOfSegment:t,duration:n,segment:i,part:r,playlist:{mediaSequence:s,id:a,segments:o=[]},mediaIndex:l,partIndex:c,timeline:u}=e,h=o.length-1;let d="mediaIndex/partIndex increment";e.getMediaInfoForTime?d="getMediaInfoForTime (".concat(e.getMediaInfoForTime,")"):e.isSyncRequest&&(d="getSyncSegmentCandidate (isSyncRequest)"),e.independent&&(d+=" with independent ".concat(e.independent));const p="number"===typeof c,f=e.segment.uri?"segment":"pre-segment",g=p?so({preloadSegment:i})-1:0;return"".concat(f," [").concat(s+l,"/").concat(s+h,"]")+(p?" part [".concat(c,"/").concat(g,"]"):"")+" segment start/end [".concat(i.start," => ").concat(i.end,"]")+(p?" part start/end [".concat(r.start," => ").concat(r.end,"]"):"")+" startOfSegment [".concat(t,"]")+" duration [".concat(n,"]")+" timeline [".concat(u,"]")+" selected by [".concat(d,"]")+" playlist [".concat(a,"]")},rc=e=>"".concat(e,"TimingInfo"),sc=e=>{let{timelineChangeController:t,currentTimeline:n,segmentTimeline:i,loaderType:r,audioDisabled:s}=e;if(n===i)return!1;if("audio"===r){const e=t.lastTimelineChange({type:"main"});return!e||e.to!==i}if("main"===r&&s){const e=t.pendingTimelineChange({type:"audio"});return!e||e.to!==i}return!1},ac=e=>{const t=e.pendingSegment_;if(!t)return;if(sc({timelineChangeController:e.timelineChangeController_,currentTimeline:e.currentTimeline_,segmentTimeline:t.timeline,loaderType:e.loaderType_,audioDisabled:e.audioDisabled_})&&(e=>{if(!e)return!1;const t=e.pendingTimelineChange({type:"audio"}),n=e.pendingTimelineChange({type:"main"}),i=t&&n,r=i&&t.to!==n.to;return!(!i||-1===t.from||-1===n.from||!r)})(e.timelineChangeController_)){if((e=>{const t=e.timelineChangeController_.pendingTimelineChange({type:"audio"}),n=e.timelineChangeController_.pendingTimelineChange({type:"main"});return t&&n&&t.to<n.to})(e))return void e.timelineChangeController_.trigger("audioTimelineBehind");e.timelineChangeController_.trigger("fixBadTimelineChange")}},oc=e=>{let{segmentDuration:t,maxDuration:n}=e;return!!t&&Math.round(t)>n+Xa},lc=(e,t)=>{if("hls"!==t)return null;const n=(e=>{let t=0;return["video","audio"].forEach(function(n){const i=e["".concat(n,"TimingInfo")];if(!i)return;const{start:s,end:a}=i;let o;"bigint"===typeof s||"bigint"===typeof a?o=r().BigInt(a)-r().BigInt(s):"number"===typeof s&&"number"===typeof a&&(o=a-s),"undefined"!==typeof o&&o>t&&(t=o)}),"bigint"===typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),t})({audioTimingInfo:e.audioTimingInfo,videoTimingInfo:e.videoTimingInfo});if(!n)return null;const i=e.playlist.targetDuration,s=oc({segmentDuration:n,maxDuration:2*i}),a=oc({segmentDuration:n,maxDuration:i}),o="Segment with index ".concat(e.mediaIndex," ")+"from playlist ".concat(e.playlist.id," ")+"has a duration of ".concat(n," ")+"when the reported duration is ".concat(e.duration," ")+"and the target duration is ".concat(i,". ")+"For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1";return s||a?{severity:s?"warn":"info",message:o}:null},cc=e=>{let{type:t,segment:n}=e;if(!n)return;const i=Boolean(n.key||n.map&&n.map.ke),r=Boolean(n.map&&!n.map.bytes),s=void 0===n.startOfSegment?n.start:n.startOfSegment;return{type:t||n.type,uri:n.resolvedUri||n.uri,start:s,duration:n.duration,isEncrypted:i,isMediaInitialization:r}};class uc extends Ma.EventTarget{constructor(e){if(super(),!e)throw new TypeError("Initialization settings are required");if("function"!==typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=Ha("SegmentLoader[".concat(this.loaderType_,"]")),Object.defineProperty(this,"state",{get(){return this.state_},set(e){e!==this.state_&&(this.logger_("".concat(this.state_," -> ").concat(e)),this.state_=e,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():ac(this)}),this.sourceUpdater_.on("codecschange",e=>{this.trigger(h({type:"codecschange"},e))}),"main"===this.loaderType_&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():ac(this)}),"audio"===this.loaderType_&&this.timelineChangeController_.on("timelinechange",e=>{this.trigger(h({type:"timelinechange"},e)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():ac(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():ac(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return Sl({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&r().clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if("WAITING"!==this.state)return this.pendingSegment_&&(this.pendingSegment_=null),void this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,r().clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)}error(e){return"undefined"!==typeof e&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&kl(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return qa();if("main"===this.loaderType_){const{hasAudio:t,hasVideo:n,isMuxed:i}=e;if(n&&t&&!this.audioDisabled_&&!i)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;const n=$o(e);let i=this.initSegments_[n];return t&&!i&&e.bytes&&(this.initSegments_[n]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),i||e}segmentKey(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;const n=Jo(e);let i=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!i&&e.bytes&&(this.keyCache_[n]=i={resolvedUri:e.resolvedUri,bytes:e.bytes});const r={resolvedUri:(i||e).resolvedUri};return i&&(r.bytes=i.bytes),r}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return;if(this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const n=this.playlist_,i=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));let r=null;if(n&&(n.id?r=n.id:n.uri&&(r=n.uri)),this.logger_("playlist update [".concat(r," => ").concat(e.id||e.uri,"]")),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_("Playlist update:\ncurrentTime: ".concat(this.currentTime_(),"\nbufferedEnd: ").concat(eo(this.buffered_()),"\n"),this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){if(null!==this.mediaIndex){!e.endList&&"number"===typeof e.partTargetDuration?this.resetLoader():this.resyncLoader()}return this.currentMediaInfo_=void 0,void this.trigger("playlistupdate")}const s=e.mediaSequence-n.mediaSequence;if(this.logger_("live window shift [".concat(s,"]")),null!==this.mediaIndex)if(this.mediaIndex-=s,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const e=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!e.parts||!e.parts.length||!e.parts[this.partIndex])){const e=this.mediaIndex;this.logger_("currently processing part (index ".concat(this.partIndex,") no longer exists.")),this.resetLoader(),this.mediaIndex=e}}i&&(i.mediaIndex-=s,i.mediaIndex<0?(i.mediaIndex=null,i.partIndex=null):(i.mediaIndex>=0&&(i.segment=e.segments[i.mediaIndex]),i.partIndex>=0&&i.segment.parts&&(i.part=i.segment.parts[i.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(r().clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return null===this.checkBufferTimeout_}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&kl(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;"hls"===this.sourceType_&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t===1/0&&(t=this.duration_()),t<=e)return void this.logger_("skipping remove because end ${end} is <= start ${start}");if(!this.sourceUpdater_||!this.getMediaInfo_())return void this.logger_("skipping remove because no source updater or starting media info");let r=1;const s=()=>{r--,0===r&&n()};!i&&this.audioDisabled_||(r++,this.sourceUpdater_.removeAudio(e,t,s)),(i||"main"===this.loaderType_)&&(this.gopBuffer_=((e,t,n,i)=>{const r=Math.ceil((t-i)*bt.ONE_SECOND_IN_TS),s=Math.ceil((n-i)*bt.ONE_SECOND_IN_TS),a=e.slice();let o=e.length;for(;o--&&!(e[o].pts<=s););if(-1===o)return a;let l=o+1;for(;l--&&!(e[l].pts<=r););return l=Math.max(l,0),a.splice(l,o-l+1),a})(this.gopBuffer_,e,t,this.timeMapping_),r++,this.sourceUpdater_.removeVideo(e,t,s));for(const a in this.inbandTextTracks_)ec(e,t,this.inbandTextTracks_[a]);ec(e,t,this.segmentMetadataTrack_),s()}monitorBuffer_(){this.checkBufferTimeout_&&r().clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=r().setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&r().clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=r().setTimeout(this.monitorBufferTick_.bind(this),500)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:cc({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),"number"===typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mediaIndex,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.playlist_,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.partIndex;if(!t||!this.mediaSource_)return!1;const i="number"===typeof e&&t.segments[e],r=e+1===t.segments.length,s=!i||!i.parts||n+1===i.parts.length;return t.endList&&"open"===this.mediaSource_.readyState&&r&&s}chooseNextRequest_(){const e=this.buffered_(),t=eo(e)||0,n=to(e,this.currentTime_()),i=!this.hasPlayed_()&&n>=1,r=n>=this.goalBufferLength_(),s=this.playlist_.segments;if(!s.length||i||r)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const a={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(a.isSyncRequest)a.mediaIndex=function(e,t,n){t=t||[];const i=[];let r=0;for(let s=0;s<t.length;s++){const a=t[s];if(e===a.timeline&&(i.push(s),r+=a.duration,r>n))return s}return 0===i.length?0:i[i.length-1]}(this.currentTimeline_,s,t),this.logger_("choose next request. Can not find sync point. Fallback to media Index: ".concat(a.mediaIndex));else if(null!==this.mediaIndex){const e=s[this.mediaIndex],n="number"===typeof this.partIndex?this.partIndex:-1;a.startOfSegment=e.end?e.end:t,e.parts&&e.parts[n+1]?(a.mediaIndex=this.mediaIndex,a.partIndex=n+1):a.mediaIndex=this.mediaIndex+1}else{let e,n,i;const r=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_("chooseNextRequest_ request after Quality Switch:\nFor TargetTime: ".concat(r,".\nCurrentTime: ").concat(this.currentTime_(),"\nBufferedEnd: ").concat(t,"\nFetch At Buffer: ").concat(this.fetchAtBuffer_,"\n"),this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const t=this.getSyncInfoFromMediaSequenceSync_(r);if(!t){const e="No sync info found while using media sequence sync";return this.error({message:e,metadata:{errorType:Ma.Error.StreamingFailedToSelectNextSegment,error:new Error(e)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_("chooseNextRequest_ mediaSequence syncInfo (".concat(t.start," --\x3e ").concat(t.end,")")),e=t.segmentIndex,n=t.partIndex,i=t.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const t=_o.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:r,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});e=t.segmentIndex,n=t.partIndex,i=t.startTime}a.getMediaInfoForTime=this.fetchAtBuffer_?"bufferedEnd ".concat(r):"currentTime ".concat(r),a.mediaIndex=e,a.startOfSegment=i,a.partIndex=n,this.logger_("choose next request. Playlist switched and we have a sync point. Media Index: ".concat(a.mediaIndex," "))}const o=s[a.mediaIndex];let l=o&&"number"===typeof a.partIndex&&o.parts&&o.parts[a.partIndex];if(!o||"number"===typeof a.partIndex&&!l)return null;"number"!==typeof a.partIndex&&o.parts&&(a.partIndex=0,l=o.parts[0]);const c=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!n&&l&&!c&&!l.independent)if(0===a.partIndex){const e=s[a.mediaIndex-1],t=e.parts&&e.parts.length&&e.parts[e.parts.length-1];t&&t.independent&&(a.mediaIndex-=1,a.partIndex=e.parts.length-1,a.independent="previous segment")}else o.parts[a.partIndex-1].independent&&(a.partIndex-=1,a.independent="previous part");const u=this.mediaSource_&&"ended"===this.mediaSource_.readyState;return a.mediaIndex>=s.length-1&&u&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,a.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(a))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_("getSyncInfoFromMediaSequenceSync_. Pulled target time from ".concat(e," to ").concat(t));const n=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!n)return null;if(!n.isAppended)return n;const i=this.mediaSequenceSync_.getSyncInfoForTime(n.end);return i?(i.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),i):null}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:i,startOfSegment:r,isSyncRequest:s,partIndex:a,forceTimestampOffset:o,getMediaInfoForTime:l}=e,c=n.segments[i],u="number"===typeof a&&c.parts[a],h={requestId:"segment-loader-"+Math.random(),uri:u&&u.resolvedUri||c.resolvedUri,mediaIndex:i,partIndex:u?a:null,isSyncRequest:s,startOfSegment:r,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:c.timeline,duration:u&&u.duration||c.duration,segment:c,part:u,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:l,independent:t},d="undefined"!==typeof o?o:this.isPendingTimestampOffset_;h.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:c.timeline,currentTimeline:this.currentTimeline_,startOfSegment:r,buffered:this.buffered_(),overrideCheck:d});const p=eo(this.sourceUpdater_.audioBuffered());return"number"===typeof p&&(h.audioAppendStart=p-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(h.gopsToAlignWith=((e,t,n)=>{if("undefined"===typeof t||null===t||!e.length)return[];const i=Math.ceil((t-n+3)*bt.ONE_SECOND_IN_TS);let r;for(r=0;r<e.length&&!(e[r].pts>i);r++);return e.slice(r)})(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),h}timestampOffsetForSegment_(e){return(e=>{let{segmentTimeline:t,currentTimeline:n,startOfSegment:i,buffered:r,overrideCheck:s}=e;return s||t!==n?t<n?i:r.length?r.end(r.length-1):i:null})(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,i=this.pendingSegment_.duration,r=_o.estimateSegmentRequestTime(i,n,this.playlist_,e.bytesReceived),s=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return((e.length?e.end(e.length-1):0)-t)/n}(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(r<=s)return;const a=function(e){const{main:t,currentTime:n,bandwidth:i,duration:r,segmentDuration:s,timeUntilRebuffer:a,currentTimeline:o,syncController:l}=e,c=t.playlists.filter(e=>!_o.isIncompatible(e));let u=c.filter(_o.isEnabled);u.length||(u=c.filter(e=>!_o.isDisabled(e)));const h=u.filter(_o.hasAttribute.bind(null,"BANDWIDTH")).map(e=>{const t=l.getSyncPoint(e,r,o,n)?1:2;return{playlist:e,rebufferingImpact:_o.estimateSegmentRequestTime(s,i,e)*t-a}}),d=h.filter(e=>e.rebufferingImpact<=0);return Gl(d,(e,t)=>ql(t.playlist,e.playlist)),d.length?d[0]:(Gl(h,(e,t)=>e.rebufferingImpact-t.rebufferingImpact),h[0]||null)}({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:i,timeUntilRebuffer:s,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!a)return;const o=r-s-a.rebufferingImpact;let l=.5;s<=Xa&&(l=1),!a.playlist||a.playlist.uri===this.playlist_.uri||o<l||(this.bandwidth=a.playlist.attributes.BANDWIDTH*dl.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_("Aborting ".concat(ic(e))),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:n,hasVideo:i}=t,r={segmentInfo:cc({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:n,hasVideo:i}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:r}),this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.checkForIllegalMediaSwitch(t)||(t=t||{},function(e,t){if(!e&&!t||!e&&t||e&&!t)return!1;if(e===t)return!0;const n=Object.keys(e).sort(),i=Object.keys(t).sort();if(n.length!==i.length)return!1;for(let r=0;r<n.length;r++){const s=n[r];if(s!==i[r])return!1;if(e[s]!==t[s])return!1}return!0}(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),this.checkForAbort_(e.requestId)||(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():ac(this)))}handleTimingInfo_(e,t,n,i){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const r=this.pendingSegment_,s=rc(t);r[s]=r[s]||{},r[s][n]=i,this.logger_("timinginfo: ".concat(t," - ").concat(n," - ").concat(i)),this.hasEnoughInfoToAppend_()?this.processCallQueue_():ac(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(0===t.length)return void this.logger_("SegmentLoader received no captions from a caption event");if(!this.pendingSegment_.hasAppendedData_)return void this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));const n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),i={};t.forEach(e=>{i[e.stream]=i[e.stream]||{startTime:1/0,captions:[],endTime:0};const t=i[e.stream];t.startTime=Math.min(t.startTime,e.startTime+n),t.endTime=Math.max(t.endTime,e.endTime+n),t.captions.push(e)}),Object.keys(i).forEach(e=>{const{startTime:t,endTime:s,captions:a}=i[e],o=this.inbandTextTracks_;this.logger_("adding cues from ".concat(t," -> ").concat(s," for ").concat(e)),function(e,t,n){if(!e[n]){t.trigger({type:"usage",name:"vhs-608"});let i=n;/^cc708_/.test(n)&&(i="SERVICE"+n.split("_")[1]);const r=t.textTracks().getTrackById(i);if(r)e[n]=r;else{let r=n,s=n,a=!1;const o=(t.options_.vhs&&t.options_.vhs.captionServices||{})[i];o&&(r=o.label,s=o.language,a=o.default),e[n]=t.addRemoteTextTrack({kind:"captions",id:i,default:a,label:r,language:s},!1).track}}}(o,this.vhs_.tech_,e),ec(t,s,o[e]),function(e){let{inbandTextTracks:t,captionArray:n,timestampOffset:i}=e;if(!n)return;const s=r().WebKitDataCue||r().VTTCue;n.forEach(e=>{const n=e.stream;e.content?e.content.forEach(r=>{const a=new s(e.startTime+i,e.endTime+i,r.text);a.line=r.line,a.align="left",a.position=r.position,a.positionAlign="line-left",t[n].addCue(a)}):t[n].addCue(new s(e.startTime+i,e.endTime+i,e.text))})}({captionArray:a,inbandTextTracks:o,timestampOffset:n})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;this.pendingSegment_.hasAppendedData_?this.addMetadataToTextTrack(n,t,this.duration_()):this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n))}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(e=>e())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(e=>e())}hasEnoughInfoToLoad_(){if("audio"!==this.loaderType_)return!0;const e=this.pendingSegment_;return!!e&&(!this.getCurrentMediaInfo_()||!sc({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}getCurrentMediaInfo_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pendingSegment_;return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pendingSegment_;return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:i,isMuxed:r}=t;return!(i&&!e.videoTimingInfo)&&(!(n&&!this.audioDisabled_&&!r&&!e.audioTimingInfo)&&!sc({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_())return ac(this),void this.callQueue_.push(this.handleData_.bind(this,e,t));const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[rc(t.type)].start;else{const e=this.getCurrentMediaInfo_(),t="main"===this.loaderType_&&e&&e.hasVideo;let i;t&&(i=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:t,firstVideoFrameTimeForData:i,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:"main"===this.loaderType_});const e=this.chooseNextRequest_();if(e.mediaIndex!==n.mediaIndex||e.partIndex!==n.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){"main"!==this.loaderType_||"number"!==typeof e.timestampOffset||e.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_(e){let{type:t,initSegment:n,map:i,playlist:r}=e;if(i){const e=$o(i);if(this.activeInitSegmentId_===e)return null;n=this.initSegmentForMap(i,!0).bytes,this.activeInitSegmentId_=e}return n&&this.appendInitSegment_[t]?(this.playlistOfLastInitSegment_[t]=r,this.appendInitSegment_[t]=!1,this.activeInitSegmentId_=null,n):null}handleQuotaExceededError_(e,t){let{segmentInfo:n,type:i,bytes:s}=e;const a=this.sourceUpdater_.audioBuffered(),o=this.sourceUpdater_.videoBuffered();a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Za(a).join(", ")),o.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Za(o).join(", "));const l=a.length?a.start(0):0,c=a.length?a.end(a.length-1):0,u=o.length?o.start(0):0,h=o.length?o.end(o.length-1):0;if(c-l<=1&&h-u<=1)return this.logger_("On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. "+"Appended byte length: ".concat(s.byteLength,", ")+"audio buffer: ".concat(Za(a).join(", "),", ")+"video buffer: ".concat(Za(o).join(", "),", ")),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:n,type:i,bytes:s}));const d=this.currentTime_()-1;this.logger_("On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ".concat(d)),this.remove(0,d,()=>{this.logger_("On QUOTA_EXCEEDED_ERR, retrying append in ".concat(1,"s")),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=r().setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},1e3)},!0)}handleAppendError_(e,t){let{segmentInfo:n,type:i,bytes:r}=e;t&&(22!==t.code?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",t),this.error({message:"".concat(i," append of ").concat(r.length,"b failed for segment ")+"#".concat(n.mediaIndex," in playlist ").concat(n.playlist.id),metadata:{errorType:Ma.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:n,type:i,bytes:r}))}appendToSourceBuffer_(e){let{segmentInfo:t,type:n,initSegment:i,data:r,bytes:s}=e;if(!s){const e=[r];let t=r.byteLength;i&&(e.unshift(i),t+=i.byteLength),s=(e=>{let t,n=0;return e.bytes&&(t=new Uint8Array(e.bytes),e.segments.forEach(e=>{t.set(e,n),n+=e.byteLength})),t})({bytes:t,segments:e})}const a={segmentInfo:cc({type:this.loaderType_,segment:t})};this.trigger({type:"segmentappendstart",metadata:a}),this.sourceUpdater_.appendBuffer({segmentInfo:t,type:n,bytes:s},this.handleAppendError_.bind(this,{segmentInfo:t,type:n,bytes:s}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const i=this.pendingSegment_.segment,r="".concat(e,"TimingInfo");i[r]||(i[r]={}),i[r].transmuxerPrependedSeconds=n.prependedContentDuration||0,i[r].transmuxedPresentationStart=n.start.presentation,i[r].transmuxedDecodeStart=n.start.decode,i[r].transmuxedPresentationEnd=n.end.presentation,i[r].transmuxedDecodeEnd=n.end.decode,i[r].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:i}=t;if(!i||!i.byteLength)return;if("audio"===n&&this.audioDisabled_)return;const r=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:r,data:i})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"===typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_())return ac(this),void this.loadQueue_.push(()=>{const t=h({},e,{forceTimestampOffset:!0});h(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),i=null!==this.mediaIndex,r=e.timeline!==this.currentTimeline_&&e.timeline>0,s=n||i&&r;this.logger_("Requesting\n".concat(Yl(e.uri),"\n").concat(ic(e))),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=Vl({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:s,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:t=>{let{message:n,level:i,stream:r}=t;this.logger_("".concat(ic(e)," logged from transmuxer stream ").concat(r," as a ").concat(i,": ").concat(n))},triggerSegmentEventFn:e=>{let{type:t,segment:n,keyInfo:i,trackInfo:r,timingInfo:s}=e;const a={segmentInfo:cc({segment:n})};i&&(a.keyInfo=i),r&&(a.trackInfo=r),s&&(a.timingInfo=s),this.trigger({type:t,metadata:a})}})}trimBackBuffer_(e){const t=((e,t,n)=>{let i=t-dl.BACK_BUFFER_LENGTH;e.length&&(i=Math.max(i,e.start(0)));const r=t-n;return Math.min(r,i)})(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,i=e.segment.key||e.segment.map&&e.segment.map.key,r=e.segment.map&&!e.segment.map.bytes,s={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:i,isMediaInitialization:r},a=e.playlist.segments[e.mediaIndex-1];if(a&&a.timeline===t.timeline&&(a.videoTimingInfo?s.baseStartTime=a.videoTimingInfo.transmuxedDecodeEnd:a.audioTimingInfo&&(s.baseStartTime=a.audioTimingInfo.transmuxedDecodeEnd)),t.key){const n=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);s.key=this.segmentKey(t.key),s.key.iv=n}return t.map&&(s.map=this.initSegmentForMap(t.map)),s}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<nc)return void this.logger_("Ignoring segment's bandwidth because its duration of ".concat(e)+" is less than the min to record ".concat(nc));const n={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:n}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length)return void this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return;if(t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===Nl)return;return this.pause(),e.code===El?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}const i=this.pendingSegment_;this.saveBandwidthRelatedStats_(i.duration,t.stats),i.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=((e,t,n)=>{if(!t.length)return e;if(n)return t.slice();const i=t[0].pts;let r=0;for(;r<e.length&&!(e[r].pts>=i);r++);return e.slice(0,r).concat(t)})(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(i)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);null!==t&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){"number"===typeof e.start&&"number"===typeof e.end?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())}trueSegmentStart_(e){let{currentStart:t,playlist:n,mediaIndex:i,firstVideoFrameTimeForData:r,currentVideoTimestampOffset:s,useVideoTimingInfo:a,videoTimingInfo:o,audioTimingInfo:l}=e;if("undefined"!==typeof t)return t;if(!a)return l.start;const c=n.segments[i-1];return 0!==i&&c&&"undefined"!==typeof c.start&&c.end===r+s?o.start:r}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t)return this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),void this.trigger("error");const{hasAudio:n,hasVideo:i,isMuxed:r}=t,s="main"===this.loaderType_&&i,a=!this.audioDisabled_&&n&&!r;if(e.waitingOnAppends=0,!e.hasAppendedData_)return e.timingInfo||"number"!==typeof e.timestampOffset||(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);s&&e.waitingOnAppends++,a&&e.waitingOnAppends++,s&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),a&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=((e,t,n)=>"main"===e&&t&&n?n.hasAudio||n.hasVideo?t.hasVideo&&!n.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.hasVideo&&n.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null)(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!t&&(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0)}updateSourceBufferTimestampOffset_(e){if(null===e.timestampOffset||"number"!==typeof e.timingInfo.start||e.changedTimestampOffset||"main"!==this.loaderType_)return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_(e){let{videoTimingInfo:t,audioTimingInfo:n,timingInfo:i}=e;return this.useDtsForTimestampOffset_?t&&"number"===typeof t.transmuxedDecodeStart?t.transmuxedDecodeStart:n&&"number"===typeof n.transmuxedDecodeStart?n.transmuxedDecodeStart:i.start:i.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),n="main"===this.loaderType_&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;n&&(e.timingInfo.end="number"===typeof n.end?n.end:n.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const e={segmentInfo:cc({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:e})}if(!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});const t=lc(e,this.sourceType_);if(t&&("warn"===t.severity?Ma.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_))return void this.logger_("Throwing away un-appended sync request ".concat(ic(e)));this.logger_("Appended ".concat(ic(e))),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,i=e.part,r=n.end&&this.currentTime_()-n.end>3*e.playlist.targetDuration,s=i&&i.end&&this.currentTime_()-i.end>3*e.playlist.partTargetDuration;if(r||s)return this.logger_("bad ".concat(r?"segment":"part"," ").concat(ic(e))),void this.resetEverything();null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<nc)return void this.logger_("Ignoring segment's throughput because its duration of ".concat(e.duration)+" is less than the min to record ".concat(nc));const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,i=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(i-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,i=t.end;if(!tc(n)||!tc(i))return;ec(n,i,this.segmentMetadataTrack_);const s=r().WebKitDataCue||r().VTTCue,a={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:i},o=new s(n,i,JSON.stringify(a));o.value=a,this.segmentMetadataTrack_.addCue(o)}}function hc(){}const dc=function(e){return"string"!==typeof e?e:e.replace(/./,e=>e.toUpperCase())},pc=["video","audio"],fc=(e,t)=>{const n=t["".concat(e,"Buffer")];return n&&n.updating||t.queuePending[e]},gc=(e,t)=>{if(0===t.queue.length)return;let n=0,i=t.queue[n];if("mediaSource"!==i.type){if("mediaSource"!==e&&t.ready()&&"closed"!==t.mediaSource.readyState&&!fc(e,t)){if(i.type!==e){if(n=((e,t)=>{for(let n=0;n<t.length;n++){const i=t[n];if("mediaSource"===i.type)return null;if(i.type===e)return n}return null})(e,t.queue),null===n)return;i=t.queue[n]}return t.queue.splice(n,1),t.queuePending[e]=i,i.action(e,t),i.doneFn?void 0:(t.queuePending[e]=null,void gc(e,t))}}else t.updating()||"closed"===t.mediaSource.readyState||(t.queue.shift(),i.action(t),i.doneFn&&i.doneFn(),gc("audio",t),gc("video",t))},mc=(e,t)=>{const n=t["".concat(e,"Buffer")],i=dc(e);n&&(n.removeEventListener("updateend",t["on".concat(i,"UpdateEnd_")]),n.removeEventListener("error",t["on".concat(i,"Error_")]),t.codecs[e]=null,t["".concat(e,"Buffer")]=null)},yc=(e,t)=>e&&t&&-1!==Array.prototype.indexOf.call(e.sourceBuffers,t),bc=(e,t,n)=>(i,r)=>{const s=r["".concat(i,"Buffer")];if(yc(r.mediaSource,s)){r.logger_("Appending segment ".concat(t.mediaIndex,"'s ").concat(e.length," bytes to ").concat(i,"Buffer"));try{s.appendBuffer(e)}catch(a){r.logger_("Error with code ".concat(a.code," ")+(22===a.code?"(QUOTA_EXCEEDED_ERR) ":"")+"when appending segment ".concat(t.mediaIndex," to ").concat(i,"Buffer")),r.queuePending[i]=null,n(a)}}},vc=(e,t)=>(n,i)=>{const r=i["".concat(n,"Buffer")];if(yc(i.mediaSource,r)){i.logger_("Removing ".concat(e," to ").concat(t," from ").concat(n,"Buffer"));try{r.remove(e,t)}catch(s){i.logger_("Remove ".concat(e," to ").concat(t," from ").concat(n,"Buffer failed"))}}},_c=e=>(t,n)=>{const i=n["".concat(t,"Buffer")];yc(n.mediaSource,i)&&(n.logger_("Setting ".concat(t,"timestampOffset to ").concat(e)),i.timestampOffset=e)},xc=e=>(t,n)=>{e()},wc=e=>t=>{if("open"===t.mediaSource.readyState){t.logger_("Calling mediaSource endOfStream(".concat(e||"",")"));try{t.mediaSource.endOfStream(e)}catch(n){Ma.log.warn("Failed to call media source endOfStream",n)}}},Tc=e=>t=>{t.logger_("Setting mediaSource duration to ".concat(e));try{t.mediaSource.duration=e}catch(n){Ma.log.warn("Failed to set media source duration",n)}},kc=()=>(e,t)=>{if("open"!==t.mediaSource.readyState)return;const n=t["".concat(e,"Buffer")];if(yc(t.mediaSource,n)){t.logger_("calling abort on ".concat(e,"Buffer"));try{n.abort()}catch(i){Ma.log.warn("Failed to abort on ".concat(e,"Buffer"),i)}}},Sc=(e,t)=>n=>{const i=dc(e),r=R(t);n.logger_("Adding ".concat(e,"Buffer with codec ").concat(t," to mediaSource"));const s=n.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",n["on".concat(i,"UpdateEnd_")]),s.addEventListener("error",n["on".concat(i,"Error_")]),n.codecs[e]=t,n["".concat(e,"Buffer")]=s},Cc=e=>t=>{const n=t["".concat(e,"Buffer")];if(mc(e,t),yc(t.mediaSource,n)){t.logger_("Removing ".concat(e,"Buffer with codec ").concat(t.codecs[e]," from mediaSource"));try{t.mediaSource.removeSourceBuffer(n)}catch(i){Ma.log.warn("Failed to removeSourceBuffer ".concat(e,"Buffer"),i)}}},Ic=e=>(t,n)=>{const i=n["".concat(t,"Buffer")],r=R(e);if(!yc(n.mediaSource,i))return;const s=e.substring(0,e.indexOf(".")),a=n.codecs[t];if(a.substring(0,a.indexOf("."))===s)return;const o={codecsChangeInfo:{from:a,to:e}};n.trigger({type:"codecschange",metadata:o}),n.logger_("changing ".concat(t,"Buffer codec from ").concat(a," to ").concat(e));try{i.changeType(r),n.codecs[t]=e}catch(l){o.errorType=Ma.Error.StreamingCodecsChangeError,o.error=l,l.metadata=o,n.error_=l,n.trigger("error"),Ma.log.warn("Failed to changeType on ".concat(t,"Buffer"),l)}},Ec=e=>{let{type:t,sourceUpdater:n,action:i,doneFn:r,name:s}=e;n.queue.push({type:t,action:i,doneFn:r,name:s}),gc(t,n)},Nc=(e,t)=>n=>{const i=function(e){if(0===e.length)return"Buffered Ranges are empty";let t="Buffered Ranges: \n";for(let n=0;n<e.length;n++){const i=e.start(n),r=e.end(n);t+="".concat(i," --\x3e ").concat(r,". Duration (").concat(r-i,")\n")}return t}(t["".concat(e,"Buffered")]());if(t.logger_('received "updateend" event for '.concat(e," Source Buffer: "),i),t.queuePending[e]){const n=t.queuePending[e].doneFn;t.queuePending[e]=null,n&&n(t["".concat(e,"Error_")])}gc(e,t)};class Ac extends Ma.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>gc("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=Ha("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=Nc("video",this),this.onAudioUpdateEnd_=Nc("audio",this),this.onVideoError_=e=>{this.videoError_=e},this.onAudioError_=e=>{this.audioError_=e},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){Ec({type:"mediaSource",sourceUpdater:this,action:Sc(e,t),name:"addSourceBuffer"})}abort(e){Ec({type:e,sourceUpdater:this,action:kc(e),name:"abort"})}removeSourceBuffer(e){this.canRemoveSourceBuffer()?Ec({type:"mediaSource",sourceUpdater:this,action:Cc(e),name:"removeSourceBuffer"}):Ma.log.error("removeSourceBuffer is not supported!")}canRemoveSourceBuffer(){return!Ma.browser.IS_FIREFOX&&r().MediaSource&&r().MediaSource.prototype&&"function"===typeof r().MediaSource.prototype.removeSourceBuffer}static canChangeType(){return r().SourceBuffer&&r().SourceBuffer.prototype&&"function"===typeof r().SourceBuffer.prototype.changeType}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){this.canChangeType()?Ec({type:e,sourceUpdater:this,action:Ic(t),name:"changeType"}):Ma.log.error("changeType is not supported!")}addOrChangeSourceBuffers(e){if(!e||"object"!==typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)})}appendBuffer(e,t){const{segmentInfo:n,type:i,bytes:r}=e;if(this.processedAppend_=!0,"audio"===i&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,t]),void this.logger_("delayed audio append of ".concat(r.length," until video append"));if(Ec({type:i,sourceUpdater:this,action:bc(r,n||{mediaIndex:-1},t),doneFn:t,name:"appendBuffer"}),"video"===i){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const e=this.delayedAudioAppendQueue_.slice();this.logger_("queuing delayed audio ".concat(e.length," appendBuffers")),this.delayedAudioAppendQueue_.length=0,e.forEach(e=>{this.appendBuffer.apply(this,e)})}}audioBuffered(){return yc(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:qa()}videoBuffered(){return yc(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:qa()}buffered(){const e=yc(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=yc(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():function(e,t){let n=null,i=null,r=0;const s=[],a=[];if(!e||!e.length||!t||!t.length)return qa();let o=e.length;for(;o--;)s.push({time:e.start(o),type:"start"}),s.push({time:e.end(o),type:"end"});for(o=t.length;o--;)s.push({time:t.start(o),type:"start"}),s.push({time:t.end(o),type:"end"});for(s.sort(function(e,t){return e.time-t.time}),o=0;o<s.length;o++)"start"===s[o].type?(r++,2===r&&(n=s[o].time)):"end"===s[o].type&&(r--,1===r&&(i=s[o].time)),null!==n&&null!==i&&(a.push([n,i]),n=null,i=null);return qa(a)}(this.audioBuffered(),this.videoBuffered())}setDuration(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hc;Ec({type:"mediaSource",sourceUpdater:this,action:Tc(e),name:"duration",doneFn:t})}endOfStream(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hc;"string"!==typeof e&&(e=void 0),Ec({type:"mediaSource",sourceUpdater:this,action:wc(e),name:"endOfStream",doneFn:t})}removeAudio(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:hc;this.audioBuffered().length&&0!==this.audioBuffered().end(0)?Ec({type:"audio",sourceUpdater:this,action:vc(e,t),doneFn:n,name:"remove"}):n()}removeVideo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:hc;this.videoBuffered().length&&0!==this.videoBuffered().end(0)?Ec({type:"video",sourceUpdater:this,action:vc(e,t),doneFn:n,name:"remove"}):n()}updating(){return!(!fc("audio",this)&&!fc("video",this))}audioTimestampOffset(e){return"undefined"!==typeof e&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Ec({type:"audio",sourceUpdater:this,action:_c(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return"undefined"!==typeof e&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(Ec({type:"video",sourceUpdater:this,action:_c(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&Ec({type:"audio",sourceUpdater:this,action:xc(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&Ec({type:"video",sourceUpdater:this,action:xc(e),name:"callback"})}dispose(){this.trigger("dispose"),pc.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this["".concat(e,"QueueCallback")](()=>mc(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const Rc=e=>decodeURIComponent(escape(String.fromCharCode.apply(null,e))),Dc=new Uint8Array("\n\n".split("").map(e=>e.charCodeAt(0)));class Oc extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class Lc extends uc{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return qa();const e=this.subtitlesTrack_.cues;return qa([[e[0].startTime,e[e.length-1].startTime]])}initSegmentForMap(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;const n=$o(e);let i=this.initSegments_[n];if(t&&!i&&e.bytes){const t=Dc.byteLength+e.bytes.byteLength,r=new Uint8Array(t);r.set(e.bytes),r.set(Dc,e.bytes.byteLength),this.initSegments_[n]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:r}}return i||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return"undefined"===typeof e||(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_}remove(e,t){ec(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(null===this.syncController_.timestampOffsetForTimeline(e.timeline)){const e=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};return this.syncController_.one("timestampoffset",e),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_)return void(this.state="READY");if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(e)return e.code===El&&this.handleTimeout_(),e.code===Nl?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(e);const i=this.pendingSegment_,s=n.mp4VttCues&&n.mp4VttCues.length;s&&(i.mp4VttCues=n.mp4VttCues),this.saveBandwidthRelatedStats_(i.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const a=i.segment;if(a.map&&(a.map.bytes=t.map.bytes),i.bytes=t.bytes,"function"!==typeof r().WebVTT&&"function"===typeof this.loadVttJs)return this.state="WAITING_ON_VTTJS",void this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,n),()=>this.stopForError({message:"Error loading vtt.js"}));a.requested=!0;try{this.parseVTTCues_(i)}catch(o){return void this.stopForError({message:o.message,metadata:{errorType:Ma.Error.StreamingVttParserError,error:o}})}if(s||this.updateTimeMapping_(i,this.syncController_.timelines[i.timeline],this.playlist_),i.cues.length?i.timingInfo={start:i.cues[0].startTime,end:i.cues[i.cues.length-1].endTime}:i.timingInfo={start:i.startOfSegment,end:i.startOfSegment+i.duration},i.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");i.byteLength=i.bytes.byteLength,this.mediaSecondsLoaded+=a.duration,i.cues.forEach(e=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new(r().VTTCue)(e.startTime,e.endTime,e.text):e)}),function(e){const t=e.cues;if(!t)return;const n={};for(let i=t.length-1;i>=0;i--){const r=t[i],s="".concat(r.startTime,"-").concat(r.endTime,"-").concat(r.text);n[s]?e.removeCue(r):n[s]=r}}(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,t){const n=e&&"vtt"===e.type,i=t&&"text"===t.type;n&&i&&super.handleData_(e,t)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const t=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(n=>{const i=n.start+t,s=n.end+t,a=new(r().VTTCue)(i,s,n.cueText);n.settings&&n.settings.split(" ").forEach(e=>{const t=e.split(":"),n=t[0],i=t[1];a[n]=isNaN(i)?i:Number(i)}),e.cues.push(a)})}parseVTTCues_(e){let t,n=!1;if("function"!==typeof r().WebVTT)throw new Oc;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues)return void this.parseMp4VttCues_(e);"function"===typeof r().TextDecoder?t=new(r().TextDecoder)("utf8"):(t=r().WebVTT.StringDecoder(),n=!0);const i=new(r().WebVTT.Parser)(r(),r().vttjs,t);if(i.oncue=e.cues.push.bind(e.cues),i.ontimestampmap=t=>{e.timestampmap=t},i.onparsingerror=e=>{Ma.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){let t=e.segment.map.bytes;n&&(t=Rc(t)),i.parse(t)}let s=e.bytes;n&&(s=Rc(s)),i.parse(s),i.flush()}updateTimeMapping_(e,t,n){const i=e.segment;if(!t)return;if(!e.cues.length)return void(i.empty=!0);const{MPEGTS:r,LOCAL:s}=e.timestampmap,a=r/bt.ONE_SECOND_IN_TS-s+t.mapping;if(e.cues.forEach(e=>{const n=e.endTime-e.startTime,i=this.handleRollover_(e.startTime+a,t.time);e.startTime=Math.max(i,0),e.endTime=Math.max(i+n,0)}),!n.syncInfo){const t=e.cues[0].startTime,r=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(t,r-i.duration)}}}handleRollover_(e,t){if(null===t)return e;let n=e*bt.ONE_SECOND_IN_TS;const i=t*bt.ONE_SECOND_IN_TS;let r;for(r=i<n?-8589934592:8589934592;Math.abs(n-i)>4294967296;)n+=r;return n/bt.ONE_SECOND_IN_TS}}const Pc=function(e,t){const n=e.cues;for(let i=0;i<n.length;i++){const e=n[i];if(t>=e.adStartTime&&t<=e.adEndTime)return e}return null};class Fc{constructor(e){let{start:t,end:n,segmentIndex:i,partIndex:r=null,appended:s=!1}=e;this.start_=t,this.end_=n,this.segmentIndex_=i,this.partIndex_=r,this.appended_=s}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class Mc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class Uc{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:n,segments:i}=e;if(this.isReliable_=this.isReliablePlaylist_(n,i),this.isReliable_)return this.updateStorage_(i,n,this.calculateBaseTime_(n,i,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:n}of this.storage_.values())if(n.length){for(const i of n)if(i.isInRange(e))return i}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,n){const i=new Map;let r="\n",s=n,a=t;this.start_=s,e.forEach((e,t)=>{const n=this.storage_.get(a),o=s,l=o+e.duration,c=Boolean(n&&n.segmentSyncInfo&&n.segmentSyncInfo.isAppended),u=new Fc({start:o,end:l,appended:c,segmentIndex:t});e.syncInfo=u;let h=s;const d=(e.parts||[]).map((e,i)=>{const s=h,o=h+e.duration,l=Boolean(n&&n.partsSyncInfo&&n.partsSyncInfo[i]&&n.partsSyncInfo[i].isAppended),c=new Fc({start:s,end:o,appended:l,segmentIndex:t,partIndex:i});return h=o,r+="Media Sequence: ".concat(a,".").concat(i," | Range: ").concat(s," --\x3e ").concat(o," | Appended: ").concat(l,"\n"),e.syncInfo=c,c});i.set(a,new Mc(u,d)),r+="".concat(Yl(e.resolvedUri)," | Media Sequence: ").concat(a," | Range: ").concat(o," --\x3e ").concat(l," | Appended: ").concat(c,"\n"),a++,s=l}),this.end_=s,this.storage_=i,this.diagnostics_=r}calculateBaseTime_(e,t,n){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const i=Math.min(...this.storage_.keys());if(e<i){const n=i-e;let r=this.storage_.get(i).segmentSyncInfo.start;for(let e=0;e<n;e++){r-=t[e].duration}return r}return n}isReliablePlaylist_(e,t){return void 0!==e&&null!==e&&Array.isArray(t)&&t.length}}class Bc extends Uc{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t,n){if(!this.storage_.size){const t=this.parent_.getSyncInfoForMediaSequence(e);return t?t.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t,n)}}const zc=[{name:"VOD",run:(e,t,n,i,r)=>{if(n!==1/0){return{time:0,segmentIndex:0,partIndex:null}}return null}},{name:"MediaSequence",run:(e,t,n,i,r,s)=>{const a=e.getMediaSequenceSync(s);if(!a)return null;if(!a.isReliable)return null;const o=a.getSyncInfoForTime(r);return o?{time:o.start,partIndex:o.partIndex,segmentIndex:o.segmentIndex}:null}},{name:"ProgramDateTime",run:(e,t,n,i,r)=>{if(!Object.keys(e.timelineToDatetimeMappings).length)return null;let s=null,a=null;const o=io(t);r=r||0;for(let l=0;l<o.length;l++){const n=o[t.endList||0===r?l:o.length-(l+1)],i=n.segment,c=e.timelineToDatetimeMappings[i.timeline];if(!c||!i.dateTimeObject)continue;let u=i.dateTimeObject.getTime()/1e3+c;if(i.parts&&"number"===typeof n.partIndex)for(let e=0;e<n.partIndex;e++)u+=i.parts[e].duration;const h=Math.abs(r-u);if(null!==a&&(0===h||a<h))break;a=h,s={time:u,segmentIndex:n.segmentIndex,partIndex:n.partIndex}}return s}},{name:"Segment",run:(e,t,n,i,r)=>{let s=null,a=null;r=r||0;const o=io(t);for(let l=0;l<o.length;l++){const e=o[t.endList||0===r?l:o.length-(l+1)],n=e.segment,c=e.part&&e.part.start||n&&n.start;if(n.timeline===i&&"undefined"!==typeof c){const t=Math.abs(r-c);if(null!==a&&a<t)break;(!s||null===a||a>=t)&&(a=t,s={time:c,segmentIndex:e.segmentIndex,partIndex:e.partIndex})}}return s}},{name:"Discontinuity",run:(e,t,n,i,r)=>{let s=null;if(r=r||0,t.discontinuityStarts&&t.discontinuityStarts.length){let n=null;for(let i=0;i<t.discontinuityStarts.length;i++){const a=t.discontinuityStarts[i],o=t.discontinuitySequence+i+1,l=e.discontinuities[o];if(l){const e=Math.abs(r-l.time);if(null!==n&&n<e)break;(!s||null===n||n>=e)&&(n=e,s={time:l.time,segmentIndex:a,partIndex:null})}}}return s}},{name:"Playlist",run:(e,t,n,i,r)=>{if(t.syncInfo){return{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence,partIndex:null}}return null}}];class Vc extends Ma.EventTarget{constructor(){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const e=new Uc,t=new Bc(e),n=new Bc(e);this.mediaSequenceStorage_={main:e,audio:t,vtt:n},this.logger_=Ha("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,n,i,r){if(t!==1/0){return zc.find(e=>{let{name:t}=e;return"VOD"===t}).run(this,e,t)}const s=this.runStrategies_(e,t,n,i,r);if(!s.length)return null;for(const a of s){const{syncPoint:t,strategy:n}=a,{segmentIndex:r,time:s}=t;if(r<0)continue;const o=s,l=o+e.segments[r].duration;if(this.logger_("Strategy: ".concat(n,". Current time: ").concat(i,". selected segment: ").concat(r,". Time: [").concat(o," -> ").concat(l,"]}")),i>=o&&i<l)return this.logger_("Found sync point with exact match: ",t),t}return this.selectSyncPoint_(s,{key:"time",value:i})}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const i=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return i.segmentIndex>0&&(i.time*=-1),Math.abs(i.time+co({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:i.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,i,r){const s=[];for(let a=0;a<zc.length;a++){const o=zc[a],l=o.run(this,e,t,n,i,r);l&&(l.strategy=o.name,s.push({strategy:o.name,syncPoint:l}))}return s}selectSyncPoint_(e,t){let n=e[0].syncPoint,i=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy;for(let s=1;s<e.length;s++){const a=Math.abs(e[s].syncPoint[t.key]-t.value);a<i&&(i=a,n=e[s].syncPoint,r=e[s].strategy)}return this.logger_("syncPoint for [".concat(t.key,": ").concat(t.value,"] chosen with strategy")+" [".concat(r,"]: [time:").concat(n.time,",")+" segmentIndex:".concat(n.segmentIndex)+("number"===typeof n.partIndex?",partIndex:".concat(n.partIndex):"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>86400)Ma.log.warn("Not saving expired segment info. Media sequence gap ".concat(n," is too large."));else for(let i=n-1;i>=0;i--){const n=e.segments[i];if(n&&"undefined"!==typeof n.start){t.syncInfo={mediaSequence:e.mediaSequence+i,time:n.start},this.logger_("playlist refresh sync: [time:".concat(t.syncInfo.time,",")+" mediaSequence: ".concat(t.syncInfo.mediaSequence,"]")),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo(e){let{segmentInfo:t,shouldSaveTimelineMapping:n}=e;const i=this.calculateSegmentTimeMapping_(t,t.timingInfo,n),r=t.segment;i&&(this.saveDiscontinuitySyncInfo_(t),t.playlist.syncInfo||(t.playlist.syncInfo={mediaSequence:t.playlist.mediaSequence+t.mediaIndex,time:r.start}));const s=r.dateTimeObject;r.discontinuity&&n&&s&&(this.timelineToDatetimeMappings[r.timeline]=-s.getTime()/1e3)}timestampOffsetForTimeline(e){return"undefined"===typeof this.timelines[e]?null:this.timelines[e].time}mappingForTimeline(e){return"undefined"===typeof this.timelines[e]?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const i=e.segment,r=e.part;let s,a,o=this.timelines[e.timeline];if("number"===typeof e.timestampOffset)o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_("time mapping for timeline ".concat(e.timeline,": ")+"[time: ".concat(o.time,"] [mapping: ").concat(o.mapping,"]"))),s=e.startOfSegment,a=t.end+o.mapping;else{if(!o)return!1;s=t.start+o.mapping,a=t.end+o.mapping}return r&&(r.start=s,r.end=a),(!i.start||s<i.start)&&(i.start=s),i.end=a,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let i=0;i<t.discontinuityStarts.length;i++){const r=t.discontinuityStarts[i],s=t.discontinuitySequence+i+1,a=r-e.mediaIndex,o=Math.abs(a);if(!this.discontinuities[s]||this.discontinuities[s].accuracy>o){let i;i=a<0?n.start-co({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:r}):n.end+co({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:r}),this.discontinuities[s]={time:i,accuracy:o}}}}dispose(){this.trigger("dispose"),this.off()}}class jc extends Ma.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange(e){let{type:t,from:n,to:i}=e;return"number"===typeof n&&"number"===typeof i&&(this.pendingTimelineChanges_[t]={type:t,from:n,to:i},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[t]}lastTimelineChange(e){let{type:t,from:n,to:i}=e;if("number"===typeof n&&"number"===typeof i){this.lastTimelineChanges_[t]={type:t,from:n,to:i},delete this.pendingTimelineChanges_[t];const e={timelineChangeInfo:{from:n,to:i}};this.trigger({type:"timelinechange",metadata:e})}return this.lastTimelineChanges_[t]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const Wc=gl(ml(function(){var e=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();let t=null;class i{constructor(e){let n,i,r;t||(t=function(){const e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],n=e[1],i=t[4],r=n[4];let s,a,o;const l=[],c=[];let u,h,d,p,f,g;for(s=0;s<256;s++)c[(l[s]=s<<1^283*(s>>7))^s]=s;for(a=o=0;!i[a];a^=u||1,o=c[o]||1)for(p=o^o<<1^o<<2^o<<3^o<<4,p=p>>8^255&p^99,i[a]=p,r[p]=a,d=l[h=l[u=l[a]]],g=16843009*d^65537*h^257*u^16843008*a,f=257*l[p]^16843008*p,s=0;s<4;s++)t[s][a]=f=f<<24^f>>>8,n[s][p]=g=g<<24^g>>>8;for(s=0;s<5;s++)t[s]=t[s].slice(0),n[s]=n[s].slice(0);return e}()),this._tables=[[t[0][0].slice(),t[0][1].slice(),t[0][2].slice(),t[0][3].slice(),t[0][4].slice()],[t[1][0].slice(),t[1][1].slice(),t[1][2].slice(),t[1][3].slice(),t[1][4].slice()]];const s=this._tables[0][4],a=this._tables[1],o=e.length;let l=1;if(4!==o&&6!==o&&8!==o)throw new Error("Invalid aes key size");const c=e.slice(0),u=[];for(this._key=[c,u],n=o;n<4*o+28;n++)r=c[n-1],(n%o===0||8===o&&n%o===4)&&(r=s[r>>>24]<<24^s[r>>16&255]<<16^s[r>>8&255]<<8^s[255&r],n%o===0&&(r=r<<8^r>>>24^l<<24,l=l<<1^283*(l>>7))),c[n]=c[n-o]^r;for(i=0;n;i++,n--)r=c[3&i?n:n-4],u[i]=n<=4||i<4?r:a[0][s[r>>>24]]^a[1][s[r>>16&255]]^a[2][s[r>>8&255]]^a[3][s[255&r]]}decrypt(e,t,n,i,r,s){const a=this._key[1];let o,l,c,u=e^a[0],h=i^a[1],d=n^a[2],p=t^a[3];const f=a.length/4-2;let g,m=4;const y=this._tables[1],b=y[0],v=y[1],_=y[2],x=y[3],w=y[4];for(g=0;g<f;g++)o=b[u>>>24]^v[h>>16&255]^_[d>>8&255]^x[255&p]^a[m],l=b[h>>>24]^v[d>>16&255]^_[p>>8&255]^x[255&u]^a[m+1],c=b[d>>>24]^v[p>>16&255]^_[u>>8&255]^x[255&h]^a[m+2],p=b[p>>>24]^v[u>>16&255]^_[h>>8&255]^x[255&d]^a[m+3],m+=4,u=o,h=l,d=c;for(g=0;g<4;g++)r[(3&-g)+s]=w[u>>>24]<<24^w[h>>16&255]<<16^w[d>>8&255]<<8^w[255&p]^a[m++],o=u,u=h,h=d,d=p,p=o}}class r extends e{constructor(){super(e),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const s=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24};class a{constructor(e,t,n,i){const o=a.STEP,l=new Int32Array(e.buffer),c=new Uint8Array(e.byteLength);let u=0;for(this.asyncStream_=new r,this.asyncStream_.push(this.decryptChunk_(l.subarray(u,u+o),t,n,c)),u=o;u<l.length;u+=o)n=new Uint32Array([s(l[u-4]),s(l[u-3]),s(l[u-2]),s(l[u-1])]),this.asyncStream_.push(this.decryptChunk_(l.subarray(u,u+o),t,n,c));this.asyncStream_.push(function(){var e;i(null,(e=c).subarray(0,e.byteLength-e[e.byteLength-1]))})}static get STEP(){return 32e3}decryptChunk_(e,t,n,r){return function(){const a=function(e,t,n){const r=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),a=new i(Array.prototype.slice.call(t)),o=new Uint8Array(e.byteLength),l=new Int32Array(o.buffer);let c,u,h,d,p,f,g,m,y;for(c=n[0],u=n[1],h=n[2],d=n[3],y=0;y<r.length;y+=4)p=s(r[y]),f=s(r[y+1]),g=s(r[y+2]),m=s(r[y+3]),a.decrypt(p,f,g,m,l,y),l[y]=s(l[y]^c),l[y+1]=s(l[y+1]^u),l[y+2]=s(l[y+2]^h),l[y+3]=s(l[y+3]^d),c=p,u=f,h=g,d=m;return o}(e,t,n);r.set(a,e.byteOffset)}}}var o,l="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{};o="undefined"!==typeof window?window:"undefined"!==typeof l?l:"undefined"!==typeof self?self:{};var c=o.BigInt||Number;c("0x1"),c("0x100"),c("0x10000"),c("0x1000000"),c("0x100000000"),c("0x10000000000"),c("0x1000000000000"),c("0x100000000000000"),c("0x10000000000000000"),function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}();const u=function(e){const t={};return Object.keys(e).forEach(n=>{const i=e[n];var r;r=i,("function"===ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer)?t[n]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:t[n]=i}),t};self.onmessage=function(e){const t=e.data,n=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),i=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),r=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new a(n,i,r,function(e,n){self.postMessage(u({source:t.source,decrypted:n}),[n.buffer])})}}));var Hc=fl(Wc);const Gc=e=>{let t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},qc=(e,t)=>{e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},Xc=(e,t)=>{t.activePlaylistLoader=e,e.load()},Kc={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:n},excludePlaylist:i}=t,r=n.activeTrack(),s=n.activeGroup(),a=(s.filter(e=>e.default)[0]||s[0]).id,o=n.tracks[a];if(r!==o){Ma.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const e in n.tracks)n.tracks[e].enabled=n.tracks[e]===o;n.onTrackChanged()}else i({error:{message:"Problem encountered loading the default audio track."}})},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:n}}=t;Ma.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const i=n.activeTrack();i&&(i.mode="disabled"),n.onTrackChanged()}},Yc={AUDIO:(e,t,n)=>{if(!t)return;const{tech:i,requestOptions:r,segmentLoaders:{[e]:s}}=n;t.on("loadedmetadata",()=>{const e=t.media();s.playlist(e,r),(!i.paused()||e.endList&&"none"!==i.preload())&&s.load()}),t.on("loadedplaylist",()=>{s.playlist(t.media(),r),i.paused()||s.load()}),t.on("error",Kc[e](e,n))},SUBTITLES:(e,t,n)=>{const{tech:i,requestOptions:r,segmentLoaders:{[e]:s},mediaTypes:{[e]:a}}=n;t.on("loadedmetadata",()=>{const e=t.media();s.playlist(e,r),s.track(a.activeTrack()),(!i.paused()||e.endList&&"none"!==i.preload())&&s.load()}),t.on("loadedplaylist",()=>{s.playlist(t.media(),r),i.paused()||s.load()}),t.on("error",Kc[e](e,n))}},Qc={AUDIO:(e,t)=>{const{vhs:n,sourceType:i,segmentLoaders:{[e]:r},requestOptions:s,main:{mediaGroups:a},mediaTypes:{[e]:{groups:o,tracks:l,logger_:c}},mainPlaylistLoader:u}=t,h=vo(u.main);a[e]&&0!==Object.keys(a[e]).length||(a[e]={main:{default:{default:!0}}},h&&(a[e].main.default.playlists=u.main.playlists));for(const d in a[e]){o[d]||(o[d]=[]);for(const r in a[e][d]){let p,f=a[e][d][r];if(h?(c("AUDIO group '".concat(d,"' label '").concat(r,"' is a main playlist")),f.isMainPlaylist=!0,p=null):p="vhs-json"===i&&f.playlists?new Wo(f.playlists[0],n,s):f.resolvedUri?new Wo(f.resolvedUri,n,s):f.playlists&&"dash"===i?new hl(f.playlists[0],n,s,u):null,f=Ga({id:r,playlistLoader:p},f),Yc[e](e,f.playlistLoader,t),o[d].push(f),"undefined"===typeof l[r]){const e=new Ma.AudioTrack({id:r,kind:Gc(f),enabled:!1,language:f.language,default:f.default,label:r});l[r]=e}}}r.on("error",Kc[e](e,t))},SUBTITLES:(e,t)=>{const{tech:n,vhs:i,sourceType:r,segmentLoaders:{[e]:s},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[e]:{groups:l,tracks:c}},mainPlaylistLoader:u}=t;for(const h in o[e]){l[h]||(l[h]=[]);for(const s in o[e][h]){if(!i.options_.useForcedSubtitles&&o[e][h][s].forced)continue;let d,p=o[e][h][s];if("hls"===r)d=new Wo(p.resolvedUri,i,a);else if("dash"===r){if(!p.playlists.filter(e=>e.excludeUntil!==1/0).length)return;d=new hl(p.playlists[0],i,a,u)}else"vhs-json"===r&&(d=new Wo(p.playlists?p.playlists[0]:p.resolvedUri,i,a));if(p=Ga({id:s,playlistLoader:d},p),Yc[e](e,p.playlistLoader,t),l[h].push(p),"undefined"===typeof c[s]){const e=n.addRemoteTextTrack({id:s,kind:"subtitles",default:p.default&&p.autoselect,language:p.language,label:s},!1).track;c[s]=e}}}s.on("error",Kc[e](e,t))},"CLOSED-CAPTIONS":(e,t)=>{const{tech:n,main:{mediaGroups:i},mediaTypes:{[e]:{groups:r,tracks:s}}}=t;for(const a in i[e]){r[a]||(r[a]=[]);for(const t in i[e][a]){const o=i[e][a][t];if(!/^(?:CC|SERVICE)/.test(o.instreamId))continue;const l=n.options_.vhs&&n.options_.vhs.captionServices||{};let c={label:t,language:o.language,instreamId:o.instreamId,default:o.default&&o.autoselect};if(l[c.instreamId]&&(c=Ga(c,l[c.instreamId])),void 0===c.default&&delete c.default,r[a].push(Ga({id:t},o)),"undefined"===typeof s[t]){const e=n.addRemoteTextTrack({id:c.instreamId,kind:"captions",default:c.default,language:c.language,label:c.label},!1).track;s[t]=e}}}}},$c=(e,t)=>{for(let n=0;n<e.length;n++){if(yo(t,e[n]))return!0;if(e[n].playlists&&$c(e[n].playlists,t))return!0}return!1},Jc={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if(n[e].enabled)return n[e];return null},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if("showing"===n[e].mode||"hidden"===n[e].mode)return n[e];return null}},Zc=e=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(t=>{Qc[t](t,e)});const{mediaTypes:t,mainPlaylistLoader:n,tech:i,vhs:r,segmentLoaders:{AUDIO:s,main:a}}=e;["AUDIO","SUBTITLES"].forEach(n=>{t[n].activeGroup=((e,t)=>n=>{const{mainPlaylistLoader:i,mediaTypes:{[e]:{groups:r}}}=t,s=i.media();if(!s)return null;let a=null;s.attributes[e]&&(a=r[s.attributes[e]]);const o=Object.keys(r);if(!a)if("AUDIO"===e&&o.length>1&&vo(t.main))for(let e=0;e<o.length;e++){const t=r[o[e]];if($c(t,s)){a=t;break}}else r.main?a=r.main:1===o.length&&(a=r[o[0]]);return"undefined"===typeof n?a:null!==n&&a&&a.filter(e=>e.id===n.id)[0]||null})(n,e),t[n].activeTrack=Jc[n](n,e),t[n].onGroupChanged=((e,t)=>()=>{const{segmentLoaders:{[e]:n,main:i},mediaTypes:{[e]:r}}=t,s=r.activeTrack(),a=r.getActiveGroup(),o=r.activePlaylistLoader,l=r.lastGroup_;a&&l&&a.id===l.id||(r.lastGroup_=a,r.lastTrack_=s,qc(n,r),a&&!a.isMainPlaylist&&(a.playlistLoader?(n.resyncLoader(),Xc(a.playlistLoader,r)):o&&i.resetEverything()))})(n,e),t[n].onGroupChanging=((e,t)=>()=>{const{segmentLoaders:{[e]:n},mediaTypes:{[e]:i}}=t;i.lastGroup_=null,n.abort(),n.pause()})(n,e),t[n].onTrackChanged=((e,t)=>()=>{const{mainPlaylistLoader:n,segmentLoaders:{[e]:i,main:r},mediaTypes:{[e]:s}}=t,a=s.activeTrack(),o=s.getActiveGroup(),l=s.activePlaylistLoader,c=s.lastTrack_;if((!c||!a||c.id!==a.id)&&(s.lastGroup_=o,s.lastTrack_=a,qc(i,s),o)){if(o.isMainPlaylist){if(!a||!c||a.id===c.id)return;const e=t.vhs.playlistController_,i=e.selectPlaylist();if(e.media()===i)return;return s.logger_("track change. Switching main audio from ".concat(c.id," to ").concat(a.id)),n.pause(),r.resetEverything(),void e.fastQualityChange_(i)}if("AUDIO"===e){if(!o.playlistLoader)return r.setAudio(!0),void r.resetEverything();i.setAudio(!0),r.setAudio(!1)}l!==o.playlistLoader?(i.track&&i.track(a),i.resetEverything(),Xc(o.playlistLoader,s)):Xc(o.playlistLoader,s)}})(n,e),t[n].getActiveGroup=((e,t)=>{let{mediaTypes:n}=t;return()=>{const t=n[e].activeTrack();return t?n[e].activeGroup(t):null}})(n,e)});const o=t.AUDIO.activeGroup();if(o){const e=(o.filter(e=>e.default)[0]||o[0]).id;t.AUDIO.tracks[e].enabled=!0,t.AUDIO.onGroupChanged(),t.AUDIO.onTrackChanged();t.AUDIO.getActiveGroup().playlistLoader?(a.setAudio(!1),s.setAudio(!0)):a.setAudio(!0)}n.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(e=>t[e].onGroupChanged())}),n.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(e=>t[e].onGroupChanging())});const l=()=>{t.AUDIO.onTrackChanged(),i.trigger({type:"usage",name:"vhs-audio-change"})};i.audioTracks().addEventListener("change",l),i.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),r.on("dispose",()=>{i.audioTracks().removeEventListener("change",l),i.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),i.clearTracks("audio");for(const c in t.AUDIO.tracks)i.audioTracks().addTrack(t.AUDIO.tracks[c])};class eu{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){1===e&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=ja(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(e=>[e.ID,e])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class tu extends Ma.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new eu,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=Ha("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const n=t.serverUri||t.serverURL;if(!n)return this.logger_("steering manifest URL is ".concat(n,", cannot request steering manifest.")),void this.trigger("error");n.startsWith("data:")?this.decodeDataUriManifest_(n.substring(n.indexOf(",")+1)):(this.steeringManifest.reloadUri=ja(e,n),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering"))}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const n=e?t:this.getRequestURI(t);if(!n)return this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),void this.dispose();const i={contentSteeringInfo:{uri:n}};this.trigger({type:"contentsteeringloadstart",metadata:i}),this.request_=this.xhr_({uri:n,requestType:"content-steering-manifest"},(e,t)=>{if(e){if(410===t.status)return this.logger_("manifest request 410 ".concat(e,".")),this.logger_("There will be no more content steering requests to ".concat(n," this session.")),void this.excludedSteeringManifestURLs.add(n);if(429===t.status){const n=t.responseHeaders["retry-after"];return this.logger_("manifest request 429 ".concat(e,".")),this.logger_("content steering will retry in ".concat(n," seconds.")),void this.startTTLTimeout_(parseInt(n,10))}return this.logger_("manifest failed to load ".concat(e,".")),void this.startTTLTimeout_()}let r;this.trigger({type:"contentsteeringloadcomplete",metadata:i});try{r=JSON.parse(this.request_.responseText)}catch(a){const e={errorType:Ma.Error.StreamingContentSteeringParserError,error:a};this.trigger({type:"error",metadata:e})}this.assignSteeringProperties_(r);const s={contentSteeringInfo:i.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:s}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new(r().URL)(e),n=new(r().URL)(this.proxyServerUrl_);return n.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(n.toString())}decodeDataUriManifest_(e){const t=JSON.parse(r().atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new(r().URL)(e),n=this.getPathway(),i=this.getBandwidth_();if(n){const e="_".concat(this.manifestType_,"_pathway");t.searchParams.set(e,n)}if(i){const e="_".concat(this.manifestType_,"_throughput");t.searchParams.set(e,i)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version)return this.logger_("manifest version is ".concat(e.VERSION,", which is not supported.")),void this.trigger("error");this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const t=(e=>{for(const t of e)if(this.availablePathways_.has(t))return t;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==t&&(this.currentPathway=t,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=e=>this.excludedSteeringManifestURLs.has(e);if(this.proxyServerUrl_){const n=this.setProxyServerUrl_(e);if(!t(n))return n}const n=this.setSteeringParams_(e);return t(n)?null:n}startTTLTimeout_(){const e=1e3*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.steeringManifest.ttl);this.ttlTimeout_=r().setTimeout(()=>{this.requestSteeringManifest()},e)}clearTTLTimeout_(){r().clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new eu}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(ja(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}let nu;const iu=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],ru=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]};class su extends Ma.EventTarget{constructor(e){super(),this.fastQualityChange_=((e,t)=>{let n=null;return function(){for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];clearTimeout(n),n=setTimeout(()=>{e.apply(null,r)},t)}})(this.fastQualityChange_.bind(this),100);const{src:t,withCredentials:n,tech:i,bandwidth:s,externVhs:a,useCueTags:o,playlistExclusionDuration:l,enableLowInitialPlaylist:c,sourceType:u,cacheEncryptionKeys:h,bufferBasedABR:d,leastPixelDiffSelector:p,captionServices:f,experimentalUseMMS:g}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:m}=e;null!==m&&"undefined"!==typeof m||(m=1/0),nu=a,this.bufferBasedABR=Boolean(d),this.leastPixelDiffSelector=Boolean(p),this.withCredentials=n,this.tech_=i,this.vhs_=i.vhs,this.player_=e.player_,this.sourceType_=u,this.useCueTags_=o,this.playlistExclusionDuration=l,this.maxPlaylistRetries=m,this.enableLowInitialPlaylist=c,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:m,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=(()=>{const e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(t=>{e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:hc,activeTrack:hc,getActiveGroup:hc,onGroupChanged:hc,onTrackChanged:hc,lastTrack_:null,logger_:Ha("MediaGroups[".concat(t,"]"))}}),e})(),g&&r().ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new(r().ManagedMediaSource),this.usingManagedMediaSource_=!0,Ma.log("Using ManagedMediaSource")):r().MediaSource&&(this.mediaSource=new(r().MediaSource)),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=qa(),this.hasPlayed_=!1,this.syncController_=new Vc(e),this.segmentMetadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new Hc,this.sourceUpdater_=new Ac(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new jc,this.keyStatusMap_=new Map;const y={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:f,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:s,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:h,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_="dash"===this.sourceType_?new hl(t,this.vhs_,Ga(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new Wo(t,this.vhs_,Ga(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new uc(Ga(y,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new uc(Ga(y,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new Lc(Ga(y,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((e,t)=>{function n(){i.off("vttjserror",r),e()}function r(){i.off("vttjsloaded",n),t()}i.one("vttjsloaded",n),i.one("vttjserror",r),i.addWebVttScript_()})}),e);this.contentSteeringController_=new tu(this.vhs_.xhr,()=>this.mainSegmentLoader_.bandwidth),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),iu.forEach(e=>{this[e+"_"]=ru.bind(this,e)}),this.logger_=Ha("pc"),this.triggeredFmp4Usage=!1,"none"===this.tech_.preload()?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const b="none"===this.tech_.preload()?"play":"loadstart";this.tech_.one(b,()=>{const e=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-e,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"abr";const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const i=this.media(),r=i&&(i.id||i.uri),s=e&&(e.id||e.uri);if(r&&r!==s){this.logger_("switch media ".concat(r," -> ").concat(s," from ").concat(t));const n={renditionInfo:{id:s,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:n}),this.tech_.trigger({type:"usage",name:"vhs-rendition-change-".concat(t)})}this.mainPlaylistLoader_.media(e,n)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],n=t?t.activeGroup():null,i=this.contentSteeringController_.getPathway();if(n&&i){const t=(n.length?n[0].playlists:n.playlists).filter(e=>e.attributes.serviceLocation===i);t.length&&this.mediaTypes_[e].activePlaylistLoader.media(t[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=r().setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(r().clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,i=Object.keys(n);let r;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)r=this.mediaTypes_.AUDIO.activeTrack();else{const e=n.main||i.length&&n[i[0]];for(const t in e)if(e[t].default){r={label:t};break}}if(!r)return t;const s=[];for(const a in n)if(n[a][r.label]){const t=n[a][r.label];if(t.playlists&&t.playlists.length)s.push.apply(s,t.playlists);else if(t.uri)s.push(t);else if(e.playlists.length)for(let n=0;n<e.playlists.length;n++){const t=e.playlists[n];t.attributes&&t.attributes.AUDIO&&t.attributes.AUDIO===a&&s.push(t)}}return s.length?s:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;mo(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&"none"!==this.tech_.preload()&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),Zc({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){let t;if(this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_(),this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t))return;this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial");if(!("vhs-json"===this.sourceType_&&this.initialMedia_.segments))return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)}),this.mainPlaylistLoader_.on("error",()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;mo(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,"dash"===this.sourceType_&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const e=this.mainPlaylistLoader_.media();if("playlist-unchanged"===e.lastExcludeReason_)return;this.stuckAtPlaylistEnd_(e)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})});["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(e=>{this.mainPlaylistLoader_.on(e,e=>{this.player_.trigger(h({},e))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let i=!0;const r=Object.keys(n.AUDIO);for(const s in n.AUDIO)for(const e in n.AUDIO[s]){n.AUDIO[s][e].uri||(i=!1)}i&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),nu.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),r.length&&Object.keys(n.AUDIO[r[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),i=this.bufferLowWaterLine(),r=this.bufferHighWaterLine();return function(e){let{currentPlaylist:t,buffered:n,currentTime:i,nextPlaylist:r,bufferLowWaterLine:s,bufferHighWaterLine:a,duration:o,bufferBasedABR:l,log:c}=e;if(!r)return Ma.log.warn("We received no playlist to switch to. Please check your stream."),!1;const u="allowing switch ".concat(t&&t.id||"null"," -> ").concat(r.id);if(!t)return c("".concat(u," as current playlist is not set")),!0;if(r.id===t.id)return!1;const h=Boolean(Qa(n,i).length);if(!t.endList)return h||"number"!==typeof t.partTargetDuration?(c("".concat(u," as current playlist is live")),!0):(c("not ".concat(u," as current playlist is live llhls, but currentTime isn't in buffered.")),!1);const d=to(n,i),p=l?dl.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:dl.MAX_BUFFER_LOW_WATER_LINE;if(o<p)return c("".concat(u," as duration < max low water line (").concat(o," < ").concat(p,")")),!0;const f=r.attributes.BANDWIDTH,g=t.attributes.BANDWIDTH;if(f<g&&(!l||d<a)){let e="".concat(u," as next bandwidth < current bandwidth (").concat(f," < ").concat(g,")");return l&&(e+=" and forwardBuffer < bufferHighWaterLine (".concat(d," < ").concat(a,")")),c(e),!0}if((!l||f>g)&&d>=s){let e="".concat(u," as forwardBuffer >= bufferLowWaterLine (").concat(d," >= ").concat(s,")");return l&&(e+=" and next bandwidth > current bandwidth (".concat(f," > ").concat(g,")")),c(e),!0}return c("not ".concat(u," as no switching criteria met")),!1}({buffered:this.tech_.buffered(),currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:i,bufferHighWaterLine:r,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const e=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const e=this.audioSegmentLoader_.pendingSegment_;if(!e||!e.segment||!e.segment.syncInfo)return;const t=e.segment.syncInfo.end+.01;this.tech_.setCurrentTime(t)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",e=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:10}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const e=this.getCodecsOrExclude_();e&&this.sourceUpdater_.addOrChangeSourceBuffers(e)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()});["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(e=>{this.mainSegmentLoader_.on(e,e=>{this.player_.trigger(h({},e))}),this.audioSegmentLoader_.on(e,e=>{this.player_.trigger(h({},e))}),this.subtitleSegmentLoader_.on(e,e=>{this.player_.trigger(h({},e))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectPlaylist();e&&e===this.mainPlaylistLoader_.media()?this.logger_("skipping fastQualityChange because new media is same as old"):(this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0)}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const n=t.end(0);let i=n;if(e.start){const r=e.start.timeOffset;i=r<0?Math.max(n+r,t.start(0)):Math.min(n,r)}this.trigger("firstplay"),this.tech_.setCurrentTime(i)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();"undefined"!==typeof e&&"function"===typeof e.then&&e.then(null,e=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!t||t.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const t=this.syncController_.getExpiredTime(e,this.duration());if(null===t)return!1;const n=nu.Playlist.playlistEnd(e,t),i=this.tech_.currentTime(),r=this.tech_.buffered();if(!r.length)return n-i<=Ka;const s=r.end(r.length-1);return s-i<=Ka&&n-s<=Ka}excludePlaylist(e){let{playlistToExclude:t=this.mainPlaylistLoader_.media(),error:n={},playlistExclusionDuration:i}=e;if(t=t||this.mainPlaylistLoader_.media(),i=i||n.playlistExclusionDuration||this.playlistExclusionDuration,!t)return this.error=n,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));t.playlistErrors_++;const r=this.mainPlaylistLoader_.main.playlists,s=r.filter(fo),a=1===s.length&&s[0]===t;if(1===r.length&&i!==1/0)return Ma.log.warn("Problem encountered with playlist ".concat(t.id,". ")+"Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(a);if(a){if(this.main().contentSteering){const e=this.pathwayAttribute_(t),n=1e3*this.contentSteeringController_.steeringManifest.ttl;return this.contentSteeringController_.excludePathway(e),this.excludeThenChangePathway_(),void setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(e)},n)}let e=!1;r.forEach(n=>{if(n===t)return;const i=n.excludeUntil;"undefined"!==typeof i&&i!==1/0&&(e=!0,delete n.excludeUntil)}),e&&(Ma.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let o;o=t.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*i,t.excludeUntil=o,n.reason&&(t.lastExcludeReason_=n.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const l=this.selectPlaylist();if(!l)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");const c=n.internal?this.logger_:Ma.log.warn,u=n.message?" "+n.message:"";c("".concat(n.internal?"Internal problem":"Problem"," encountered with playlist ").concat(t.id,".")+"".concat(u," Switching to playlist ").concat(l.id,".")),l.attributes.AUDIO!==t.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),l.attributes.SUBTITLES!==t.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const h=l.targetDuration/2*1e3||5e3,d="number"===typeof l.lastRequest&&Date.now()-l.lastRequest<=h;return this.switchMedia_(l,"exclude",a||d)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],i="all"===e;(i||"main"===e)&&n.push(this.mainPlaylistLoader_);const r=[];(i||"audio"===e)&&r.push("AUDIO"),(i||"subtitle"===e)&&(r.push("CLOSED-CAPTIONS"),r.push("SUBTITLES")),r.forEach(e=>{const t=this.mediaTypes_[e]&&this.mediaTypes_[e].activePlaylistLoader;t&&n.push(t)}),["main","audio","subtitle"].forEach(t=>{const i=this["".concat(t,"SegmentLoader_")];!i||e!==t&&"all"!==e||n.push(i)}),n.forEach(e=>t.forEach(t=>{"function"===typeof e[t]&&e[t]()}))}setCurrentTime(e){const t=Qa(this.tech_.buffered(),e);return this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media()&&this.mainPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),void this.load()):0}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:nu.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,t){const n=e.media();if(!n)return null;const i=this.syncController_.getMediaSequenceSync(t);if(i&&i.isReliable){const e=i.start,t=i.end;if(!isFinite(e)||!isFinite(t))return null;const r=nu.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n);return qa([[e,Math.max(e,t-r)]])}const r=this.syncController_.getExpiredTime(n,this.duration());if(null===r)return null;const s=nu.Playlist.seekable(n,r,nu.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n));return s.length?s:null}computeFinalSeekable_(e,t){if(!t)return e;const n=e.start(0),i=e.end(0),r=t.start(0),s=t.end(0);return r>i||n>s?e:qa([[Math.max(n,r),Math.min(i,s)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let t;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!t))return;const n=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,t),!this.seekable_)return;if(n&&n.length&&this.seekable_.length&&n.start(0)===this.seekable_.start(0)&&n.end(0)===this.seekable_.end(0))return;this.logger_("seekable updated [".concat(Ja(this.seekable_),"]"));const i={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:i}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){const e=this.seekable();if(!e.length)return;return void((isNaN(this.mediaSource.duration)||this.mediaSource.duration<e.end(e.length-1))&&this.sourceUpdater_.setDuration(e.end(e.length-1)))}const t=this.tech_.buffered();let n=nu.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach(e=>{e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=Lo(this.main(),t),i={},r=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(i.video=n.video||e.main.videoCodec||"avc1.4d400d"),e.main.isMuxed&&(i.video+=",".concat(n.audio||e.main.audioCodec||L)),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||r)&&(i.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||L,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!i.audio&&!i.video)return void this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});const s=(e,t)=>e?D(t,this.usingManagedMediaSource_):O(t),a={};let o;if(["video","audio"].forEach(function(t){if(i.hasOwnProperty(t)&&!s(e[t].isFmp4,i[t])){const n=e[t].isFmp4?"browser":"muxer";a[n]=a[n]||[],a[n].push(i[t]),"audio"===t&&(o=n)}}),r&&o&&t.attributes.AUDIO){const e=t.attributes.AUDIO;this.main().playlists.forEach(n=>{(n.attributes&&n.attributes.AUDIO)===e&&n!==t&&(n.excludeUntil=1/0)}),this.logger_("excluding audio group ".concat(e," as ").concat(o,' does not support codec(s): "').concat(i.audio,'"'))}if(Object.keys(a).length){const e=Object.keys(a).reduce((e,t)=>(e&&(e+=", "),e+="".concat(t,' does not support codec(s): "').concat(a[t].join(","),'"')),"")+".";return void this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:e},playlistExclusionDuration:1/0})}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const e=[];if(["video","audio"].forEach(t=>{const n=(N(this.sourceUpdater_.codecs[t]||"")[0]||{}).type,r=(N(i[t]||"")[0]||{}).type;n&&r&&n.toLowerCase()!==r.toLowerCase()&&e.push('"'.concat(this.sourceUpdater_.codecs[t],'" -> "').concat(i[t],'"'))}),e.length)return void this.excludePlaylist({playlistToExclude:t,error:{message:"Codec switching not supported: ".concat(e.join(", "),"."),internal:!0},playlistExclusionDuration:1/0})}return i}tryToCreateSourceBuffers_(){if("open"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers())return;if(!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(n=>{const i=e[n];if(-1!==t.indexOf(i.id))return;t.push(i.id);const r=Lo(this.main,i),s=[];!r.audio||O(r.audio)||D(r.audio,this.usingManagedMediaSource_)||s.push("audio codec ".concat(r.audio)),!r.video||O(r.video)||D(r.video,this.usingManagedMediaSource_)||s.push("video codec ".concat(r.video)),r.text&&"stpp.ttml.im1t"===r.text&&s.push("text codec ".concat(r.text)),s.length&&(i.excludeUntil=1/0,this.logger_("excluding ".concat(i.id," for unsupported: ").concat(s.join(", "))))})}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,i=Do(N(e)),r=Oo(i),s=i.video&&N(i.video)[0]||null,a=i.audio&&N(i.audio)[0]||null;Object.keys(n).forEach(e=>{const i=n[e];if(-1!==t.indexOf(i.id)||i.excludeUntil===1/0)return;t.push(i.id);const o=[],l=Lo(this.mainPlaylistLoader_.main,i),c=Oo(l);if(l.audio||l.video){if(c!==r&&o.push('codec count "'.concat(c,'" !== "').concat(r,'"')),!this.sourceUpdater_.canChangeType()){const e=l.video&&N(l.video)[0]||null,t=l.audio&&N(l.audio)[0]||null;e&&s&&e.type.toLowerCase()!==s.type.toLowerCase()&&o.push('video codec "'.concat(e.type,'" !== "').concat(s.type,'"')),t&&a&&t.type.toLowerCase()!==a.type.toLowerCase()&&o.push('audio codec "'.concat(t.type,'" !== "').concat(a.type,'"'))}o.length&&(i.excludeUntil=1/0,this.logger_("excluding ".concat(i.id,": ").concat(o.join(" && "))))}})}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e.segments)return;let i,s=n;for(let a=0;a<e.segments.length;a++){const n=e.segments[a];if(i||(i=Pc(t,s+n.duration/2)),i){if("cueIn"in n){i.endTime=s,i.adEndTime=s,s+=n.duration,i=null;continue}if(s<i.endTime){s+=n.duration;continue}i.endTime+=n.duration}else if("cueOut"in n&&(i=new(r().VTTCue)(s,s+n.duration,n.cueOut),i.adStartTime=s,i.adEndTime=s+parseFloat(n.cueOut),t.addCue(i)),"cueOutCont"in n){const[e,a]=n.cueOutCont.split("/").map(parseFloat);i=new(r().VTTCue)(s,s+n.duration,""),i.adStartTime=s-e,i.adEndTime=i.adStartTime+a,t.addCue(i)}s+=n.duration}}(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=dl.GOAL_BUFFER_LENGTH,n=dl.GOAL_BUFFER_LENGTH_RATE,i=Math.max(t,dl.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,i)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=dl.BUFFER_LOW_WATER_LINE,n=dl.BUFFER_LOW_WATER_LINE_RATE,i=Math.max(t,dl.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(t,dl.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?r:i)}bufferHighWaterLine(){return dl.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){Zl(this.inbandTextTracks_,"com.apple.streaming",this.tech_),(e=>{let{inbandTextTracks:t,dateRanges:n}=e;const i=t.metadataTrack_;if(!i)return;const s=r().WebKitDataCue||r().VTTCue;n.forEach(e=>{for(const t of Object.keys(e)){if(Jl.has(t))continue;const n=new s(e.startTime,e.endTime,"");n.id=e.id,n.type="com.apple.quicktime.HLS",n.value={key:$l[t],data:e[t]},"scte35Out"!==t&&"scte35In"!==t||(n.value.data=new Uint8Array(n.value.data.match(/[\da-f]{2}/gi)).buffer),i.addCue(n)}e.processDateRange()})})({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,n){const i=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();Zl(this.inbandTextTracks_,e,this.tech_),Ql({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:i,videoDuration:n})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart?this.contentSteeringController_.requestSteeringManifest(!0):this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this));["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(e=>{this.contentSteeringController_.on(e,e=>{this.trigger(h({},e))})}),"dash"===this.sourceType_&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const e=this.main();(this.contentSteeringController_.didDASHTagChange(e.uri,e.contentSteering)||(()=>{const t=this.contentSteeringController_.getAvailablePathways(),n=[];for(const i of e.playlists){const e=i.attributes.serviceLocation;if(e&&(n.push(e),!t.has(e)))return!0}return!(n.length||!t.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const t=this.main().playlists,n=new Set;let i=!1;Object.keys(t).forEach(r=>{const s=t[r],a=this.pathwayAttribute_(s),o=a&&e!==a;s.excludeUntil===1/0&&"content-steering"===s.lastExcludeReason_&&!o&&(delete s.excludeUntil,delete s.lastExcludeReason_,i=!0);const l=!s.excludeUntil&&s.excludeUntil!==1/0;!n.has(s.id)&&o&&l&&(n.add(s.id),s.excludeUntil=1/0,s.lastExcludeReason_="content-steering",this.logger_("excluding ".concat(s.id," for ").concat(s.lastExcludeReason_)))}),"DASH"===this.contentSteeringController_.manifestType_&&Object.keys(this.mediaTypes_).forEach(t=>{const n=this.mediaTypes_[t];if(n.activePlaylistLoader){const t=n.activePlaylistLoader.media_;t&&t.attributes.serviceLocation!==e&&(i=!0)}}),i&&this.changeSegmentPathway_()}handlePathwayClones_(){const e=this.main().playlists,t=this.contentSteeringController_.currentPathwayClones,n=this.contentSteeringController_.nextPathwayClones;if(t&&t.size||n&&n.size){for(const[e,i]of t.entries()){n.get(e)||(this.mainPlaylistLoader_.updateOrDeleteClone(i),this.contentSteeringController_.excludePathway(e))}for(const[i,r]of n.entries()){const n=t.get(i);if(!n){e.filter(e=>e.attributes["PATHWAY-ID"]===r["BASE-ID"]).forEach(e=>{this.mainPlaylistLoader_.addClonePathway(r,e)}),this.contentSteeringController_.addAvailablePathway(i);continue}this.equalPathwayClones_(n,r)||(this.mainPlaylistLoader_.updateOrDeleteClone(r,!0),this.contentSteeringController_.addAvailablePathway(i))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...n])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const n=e["URI-REPLACEMENT"].PARAMS,i=t["URI-REPLACEMENT"].PARAMS;for(const r in n)if(n[r]!==i[r])return!1;for(const r in i)if(n[r]!==i[r])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),"DASH"===this.contentSteeringController_.manifestType_&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(n=>{const i=this.mainPlaylistLoader_.getKeyIdSet(n);i&&i.size&&i.forEach(i=>{const r="usable",s=this.keyStatusMap_.has(i)&&this.keyStatusMap_.get(i)===r,a=n.lastExcludeReason_===t&&n.excludeUntil===1/0;s?s&&a&&(delete n.excludeUntil,delete n.lastExcludeReason_,this.logger_("enabling playlist ".concat(n.id," because key ID ").concat(i," is ").concat(r))):(n.excludeUntil!==1/0&&n.lastExcludeReason_!==t&&(n.excludeUntil=1/0,n.lastExcludeReason_=t,this.logger_("excluding playlist ".concat(n.id," because the key ID ").concat(i," doesn't exist in the keyStatusMap or is not ").concat(r))),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(e=>{const n=e&&e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height<720,i=e.excludeUntil===1/0&&e.lastExcludeReason_===t;n&&i&&(delete e.excludeUntil,Ma.log.warn("enabling non-HD playlist ".concat(e.id," because all playlists were excluded due to ").concat(t," key IDs")))})}addKeyStatus_(e,t){const n=("string"===typeof e?e:(e=>{const t=new Uint8Array(e);return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")})(e)).slice(0,32).toLowerCase();this.logger_("KeyStatus '".concat(t,"' with key ID ").concat(n," added to the keyStatusMap")),this.keyStatusMap_.set(n,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}class au{constructor(e,t,n){const{playlistController_:i}=e,r=i.fastQualityChange_.bind(i);if(t.attributes){const e=t.attributes.RESOLUTION;this.width=e&&e.width,this.height=e&&e.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}var s,a,o;this.codecs=Lo(i.main(),t),this.playlist=t,this.id=n,this.enabled=(s=e.playlists,a=t.id,o=r,e=>{const t=s.main.playlists[a],n=po(t),i=fo(t);if("undefined"===typeof e)return i;e?delete t.disabled:t.disabled=!0;const r={renditionInfo:{id:a,bandwidth:t.attributes.BANDWIDTH,resolution:t.attributes.RESOLUTION,codecs:t.attributes.CODECS},cause:"fast-quality"};return e===i||n||(e?(o(t),s.trigger({type:"renditionenabled",metadata:r})):s.trigger({type:"renditiondisabled",metadata:r})),e})}}const ou=["seeking","seeked","pause","playing","error"];class lu extends Ma.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=Ha("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),i=()=>this.techWaiting_(),s=()=>this.resetTimeUpdate_(),a=this.playlistController_,o=["main","subtitle","audio"],l={};o.forEach(e=>{l[e]={reset:()=>this.resetSegmentDownloads_(e),updateend:()=>this.checkSegmentDownloads_(e)},a["".concat(e,"SegmentLoader_")].on("appendsdone",l[e].updateend),a["".concat(e,"SegmentLoader_")].on("playlistupdate",l[e].reset),this.tech_.on(["seeked","seeking"],l[e].reset)});const c=e=>{["main","audio"].forEach(t=>{a["".concat(t,"SegmentLoader_")][e]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),c("off"))},this.clearSeekingAppendCheck_=()=>c("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),c("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",i),this.tech_.on(ou,s),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",i),this.tech_.off(ou,s),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),o.forEach(e=>{a["".concat(e,"SegmentLoader_")].off("appendsdone",l[e].updateend),a["".concat(e,"SegmentLoader_")].off("playlistupdate",l[e].reset),this.tech_.off(["seeked","seeking"],l[e].reset)}),this.checkCurrentTimeTimeout_&&r().clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&r().clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=r().setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_["".concat(e,"SegmentLoader_")];this["".concat(e,"StalledDownloads_")]>0&&this.logger_("resetting possible stalled download count for ".concat(e," loader")),this["".concat(e,"StalledDownloads_")]=0,this["".concat(e,"Buffered_")]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t["".concat(e,"SegmentLoader_")],i=n.buffered_(),r=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++)if(e.start(n)!==t.start(n)||e.end(n)!==t.end(n))return!0;return!1}(this["".concat(e,"Buffered_")],i);if(this["".concat(e,"Buffered_")]=i,r){const n={bufferedRanges:i};return t.trigger({type:"bufferedrangeschanged",metadata:n}),void this.resetSegmentDownloads_(e)}this["".concat(e,"StalledDownloads_")]++,this.logger_("found #".concat(this["".concat(e,"StalledDownloads_")]," ").concat(e," appends that did not increase buffer (possible stalled download)"),{playlistId:n.playlist_&&n.playlist_.id,buffered:Za(i)}),this["".concat(e,"StalledDownloads_")]<10||(this.logger_("".concat(e," loader stalled download exclusion")),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:"vhs-".concat(e,"-download-exclusion")}),"subtitle"!==e&&t.excludePlaylist({error:{message:"Excessive ".concat(e," segment downloading detected.")},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+Ka>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(qa([this.lastRecordedTime,e]));const t={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:t}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const e=this.seekable(),t=this.tech_.currentTime();let n;if(this.afterSeekableWindow_(e,t,this.media(),this.allowSeeksWithinUnsafeLiveWindow)){n=e.end(e.length-1)}if(this.beforeSeekableWindow_(e,t)){const t=e.start(0);n=t+(t===e.end(0)?0:Ka)}if("undefined"!==typeof n)return this.logger_("Trying to seek outside of seekable at time ".concat(t," with ")+"seekable range ".concat(Ja(e),". Seeking to ")+"".concat(n,".")),this.tech_.setCurrentTime(n),!0;const i=this.playlistController_.sourceUpdater_,r=this.tech_.buffered(),s=i.audioBuffer?i.audioBuffered():null,a=i.videoBuffer?i.videoBuffered():null,o=this.media(),l=o.partTargetDuration?o.partTargetDuration:2*(o.targetDuration-Xa),c=[s,a];for(let h=0;h<c.length;h++){if(!c[h])continue;if(to(c[h],t)<l)return!1}const u=$a(r,t);return 0!==u.length&&(n=u.start(0)+Ka,this.logger_("Buffered region starts (".concat(u.start(0),") ")+" just beyond seek point (".concat(t,"). Seeking to ").concat(n,".")),this.tech_.setCurrentTime(n),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=Qa(t,e);return n.length&&e+3<=n.end(0)?(this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_("Stopped at ".concat(e," while inside a buffered region ")+"[".concat(n.start(0)," -> ").concat(n.end(0),"]. Attempting to resume ")+"playback by seeking to the current time."),void this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"})):void 0}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const n=e.end(e.length-1);return this.logger_("Fell out of live window at time ".concat(t,". Seeking to ")+"live point (seekable end) ".concat(n)),this.resetTimeUpdate_(),this.tech_.setCurrentTime(n),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,i=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const r=$a(i,t);return r.length>0&&(this.logger_("Stopped at ".concat(t," and seeking to ").concat(r.start(0))),this.resetTimeUpdate_(),this.skipTheGap_(t),!0)}afterSeekableWindow_(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e.length)return!1;let r=e.end(e.length-1)+Ka;const s=!n.endList,a="number"===typeof n.partTargetDuration;return s&&(a||i)&&(r=e.end(e.length-1)+3*n.targetDuration),t>r}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_(e){let t,{videoBuffered:n,audioBuffered:i,currentTime:r}=e;if(n){if(n.length&&i.length){const e=Qa(n,r-3),s=Qa(n,r),a=Qa(i,r);a.length&&!s.length&&e.length&&(t={start:e.end(0),end:a.end(0)})}else{$a(n,r).length||(t=this.gapFromVideoUnderflow_(n,r))}return!!t&&(this.logger_("Encountered a gap in video from ".concat(t.start," to ").concat(t.end,". ")+"Seeking to current time ".concat(r)),!0)}}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),i=$a(t,n);if(this.resetTimeUpdate_(),0===i.length||n!==e)return;this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",i.start(0)),this.tech_.setCurrentTime(i.start(0)+Xa);const r={gapInfo:{from:n,to:i.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:r}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const n=function(e){if(e.length<2)return qa();const t=[];for(let n=1;n<e.length;n++){const i=e.end(n-1),r=e.start(n);t.push([i,r])}return qa(t)}(e);for(let i=0;i<n.length;i++){const e=n.start(i),r=n.end(i);if(t-e<4&&t-e>2)return{start:e,end:r}}return null}}const cu={errorInterval:30,getSource(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},uu=function(e,t){let n=0,i=0;const r=Ga(cu,t);e.ready(()=>{e.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const s=function(){i&&e.currentTime(i)},a=function(t){null!==t&&void 0!==t&&(i=e.duration()!==1/0&&e.currentTime()||0,e.one("loadedmetadata",s),e.src(t),e.trigger({type:"usage",name:"vhs-error-reload"}),e.play())},o=function(){if(Date.now()-n<1e3*r.errorInterval)e.trigger({type:"usage",name:"vhs-error-reload-canceled"});else{if(r.getSource&&"function"===typeof r.getSource)return n=Date.now(),r.getSource.call(e,a);Ma.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},l=function(){e.off("loadedmetadata",s),e.off("error",o),e.off("dispose",l)};e.on("error",o),e.on("dispose",l),e.reloadSourceOnError=function(t){l(),uu(e,t)}},hu=function(e){uu(this,e)};var du="3.17.2";const pu={PlaylistLoader:Wo,Playlist:_o,utils:el,STANDARD_PLAYLIST_SELECTOR:Kl,INITIAL_PLAYLIST_SELECTOR:function(){const e=this.playlists.main.playlists.filter(_o.isEnabled);Gl(e,(e,t)=>ql(e,t));return e.filter(e=>!!Lo(this.playlists.main,e).video)[0]||null},lastBandwidthSelector:Kl,movingAverageBandwidthSelector:function(e){let t=-1,n=-1;if(e<0||e>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let i=this.useDevicePixelRatio&&r().devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),t<0&&(t=this.systemBandwidth,n=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==n&&(t=e*this.systemBandwidth+(1-e)*t,n=this.systemBandwidth),Xl({main:this.playlists.main,bandwidth:t,playerWidth:parseInt(Hl(this.tech_.el(),"width"),10)*i,playerHeight:parseInt(Hl(this.tech_.el(),"height"),10)*i,playerObjectFit:this.usePlayerObjectFit?Hl(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},comparePlaylistBandwidth:ql,comparePlaylistResolution:function(e,t){let n,i;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||r().Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(i=t.attributes.RESOLUTION.width),i=i||r().Number.MAX_VALUE,n===i&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:n-i},xhr:Go()};Object.keys(dl).forEach(e=>{Object.defineProperty(pu,e,{get:()=>(Ma.log.warn("using Vhs.".concat(e," is UNSAFE be sure you know what you are doing")),dl[e]),set(t){Ma.log.warn("using Vhs.".concat(e," is UNSAFE be sure you know what you are doing")),"number"!==typeof t||t<0?Ma.log.warn("value of Vhs.".concat(e," must be greater than or equal to 0")):dl[e]=t}})});const fu="videojs-vhs",gu=function(e,t){const n=t.media();let i=-1;for(let r=0;r<e.length;r++)if(e[r].id===n.id){i=r;break}e.selectedIndex_=i,e.trigger({selectedIndex:i,type:"change"})};pu.canPlaySource=function(){return Ma.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const mu=e=>{let{player:t,sourceKeySystems:n,audioMedia:i,mainPlaylists:r}=e;if(!t.eme.initializeMediaKeys)return Promise.resolve();const s=((e,t)=>e.reduce((e,n)=>{if(!n.contentProtection)return e;const i=t.reduce((e,t)=>{const i=n.contentProtection[t];return i&&i.pssh&&(e[t]={pssh:i.pssh}),e},{});return Object.keys(i).length&&e.push(i),e},[]))(i?r.concat([i]):r,Object.keys(n)),a=[],o=[];return s.forEach(e=>{o.push(new Promise((e,n)=>{t.tech_.one("keysessioncreated",e)})),a.push(new Promise((n,i)=>{t.eme.initializeMediaKeys({keySystems:e},e=>{e?i(e):n()})}))}),Promise.race([Promise.all(a),Promise.race(o)])},yu=e=>{let{player:t,sourceKeySystems:n,media:i,audioMedia:r}=e;const s=((e,t,n)=>{if(!e)return e;let i={};t&&t.attributes&&t.attributes.CODECS&&(i=Do(N(t.attributes.CODECS))),n&&n.attributes&&n.attributes.CODECS&&(i.audio=n.attributes.CODECS);const r=R(i.video),s=R(i.audio),a={};for(const o in e)a[o]={},s&&(a[o].audioContentType=s),r&&(a[o].videoContentType=r),t.contentProtection&&t.contentProtection[o]&&t.contentProtection[o].pssh&&(a[o].pssh=t.contentProtection[o].pssh),"string"===typeof e[o]&&(a[o].url=e[o]);return Ga(e,a)})(n,i,r);return!!s&&(t.currentSource().keySystems=s,!(s&&!t.eme)||(Ma.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1))},bu=()=>{if(!r().localStorage)return null;const e=r().localStorage.getItem(fu);if(!e)return null;try{return JSON.parse(e)}catch(t){return null}},vu=(e,t)=>{e._requestCallbackSet||(e._requestCallbackSet=new Set),e._requestCallbackSet.add(t)},_u=(e,t)=>{e._responseCallbackSet||(e._responseCallbackSet=new Set),e._responseCallbackSet.add(t)},xu=(e,t)=>{e._requestCallbackSet&&(e._requestCallbackSet.delete(t),e._requestCallbackSet.size||delete e._requestCallbackSet)},wu=(e,t)=>{e._responseCallbackSet&&(e._responseCallbackSet.delete(t),e._responseCallbackSet.size||delete e._responseCallbackSet)};pu.supportsNativeHls=function(){if(!a()||!a().createElement)return!1;const e=a().createElement("video");if(!Ma.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}(),pu.supportsNativeDash=!!(a()&&a().createElement&&Ma.getTech("Html5").isSupported())&&/maybe|probably/i.test(a().createElement("video").canPlayType("application/dash+xml")),pu.supportsTypeNatively=e=>"hls"===e?pu.supportsNativeHls:"dash"===e&&pu.supportsNativeDash,pu.isSupported=function(){return Ma.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")},pu.xhr.onRequest=function(e){vu(pu.xhr,e)},pu.xhr.onResponse=function(e){_u(pu.xhr,e)},pu.xhr.offRequest=function(e){xu(pu.xhr,e)},pu.xhr.offResponse=function(e){wu(pu.xhr,e)};const Tu=Ma.getComponent("Component");class ku extends Tu{constructor(e,t,n){if(super(t,n.vhs),"number"===typeof n.initialBandwidth&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=Ha("VhsHandler"),t.options_&&t.options_.playerId){const e=Ma.getPlayer(t.options_.playerId);this.player_=e}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(a(),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],e=>{const t=a().fullscreenElement||a().webkitFullscreenElement||a().mozFullScreenElement||a().msFullscreenElement;t&&t.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.options_=Ga(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage="undefined"!==typeof this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi="undefined"===typeof this.options_.useNetworkInformationApi||this.options_.useNetworkInformationApi,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=!1!==this.options_.llhls,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,"number"!==typeof this.options_.playlistExclusionDuration&&(this.options_.playlistExclusionDuration=60),"number"!==typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){const e=bu();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}"number"!==typeof this.options_.bandwidth&&(this.options_.bandwidth=dl.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===dl.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(e=>{"undefined"!==typeof this.source_[e]&&(this.options_[e]=this.source_[e])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const t=this.options_.customPixelRatio;"number"===typeof t&&t>=0&&(this.customPixelRatio=t)}setOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setOptions_(e)}src(e,t){if(!e)return;var n;this.setOptions_(),this.options_.src=0===(n=this.source_.src).toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(n.substring(n.indexOf(",")+1)):n,this.options_.tech=this.tech_,this.options_.externVhs=pu,this.options_.sourceType=M(t),this.options_.seekTo=e=>{this.tech_.setCurrentTime(e)},this.options_.player_=this.player_,this.playlistController_=new su(this.options_);const i=Ga({liveRangeSafeTimeDelta:Ka},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new lu(i),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const e=Ma.players[this.tech_.options_.playerId];let t=this.playlistController_.error;"object"!==typeof t||t.code?"string"===typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)});const s=this.options_.bufferBasedABR?pu.movingAverageBandwidthSelector(.55):pu.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):s.bind(this),this.playlistController_.selectInitialPlaylist=pu.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(e){this.playlistController_.selectPlaylist=e.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(e){this.playlistController_.mainSegmentLoader_.throughput.rate=e,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let e=this.playlistController_.mainSegmentLoader_.bandwidth;const t=r().navigator.connection||r().navigator.mozConnection||r().navigator.webkitConnection,n=1e7;if(this.options_.useNetworkInformationApi&&t){const i=1e3*t.downlink*1e3;e=i>=n&&e>=n?Math.max(e,i):i}return e},set(e){this.playlistController_.mainSegmentLoader_.bandwidth=e,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const e=1/(this.bandwidth||1);let t;t=this.throughput>0?1/this.throughput:0;return Math.floor(1/(e+t))},set(){Ma.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>Za(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>Za(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&(e=>{if(!r().localStorage)return!1;let t=bu();t=t?Ga(t,e):e;try{r().localStorage.setItem(fu,JSON.stringify(t))}catch(n){return!1}})({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{var e;(e=this).representations=()=>{const t=e.playlistController_.main(),n=vo(t)?e.playlistController_.getAudioTrackPlaylists_():t.playlists;return n?n.filter(e=>!po(e)).map((t,n)=>new au(e,t,t.id)):[]}}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=r().URL.createObjectURL(this.playlistController_.mediaSource),(Ma.browser.IS_ANY_SAFARI||Ma.browser.IS_IOS)&&this.options_.overrideNative&&"hls"===this.options_.sourceType&&"function"===typeof this.tech_.addSourceElement?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),mu({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(e=>{this.logger_("error while creating EME key session",e),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=yu({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});this.player_.tech_.on("keystatuschange",e=>{this.playlistController_.updatePlaylistByKeyStatus(e.keyId,e.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),t?this.createKeySessions_():this.playlistController_.sourceUpdater_.initializedEme()}setupQualityLevels_(){const e=Ma.players[this.tech_.options_.playerId];e&&e.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{!function(e,t){t.representations().forEach(t=>{e.addQualityLevel(t)}),gu(e,t.playlists)}(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{gu(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":du,"mux.js":"7.1.0","mpd-parser":"1.3.1","m3u8-parser":"7.2.0","aes-decrypter":"4.0.2"}}version(){return this.constructor.version()}canChangeType(){return Ac.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&r().URL.revokeObjectURL&&(r().URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return tl({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return nl({programTime:e,playlist:this.playlistController_.media(),retryCount:i,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{vu(this.xhr,e)},this.xhr.onResponse=e=>{_u(this.xhr,e)},this.xhr.offRequest=e=>{xu(this.xhr,e)},this.xhr.offResponse=e=>{wu(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(e=>{this.playlistController_.on(e,e=>{this.player_.trigger(h({},e))})}),["gapjumped","playedrangeschanged"].forEach(e=>{this.playbackWatcher_.on(e,e=>{this.player_.trigger(h({},e))})})}}const Su={name:"videojs-http-streaming",VERSION:du,canHandleSource(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Ga(Ma.options,t);return!(!n.vhs.experimentalUseMMS&&!D("avc1.4d400d,mp4a.40.2",!1))&&Su.canPlayType(e.type,n)},handleSource(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=Ga(Ma.options,n);return t.vhs=new ku(e,t,i),t.vhs.xhr=Go(),t.vhs.setupXhrHooks_(),t.vhs.src(e.src,e.type),t.vhs},canPlayType(e,t){const n=M(e);if(!n)return"";const i=Su.getOverrideNative(t);return!pu.supportsTypeNatively(n)||i?"maybe":""},getOverrideNative(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{vhs:t={}}=e,n=!(Ma.browser.IS_ANY_SAFARI||Ma.browser.IS_IOS),{overrideNative:i=n}=t;return i}};D("avc1.4d400d,mp4a.40.2",!0)&&Ma.getTech("Html5").registerSourceHandler(Su,0),Ma.VhsHandler=ku,Ma.VhsSourceHandler=Su,Ma.Vhs=pu,Ma.use||Ma.registerComponent("Vhs",pu),Ma.options.vhs=Ma.options.vhs||{},Ma.getPlugin&&Ma.getPlugin("reloadSourceOnError")||Ma.registerPlugin("reloadSourceOnError",hu)},626:(e,t,n)=>{var i;i="undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},e.exports=i},634:e=>{function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},647:function(e,t,n){var i;!function(e,r){function s(e){var t=this;t.next=function(){var e,n,i=t.w,r=t.X,s=t.i;return t.w=i=i+1640531527|0,n=r[s+34&127],e=r[s=s+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=r[s]=n^e,t.i=s,n+(i^i>>>16)|0},function(e,t){var n,i,r,s,a,o=[],l=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,l=Math.max(l,t.length)),r=0,s=-32;s<l;++s)t&&(i^=t.charCodeAt((s+32)%t.length)),0===s&&(a=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,s>=0&&(a=a+1640531527|0,r=0==(n=o[127&s]^=i+a)?r+1:0);for(r>=128&&(o[127&(t&&t.length||0)]=-1),r=127,s=512;s>0;--s)i=o[r+34&127],n=o[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,o[r]=i^n;e.w=a,e.X=o,e.i=r}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new s(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&(i.X&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=o:n.amdD&&n.amdO?void 0===(i=function(){return o}.call(t,n,t,r))||(r.exports=i):this.xor4096=o}(0,e=n.nmd(e),n.amdD)},650:e=>{e.exports=function(e){if(!e)return!1;var n=t.call(e);return"[object Function]"===n||"function"===typeof e&&"[object RegExp]"!==n||"undefined"!==typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var t=Object.prototype.toString},654:(e,t,n)=>{"use strict";var i=n(950),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,s={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},658:function(e,t,n){var i;!function(e,r){function s(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new s(e),i=t&&t.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=o:n.amdD&&n.amdO?void 0===(i=function(){return o}.call(t,n,t,r))||(r.exports=i):this.alea=o}(0,e=n.nmd(e),n.amdD)},672:e=>{var t=Math.pow(2,32);e.exports={getUint64:function(e){var n,i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.getBigUint64?(n=i.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(n):n:i.getUint32(0)*t+i.getUint32(4)},MAX_UINT32:t}},748:(e,t,n)=>{var i=n(132).NAMESPACE,r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,s=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),a=new RegExp("^"+r.source+s.source+"*(?::"+r.source+s.source+"*)?$");function o(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,o)}function l(){}function c(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function u(e,t,n,r,s,a){function o(e,t,i){n.attributeNames.hasOwnProperty(e)&&a.fatalError("Attribute "+e+" redefined"),n.addValue(e,t.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,s),i)}for(var l,c=++t,u=0;;){var h=e.charAt(c);switch(h){case"=":if(1===u)l=e.slice(t,c),u=3;else{if(2!==u)throw new Error("attribute equal must after attrName");u=3}break;case"'":case'"':if(3===u||1===u){if(1===u&&(a.warning('attribute value must after "="'),l=e.slice(t,c)),t=c+1,!((c=e.indexOf(h,t))>0))throw new Error("attribute value no end '"+h+"' match");o(l,d=e.slice(t,c),t-1),u=5}else{if(4!=u)throw new Error('attribute value must after "="');o(l,d=e.slice(t,c),t),a.warning('attribute "'+l+'" missed start quot('+h+")!!"),t=c+1,u=5}break;case"/":switch(u){case 0:n.setTagName(e.slice(t,c));case 5:case 6:case 7:u=7,n.closed=!0;case 4:case 1:break;case 2:n.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),0==u&&n.setTagName(e.slice(t,c)),c;case">":switch(u){case 0:n.setTagName(e.slice(t,c));case 5:case 6:case 7:break;case 4:case 1:"/"===(d=e.slice(t,c)).slice(-1)&&(n.closed=!0,d=d.slice(0,-1));case 2:2===u&&(d=l),4==u?(a.warning('attribute "'+d+'" missed quot(")!'),o(l,d,t)):(i.isHTML(r[""])&&d.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+d+'" missed value!! "'+d+'" instead!!'),o(d,d,t));break;case 3:throw new Error("attribute value missed!!")}return c;case"\x80":h=" ";default:if(h<=" ")switch(u){case 0:n.setTagName(e.slice(t,c)),u=6;break;case 1:l=e.slice(t,c),u=2;break;case 4:var d=e.slice(t,c);a.warning('attribute "'+d+'" missed quot(")!!'),o(l,d,t);case 5:u=6}else switch(u){case 2:n.tagName;i.isHTML(r[""])&&l.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+l+'" missed value!! "'+l+'" instead2!!'),o(l,l,t),t=c,u=1;break;case 5:a.warning('attribute space is required"'+l+'"!!');case 6:u=1,t=c;break;case 3:u=4,t=c;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function h(e,t,n){for(var r=e.tagName,s=null,a=e.length;a--;){var o=e[a],l=o.qName,c=o.value;if((p=l.indexOf(":"))>0)var u=o.prefix=l.slice(0,p),h=l.slice(p+1),d="xmlns"===u&&h;else h=l,u=null,d="xmlns"===l&&"";o.localName=h,!1!==d&&(null==s&&(s={},f(n,n={})),n[d]=s[d]=c,o.uri=i.XMLNS,t.startPrefixMapping(d,c))}for(a=e.length;a--;){(u=(o=e[a]).prefix)&&("xml"===u&&(o.uri=i.XML),"xmlns"!==u&&(o.uri=n[u||""]))}var p;(p=r.indexOf(":"))>0?(u=e.prefix=r.slice(0,p),h=e.localName=r.slice(p+1)):(u=null,h=e.localName=r);var g=e.uri=n[u||""];if(t.startElement(g,h,r,e),!e.closed)return e.currentNSMap=n,e.localNSMap=s,!0;if(t.endElement(g,h,r),s)for(u in s)Object.prototype.hasOwnProperty.call(s,u)&&t.endPrefixMapping(u)}function d(e,t,n,i,r){if(/^(?:script|textarea)$/i.test(n)){var s=e.indexOf("</"+n+">",t),a=e.substring(t+1,s);if(/[&<]/.test(a))return/^script$/i.test(n)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,i),r.characters(a,0,a.length),s)}return t+1}function p(e,t,n,i){var r=i[n];return null==r&&((r=e.lastIndexOf("</"+n+">"))<t&&(r=e.lastIndexOf("</"+n)),i[n]=r),r<t}function f(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function g(e,t,n,i){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(r=e.indexOf("--\x3e",t+4))>t?(n.comment(e,t+4,r-t-4),r+3):(i.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var r=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,r-t-9),n.endCDATA(),r+3}var s=function(e,t){var n,i=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;r.lastIndex=t,r.exec(e);for(;n=r.exec(e);)if(i.push(n),n[1])return i}(e,t),a=s.length;if(a>1&&/!doctype/i.test(s[0][0])){var o=s[1][0],l=!1,c=!1;a>3&&(/^public$/i.test(s[2][0])?(l=s[3][0],c=a>4&&s[4][0]):/^system$/i.test(s[2][0])&&(c=s[3][0]));var u=s[a-1];return n.startDTD(o,l,c),n.endDTD(),u.index+u[0].length}return-1}function m(e,t,n){var i=e.indexOf("?>",t);if(i){var r=e.substring(t,i).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(r){r[0].length;return n.processingInstruction(r[1],r[2]),i+2}return-1}return-1}function y(){this.attributeNames={}}o.prototype=new Error,o.prototype.name=o.name,l.prototype={parse:function(e,t,n){var r=this.domBuilder;r.startDocument(),f(t,t={}),function(e,t,n,r,s){function a(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}function l(e){var t=e.slice(1,-1);return Object.hasOwnProperty.call(n,t)?n[t]:"#"===t.charAt(0)?a(parseInt(t.substr(1).replace("x","0x"))):(s.error("entity not found:"+e),e)}function f(t){if(t>S){var n=e.substring(S,t).replace(/&#?\w+;/g,l);w&&b(S),r.characters(n,0,t-S),S=t}}function b(t,n){for(;t>=_&&(n=x.exec(e));)v=n.index,_=v+n[0].length,w.lineNumber++;w.columnNumber=t-v+1}var v=0,_=0,x=/.*(?:\r\n?|\n)|.*$/g,w=r.locator,T=[{currentNSMap:t}],k={},S=0;for(;;){try{var C=e.indexOf("<",S);if(C<0){if(!e.substr(S).match(/^\s*$/)){var I=r.doc,E=I.createTextNode(e.substr(S));I.appendChild(E),r.currentElement=E}return}switch(C>S&&f(C),e.charAt(C+1)){case"/":var N=e.indexOf(">",C+3),A=e.substring(C+2,N).replace(/[ \t\n\r]+$/g,""),R=T.pop();N<0?(A=e.substring(C+2).replace(/[\s<].*/,""),s.error("end tag name: "+A+" is not complete:"+R.tagName),N=C+1+A.length):A.match(/\s</)&&(A=A.replace(/[\s<].*/,""),s.error("end tag name: "+A+" maybe not complete"),N=C+1+A.length);var D=R.localNSMap,O=R.tagName==A;if(O||R.tagName&&R.tagName.toLowerCase()==A.toLowerCase()){if(r.endElement(R.uri,R.localName,A),D)for(var L in D)Object.prototype.hasOwnProperty.call(D,L)&&r.endPrefixMapping(L);O||s.fatalError("end tag name: "+A+" is not match the current start tagName:"+R.tagName)}else T.push(R);N++;break;case"?":w&&b(C),N=m(e,C,r);break;case"!":w&&b(C),N=g(e,C,r,s);break;default:w&&b(C);var P=new y,F=T[T.length-1].currentNSMap,M=(N=u(e,C,P,F,l,s),P.length);if(!P.closed&&p(e,N,P.tagName,k)&&(P.closed=!0,n.nbsp||s.warning("unclosed xml attribute")),w&&M){for(var U=c(w,{}),B=0;B<M;B++){var z=P[B];b(z.offset),z.locator=c(w,{})}r.locator=U,h(P,r,F)&&T.push(P),r.locator=w}else h(P,r,F)&&T.push(P);i.isHTML(P.uri)&&!P.closed?N=d(e,N,P.tagName,l,r):N++}}catch(V){if(V instanceof o)throw V;s.error("element parse error: "+V),N=-1}N>S?S=N:f(Math.max(C,S)+1)}}(e,t,n,r,this.errorHandler),r.endDocument()}},y.prototype={setTagName:function(e){if(!a.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!a.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.XMLReader=l,t.ParseError=o},760:e=>{"use strict";var t=function(){function e(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var t=e.prototype;return t.getIsEnabled=function(){return this.enabled_},t.enable=function(){this.enabled_=!0},t.disable=function(){this.enabled_=!1},t.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},t.getMaxAttempts=function(){return this.maxAttempts_},t.setMaxAttempts=function(e){this.maxAttempts_=e},t.getDelayFactor=function(){return this.delayFactor_},t.setDelayFactor=function(e){this.delayFactor_=e},t.getFuzzFactor=function(){return this.fuzzFactor_},t.setFuzzFactor=function(e){this.fuzzFactor_=e},t.getInitialDelay=function(){return this.initialDelay_},t.setInitialDelay=function(e){this.initialDelay_=e},t.createRetry=function(e){var t=void 0===e?{}:e,i=t.maxAttempts,r=t.delayFactor,s=t.fuzzFactor,a=t.initialDelay;return new n({maxAttempts:i||this.maxAttempts_,delayFactor:r||this.delayFactor_,fuzzFactor:s||this.fuzzFactor_,initialDelay:a||this.initialDelay_})},e}(),n=function(){function e(e){this.maxAttempts_=e.maxAttempts,this.delayFactor_=e.delayFactor,this.fuzzFactor_=e.fuzzFactor,this.currentDelay_=e.initialDelay,this.currentAttempt_=1}var t=e.prototype;return t.moveToNextAttempt=function(){this.currentAttempt_++;var e=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+e},t.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},t.getCurrentDelay=function(){return this.currentDelay_},t.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},t.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},t.getCurrentFuzzedDelay=function(){var e=this.getCurrentMinPossibleDelay(),t=this.getCurrentMaxPossibleDelay();return e+Math.random()*(t-e)},e}();e.exports=t},761:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<r&&0>s(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<r&&0>s(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,g=!1,m=!1,y="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function _(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function x(e){if(m=!1,_(e),!g)if(null!==i(c))g=!0,O(w);else{var t=i(u);null!==t&&L(x,t.startTime-e)}}function w(e,n){g=!1,m&&(m=!1,b(C),C=-1),f=!0;var s=p;try{for(_(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!N());){var a=d.callback;if("function"===typeof a){d.callback=null,p=d.priorityLevel;var o=a(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===i(c)&&r(c),_(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&L(x,h.startTime-n),l=!1}return l}finally{d=null,p=s,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,k=!1,S=null,C=-1,I=5,E=-1;function N(){return!(t.unstable_now()-E<I)}function A(){if(null!==S){var e=t.unstable_now();E=e;var n=!0;try{n=S(!0,e)}finally{n?T():(k=!1,S=null)}}else k=!1}if("function"===typeof v)T=function(){v(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,D=R.port2;R.port1.onmessage=A,T=function(){D.postMessage(null)}}else T=function(){y(A,0)};function O(e){S=e,k||(k=!0,T())}function L(e,n){C=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,O(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(u,e),null===i(c)&&e===i(u)&&(m?(b(C),C=-1):m=!0,L(x,s-a))):(e.sortIndex=o,n(c,e),g||f||(g=!0,O(w))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},768:e=>{"use strict";function t(e,t){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"===typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var i=function(){function e(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var n=e.prototype;return n.getIsEnabled=function(){return this.enabled_},n.enable=function(){this.enabled_=!0},n.disable=function(){this.enabled_=!1},n.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},n.addInterceptor=function(e,t){this.typeToInterceptorsMap_.has(e)||this.typeToInterceptorsMap_.set(e,new Set);var n=this.typeToInterceptorsMap_.get(e);return!n.has(t)&&(n.add(t),!0)},n.removeInterceptor=function(e,t){var n=this.typeToInterceptorsMap_.get(e);return!(!n||!n.has(t))&&(n.delete(t),!0)},n.clearInterceptorsByType=function(e){return!!this.typeToInterceptorsMap_.get(e)&&(this.typeToInterceptorsMap_.delete(e),this.typeToInterceptorsMap_.set(e,new Set),!0)},n.clear=function(){return!!this.typeToInterceptorsMap_.size&&(this.typeToInterceptorsMap_=new Map,!0)},n.getForType=function(e){return this.typeToInterceptorsMap_.get(e)||new Set},n.execute=function(e,n){for(var i,r=t(this.getForType(e));!(i=r()).done;){var s=i.value;try{n=s(n)}catch(a){}}return n},e}();e.exports=i},817:()=>{},820:(e,t,n)=>{var i=n(188);i.DOMImplementation,i.XMLSerializer,t.DOMParser=n(18).DOMParser},855:function(e,t,n){var i;!function(e,r){function s(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,i=t.d,r=t.a;return e=e<<25^e>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-i|0,t.d=i<<16^n>>>16^r,t.a=r-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var i=0;i<n.length+20;i++)t.b^=0|n.charCodeAt(i),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new s(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=o:n.amdD&&n.amdO?void 0===(i=function(){return o}.call(t,n,t,r))||(r.exports=i):this.tychei=o}(0,e=n.nmd(e),n.amdD)},913:e=>{var t={"":!0,up:!0};function n(e){return"number"===typeof e&&e>=0&&e<=100}e.exports=function(){var e=100,i=3,r=0,s=100,a=0,o=100,l="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!n(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return i},set:function(e){if("number"!==typeof e)throw new TypeError("Lines must be set to a number.");i=e}},regionAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!n(e))throw new Error("RegionAnchorX must be between 0 and 100.");s=e}},regionAnchorX:{enumerable:!0,get:function(){return r},set:function(e){if(!n(e))throw new Error("RegionAnchorY must be between 0 and 100.");r=e}},viewportAnchorY:{enumerable:!0,get:function(){return o},set:function(e){if(!n(e))throw new Error("ViewportAnchorY must be between 0 and 100.");o=e}},viewportAnchorX:{enumerable:!0,get:function(){return a},set:function(e){if(!n(e))throw new Error("ViewportAnchorX must be between 0 and 100.");a=e}},scroll:{enumerable:!0,get:function(){return l},set:function(e){var n=function(e){return"string"===typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);!1===n?console.warn("Scroll: an invalid or illegal string was specified."):l=n}}})}},938:(e,t,n)=>{"use strict";var i=n(626),r=n(634),s=n(650),a=n(768),o=n(760);u.httpHandler=n(45),u.requestInterceptorsStorage=new a,u.responseInterceptorsStorage=new a,u.retryManager=new o;var l=function(e){var t={};return e?(e.trim().split("\n").forEach(function(e){var n=e.indexOf(":"),i=e.slice(0,n).trim().toLowerCase(),r=e.slice(n+1).trim();"undefined"===typeof t[i]?t[i]=r:Array.isArray(t[i])?t[i].push(r):t[i]=[t[i],r]}),t):t};function c(e,t,n){var i=e;return s(t)?(n=t,"string"===typeof e&&(i={uri:e})):i=r({},t,{uri:e}),i.callback=n,i}function u(e,t,n){return h(t=c(e,t,n))}function h(e){if("undefined"===typeof e.callback)throw new Error("callback argument missing");if(e.requestType&&u.requestInterceptorsStorage.getIsEnabled()){var t={uri:e.uri||e.url,headers:e.headers||{},body:e.body,metadata:e.metadata||{},retry:e.retry,timeout:e.timeout},n=u.requestInterceptorsStorage.execute(e.requestType,t);e.uri=n.uri,e.headers=n.headers,e.body=n.body,e.metadata=n.metadata,e.retry=n.retry,e.timeout=n.timeout}var i=!1,r=function(t,n,r){i||(i=!0,e.callback(t,n,r))};function s(){var e=void 0;if(e=p.response?p.response:p.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(n){}return null}(p),_)try{e=JSON.parse(e)}catch(t){}return e}function a(t){if(clearTimeout(f),clearTimeout(e.retryTimeout),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,d||!u.retryManager.getIsEnabled()||!e.retry||!e.retry.shouldRetry()){if(e.requestType&&u.responseInterceptorsStorage.getIsEnabled()){var n={headers:x.headers||{},body:x.body,responseUrl:p.responseURL,responseType:p.responseType},i=u.responseInterceptorsStorage.execute(e.requestType,n);x.body=i.body,x.headers=i.headers}return r(t,x)}e.retryTimeout=setTimeout(function(){e.retry.moveToNextAttempt(),e.xhr=p,h(e)},e.retry.getCurrentFuzzedDelay())}function o(){if(!d){var t;clearTimeout(f),clearTimeout(e.retryTimeout),t=e.useXDR&&void 0===p.status?200:1223===p.status?204:p.status;var n=x,i=null;if(0!==t?(n={body:s(),statusCode:t,method:m,headers:{},url:g,rawRequest:p},p.getAllResponseHeaders&&(n.headers=l(p.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),e.requestType&&u.responseInterceptorsStorage.getIsEnabled()){var a={headers:n.headers||{},body:n.body,responseUrl:p.responseURL,responseType:p.responseType},o=u.responseInterceptorsStorage.execute(e.requestType,a);n.body=o.body,n.headers=o.headers}return r(i,n,n.body)}}var c,d,p=e.xhr||null;p||(p=e.cors||e.useXDR?new u.XDomainRequest:new u.XMLHttpRequest);var f,g=p.url=e.uri||e.url,m=p.method=e.method||"GET",y=e.body||e.data,b=p.headers=e.headers||{},v=!!e.sync,_=!1,x={body:void 0,headers:{},statusCode:0,method:m,url:g,rawRequest:p};if("json"in e&&!1!==e.json&&(_=!0,b.accept||b.Accept||(b.Accept="application/json"),"GET"!==m&&"HEAD"!==m&&(b["content-type"]||b["Content-Type"]||(b["Content-Type"]="application/json"),y=JSON.stringify(!0===e.json?y:e.json))),p.onreadystatechange=function(){4!==p.readyState||u.responseInterceptorsStorage.getIsEnabled()||setTimeout(o,0)},p.onload=o,p.onerror=a,p.onprogress=function(){},p.onabort=function(){d=!0,clearTimeout(e.retryTimeout)},p.ontimeout=a,p.open(m,g,!v,e.username,e.password),v||(p.withCredentials=!!e.withCredentials),!v&&e.timeout>0&&(f=setTimeout(function(){if(!d){d=!0,p.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",a(e)}},e.timeout)),p.setRequestHeader)for(c in b)b.hasOwnProperty(c)&&p.setRequestHeader(c,b[c]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(p.responseType=e.responseType),"beforeSend"in e&&"function"===typeof e.beforeSend&&e.beforeSend(p),p.send(y||null),p}e.exports=u,e.exports.default=u,u.XMLHttpRequest=i.XMLHttpRequest||function(){},u.XDomainRequest="withCredentials"in new u.XMLHttpRequest?u.XMLHttpRequest:i.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],function(e){u["delete"===e?"del":e]=function(t,n,i){return(n=c(t,n,i)).method=e.toUpperCase(),h(n)}})},950:(e,t,n)=>{"use strict";e.exports=n(49)},974:(e,t,n)=>{var i=n(626),r=e.exports={WebVTT:n(181),VTTCue:n(118),VTTRegion:n(913)};i.vttjs=r,i.WebVTT=r.WebVTT;var s=r.VTTCue,a=r.VTTRegion,o=i.VTTCue,l=i.VTTRegion;r.shim=function(){i.VTTCue=s,i.VTTRegion=a},r.restore=function(){i.VTTCue=o,i.VTTRegion=l},i.VTTCue||r.shim()}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e={};n.r(e),n.d(e,{assertParamsValid:()=>Ua,computeFlatOffset:()=>$a,computeOutShape:()=>za,getNormalizedAxes:()=>Ha,isSliceContinous:()=>Qa,maskToAxes:()=>Ba,parseSliceParams:()=>Ja,sliceInfo:()=>Za,startForAxis:()=>Ka,startIndicesWithElidedDims:()=>Ga,stopForAxis:()=>Ya,stopIndicesWithElidedDims:()=>qa,stridesForAxis:()=>Xa,stridesWithElidedDims:()=>Va});var t={};n.r(t),n.d(t,{collectGatherOpShapeInfo:()=>yh,computeOutShape:()=>mh,segOpComputeOptimalWindowSize:()=>gh});var i={};n.r(i),n.d(i,{ERF_A1:()=>Ou,ERF_A2:()=>Lu,ERF_A3:()=>Pu,ERF_A4:()=>Fu,ERF_A5:()=>Mu,ERF_P:()=>Du,PARALLELIZE_THRESHOLD:()=>bu,RowPartitionType:()=>pu,SELU_SCALE:()=>Ru,SELU_SCALEALPHA:()=>Au,applyActivation:()=>gc,assertAndGetBroadcastShape:()=>xa,assertAxesAreInnerMostDims:()=>ml,assertParamsConsistent:()=>hu,assignToTypedArray:()=>Wu,axesAreInnerMostDims:()=>dl,calculateShapes:()=>Nu,checkEinsumDimSizes:()=>Ju,checkPadOnDimRoundingMode:()=>vo,combineLocations:()=>pl,combineRaggedTensorToTensorShapes:()=>fu,complexWithEvenIndex:()=>zu,complexWithOddIndex:()=>Vu,computeConv2DInfo:()=>oo,computeConv3DInfo:()=>lo,computeDefaultPad:()=>co,computeDilation2DInfo:()=>ro,computeOptimalWindowSize:()=>vu,computeOutAndReduceShapes:()=>fl,computeOutShape:()=>du,computePool2DInfo:()=>so,computePool3DInfo:()=>ao,convertConv2DDataFormat:()=>bo,decodeEinsumEquation:()=>Qu,eitherStridesOrDilationsAreOne:()=>mo,expandShapeToKeepDim:()=>gl,exponent:()=>Gu,exponents:()=>Hu,fromStringArrayToUint8:()=>vh,fromUint8ToStringArray:()=>bh,getAxesPermutation:()=>yl,getBroadcastDims:()=>va,getComplexWithIndex:()=>ju,getEinsumComputePath:()=>Zu,getEinsumPermutation:()=>$u,getFusedBiasGradient:()=>fc,getFusedDyActivation:()=>pc,getImageCenter:()=>_u,getInnerMostAxes:()=>vl,getPermuted:()=>wu,getRaggedRank:()=>mu,getReductionAxes:()=>_a,getReshaped:()=>xu,getReshapedPermuted:()=>Tu,getRowPartitionTypesHelper:()=>gu,getSliceBeginCoords:()=>ku,getSliceSize:()=>Su,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>ih,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>rh,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>sh,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>lh,getSparseReshapeInputOutputMismatchErrorMessage:()=>uh,getSparseReshapeInputOutputMultipleErrorMessage:()=>ch,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>ah,getSparseReshapeNegativeOutputDimErrorMessage:()=>oh,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>fh,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>hh,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>dh,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>ph,getUndoAxesPermutation:()=>bl,isIdentityPermutation:()=>eh,log:()=>Li,mergeRealAndImagArrays:()=>Uu,prepareAndValidate:()=>Cu,prepareSplitSize:()=>nh,segment_util:()=>t,shouldFuse:()=>mc,slice_util:()=>e,splitRealAndImagArrays:()=>Bu,stridesOrDilationsArePositive:()=>yo,tupleValuesAreOne:()=>go,upcastType:()=>Dr,validateDefaultValueShape:()=>yu,validateInput:()=>Eu,validateUpdateShape:()=>Iu,warn:()=>Oi});var r={};n.r(r),n.d(r,{mx:()=>mx,XI:()=>lw,Nk:()=>cw,f6:()=>hw,ct:()=>hx,YG:()=>fw,hH:()=>_w,z3:()=>rT,sG:()=>gT,uM:()=>_T,vS:()=>MT,qB:()=>GT,GG:()=>XT,lg:()=>JT,rq:()=>YT,cu:()=>hk,WR:()=>lk,GE:()=>fk,px:()=>mk,jC:()=>Rk,He:()=>Lk,hE:()=>Hk,BF:()=>Qw,Dk:()=>eS,cl:()=>lS,_B:()=>xS,ub:()=>CS,_f:()=>NS,Ku:()=>PS,qy:()=>MS,Zy:()=>YS,bu:()=>JS,zv:()=>nx,dH:()=>Sx,HS:()=>rw,yH:()=>bC,l3:()=>_C,z9:()=>wC,x6:()=>IC,_m:()=>LC,eW:()=>BC,GK:()=>jC,SP:()=>GC,yr:()=>XC,dl:()=>CT,Dw:()=>ZC,xT:()=>iI,_X:()=>Dx,wz:()=>uI});var s=n(950),a=n(352),o=n(414);function l(e){let{onLoad:t}=e;const[n,i]=(0,s.useState)("file"),[r,a]=(0,s.useState)(""),l=()=>{const e=r.trim();e&&(null===t||void 0===t||t({src:e,name:e,isURL:!0}))};return(0,o.jsxs)("section",{className:"src",children:[(0,o.jsxs)("div",{className:"src__tabs",role:"tablist","aria-label":"Video source",children:[(0,o.jsx)("button",{className:"src__tab ".concat("file"===n?"is-active":""),role:"tab","aria-selected":"file"===n,onClick:()=>i("file"),children:"Local file"}),(0,o.jsx)("button",{className:"src__tab ".concat("url"===n?"is-active":""),role:"tab","aria-selected":"url"===n,onClick:()=>i("url"),children:"YouTube URL"})]}),"file"===n&&(0,o.jsxs)("div",{className:"src__panel",role:"tabpanel","aria-label":"Local file",children:[(0,o.jsx)("label",{className:"sr-only",htmlFor:"file-input",children:"Choose a video file"}),(0,o.jsx)("div",{className:"src__drop",onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDrop:e=>{var n;e.preventDefault();const i=null===(n=e.dataTransfer.files)||void 0===n?void 0:n[0];if(!i)return;const r=URL.createObjectURL(i);null===t||void 0===t||t({src:r,name:i.name,isURL:!1})},children:(0,o.jsxs)("div",{className:"src__dropInner",children:[(0,o.jsx)("div",{className:"src__dropIcon",children:"\ud83d\udce6"}),(0,o.jsxs)("div",{className:"src__dropText",children:[(0,o.jsx)("strong",{children:"Drag & drop a video"}),(0,o.jsx)("span",{children:"or"})]}),(0,o.jsxs)("label",{className:"src__btn",children:["Choose file",(0,o.jsx)("input",{id:"file-input",type:"file",accept:"video/*",onChange:e=>{var n;const i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!i)return;const r=URL.createObjectURL(i);null===t||void 0===t||t({src:r,name:i.name,isURL:!1})},hidden:!0})]})]})}),(0,o.jsx)("div",{className:"src__hint",children:"Supported: mp4, mov, webm."})]}),"url"===n&&(0,o.jsxs)("div",{className:"src__panel",role:"tabpanel","aria-label":"YouTube URL",children:[(0,o.jsx)("label",{className:"src__label",htmlFor:"url-input",children:"YouTube URL"}),(0,o.jsxs)("div",{className:"src__urlrow",children:[(0,o.jsx)("input",{id:"url-input",type:"text",placeholder:"https://www.youtube.com/watch?v=...",value:r,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&l()},className:"src__input"}),(0,o.jsx)("button",{className:"src__btn",onClick:l,disabled:!r.trim(),children:"Load"})]}),(0,o.jsx)("div",{className:"src__hint",children:"YouTube videos can be previewed but not analyzed due to browser restrictions."})]})]})}var c=n(601),u=(n(163),{color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0}),h=s.createContext&&s.createContext(u),d=["attr","size","title"];function p(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},f.apply(this,arguments)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function y(e,t,n){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){return e&&e.map((e,t)=>s.createElement(e.tag,m({key:t},e.attr),b(e.child)))}function v(e){return t=>s.createElement(_,f({attr:m({},e.attr)},t),b(e.child))}function _(e){var t=t=>{var n,{attr:i,size:r,title:a}=e,o=p(e,d),l=r||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),s.createElement("svg",f({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,o,{className:n,style:m(m({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),a&&s.createElement("title",null,a),e.children)};return void 0!==h?s.createElement(h.Consumer,null,e=>t(e)):t(u)}function x(e){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},child:[]}]})(e)}function w(e){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M8 5v14l11-7z"},child:[]}]})(e)}function T(e){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m6 18 8.5-6L6 6v12zM16 6v12h2V6h-2z"},child:[]}]})(e)}function k(e){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"},child:[]}]})(e)}function S(e){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m7 10 5 5 5-5z"},child:[]}]})(e)}function C(e){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"},child:[]}]})(e)}function I(e){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},child:[]}]})(e)}function E(e){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(e)}class N{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class A{refCount(e){return R("refCount")}incRef(e){return R("incRef")}timerAvailable(){return!0}time(e){return R("time")}read(e){return R("read")}readSync(e){return R("readSync")}readToGPU(e,t){return R("readToGPU")}numDataIds(){return R("numDataIds")}disposeData(e,t){return R("disposeData")}write(e,t,n){return R("write")}move(e,t,n,i,r){return R("move")}createTensorFromGPUData(e,t,n){return R("createTensorFromGPUData")}memory(){return R("memory")}floatPrecision(){return R("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return R("dispose")}}function R(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function D(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,P(e,t,n)}function O(e,t,n){return Math.max(e,Math.min(t,n))}function L(e){return e%2===0?e:e+1}function P(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function F(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function M(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";F(z(e,t),()=>n+" Shapes ".concat(e," and ").concat(t," must match"))}function U(e){F(null!=e,()=>"The input to the tensor constructor must be a non-null value.")}function B(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function z(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function V(e){return e%1===0}function j(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function W(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function H(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return new Promise((r,s)=>{let a=0;const o=()=>{if(e())return void r();a++;const l=t(a);null!=n&&a>=n?s():null!=i?i(o,l):setTimeout(o,l)};o()})}function G(e,t){let n=1,i=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)n*=e[s];else if(-1===e[s]){if(-1!==i)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(i," and dim ").concat(s));i=s}else if(e[s]<0)throw Error("Shapes can not be < 0. Found ".concat(e[s]," at dim ").concat(s));if(-1===i){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));const r=e.slice();return r[i]=t/n,r}function q(e,t){const n=t.length;return e=null==e?t.map((e,t)=>t):[].concat(e),F(e.every(e=>e>=-n&&e<n),()=>"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)),F(e.every(e=>V(e)),()=>"All values in axis param must be integers but "+"got axis ".concat(e)),e.map(e=>e<0?n+e:e)}function X(e,t){const n=[],i=[],r=null!=t&&Array.isArray(t)&&0===t.length,s=null==t||r?null:q(t,e).sort();let a=0;for(let o=0;o<e.length;++o){if(null!=s){if(s[a]===o&&1!==e[o])throw new Error("Can't squeeze axis ".concat(o," since its dim '").concat(e[o],"' is not 1"));(null==s[a]||s[a]>o)&&1===e[o]&&(n.push(e[o]),i.push(o)),s[a]<=o&&a++}1!==e[o]&&(n.push(e[o]),i.push(o))}return{newShape:n,keptDims:i}}function K(e,t){return Y(e,t)}function Y(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Q(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function $(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function J(e){return"string"===typeof e||e instanceof String}function Z(e){return"number"===typeof e}function ee(e){return Array.isArray(e)?ee(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Z(e)?"float32":J(e)?"string":"boolean"===typeof e?"bool":"float32"}function te(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ne(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function ie(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let i=t-3;i>=0;--i)n[i]=n[i+1]*e[i+1];return n}function re(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=new Array;if(1===t.length){const s=t[0]*(i?2:1);for(let t=0;t<s;t++)r[t]=n[e+t]}else{const s=t[0],a=t.slice(1),o=a.reduce((e,t)=>e*t)*(i?2:1);for(let t=0;t<s;t++)r[t]=re(e+t*o,a,n,i)}return r}function se(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];const i=e.reduce((e,t)=>e*t)*(n?2:1);if(0===i)return[];if(i!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return re(0,e,t,n)}function ae(e,t){const n=oe(e,t);for(let i=0;i<n.length;i++)n[i]=1;return n}function oe(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function le(e,t){const n=e.reduce((e,t)=>e*t,1);if(null==t||"float32"===t)return se(e,new Float32Array(n));if("int32"===t)return se(e,new Int32Array(n));if("bool"===t)return se(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function ce(e){e.forEach(t=>{F(Number.isInteger(t)&&t>=0,()=>"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"]."))})}function ue(e,t,n){if(0===t)return 0;if(1===t)return e[0];let i=e[e.length-1];for(let r=0;r<e.length-1;++r)i+=n[r]*e[r];return i}function he(e,t,n){if(0===t)return[];if(1===t)return[e];const i=new Array(t);for(let r=0;r<i.length-1;++r)i[r]=Math.floor(e/n[r]),e-=i[r]*n[r];return i[i.length-1]=e,i}function de(e){return e&&e.then&&"function"===typeof e.then}const pe="tfjsflags";class fe{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=ge,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(me().getBool("IS_TEST")||me().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];me().getBool("IS_TEST")||me().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(t,".")),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(de(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if("undefined"===typeof this.global||"undefined"===typeof this.global.location||"undefined"===typeof this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);if(pe in e){e[pe].split(",").forEach(e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){const n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,n)})}}}function ge(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,i[0],i[1]),i.join("=")}),t}function me(){return be}let ye,be=null;function ve(){if(null==ye){let e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}ye=e}return ye}function _e(e,t){const n=function(){const e=ve();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const i=t();return n.set(e,i),n.get(e)}}const xe="Abs",we="Acos",Te="Acosh",ke="Add",Se="AddN",Ce="All",Ie="Any",Ee="ArgMax",Ne="ArgMin",Ae="Asin",Re="Asinh",De="Atan",Oe="Atanh",Le="Atan2",Pe="AvgPool",Fe="AvgPoolGrad",Me="AvgPool3D",Ue="AvgPool3DGrad",Be="BatchMatMul",ze="BatchToSpaceND",Ve="Bincount",je="BitwiseAnd",We="BroadcastArgs",He="Cast",Ge="Ceil",qe="ClipByValue",Xe="Complex",Ke="ComplexAbs",Ye="Concat",Qe="Conv2D",$e="Conv2DBackpropFilter",Je="Conv2DBackpropInput",Ze="Conv3D",et="Conv3DBackpropFilterV2",tt="Conv3DBackpropInputV2",nt="Cos",it="Cosh",rt="Cumprod",st="Cumsum",at="CropAndResize",ot="DenseBincount",lt="DepthToSpace",ct="DepthwiseConv2dNative",ut="DepthwiseConv2dNativeBackpropFilter",ht="DepthwiseConv2dNativeBackpropInput",dt="Diag",pt="Dilation2D",ft="Dilation2DBackpropInput",gt="Dilation2DBackpropFilter",mt="Draw",yt="RealDiv",bt="Einsum",vt="Elu",_t="EluGrad",xt="Erf",wt="Equal",Tt="Exp",kt="ExpandDims",St="Expm1",Ct="FFT",It="Fill",Et="FlipLeftRight",Nt="Floor",At="FloorDiv",Rt="FusedBatchNorm",Dt="GatherV2",Ot="GatherNd",Lt="Greater",Pt="GreaterEqual",Ft="Identity",Mt="IFFT",Ut="Imag",Bt="IsFinite",zt="IsInf",Vt="IsNan",jt="LeakyRelu",Wt="Less",Ht="LessEqual",Gt="LinSpace",qt="Log",Xt="Log1p",Kt="LogicalAnd",Yt="LogicalNot",Qt="LogicalOr",$t="LRN",Jt="LRNGrad",Zt="Max",en="Maximum",tn="MaxPool",nn="MaxPoolGrad",rn="MaxPool3D",sn="MaxPool3DGrad",an="MaxPoolWithArgmax",on="Mean",ln="Min",cn="Minimum",un="MirrorPad",hn="Mod",dn="Multinomial",pn="Multiply",fn="Neg",gn="NotEqual",mn="NonMaxSuppressionV3",yn="NonMaxSuppressionV4",bn="NonMaxSuppressionV5",vn="OnesLike",_n="OneHot",xn="Pack",wn="PadV2",Tn="Pow",kn="Prelu",Sn="Prod",Cn="RaggedGather",In="RaggedRange",En="RaggedTensorToTensor",Nn="Range",An="Real",Rn="Reciprocal",Dn="Relu",On="Reshape",Ln="ResizeNearestNeighbor",Pn="ResizeNearestNeighborGrad",Fn="ResizeBilinear",Mn="ResizeBilinearGrad",Un="Relu6",Bn="Reverse",zn="Round",Vn="Rsqrt",jn="ScatterNd",Wn="TensorScatterUpdate",Hn="SearchSorted",Gn="Select",qn="Selu",Xn="Slice",Kn="Sin",Yn="Sinh",Qn="Sign",$n="Sigmoid",Jn="Softplus",Zn="Sqrt",ei="Sum",ti="SpaceToBatchND",ni="SplitV",ii="Softmax",ri="SparseFillEmptyRows",si="SparseReshape",ai="SparseSegmentMean",oi="SparseSegmentSum",li="SparseToDense",ci="SquaredDifference",ui="Square",hi="StaticRegexReplace",di="StridedSlice",pi="StringNGrams",fi="StringSplit",gi="StringToHashBucketFast",mi="Sub",yi="Tan",bi="Tanh",vi="Tile",_i="TopK",xi="Transform",wi="Transpose",Ti="Unique",ki="Unpack",Si="UnsortedSegmentSum",Ci="ZerosLike",Ii="Step",Ei="FromPixels",Ni="RotateWithOffset",Ai="_FusedMatMul",Ri="FusedConv2D",Di="FusedDepthwiseConv2D";function Oi(){me().getBool("IS_TEST")||me().getBool("PROD")||console.warn(...arguments)}function Li(){me().getBool("IS_TEST")||me().getBool("PROD")||console.log(...arguments)}const Pi=_e("kernelRegistry",()=>new Map),Fi=_e("gradRegistry",()=>new Map);function Mi(e,t){const n=ji(e,t);return Pi.get(n)}function Ui(e){return Fi.get(e)}function Bi(e){const t=Pi.entries(),n=[];for(;;){const{done:i,value:r}=t.next();if(i)break;const[s,a]=r,[o]=s.split("_");o===e&&n.push(a)}return n}function zi(e){const{kernelName:t,backendName:n}=e,i=ji(t,n);Pi.has(i)&&Oi("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),Pi.set(i,e)}function Vi(e){const{kernelName:t}=e;Fi.has(t)&&me().getBool("DEBUG")&&Oi("Overriding the gradient for '".concat(t,"'")),Fi.set(t,e)}function ji(e,t){return"".concat(t,"_").concat(e)}function Wi(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var Hi=n(72);const Gi=n.n(Hi)()||Hi;function qi(e){return Gi.fromString(e,!0,16)}const Xi=qi("c3a5c85c97cb3127"),Ki=qi("b492b66fbe98f273"),Yi=qi("9ae16a3b2f90404f");function Qi(e){return e.xor(e.shru(47))}function $i(e,t,n){const i=e.slice(t,t+n);return Gi.fromBytes(Array.from(i),!0,!0)}function Ji(e,t){return $i(e,t,8)}function Zi(e,t){return $i(e,t,4)}function er(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function tr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qi("9ddfea08eb382d69"),i=e.xor(t).mul(n);i=i.xor(i.shru(47));let r=t.xor(i).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function nr(e,t,n,i){return function(e,t,n,i,r,s){r=r.add(e),s=er(s.add(r).add(i),21);const a=r;return r=(r=r.add(t)).add(n),s=s.add(er(r,44)),[r.add(i),s.add(a)]}(Ji(e,t),Ji(e,t+8),Ji(e,t+16),Ji(e,t+24),n,i)}function ir(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=Gi.fromNumber(81,!0);if(t<=32)return t<=16?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){const n=Yi.add(2*t),i=Ji(e,0).add(Yi),r=Ji(e,t-8);return tr(er(r,37).mul(n).add(i),er(i,25).add(r).mul(n),n)}if(t>=4){const n=Yi.add(2*t);return tr(Zi(e,0).shl(3).add(t),Zi(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),i=t+(e[t-1]<<2);return Qi(Yi.mul(n).xor(Xi.mul(i))).mul(Yi)}return Yi}(e,t):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=Yi.add(2*t),i=Ji(e,0).mul(Ki),r=Ji(e,8),s=Ji(e,t-8).mul(n),a=Ji(e,t-16).mul(Yi);return tr(er(i.add(r),43).add(er(s,30)).add(a),i.add(er(r.add(Yi),18)).add(s),n)}(e,t);if(t<=64)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=Yi.add(2*t),i=Ji(e,0).mul(Yi),r=Ji(e,8),s=Ji(e,t-8).mul(n),a=Ji(e,t-16).mul(Yi),o=er(i.add(r),43).add(er(s,30)).add(a),l=tr(o,i.add(er(r.add(Yi),18)).add(s),n),c=Ji(e,16).mul(n),u=Ji(e,24),h=o.add(Ji(e,t-32)).mul(n),d=l.add(Ji(e,t-24)).mul(n);return tr(er(c.add(u),43).add(er(h,30)).add(d),c.add(er(u.add(i),18)).add(h),n)}(e,t);let i=n,r=n.mul(Ki).add(113),s=Qi(r.mul(Yi).add(113)).mul(Yi),a=[Gi.UZERO,Gi.UZERO],o=[Gi.UZERO,Gi.UZERO];i=i.mul(Yi).add(Ji(e,0));let l=0;const c=64*(t-1>>6),u=c+(t-1&63)-63;do{i=er(i.add(r).add(a[0]).add(Ji(e,l+8)),37).mul(Ki),r=er(r.add(a[1]).add(Ji(e,l+48)),42).mul(Ki),i=i.xor(o[1]),r=r.add(a[0]).add(Ji(e,l+40)),s=er(s.add(o[0]),33).mul(Ki),a=nr(e,l,a[1].mul(Ki),i.add(o[0])),o=nr(e,l+32,s.add(o[1]),r.add(Ji(e,l+16))),[s,i]=[i,s],l+=64}while(l!==c);const h=Ki.add(s.and(255).shl(1));return l=u,o[0]=o[0].add(t-1&63),a[0]=a[0].add(o[0]),o[0]=o[0].add(a[0]),i=er(i.add(r).add(a[0]).add(Ji(e,l+8)),37).mul(h),r=er(r.add(a[1]).add(Ji(e,l+48)),42).mul(h),i=i.xor(o[1].mul(9)),r=r.add(a[0].mul(9).add(Ji(e,l+40))),s=er(s.add(o[0]),33).mul(h),a=nr(e,l,a[1].mul(h),i.add(o[0])),o=nr(e,l+32,s.add(o[1]),r.add(Ji(e,l+16))),[s,i]=[i,s],tr(tr(a[0],o[0],h).add(Qi(r).mul(Xi)).add(s),tr(a[1],o[1],h).add(i),h)}function rr(e,t){return"string"===t?or(e):sr([e],t)}function sr(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ur(e)),me().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(isNaN(i)||!isFinite(i))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(i,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type ".concat(t))}function ar(){return me().platform.now()}function or(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",me().platform.encode(e,t)}function lr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",me().platform.decode(e,t)}function cr(e){return null!=me().platform.isTypedArray?me().platform.isTypedArray(e):Wi(e)}function ur(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"===typeof e||"number"===typeof e||"string"===typeof e||de(e)||null==e||cr(e)&&n)t.push(e);else if(Array.isArray(e)||cr(e))for(let i=0;i<e.length;++i)ur(e[i],t,n);else{let i=-1;for(const t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(i=Math.max(i,Number(t)));for(let r=0;r<=i;r++)ur(e[r],t,n)}return t}class hr{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new pr)}profileKernel(e,t,n){let i;const r=()=>{i=n()};let s;const a=ar();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(r);else{r();for(const e of i)e.dataSync();s=Promise.resolve({kernelMs:ar()-a})}if(me().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let o=0;o<i.length;o++){const t=i[o];t.data().then(n=>{dr(n,t.dtype,e)})}return{kernelName:e,outputs:i,inputs:t,timeMs:s.then(e=>e.kernelMs),extraInfo:s.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:i,inputs:r,extraInfo:s}=e;n.forEach(e=>{Promise.all([e.data(),i,s]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],r,n[2])})})}}function dr(e,t,n){if("float32"!==t)return!1;for(let i=0;i<e.length;i++){const t=e[i];if(isNaN(t)||!isFinite(t))return console.warn("Found ".concat(t," in the result of '").concat(n,"'")),!0}return!1}class pr{logKernelProfile(e,t,n,i,r,s){const a="number"===typeof i?W("".concat(i,"ms"),9):i.error,o=W(e,25),l=t.rank,c=t.size,u=W(t.shape.toString(),14);let h="";for(const d in r){const e=r[d];if(null!=e){const n=e.shape||t.shape,i=n.length;h+="".concat(d,": ").concat(i,"D ").concat(i>0?n:""," ")}}console.log("%c".concat(o,"\t%c").concat(a,"\t%c").concat(l,"D ").concat(u,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(s),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function fr(e,t,n,i){const r=ie(t),s=function(e,t,n,i){const r=B(t),s=i[i.length-1],a=new Array(s).fill(0),o=t.length,l="complex64"===n?br(e):e;if(o>1)for(let c=0;c<r/s;c++){const e=c*s;for(let t=0;t<s;t++)a[t]=Math.max(a[t],gr(l[e+t],0,n).length)}return a}(e,t,n,r),a=t.length,o=yr(e,t,n,r,s),l=["Tensor"];return i&&(l.push("  dtype: ".concat(n)),l.push("  rank: ".concat(a)),l.push("  shape: [".concat(t,"]")),l.push("  values:")),l.push(o.map(e=>"    "+e).join("\n")),l.join("\n")}function gr(e,t,n){let i;return i=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):J(e)?"'".concat(e,"'"):"bool"===n?mr(e):parseFloat(e.toFixed(7)).toString(),W(i,t)}function mr(e){return 0===e?"false":"true"}function yr(e,t,n,i,r){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const a="complex64"===n?2:1,o=t[0],l=t.length;if(0===l){if("complex64"===n){return[gr(br(e)[0],0,n)]}return"bool"===n?[mr(e[0])]:[e[0].toString()]}if(1===l){if(o>20){const t=3*a;let i=Array.from(e.slice(0,t)),s=Array.from(e.slice((o-3)*a,o*a));return"complex64"===n&&(i=br(i),s=br(s)),["["+i.map((e,t)=>gr(e,r[t],n)).join(", ")+", ..., "+s.map((e,t)=>gr(e,r[o-3+t],n)).join(", ")+"]"]}return["["+("complex64"===n?br(e):Array.from(e)).map((e,t)=>gr(e,r[t],n)).join(", ")+"]"]}const c=t.slice(1),u=i.slice(1),h=i[0]*a,d=[];if(o>20){for(let t=0;t<3;t++){const i=t*h,s=i+h;d.push(...yr(e.slice(i,s),c,n,u,r,!1))}d.push("...");for(let t=o-3;t<o;t++){const i=t*h,s=i+h;d.push(...yr(e.slice(i,s),c,n,u,r,t===o-1))}}else for(let g=0;g<o;g++){const t=g*h,i=t+h;d.push(...yr(e.slice(t,i),c,n,u,r,g===o-1))}const p=2===l?",":"";d[0]="["+(o>0?d[0]+p:"");for(let g=1;g<d.length-1;g++)d[g]=" "+d[g]+p;let f=",\n";for(let g=2;g<l;g++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function br(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class vr{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=B(e),null!=n){const e=n.length;F(e===this.size,()=>"Length of values '".concat(e,"' does not match the size ")+"inferred by the shape '".concat(this.size,"'."))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Y(t,this.size),this.strides=ie(e)}set(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];0===n.length&&(n=[0]),F(n.length===this.rank,()=>"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(this.rank,")"));const r=this.locToIndex(n);this.values[r]=e}get(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);let i=0;for(const s of t){if(s<0||s>=this.shape[i]){const e="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(e)}i++}let r=t[t.length-1];for(let s=0;s<t.length-1;++s)r+=this.strides[s]*t[s];return this.values[r]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return _r().makeTensor(this.values,this.shape,this.dtype)}}let _r=null,xr=null,wr=null;class Tr{constructor(e,t,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=B(e),this.strides=ie(e),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return xr.buffer(this.shape,this.dtype,e)}bufferSync(){return xr.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return se(this.shape,e,"complex64"===this.dtype)}arraySync(){return se(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=_r().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map(e=>lr(e))}catch(uG){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),_r().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=_r().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>lr(e))}catch(uG){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await _r().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(_r().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return xr.print(this,e)}clone(){return this.throwIfDisposed(),xr.clone(this)}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return fr(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),xr.cast(this,e)}variable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),_r().makeVariable(this,e,t,n)}}function kr(){return _e("Tensor",()=>Tr)}Object.defineProperty(Tr,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),kr();class Sr extends Tr{constructor(e,t,n,i){super(e.shape,e.dtype,e.dataId,i),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!z(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));_r().disposeTensor(this),this.dataId=e.dataId,_r().incRef(this,null)}dispose(){_r().disposeVariable(this),this.isDisposedInternal=!0}}var Cr,Ir,Er,Nr,Ar;Object.defineProperty(Sr,Symbol.hasInstance,{value:e=>e instanceof Tr&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Cr||(Cr={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ir||(Ir={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Er||(Er={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Nr||(Nr={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ar||(Ar={}));const Rr={float32:Nr,int32:Ir,bool:Er,complex64:Ar};function Dr(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Rr[e][t]}function Or(e){return Dr(e,"int32")}function Lr(e){return null!=e&&"object"===typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function Pr(e){return"undefined"!==typeof GPUBuffer&&null!=e&&"object"===typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function Fr(e,t){if(e.dtype===t.dtype)return[e,t];const n=Dr(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Mr(e,t){return t.some(t=>t.id===e.id)}function Ur(e){const t=[];return Br(e,t,new Set),t}function Br(e,t,n){if(null==e)return;if(e instanceof Tr)return void t.push(e);if(i=e,!Array.isArray(i)&&"object"!==typeof i)return;var i;const r=e;for(const s in r){const e=r[s];n.has(e)||(n.add(e),Br(e,t,n))}}function zr(e){return null!=e.kernelName}class Vr{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class jr{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Vr}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error("The highest priority backend '".concat(e,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(Oi("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error("Backend name '".concat(e,"' not found in registry"));if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new hr(this.backendInstance),!0}setupRegisteredKernels(){Bi(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Bi(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{const n=t.factory();if(!n||n instanceof A||"function"!==typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,i=n.then(n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0)).catch(n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,Oi("Initialization of backend ".concat(e," failed")),Oi(n.stack||n.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}}catch(n){return Oi("Initialization of backend ".concat(e," failed")),Oi(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:i,asyncInit:r}=this.initializeBackend(n);if(r||i)return{name:n,asyncInit:r}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),i=n.backend,r=this.readSync(t),s=i.refCount(t);i.disposeData(t,!0),n.backend=e,e.move(t,r,n.shape,n.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,i=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun(()=>this.startScope(i),()=>this.endScope(n),()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(i){throw t(),i}}nextTensorId(){return jr.nextTensorId++}nextVariableId(){return jr.nextVariableId++}clone(e){const t=Hr.runKernel(Ft,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],e=>({x:()=>{const t={x:e},n={dtype:"float32"};return Hr.runKernel(He,t,n)}}),[],{}),t}runKernel(e,t,n){null==this.backendName&&this.backend;if(!(null!=Mi(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const i=this.backend.numDataIds();let r=0;n.forEach(e=>{r+="complex64"===e.dtype?3:1});const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-t-r-s;if(a>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(a," data ids) after running '").concat(e,"'"))}runKernelFunc(e){let t,n=[];const i=this.isTapeOn(),r=this.state.numBytes,s=this.state.numTensors;let a,o;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=zr(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(zr(e)){const{kernelName:t,inputs:r,attrs:s}=e;null==this.backendName&&this.backend;const l=Mi(t,this.backendName);F(null!=l,()=>"Cannot find registered kernel '".concat(t,"' for backend '").concat(this.backendName,"'")),a=()=>{const e=this.backend.numDataIds();o=l.kernelFunc({inputs:r,attrs:s,backend:this.backend});const a=Array.isArray(o)?o:[o];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,a);const c=a.map(e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e));if(i){const e=this.getTensorsForGradient(t,r,c);n=this.saveTensorsForBackwardMode(e)}return c}}else{const{forwardFunc:t}=e,r=e=>{i&&(n=e.map(e=>this.keep(this.clone(e))))};a=()=>{const e=this.backend.numDataIds();o=this.tidy(()=>t(this.backend,r));const n=Array.isArray(o)?o:[o];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,e,n),n}}const{inputs:c,attrs:u}=e,h=zr(e)?null:e.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(l,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs):t=a()}),i&&this.addTapeNode(l,c,t,h,n,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-r,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(e=>null!=c[e]?c[e].shape:null),outputShapes:t.map(e=>e.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(o)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(e=>this.keep(this.clone(e)))}getTensorsForGradient(e,t,n){const i=Ui(e);if(null!=i){const e=i.inputsToSave||[],r=i.outputsToSave||[];let s;i.saveAllInputs?(F(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(e=>t[e])):s=e.map(e=>t[e]);const a=n.filter((e,t)=>r[t]);return s.concat(a)}return[]}makeTensor(e,t,n,i){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;let r=e;"string"===n&&J(e[0])&&(r=e.map(e=>or(e)));const s=i.write(r,t,n),a=new Tr(t,n,s,this.nextTensorId());if(this.trackTensor(a,i),"string"===n){const e=this.state.tensorInfo.get(s),t=function(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}(r);this.state.numBytes+=t-e.bytes,e.bytes=t}return a}makeTensorFromDataId(e,t,n,i){const r={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(r,i)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:i,dtype:r}=e,s=new Tr(i,r,n,this.nextTensorId());return this.trackTensor(s,t),s}makeVariable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=i&&i!==e.dtype&&(e=e.cast(i));const r=new Sr(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[r.name])throw new Error("Variable with name ".concat(r.name," was already registered"));return this.state.registeredVariables[r.name]=r,this.incRef(r,this.backend),r}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*$(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Sr||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*$(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,i,r,s){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:r},o=Ui(e);null!=o&&(i=o.gradFunc),null!=i&&(a.gradient=e=>(e=e.map((e,t)=>{if(null==e){const e=n[t],i=oe(e.size,e.dtype);return this.makeTensor(i,e.shape,e.dtype)}return e}),i(e.length>1?e:e[0],r,s))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Ur(e),n=new Set(t.map(e=>e.id));for(let r=0;r<this.state.activeScope.track.length;r++){const e=this.state.activeScope.track[r];e.kept||n.has(e.id)||e.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==i.id||this.track(e)})}gradients(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(F(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));const r=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));F(r instanceof Tr,()=>"The result y returned by f() must be a tensor.");const s=function(e,t,n){const i={},r={};for(let l=0;l<t.length;l++)i[t[l].id]=!0;for(let l=0;l<e.length;l++){const n=e[l],s=n.inputs;for(const e in s){const a=s[e];let o=!1;for(let e=0;e<t.length;e++)if(i[a.id]){n.outputs.forEach(e=>i[e.id]=!0),o=!0,r[n.id]=!0;break}if(o)break}}const s={};s[n.id]=!0;const a={};for(let l=e.length-1;l>=0;l--){const t=e[l],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(s[t.outputs[e].id]){for(const e in n)s[n[e].id]=!0,a[t.id]=!0;break}}const o=[];for(let l=0;l<e.length;l++){const t=e[l];if(r[t.id]&&a[t.id]){const e={};for(const r in t.inputs){const n=t.inputs[r];i[n.id]&&(e[r]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,o.push(n)}}return o}(this.state.activeTape,t,r);if(!i&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const e={};e[r.id]=null==n?function(e){const t=ae(B(e),"float32");return Hr.makeTensor(t,e,"float32")}(r.shape):n,function(e,t,n,i){for(let r=t.length-1;r>=0;r--){const s=t[r],a=[];if(s.outputs.forEach(t=>{const n=e[t.id];null!=n?a.push(n):a.push(null)}),null==s.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));const o=s.gradient(a);for(const t in s.inputs){if(!(t in o))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(o),"."));const r=n(()=>o[t]());if("float32"!==r.dtype)throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(r.dtype,"'"));const a=s.inputs[t];if(!z(r.shape,a.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(r.shape,"', which does not match ")+"the shape of the input '".concat(a.shape,"'"));if(null==e[a.id])e[a.id]=r;else{const t=e[a.id];e[a.id]=i(t,r),t.dispose()}}}}(e,s,e=>this.tidy(e),Gr);const i=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(const t of e.saved)t.dispose()}),this.state.activeTape=null),{value:r,grads:i}})}customGrad(e){var t=this;return F(te(e),()=>"The f passed in customGrad(f) must be a function."),function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];let s;F(i.every(e=>e instanceof Tr),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const a={};i.forEach((e,t)=>{a[t]=e});return t.runKernelFunc({forwardFunc:(t,n)=>(s=e(...i,n),F(s.value instanceof Tr,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),F(te(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),backwardsFunc:(e,t)=>{const n=s.gradFunc(e,t),r=Array.isArray(n)?n:[n];F(r.length===i.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),F(r.every(e=>e instanceof Tr),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const a={};return r.forEach((e,t)=>{a[t]=()=>e}),a},inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=ar(),n=await this.backend.time(e);return n.wallMs=ar()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Vr;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function Wr(){const e=ve();if(null==e._tfengine){const t=new fe(e);e._tfengine=new jr(t)}var t;return t=e._tfengine.ENV,be=t,function(e){_r=e}(()=>e._tfengine),e._tfengine}jr.nextTensorId=0,jr.nextVariableId=0;const Hr=Wr();function Gr(e,t){const n={a:e,b:t};return Hr.runKernel(ke,n)}let qr;function Xr(e){if(void 0!==qr)return qr;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Kr(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}const Yr=me();function Qr(e,t){let n=e;if(cr(e))return"string"===t?[]:[e.length];if(Lr(e)){const t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(Pr(e))return[e.buffer.size/(null==t?4:$(t))];if(!Array.isArray(e))return[];const i=[];for(;Array.isArray(n)||cr(n)&&"string"!==t;)i.push(n.length),n=n[0];return Array.isArray(e)&&me().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&$r(e,i,[]),i}function $r(e,t,n){if(n=n||[],!Array.isArray(e)&&!cr(e))return void F(0===t.length,()=>"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements"));F(t.length>0,()=>"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")),F(e.length===t[0],()=>"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements"));const i=t.slice(1);for(let r=0;r<e.length;++r)$r(e[r],i,n.concat(r))}function Jr(e,t,n,i){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(i,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function Zr(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof Tr)return Jr(i,e.dtype,t,n),e;let r=ee(e);if("string"!==r&&["bool","int32","float32"].indexOf(i)>=0&&(r=i),Jr(i,r,t,n),null==e||!cr(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){const i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}const s=Qr(e,r);cr(e)||Array.isArray(e)||(e=[e]);const a="string"!==r?sr(e,r):ur(e,[],!0);return Hr.makeTensor(a,s,r)}function es(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((e,r)=>Zr(e,"".concat(t,"[").concat(r,"]"),n,i))}Yr.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Yr.registerFlag("IS_BROWSER",()=>Kr()),Yr.registerFlag("IS_NODE",()=>"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node),Yr.registerFlag("IS_CHROME",()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),Yr.registerFlag("IS_SAFARI",()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),Yr.registerFlag("PROD",()=>!1),Yr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Yr.getBool("DEBUG")),Yr.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),Yr.registerFlag("IS_TEST",()=>!1),Yr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Yr.getBool("DEBUG")),Yr.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),Yr.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),Yr.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function ts(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));let n=t[0];const i=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const r=function(){Hr.startScope(n);try{const e=i(...arguments);return de(e)&&console.error("Cannot return a Promise inside of tidy."),Hr.endScope(e),e}catch(e){throw Hr.endScope(null),e}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}const ns=ts({complex_:function(e,t){const n=Zr(e,"real","complex"),i=Zr(t,"imag","complex");M(n.shape,i.shape,"real and imag shapes, ".concat(n.shape," and ").concat(i.shape,", ")+"must match in call to tf.complex().");const r={real:n,imag:i};return Hr.runKernel(Xe,r)}});function is(e,t,n,i){if(null==i)i=ee(e);else if("complex64"===i)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Pr(e)||Lr(e)){if("float32"!==i&&"int32"!==i)throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(i,"."));return Hr.backend.createTensorFromGPUData(e,t||n,i)}if(!cr(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){ce(t);const e=B(t),i=B(n);F(e===i,()=>"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(e," values but has ").concat(i));for(let r=0;r<n.length;++r){const e=n[r],i=r!==n.length-1||e!==B(t.slice(r));F(n[r]===t[r]||!i,()=>"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). "))}}return cr(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==i?sr(e,i):ur(e,[],!0),Hr.makeTensor(e,t,i)}function rs(e,t,n){return is(e,t,Qr(e,n),n)}class ss{static join(e){return new ss(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e)return;if(e instanceof Array||(e=[e]),0===(e=e.map(e=>cr(e)?e.buffer:e)).length)return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){const i=e[n];n!==e.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const r=t+i.byteLength;this.shards.push({buffer:i,start:t,end:r}),t=r}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));const i=new ArrayBuffer(t-e),r=new Uint8Array(i);let s=0;for(let a=n;a<this.shards.length;a++){const n=this.shards[a],i=e+s-n.start,o=s,l=Math.min(t,n.end)-n.start,c=new Uint8Array(n.buffer,i,l-i);if(r.set(c,o),s+=c.length,t<n.end)break}return i}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;const n=function(e,t){let n=0,i=e.length;for(;n<=i;){const r=Math.floor((i-n)/2)+n,s=t(e[r]);if(0===s)return r;s<0?i=r:n=r+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}async function as(e,t){const n=[],i=[],r=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);for(let s=0;s<r.length;++s){const a=r[s],o=Array.isArray(e)?e[s].tensor:e[a];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw new Error("Unsupported dtype in weight '".concat(a,"': ").concat(o.dtype));const l={name:a,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){const e=new Promise(async e=>{const t=await o.bytes(),n=t.reduce((e,t)=>e+t.length,0)+4*t.length,i=new Uint8Array(n);let r=0;for(let s=0;s<t.length;s++){const e=t[s],n=new Uint8Array(new Uint32Array([e.length]).buffer);i.set(n,r),r+=4,i.set(e,r),r+=e.length}e(i)});i.push(e)}else i.push(o.data());null!=t&&(l.group=t),n.push(l)}return{data:os(await Promise.all(i)),specs:n}}function os(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));let t=0;const n=[];e.forEach(e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))});const i=new Uint8Array(t);let r=0;return n.forEach(e=>{i.set(new Uint8Array(e.buffer),r),r+=e.byteLength}),i.buffer}const ls="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function cs(e){return ls?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function us(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}async function hs(e,t){let n,i;return null!=e.weightsManifest&&([n,i]=await t(e.weightsManifest)),function(e,t,n){const i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(i.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");i.weightSpecs=t,i.weightData=n}return null!=e.signature&&(i.signature=e.signature),null!=e.userDefinedMetadata&&(i.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(i.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(i.initializerSignature=e.initializerSignature),i}(e,n,i)}function ds(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:cs(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:cs(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new ss(e.weightData).byteLength}}class ps{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==ps.instance&&(ps.instance=new ps),ps.instance}static registerSaveRouter(e){ps.getInstance().saveRouters.push(e)}static registerLoadRouter(e){ps.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return ps.getHandlers(e,"save")}static getLoadHandlers(e,t){return ps.getHandlers(e,"load",t)}static getHandlers(e,t,n){const i=[];return("load"===t?ps.getInstance().loadRouters:ps.getInstance().saveRouters).forEach(t=>{const r=t(e,n);null!==r&&i.push(r)}),i}}const fs="tensorflowjs",gs="models_store",ms="model_info_store";function ys(){if(!me().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function bs(e){const t=e.result;t.createObjectStore(gs,{keyPath:"modelPath"}),t.createObjectStore(ms,{keyPath:"modelPath"})}class vs{constructor(e){if(this.indexedDB=ys(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((e,n)=>{const i=this.indexedDB.open(fs,1);i.onupgradeneeded=()=>bs(i),i.onsuccess=()=>{const r=i.result;if(null==t){const t=r.transaction(gs,"readonly"),i=t.objectStore(gs).get(this.modelPath);i.onsuccess=()=>{if(null==i.result)return r.close(),n(new Error("Cannot find model with path '".concat(this.modelPath,"' ")+"in IndexedDB."));e(i.result.modelArtifacts)},i.onerror=e=>(r.close(),n(i.error)),t.oncomplete=()=>r.close()}else{t.weightData=ss.join(t.weightData);const i=ds(t),a=r.transaction(ms,"readwrite");let o,l,c=a.objectStore(ms);try{o=c.put({modelPath:this.modelPath,modelArtifactsInfo:i})}catch(s){return n(s)}o.onsuccess=()=>{l=r.transaction(gs,"readwrite");const o=l.objectStore(gs);let u;try{u=o.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:i})}catch(s){return n(s)}u.onsuccess=()=>e({modelArtifactsInfo:i}),u.onerror=e=>{c=a.objectStore(ms);const t=c.delete(this.modelPath);t.onsuccess=()=>(r.close(),n(u.error)),t.onerror=e=>(r.close(),n(u.error))}},o.onerror=e=>(r.close(),n(o.error)),a.oncomplete=()=>{null==l?r.close():l.oncomplete=()=>r.close()}}},i.onerror=e=>n(i.error)})}}vs.URL_SCHEME="indexeddb://";const _s=e=>{return me().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(vs.URL_SCHEME)?(t=e.slice(vs.URL_SCHEME.length),new vs(t)):null;var t};ps.registerSaveRouter(_s),ps.registerLoadRouter(_s);class xs{constructor(){this.indexedDB=ys()}async listModels(){return new Promise((e,t)=>{const n=this.indexedDB.open(fs,1);n.onupgradeneeded=()=>bs(n),n.onsuccess=()=>{const i=n.result,r=i.transaction(ms,"readonly"),s=r.objectStore(ms).getAll();s.onsuccess=()=>{const t={};for(const e of s.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},s.onerror=e=>(i.close(),t(s.error)),r.oncomplete=()=>i.close()},n.onerror=e=>t(n.error)})}async removeModel(e){var t;return e=(t=e).startsWith(vs.URL_SCHEME)?t.slice(vs.URL_SCHEME.length):t,new Promise((t,n)=>{const i=this.indexedDB.open(fs,1);i.onupgradeneeded=()=>bs(i),i.onsuccess=()=>{const r=i.result,s=r.transaction(ms,"readwrite"),a=s.objectStore(ms),o=a.get(e);let l;o.onsuccess=()=>{if(null==o.result)return r.close(),n(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));{const i=a.delete(e),s=()=>{l=r.transaction(gs,"readwrite");const i=l.objectStore(gs).delete(e);i.onsuccess=()=>t(o.result.modelArtifactsInfo),i.onerror=e=>n(o.error)};i.onsuccess=s,i.onerror=e=>(s(),r.close(),n(o.error))}},o.onerror=e=>(r.close(),n(o.error)),s.oncomplete=()=>{null==l?r.close():l.oncomplete=()=>r.close()}},i.onerror=e=>n(i.error)})}}const ws="/",Ts="tensorflowjs_models",ks="info",Ss="model_topology",Cs="weight_specs",Is="weight_data",Es="model_metadata";function Ns(e){return{info:[Ts,e,ks].join(ws),topology:[Ts,e,Ss].join(ws),weightSpecs:[Ts,e,Cs].join(ws),weightData:[Ts,e,Is].join(ws),modelMetadata:[Ts,e,Es].join(ws)}}function As(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function Rs(e){const t=e.split(ws);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(ws)}class Ds{constructor(e){if(!me().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Ns(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),i=JSON.stringify(e.weightSpecs),r=ds(e),s=ss.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,i),this.LS.setItem(this.keys.weightData,function(e){if(ls)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let i=0,r=t.length;i<r;i++)n+=String.fromCharCode(t[i]);return btoa(n)}(s));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:r}}catch(t){throw As(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(r.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(r.weightSpecsBytes,", ")+"weightDataBytes=".concat(r.weightDataBytes,"."))}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");t.modelTopology=n;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==i)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");t.weightSpecs=i;const r=this.LS.getItem(this.keys.modelMetadata);if(null!=r){const e=JSON.parse(r);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(null==s)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=function(e){if(ls){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n.set([t.charCodeAt(i)],i);return n.buffer}(s),t}}Ds.URL_SCHEME="localstorage://";const Os=e=>{return me().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ds.URL_SCHEME)?(t=e.slice(Ds.URL_SCHEME.length),new Ds(t)):null;var t};ps.registerSaveRouter(Os),ps.registerLoadRouter(Os);class Ls{constructor(){F(me().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),F("undefined"===typeof window||"undefined"!==typeof window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Ts+ws,n=ws+ks;for(let i=0;i<this.LS.length;++i){const r=this.LS.key(i);if(r.startsWith(t)&&r.endsWith(n)){e[Rs(r)]=JSON.parse(this.LS.getItem(r))}}return e}async removeModel(e){var t;const n=Ns(e=(t=e).startsWith(Ds.URL_SCHEME)?t.slice(Ds.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error("Cannot find model at path '".concat(e,"'"));const i=JSON.parse(this.LS.getItem(n.info));return As(n),i}}const Ps="://";class Fs{constructor(){this.managers={}}static getInstance(){return null==Fs.instance&&(Fs.instance=new Fs),Fs.instance}static registerManager(e,t){F(null!=e,()=>"scheme must not be undefined or null."),e.endsWith(Ps)&&(e=e.slice(0,e.indexOf(Ps))),F(e.length>0,()=>"scheme must not be an empty string.");const n=Fs.getInstance();F(null==n.managers[e],()=>"A model store manager is already registered for scheme '".concat(e,"'.")),n.managers[e]=t}static getManager(e){const t=Fs.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}static getSchemes(){return Object.keys(Fs.getInstance().managers)}}class Ms{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){"undefined"!==typeof window&&me().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",e=>{if(e.source===window&&e.data.name===this.messageName){e.stopPropagation();(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))):setTimeout(e,t)}isTypedArray(e){return Wi(e)}}if(me().get("IS_BROWSER")){me().setPlatform("browser",new Ms);try{Fs.registerManager(Ds.URL_SCHEME,new Ls)}catch(sX){}try{Fs.registerManager(vs.URL_SCHEME,new xs)}catch(sX){}}const Us=()=>n(817);let Bs;class zs{constructor(){this.util=n(590),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=me().global.fetch?me().global.fetch(e,t):(null==Bs&&(Bs=Us()),Bs(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}function Vs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",ce(e),new vr(e,t,n)}me().get("IS_NODE")&&!me().get("IS_BROWSER")&&me().setPlatform("node",new zs);const js=ts({cast_:function(e,t){const n=Zr(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const i={x:n},r={dtype:t};return Hr.runKernel(He,i,r)}});const Ws=ts({clone_:function(e){const t={x:Zr(e,"x","clone","string_or_numeric")};return Hr.runKernel(Ft,t)}});Wr();const Hs={buffer:Vs,cast:js,clone:Ws,print:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};function Gs(){return Hr}function qs(){return Hr.memory()}function Xs(e,t){return Hr.tidy(e,t)}function Ks(e){Ur(e).forEach(e=>e.dispose())}function Ys(e){return Hr.keep(e)}function Qs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Hr.registerBackend(e,t,n)}xr=Hs,function(e){wr=e}(function(e){me().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")});const $s=ts({add_:function(e,t){let n=Zr(e,"a","add"),i=Zr(t,"b","add");[n,i]=Fr(n,i);const r={a:n,b:i};return Hr.runKernel(ke,r)}});const Js=ts({floorDiv_:function(e,t){let n=Zr(e,"a","floorDiv"),i=Zr(t,"b","floorDiv");[n,i]=Fr(n,i);const r={a:n,b:i};return Hr.runKernel(At,r)}});const Zs=ts({div_:function(e,t){let n=Zr(e,"a","div"),i=Zr(t,"b","div");if([n,i]=Fr(n,i),"int32"===n.dtype&&"int32"===i.dtype)return Js(n,i);const r={a:n,b:i};return Hr.runKernel(yt,r,{})}});const ea=ts({mul_:function(e,t){let n=Zr(e,"a","mul"),i=Zr(t,"b","mul");[n,i]=Fr(n,i);const r={a:n,b:i};return Hr.runKernel(pn,r)}});const ta=ts({sqrt_:function(e){const t={x:Zr(e,"x","sqrt","float32")};return Hr.runKernel(Zn,t)}});const na=ts({square_:function(e){const t=Zr(e,"x","square");return Hr.runKernel("Square",{x:t},{})}});const ia=ts({zerosLike_:function(e){const t={x:Zr(e,"x","zerosLike")};return Hr.runKernel(Ci,t)}});function ra(e){return Hr.customGrad(e)}function sa(e,t){if((cr(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&cr(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return is(e,[],[],t)}const aa=new Map,oa=new Map;class la{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class ca{constructor(){this.classNameMap={}}static getMap(){return null==ca.instance&&(ca.instance=new ca),ca.instance}static register(e){ca.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ua(e,t,n){F(null!=e.className,()=>"Class being registered does not have the static className property defined."),F("string"===typeof e.className,()=>"className is required to be a string, but got type "+typeof e.className),F(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),"undefined"===typeof t&&(t="Custom"),"undefined"===typeof n&&(n=e.className);const i=t+">"+n;return ca.register(e),aa.set(i,e),oa.set(e,i),e}class ha extends la{minimize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const{value:i,grads:r}=this.computeGradients(e,n);if(null!=n){const e=n.map(e=>({name:e.name,tensor:r[e.name]}));this.applyGradients(e)}else this.applyGradients(r);return Ks(r),t?i:(i.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return function(e,t){F(te(e),()=>"The f passed in variableGrads(f) must be a function"),F(null==t||Array.isArray(t)&&t.every(e=>e instanceof Sr),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=null!=t;if(!n){t=[];for(const e in Hr.registeredVariables)t.push(Hr.registeredVariables[e])}const i=n?t.filter(e=>!e.trainable):null,r=t.length;t=t.filter(e=>e.trainable),F(t.length>0,()=>"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(r," variables is ")+"trainable.");const{value:s,grads:a}=Hr.gradients(e,t,null,!0);F(a.some(e=>null!=e),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),F(0===s.rank,()=>"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(s.rank," tensor"));const o={};return t.forEach((e,t)=>{null!=a[t]&&(o[e.name]=a[t])}),null!=i&&i.forEach(e=>o[e.name]=null),{value:s,grads:o}}(e,t)}dispose(){null!=this.iterations_&&Ks(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:sa(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(ha,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class da extends ha{static get className(){return"Adadelta"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Hr.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=Hr.registeredVariables[t],r=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:"".concat(t,"/accum_grad"),variable:Xs(()=>ia(i).variable(r))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:"".concat(t,"/accum_var"),variable:Xs(()=>ia(i).variable(r))});const s=Array.isArray(e)?e[n].tensor:e[t];if(null==s)return;const a=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;Xs(()=>{const e=$s(ea(a,this.rho),ea(na(s),1-this.rho)),t=ea(Zs(ta($s(o,this.epsilon)),ta($s(a,this.epsilon))),s),n=$s(ea(o,this.rho),ea(na(t),1-this.rho));a.assign(e),o.assign(n);const r=$s(ea(t,-this.learningRate),i);i.assign(r)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(Ks(this.accumulatedGrads.map(e=>e.variable)),Ks(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function pa(e,t,n){ce(e);const i={shape:e,value:t,dtype:n=n||ee(t)};return Hr.runKernel(It,{},i)}class fa extends ha{static get className(){return"Adagrad"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=Hr.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:"".concat(t,"/accumulator"),variable:Xs(()=>pa(i.shape,this.initialAccumulatorValue).variable(e))}}const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const s=this.accumulatedGrads[n].variable;Xs(()=>{const e=$s(s,na(r));s.assign(e);const t=$s(ea(Zs(r,ta($s(e,Hr.backend.epsilon()))),-this.learningRate),i);i.assign(t)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&Ks(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}const ga=ts({pow_:function(e,t){let n=Zr(e,"base","pow"),i=Zr(t,"exp","pow");[n,i]=Fr(n,i);const r={a:n,b:i};return Hr.runKernel(Tn,r)}});const ma=ts({sub_:function(e,t){let n=Zr(e,"a","sub"),i=Zr(t,"b","sub");[n,i]=Fr(n,i);const r={a:n,b:i};return Hr.runKernel(mi,r)}});class ya extends ha{static get className(){return"Adam"}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Xs(()=>{this.accBeta1=sa(t).variable(),this.accBeta2=sa(n).variable()}),null==i&&(this.epsilon=Hr.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);Xs(()=>{const n=ma(1,this.accBeta1),i=ma(1,this.accBeta2);t.forEach((t,r)=>{const s=Hr.registeredVariables[t],a=!1;null==this.accumulatedFirstMoment[r]&&(this.accumulatedFirstMoment[r]={originalName:"".concat(t,"/m"),variable:Xs(()=>ia(s).variable(a))}),null==this.accumulatedSecondMoment[r]&&(this.accumulatedSecondMoment[r]={originalName:"".concat(t,"/v"),variable:Xs(()=>ia(s).variable(a))});const o=Array.isArray(e)?e[r].tensor:e[t];if(null==o)return;const l=this.accumulatedFirstMoment[r].variable,c=this.accumulatedSecondMoment[r].variable,u=$s(ea(l,this.beta1),ea(o,1-this.beta1)),h=$s(ea(c,this.beta2),ea(na(o),1-this.beta2)),d=Zs(u,n),p=Zs(h,i);l.assign(u),c.assign(h);const f=$s(ea(Zs(d,$s(ta(p),this.epsilon)),-this.learningRate),s);s.assign(f)}),this.accBeta1.assign(ea(this.accBeta1,this.beta1)),this.accBeta2.assign(ea(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ks(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedSecondMoment&&Ks(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),Xs(()=>{this.accBeta1.assign(ga(this.beta1,this.iterations_+1)),this.accBeta2.assign(ga(this.beta2,this.iterations_+1))});const t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}const ba=ts({abs_:function(e){const t=Zr(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return Hr.runKernel(Ke,e)}{const e={x:t};return Hr.runKernel(xe,e)}}});function va(e,t){const n=e.length,i=[];for(let r=0;r<n;r++){const s=n-1-r,a=e[s]||1;(t[t.length-1-r]||1)>1&&1===a&&i.unshift(s)}return i}function _a(e,t){const n=[];for(let i=0;i<t.length;i++){const r=e[e.length-i-1],s=t.length-i-1,a=t[s];(null==r||1===r&&a>1)&&n.unshift(s)}return n}function xa(e,t){const n=Math.max(e.length,t.length),i=new Array(n);for(let r=0;r<n;r++){let s=e[e.length-r-1];null==s&&(s=1);let a=t[t.length-r-1];if(null==a&&(a=1),1===s)i[n-r-1]=a;else if(1===a)i[n-r-1]=s;else{if(s!==a){const n="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(n)}i[n-r-1]=s}}return i}const wa=ts({maximum_:function(e,t){let n=Zr(e,"a","maximum"),i=Zr(t,"b","maximum");[n,i]=Fr(n,i),"bool"===n.dtype&&(n=js(n,"int32"),i=js(i,"int32")),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(en,r)}});class Ta extends ha{static get className(){return"Adamax"}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=i,this.decay=r,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Xs(()=>{this.iteration=sa(0).variable(),this.accBeta1=sa(t).variable()}),null==i&&(this.epsilon=Hr.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);Xs(()=>{const n=ma(1,this.accBeta1),i=Zs(-this.learningRate,$s(ea(this.iteration,this.decay),1));t.forEach((t,r)=>{const s=Hr.registeredVariables[t],a=!1;null==this.accumulatedFirstMoment[r]&&(this.accumulatedFirstMoment[r]={originalName:"".concat(t,"/m"),variable:ia(s).variable(a)}),null==this.accumulatedWeightedInfNorm[r]&&(this.accumulatedWeightedInfNorm[r]={originalName:"".concat(t,"/v"),variable:ia(s).variable(a)});const o=Array.isArray(e)?e[r].tensor:e[t];if(null==o)return;const l=this.accumulatedFirstMoment[r].variable,c=this.accumulatedWeightedInfNorm[r].variable,u=$s(ea(l,this.beta1),ea(o,1-this.beta1)),h=ea(c,this.beta2),d=ba(o),p=wa(h,d);l.assign(u),c.assign(p);const f=$s(ea(Zs(i,n),Zs(u,$s(p,this.epsilon))),s);s.assign(f)}),this.iteration.assign($s(this.iteration,1)),this.accBeta1.assign(ea(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ks(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedWeightedInfNorm&&Ks(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class ka extends ha{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);t.forEach((t,n)=>{const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const r=Hr.registeredVariables[t];Xs(()=>{const e=$s(ea(this.c,i),r);r.assign(e)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Ys(sa(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class Sa extends ka{static get className(){return"Momentum"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=sa(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=Hr.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:"".concat(t,"/momentum"),variable:Xs(()=>ia(i).variable(e))}}const r=this.accumulations[n].variable,s=Array.isArray(e)?e[n].tensor:e[t];null!=s&&Xs(()=>{let e;const t=$s(ea(this.m,r),s);e=this.useNesterov?$s(ea(this.c,$s(s,ea(t,this.m))),i):$s(ea(this.c,t),i),r.assign(t),i.assign(e)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&Ks(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class Ca extends ha{static get className(){return"RMSProp"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=r,null==i&&(this.epsilon=Hr.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=Hr.registeredVariables[t],r=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:"".concat(t,"/rms"),variable:Xs(()=>ia(i).variable(r))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:"".concat(t,"/momentum"),variable:Xs(()=>ia(i).variable(r))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:"".concat(t,"/mg"),variable:Xs(()=>ia(i).variable(r))});const s=Array.isArray(e)?e[n].tensor:e[t];if(null==s)return;const a=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;Xs(()=>{const e=$s(ea(a,this.decay),ea(na(s),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,r=$s(ea(t,this.decay),ea(s,1-this.decay)),l=Zs(ea(s,this.learningRate),ta(ma(e,$s(na(r),this.epsilon)))),c=$s(ea(o,this.momentum),l);a.assign(e),t.assign(r),o.assign(c);const u=ma(i,c);i.assign(u)}else{const e=$s(ea(a,this.decay),ea(na(s),1-this.decay)),t=$s(ea(o,this.momentum),Zs(ea(s,this.learningRate),ta($s(e,this.epsilon))));a.assign(e),o.assign(t);const n=ma(i,t);i.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&Ks(this.accumulatedMeanSquares.map(e=>e.variable)),null!=this.accumulatedMeanGrads&&this.centered&&Ks(this.accumulatedMeanGrads.map(e=>e.variable)),null!=this.accumulatedMoments&&Ks(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}const Ia=[da,fa,ya,Ta,Sa,Ca,ka];function Ea(e){return new Promise(e=>setTimeout(e)).then(e)}class Na{constructor(e){if(!me().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Na.URL_SCHEME)&&(e=e.slice(Na.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"===typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=ss.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const t=us(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),i=window.URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),r=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(r.download=this.modelJsonFileName,r.href=i,await Ea(()=>r.dispatchEvent(new MouseEvent("click"))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await Ea(()=>e.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:ds(e)}}}}Na.URL_SCHEME="downloads://";function Aa(e,t,n,i){!function(e){F(null!=e&&Array.isArray(e)&&e.length>0,()=>"promises must be a none empty array")}(e),function(e,t){F(e>=0&&e<=1,()=>"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)),F(t>=0&&t<=1,()=>"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)),F(t>=e,()=>"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t))}(n=null==n?0:n,i=null==i?1:i);let r=0;return Promise.all(e.map(s=>(s.then(s=>{const a=n+ ++r/e.length*(i-n);return t(a),s}),s)))}async function Ra(e,t){null==t&&(t={});const n=null==t.fetchFunc?me().platform.fetch:t.fetchFunc,i=e.map(e=>n(e,t.requestInit,{isBinary:!0})),r=(null==t.onProgress?await Promise.all(i):await Aa(i,t.onProgress,0,.5)).map(e=>e.arrayBuffer());return null==t.onProgress?await Promise.all(r):await Aa(r,t.onProgress,.5,1)}ps.registerSaveRouter(e=>me().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Na.URL_SCHEME)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Na(e)}(e.slice(Na.URL_SCHEME.length)):null);class Da{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(F("function"===typeof t.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=me().platform.fetch,F(null!=e&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&F(2===e.length,()=>"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=us(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);if(t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData){const n=ss.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:"application/octet-stream"}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:ds(e),responses:[i]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."))}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");let t;try{t=await e.json()}catch($F){let t="Failed to parse model JSON of response from ".concat(this.path,".");throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,i=t.weightsManifest;if(null==n&&null==i)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return hs(t,e=>this.loadWeights(e))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,i]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),i=e.substring(0,t),r=n>t?e.substring(n):"";return[i+"/",r]}(t),r=this.weightPathPrefix||n,s=function(e){const t=[];for(const n of e)t.push(...n.weights);return t}(e),a=[],o=[];for(const l of e)for(const e of l.paths)null!=this.weightUrlConverter?o.push(this.weightUrlConverter(e)):a.push(r+e+i);this.weightUrlConverter&&a.push(...await Promise.all(o));return[s,await Ra(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})]}}function Oa(e){return null!=e.match(Da.URL_SCHEME_REGEX)}Da.URL_SCHEME_REGEX=/^https?:\/\//;const La=(e,t)=>{if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every(e=>Oa(e)):Oa(e),n)return Pa(e,t)}return null};function Pa(e,t){return new Da(e,t)}ps.registerSaveRouter(La),ps.registerLoadRouter(La);const Fa=-2,Ma=-1;function Ua(e,t,n){const i=e.shape.length;F(i===t.length,()=>"Error in slice".concat(i,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(i,").")),F(i===n.length,()=>"Error in slice".concat(i,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(i,")."));for(let r=0;r<i;++r)F(t[r]+n[r]<=e.shape[r],()=>"Error in slice".concat(i,"D: begin[").concat(r,"] + size[").concat(r,"] ")+"(".concat(t[r]+n[r],") would overflow input.shape[").concat(r,"] (").concat(e.shape[r],")"))}function Ba(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function za(e,t,n){const i=[];for(let r=0;r<e.length;r++)i[r]=Math.ceil((t[r]-e[r])/n[r]);return i}function Va(e,t,n,i){const r=[...e];for(let s=r.length;s<i.length;s++)r.push(1);for(let s=0;s<n;s++)0===s?r[t]=1:(r.splice(t,0,1),r.pop());return r}function ja(e,t,n){return n<=e?n:n-(t-1)}function Wa(e,t){const n=[];for(let i=0;i<e;i++)n.push(t+i);return n}function Ha(e,t,n,i,r,s,a,o,l){const c=e.length;let u=new Array(c),h=new Array(c),d=new Array(c);if(t.length&&n>0){const l=t[0],c=n+1;u=Ga(a,l,c,i,e),h=qa(o,l,c,r,e),d=Va(s,l,c,e)}else for(let p=0;p<c;p++)u[p]=Ka(a,i,s,e,p,l),h[p]=Ya(o,r,s,e,p,l),d[p]=Xa(s,p,l);return{begin:u,end:h,strides:d}}function Ga(e,t,n,i,r){const s=[...r],a=Wa(n,t);for(let o=0;o<s.length;o++)if(a.indexOf(o)>-1)s[o]=0;else{const r=ja(t,n,o);let a=i[r];e&1<<r&&(a=0),s[o]=a}return s}function qa(e,t,n,i,r){const s=[...r],a=Wa(n,t);for(let o=0;o<s.length;o++)if(a.indexOf(o)>-1)s[o]=Number.MAX_SAFE_INTEGER;else{const r=ja(t,n,o);let a=i[r];e&1<<r&&(a=Number.MAX_SAFE_INTEGER),s[o]=a}for(let o=0;o<s.length;o++){const e=r[o];s[o]<0&&(s[o]+=e),s[o]=O(0,s[o],r[o])}return s}function Xa(e,t,n){let i=e[t];return(n&1<<t||null==i)&&(i=1),i}function Ka(e,t,n,i,r,s){let a=t[r];const o=n[r]||1;(e&1<<r||s&1<<r||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const l=i[r];return a<0&&(a+=l),a=O(0,a,l-1),a}function Ya(e,t,n,i,r,s){let a=t[r];const o=n[r]||1;(e&1<<r||s&1<<r||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=i[r];return a<0&&(a+=l),a=o>0?O(0,a,l):O(-1,a,l-1),a}function Qa(e,t,n){let i=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){i=r;break}for(let r=i+1;r<n.length;r++)if(t[r]>0||n[r]!==e[r])return!1;return!0}function $a(e,t){let n=e.length>0?e[e.length-1]:1;for(let i=0;i<e.length-1;i++)n+=e[i]*t[i];return n}function Ja(e,t,n){let i;const r=e.shape.length;let s;return i="number"===typeof t?[t,...new Array(r-1).fill(0)]:t.length<r?t.concat(new Array(r-t.length).fill(0)):t.slice(),i.forEach(e=>{F(-1!==e,()=>"slice() does not support negative begin indexing.")}),s=null==n?new Array(r).fill(-1):"number"===typeof n?[n,...new Array(r-1).fill(-1)]:n.length<r?n.concat(new Array(r-n.length).fill(-1)):n,s=s.map((t,n)=>t>=0?t:(F(-1===t,()=>"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")),e.shape[n]-i[n])),[i,s]}function Za(e,t,n,i,r,s,a,o,l){let c;if(null==i?(c=new Array(t.length),c.fill(1)):c=i,null!=a&&0!==(a&a-1))throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:r,endMask:s,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};for(let v=0;v<h.dims;v++)u&&0!==(1<<v&o)&&h.numAddAxisAfterEllipsis++,1<<v&a&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let i=0;i<e.dims;i++)if(1<<i&e.ellipsisMask){const r=Math.min(t.dims-(e.dims-i)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<r;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=i}else if(1<<i&e.newAxisMask)t.finalShapeGatherIndices.push(Fa),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[i]),null!=e.end&&(t.end[n]=e.end[i]),t.strides[n]=e.strides[i],e.beginMask&1<<i&&(t.beginMask|=1<<n),e.endMask&1<<i&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<i?(t.finalShapeGatherIndices.push(Ma),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(i)),t.inputShapeGatherIndicesSparse[n]=i,n++}}(h,d);let p=!0,f=!0,g=!0;const m=[],y=[];for(let v=0;v<e.length;++v){if(0===d.strides[v])throw Error("strides[".concat(v,"] must be non-zero"));const t=!!(d.shrinkAxisMask&1<<v),n=e[v];if(-1===n){m.push(t?1:-1);continue}const i=[d.beginMask&1<<v,d.endMask&1<<v],r=[d.strides[v]>0?0:-1,d.strides[v]>0?n:n-1];if(t&&d.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&1===d.strides[v];const s=!!(d.beginMask&1<<v&&d.endMask&1<<v);if(d.beginValid&&d.endValid){if(t){const e=d.begin[v]<0?n+d.begin[v]:d.begin[v];if(d.begin[v]=e,d.end[v]=d.begin[v]+1,e<0||e>=n)throw Error("slice index ".concat(d.begin[v]," of dimension ").concat(v," out of bounds."))}else d.begin[v]=eo(d.begin[v],0,d.strides[v],n,i,r),d.end[v]=eo(d.end[v],1,d.strides[v],n,i,r);const e=1===d.strides[v]&&0===d.begin[v]&&d.end[v]===n;p=p&&e,f=f&&(0===v&&1===d.strides[v]||e)}else p=p&&1===d.strides[v]&&s,f=f&&(0===v&&1===d.strides[v]||s);let a,o=!1;if(d.beginValid&&d.endValid?(a=d.end[v]-d.begin[v],o=!0):t?(a=1,o=!0):s&&n>=0&&(a=d.strides[v]<0?-n:n,o=!0),o){let e;e=0===a||a<0!==d.strides[v]<0?0:Math.trunc(a/d.strides[v])+(a%d.strides[v]!==0?1:0),m.push(e)}else m.push(-1)}for(let v=0;v<d.finalShapeGatherIndices.length;++v){const e=d.finalShapeGatherIndices[v];e>=0?y.push(m[e]):e===Fa&&y.push(1)}const b=y.filter((e,t)=>d.finalShapeGatherIndices[t]!==Fa);return{finalShapeSparse:b,finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:g,begin:d.begin,end:d.end,strides:d.strides}}function eo(e,t,n,i,r,s){if(r[t])return n>0?s[t]:s[t+1&1];{const t=e<0?i+e:e;return t<s[0]?s[0]:t>s[1]?s[1]:t}}const to=ts({all_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i={x:Zr(e,"x","all","bool")},r={axis:t,keepDims:n};return Hr.runKernel(Ce,i,r)}});const no=ts({any_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i={x:Zr(e,"x","any","bool")},r={axis:t,keepDims:n};return Hr.runKernel(Ie,i,r)}});const io=ts({argMax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:Zr(e,"x","argMax")},i={axis:t};return Hr.runKernel(Ee,n,i)}});function ro(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",s=arguments.length>5?arguments[5]:void 0;return oo(e,[...t,e[3]],n,s,i,null,null,bo(r))}function so(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";const[o,l]=uo(t);let c;if("channelsLast"===a)c=[o,l,e[3],e[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat ".concat(a));c=[o,l,e[1],e[1]]}return oo(e,c,n,i,r,s,!1,a)}function ao(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC";const[o,l,c]=ho(t);let u,h;if("NDHWC"===a)h="channelsLast",u=[o,l,c,e[4],e[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat ".concat(a));h="channelsFirst",u=[o,l,c,e[1],e[1]]}return lo(e,u,n,i,r,!1,h,s)}function oo(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",[l,c,u,h]=[-1,-1,-1,-1];if("channelsLast"===o)[l,c,u,h]=e;else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));[l,h,c,u]=e}const[d,p,,f]=t,[g,m]=uo(n),[y,b]=uo(i),v=po(d,y),_=po(p,b),{padInfo:x,outHeight:w,outWidth:T}=function(e,t,n,i,r,s,a,o,l){let c,u,h;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const r=function(e,t,n,i,r){null==i&&(i=co(e,t,n));const s=e[0],a=e[1],o=fo((s-t+2*i)/n+1,r),l=fo((a-t+2*i)/n+1,r);return[o,l]}([t,n],s,i,e,o);u=r[0],h=r[1]}else if("same"===e){u=Math.ceil(t/i),h=Math.ceil(n/r);const e=Math.max(0,(u-1)*i+s-t),o=Math.max(0,(h-1)*r+a-n),l=Math.floor(e/2),d=e-l,p=Math.floor(o/2);c={top:l,bottom:d,left:p,right:o-p,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-s+1)/i),h=Math.ceil((n-a+1)/r);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));{const d="channelsLast"===l?e[1][0]:e[2][0],p="channelsLast"===l?e[1][1]:e[2][1],f="channelsLast"===l?e[2][0]:e[3][0],g="channelsLast"===l?e[2][1]:e[3][1];c={top:d,bottom:p,left:f,right:g,type:0===d&&0===p&&0===f&&0===g?"VALID":"EXPLICIT"},u=fo((t-s+d+p)/i+1,o),h=fo((n-a+f+g)/r+1,o)}}return{padInfo:c,outHeight:u,outWidth:h}}(r,c,u,g,m,v,_,s,o),k=a?f*h:f;let S;return"channelsFirst"===o?S=[l,k,w,T]:"channelsLast"===o&&(S=[l,w,T,k]),{batchSize:l,dataFormat:o,inHeight:c,inWidth:u,inChannels:h,outHeight:w,outWidth:T,outChannels:k,padInfo:x,strideHeight:g,strideWidth:m,filterHeight:d,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:_,dilationHeight:y,dilationWidth:b,inShape:e,outShape:S,filterShape:t}}function lo(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",o=arguments.length>7?arguments[7]:void 0,[l,c,u,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===a)[l,c,u,h,d]=e;else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat ".concat(a));[l,d,c,u,h]=e}const[p,f,g,,m]=t,[y,b,v]=ho(n),[_,x,w]=ho(i),T=po(p,_),k=po(f,x),S=po(g,w),{padInfo:C,outDepth:I,outHeight:E,outWidth:N}=function(e,t,n,i,r,s,a,o,l,c,u){let h,d,p,f;"valid"===e&&(e=0);if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const g=function(e,t,n,i,r,s){null==r&&(r=co(e,t[0],i[0]));const a=[0,0,0,n];for(let o=0;o<3;o++)e[o]+2*r>=t[o]&&(a[o]=fo((e[o]-t[o]+2*r)/i[o]+1,s));return a}([t,n,i,1],[o,l,c],1,[r,s,a],e,u);d=g[0],p=g[1],f=g[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));{d=Math.ceil(t/r),p=Math.ceil(n/s),f=Math.ceil(i/a);const e=(d-1)*r+o-t,u=(p-1)*s+l-n,g=(f-1)*a+c-i,m=Math.floor(e/2),y=e-m,b=Math.floor(u/2),v=u-b,_=Math.floor(g/2);h={top:b,bottom:v,left:_,right:g-_,front:m,back:y,type:"SAME"}}}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}(r,c,u,h,y,b,v,T,k,S,o),A=s?m*d:m;let R;return"channelsFirst"===a?R=[l,A,I,E,N]:"channelsLast"===a&&(R=[l,I,E,N,A]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:u,inWidth:h,inChannels:d,outDepth:I,outHeight:E,outWidth:N,outChannels:A,padInfo:C,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:p,filterHeight:f,filterWidth:g,effectiveFilterDepth:T,effectiveFilterHeight:k,effectiveFilterWidth:S,dilationDepth:_,dilationHeight:x,dilationWidth:w,inShape:e,outShape:R,filterShape:t}}function co(e,t,n){const i=po(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+i)/2)}function uo(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function ho(e){return"number"===typeof e?[e,e,e]:e}function po(e,t){return t<=1?e:e+(e-1)*(t-1)}function fo(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function go(e){const[t,n,i]=uo(e);return 1===t&&1===n&&1===i}function mo(e,t){return go(e)||go(t)}function yo(e){return uo(e).every(e=>e>0)}function bo(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function vo(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)F(V(t),()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach(t=>{t.forEach(t=>{F(V(t),()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."))})})}}}const _o=ts({reshape_:function(e,t){const n={x:Zr(e,"x","reshape","string_or_numeric")},i={shape:t};return Hr.runKernel(On,n,i)}});const xo=ts({avgPool_:function(e,t,n,i,r){const s=Zr(e,"x","avgPool","float32");F(mo(n,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'"));let a=s,o=!1;3===s.rank&&(o=!0,a=_o(s,[1,s.shape[0],s.shape[1],s.shape[2]])),F(4===a.rank,()=>"Error in avgPool: x must be rank 4 but got rank ".concat(a.rank,".")),vo("avgPool",i,r);const l={x:a},c={filterSize:t,strides:n,pad:i,dimRoundingMode:r};let u=Hr.runKernel(Pe,l,c);return u=js(u,s.dtype),o?_o(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const wo=ts({avgPool3d_:function(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const a=Zr(e,"x","avgPool3d","float32");let o=a,l=!1;4===a.rank&&(l=!0,o=_o(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),F(5===o.rank,()=>"Error in avgPool3d: x must be rank 5 but got rank ".concat(o.rank,".")),F("NDHWC"===s,()=>"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(s)),F("number"===typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")),vo("avgPool3d",i,r);const c={x:o},u={filterSize:t,strides:n,pad:i,dimRoundingMode:r,dataFormat:s};let h=Hr.runKernel(Me,c,u);return h=js(h,o.dtype),l?_o(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const To=ts({batchNorm_:function(e,t,n,i,r,s){null==s&&(s=.001);const a=Zr(e,"x","batchNorm"),o=Zr(t,"mean","batchNorm"),l=Zr(n,"variance","batchNorm");let c,u;null!=r&&(c=Zr(r,"scale","batchNorm")),null!=i&&(u=Zr(i,"offset","batchNorm")),F(o.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(null==u||o.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(null==c||o.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h=function(e){let t;return t=0===e.rank||1===e.rank?_o(e,[1,1,1,e.size]):2===e.rank?_o(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?_o(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(a),d={x:h,scale:c,offset:u,mean:o,variance:l},p={varianceEpsilon:s},f=Hr.runKernel(Rt,d,p);return _o(f,a.shape)}});const ko=ts({batchNorm2d_:function(e,t,n,i,r,s){const a=Zr(e,"x","batchNorm"),o=Zr(t,"mean","batchNorm"),l=Zr(n,"variance","batchNorm");let c,u;return null!=r&&(c=Zr(r,"scale","batchNorm")),null!=i&&(u=Zr(i,"offset","batchNorm")),F(2===a.rank,()=>"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(a.rank,".")),F(2===o.rank||1===o.rank,()=>"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(o.rank,".")),F(2===l.rank||1===l.rank,()=>"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&F(2===c.rank||1===c.rank,()=>"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&F(2===u.rank||1===u.rank,()=>"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")),To(a,o,l,u,c,s)}});const So=ts({batchNorm3d_:function(e,t,n,i,r,s){const a=Zr(e,"x","batchNorm"),o=Zr(t,"mean","batchNorm"),l=Zr(n,"variance","batchNorm");let c,u;return null!=r&&(c=Zr(r,"scale","batchNorm")),null!=i&&(u=Zr(i,"offset","batchNorm")),F(3===a.rank,()=>"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(a.rank,".")),F(3===o.rank||1===o.rank,()=>"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(o.rank,".")),F(3===l.rank||1===l.rank,()=>"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&F(3===c.rank||1===c.rank,()=>"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&F(3===u.rank||1===u.rank,()=>"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")),To(a,o,l,u,c,s)}});const Co=ts({batchNorm4d_:function(e,t,n,i,r,s){const a=Zr(e,"x","batchNorm"),o=Zr(t,"mean","batchNorm"),l=Zr(n,"variance","batchNorm");let c,u;return null!=r&&(c=Zr(r,"scale","batchNorm")),null!=i&&(u=Zr(i,"offset","batchNorm")),F(4===a.rank,()=>"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(a.rank,".")),F(4===o.rank||1===o.rank,()=>"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(o.rank,".")),F(4===l.rank||1===l.rank,()=>"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&F(4===c.rank||1===c.rank,()=>"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&F(4===u.rank||1===u.rank,()=>"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")),To(a,o,l,u,c,s)}});const Io=ts({broadcastTo_:function(e,t){let n=Zr(e,"broadcastTo","x");const i=n.shape;if(ce(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=_o(n,e)}const r=n.shape,s=Array.from(t);for(let c=t.length-1;c>=0;c--)if(r[c]===t[c])s[c]=1;else if(1!==n.shape[c])throw new Error("broadcastTo(): [".concat(i,"] cannot be broadcast to [").concat(t,"]."));const a=s.map((e,t)=>e>1?t:-1).filter(e=>e>=0);if(0===a.length)return Ws(n);const o={x:n},l={reps:s};return Hr.runKernel(vi,o,l)}});const Eo=ts({clipByValue_:function(e,t,n){const i=Zr(e,"x","clipByValue");if(F(t<=n,()=>"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")),t===n)return pa(i.shape,t,i.dtype);const r={x:i},s={clipValueMin:t,clipValueMax:n};return Hr.runKernel(qe,r,s)}});const No=ts({concat_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;F(e.length>=1,()=>"Pass at least one tensor to concat");const n=es(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach(e=>{if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))}),1===n.length)return Ws(n[0]);const i=n,r={axis:t};return Hr.runKernel(Ye,i,r)}});const Ao=ts({concat1d_:function(e){return No(e,0)}});const Ro=ts({concat2d_:function(e,t){return No(e,t)}});const Do=ts({concat3d_:function(e,t){return No(e,t)}});const Oo=ts({concat4d_:function(e,t){return No(e,t)}});const Lo=ts({conv2d_:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],a=arguments.length>6?arguments[6]:void 0;const o=Zr(e,"x","conv2d","float32"),l=Zr(t,"filter","conv2d","float32");let c=o,u=!1;3===o.rank&&(u=!0,c=_o(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(4===c.rank,()=>"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")),F(4===l.rank,()=>"Error in conv2d: filter must be rank 4, but got rank "+"".concat(l.rank,".")),vo("conv2d",i,a);const h="NHWC"===r?c.shape[3]:c.shape[1];F(h===l.shape[2],()=>"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(l.shape[2],".")),F(mo(n,s),()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(s,"'")),F(yo(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),F(yo(n),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:c,filter:l},p={strides:n,pad:i,dataFormat:r,dilations:s,dimRoundingMode:a},f=Hr.runKernel(Qe,d,p);return u?_o(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const Po=ts({conv1d_:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0;const o=Zr(e,"x","conv1d"),l=Zr(t,"filter","conv1d");let c=o,u=!1;2===o.rank&&(u=!0,c=_o(o,[1,o.shape[0],o.shape[1]])),F(3===c.rank,()=>"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")),F(3===l.rank,()=>"Error in conv1d: filter must be rank 3, but got rank "+"".concat(l.rank,".")),vo("conv1d",i,a),F(c.shape[2]===l.shape[1],()=>"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(l.shape[1],".")),F(mo(n,s),()=>"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(s,"'")),F(yo(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),F(yo(n),()=>"Error in conv1D: Stride should be larger than 0."),F("NWC"===r,()=>"Error in conv1d: got dataFormat of ".concat(r," but only NWC is currently supported."));const h=_o(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=_o(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=Lo(d,h,[1,n],i,"NHWC",[1,s],a);return _o(p,u?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});const Fo=ts({conv2DBackpropInput_:function(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",a=arguments.length>6?arguments[6]:void 0;F(e.length===t.rank,()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match"));let o=e,l=t,c=!1;3===t.rank&&(c=!0,l=_o(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),F(4===o.length,()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(o.length,".")),F(4===l.rank,()=>"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(l.rank)),F(4===n.rank,()=>"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank));const u="NHWC"===s?o[3]:o[1],h="NHWC"===s?l.shape[3]:l.shape[1];F(u===n.shape[2],()=>"Error in conv2dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[2],".")),F(h===n.shape[3],()=>"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")),vo("conv2dDerInput",r,a);const d={dy:l,filter:n},p={strides:i,pad:r,dataFormat:s,dimRoundingMode:a,inputShape:o},f=Hr.runKernel(Je,d,p);return c?_o(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const Mo=ts({conv2dTranspose_:function(e,t,n,i,r,s){const a=Zr(e,"x","conv2dTranspose"),o=Zr(t,"filter","conv2dTranspose");return Fo(n,a,o,i,r,"NHWC",s)}});const Uo=ts({conv3d_:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1];const a=Zr(e,"x","conv3d"),o=Zr(t,"filter","conv3d");let l=a,c=!1;4===a.rank&&(c=!0,l=_o(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),F(5===l.rank,()=>"Error in conv3d: input must be rank 5, but got rank ".concat(l.rank,".")),F(5===o.rank,()=>"Error in conv3d: filter must be rank 5, but got rank "+"".concat(o.rank,".")),F(l.shape[4]===o.shape[3],()=>"Error in conv3d: depth of input (".concat(l.shape[4],") must match ")+"input depth for filter ".concat(o.shape[3],".")),F(mo(n,s),()=>"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(s,"'")),F("NDHWC"===r,()=>"Error in conv3d: got dataFormat of ".concat(r," but only NDHWC is currently supported.")),F(yo(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),F(yo(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:o},h={strides:n,pad:i,dataFormat:r,dilations:s},d=Hr.runKernel(Ze,u,h);return c?_o(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const Bo=ts({conv3DBackpropInput_:function(e,t,n,i,r){F(e.length===t.rank,()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match"));let s=e,a=t,o=!1;4===t.rank&&(o=!0,a=_o(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);const l=s[4],c=a.shape[4];F(5===s.length,()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(s.length,".")),F(5===a.rank,()=>"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(a.rank)),F(5===n.rank,()=>"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)),F(l===n.shape[3],()=>"Error in conv3dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[3],".")),F(c===n.shape[4],()=>"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],"."));const u={dy:a,filter:n},h={pad:r,strides:i,inputShape:s},d=Hr.runKernel(tt,u,h);return o?_o(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const zo=ts({conv3dTranspose_:function(e,t,n,i,r){const s=Zr(e,"x","conv3dTranspose"),a=Zr(t,"filter","conv3dTranspose");return Bo(n,s,a,i,r)}});const Vo=ts({denseBincount_:function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=Zr(e,"x","denseBincount"),s=Zr(t,"weights","denseBincount");F("int32"===r.dtype,()=>"Error in denseBincount: input "+"dtype must be int32, but got ".concat(r.dtype)),F(r.rank<=2,()=>"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(r.rank,".")),F(n>=0,()=>"size must be non-negative, but got ".concat(n,".")),F(s.size===r.size||0===s.size,()=>"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(r.shape,", weights shape: ")+"".concat(s.shape,"."));const a={x:r,weights:s},o={size:n,binaryOutput:i};return Hr.runKernel(ot,a,o)}});const jo=ts({depthwiseConv2d_:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],a=arguments.length>6?arguments[6]:void 0;const o=Zr(e,"x","depthwiseConv2d","float32"),l=Zr(t,"filter","depthwiseConv2d","float32");let c=o,u=!1;3===o.rank&&(u=!0,c=_o(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(4===c.rank,()=>"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")),F(4===l.rank,()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(l.rank,"."));const h="NHWC"===r?c.shape[3]:c.shape[1];F(h===l.shape[2],()=>"Error in depthwiseConv2d: number of input channels "+"(".concat(h,") must match the inChannels dimension in ")+"filter ".concat(l.shape[2],".")),vo("depthwiseConv2d",i,a);const d={x:c,filter:l},p={strides:n,pad:i,dataFormat:r,dilations:s,dimRoundingMode:a},f=Hr.runKernel(ct,d,p);return u?_o(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const Wo=ts({elu_:function(e){const t={x:Zr(e,"x","elu","float32")};return Hr.runKernel(vt,t)}});const Ho=ts({equal_:function(e,t){let n=Zr(e,"a","equal","string_or_numeric"),i=Zr(t,"b","equal","string_or_numeric");[n,i]=Fr(n,i),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(wt,r)}});const Go=ts({exp_:function(e){const t={x:Zr(e,"x","exp")};return Hr.runKernel(Tt,t)}});const qo=ts({expandDims_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Zr(e,"x","expandDims","string_or_numeric");F(t<=n.rank,()=>"Axis must be <= rank of the tensor");const i={input:n},r={dim:t};return Hr.runKernel(kt,i,r)}});const Xo=ts({tile_:function(e,t){const n=Zr(e,"x","tile","string_or_numeric");F(n.rank===t.length,()=>"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,"."));const i={x:n},r={reps:t};return Hr.runKernel(vi,i,r)}});const Ko=ts({eye_:function(e,t,n){null==t&&(t=e);const i=Vs([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),r=e<=t?e:t;for(let a=0;a<r;++a)i.set(1,a,a);const s=_o(i.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return Xo(qo(s,0),[n[0],1,1]);if(2===n.length)return Xo(qo(qo(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Xo(qo(qo(qo(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});const Yo=ts({floor_:function(e){const t={x:Zr(e,"x","floor","float32")};return Hr.runKernel(Nt,t)}});const Qo=ts({gather_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r={x:Zr(e,"x","gather"),indices:Zr(t,"indices","gather","int32")},s={axis:n,batchDims:i};return Hr.runKernel(Dt,r,s)}});const $o=ts({greater_:function(e,t){let n=Zr(e,"a","greater","string_or_numeric"),i=Zr(t,"b","greater","string_or_numeric");[n,i]=Fr(n,i),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(Lt,r)}});const Jo=ts({greaterEqual_:function(e,t){let n=Zr(e,"a","greaterEqual","string_or_numeric"),i=Zr(t,"b","greaterEqual","string_or_numeric");[n,i]=Fr(n,i),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(Pt,r)}});const Zo=ts({leakyRelu_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;const n={x:Zr(e,"x","leakyRelu")},i={alpha:t};return Hr.runKernel(jt,n,i)}});const el=ts({log_:function(e){const t={x:Zr(e,"x","log","float32")};return Hr.runKernel(qt,t)}});const tl=ts({log1p_:function(e){const t={x:Zr(e,"x","log1p")};return Hr.runKernel(Xt,t)}});const nl=ts({max_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i={x:Zr(e,"x","max")},r={reductionIndices:t,keepDims:n};return Hr.runKernel(Zt,i,r)}});const il=ts({sum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Zr(e,"x","sum");"bool"===i.dtype&&(i=js(i,"int32"));const r={x:i},s={axis:t,keepDims:n};return Hr.runKernel(ei,r,s)}});const rl=ts({logSoftmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=Zr(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));const i=ra((e,n)=>{const i=nl(e,t,!0),r=ma(e,i),s=ma(js(r,"float32"),el(il(Go(r),t,!0)));n([s]);return{value:s,gradFunc:(e,n)=>{const[i]=n,r=Go(i);return ma(e,ea(il(e,t,!0),r))}}});return i(n)}});const sl=ts({logicalAnd_:function(e,t){const n=Zr(e,"a","logicalAnd","bool"),i=Zr(t,"b","logicalAnd","bool");xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(Kt,r)}});const al=ts({matMul_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=Zr(e,"a","matMul"),s=Zr(t,"b","matMul");[r,s]=Fr(r,s);const a={a:r,b:s},o={transposeA:n,transposeB:i};return Hr.runKernel(Be,a,o)}});const ol=ts({maxPool_:function(e,t,n,i,r){const s=Zr(e,"x","maxPool");let a=s,o=!1;3===s.rank&&(o=!0,a=_o(s,[1,s.shape[0],s.shape[1],s.shape[2]])),F(4===a.rank,()=>"Error in maxPool: input must be rank 4 but got rank ".concat(a.rank,".")),F(mo(n,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")),vo("maxPool",i,r);const l={x:a},c={filterSize:t,strides:n,pad:i,dimRoundingMode:r},u=Hr.runKernel(tn,l,c);return o?_o(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const ll=ts({maxPool3d_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const a=Zr(e,"x","maxPool3d");let o=a,l=!1;4===a.rank&&(l=!0,o=_o(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),F(5===o.rank,()=>"Error in maxPool3d: x must be rank 5 but got rank ".concat(o.rank,".")),F("NDHWC"===s,()=>"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(s)),vo("maxPool3d",i,r);const c={x:o},u={filterSize:t,strides:n,pad:i,dimRoundingMode:r,dataFormat:s},h=Hr.runKernel(rn,c,u);return l?_o(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const cl=ts({mean_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i={x:Zr(e,"x","mean")},r={axis:t,keepDims:n};return Hr.runKernel(on,i,r)}});const ul=ts({min_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i={x:Zr(e,"x","min")},r={axis:t,keepDims:n};return Hr.runKernel(ln,i,r)}});const hl=ts({minimum_:function(e,t){let n=Zr(e,"a","minimum"),i=Zr(t,"b","minimum");[n,i]=Fr(n,i),"bool"===n.dtype&&(n=js(n,"int32"),i=js(i,"int32")),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(cn,r)}});function dl(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function pl(e,t,n){const i=e.length+t.length,r=[];let s=0,a=0;for(let o=0;o<i;o++)-1===n.indexOf(o)?r.push(e[s++]):r.push(t[a++]);return r}function fl(e,t){const n=[],i=e.length;for(let r=0;r<i;r++)-1===t.indexOf(r)&&n.push(e[r]);return[n,t.map(t=>e[t])]}function gl(e,t){return pl(e,t.map(e=>1),t)}function ml(e,t,n){F(dl(t,n),()=>"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input."))}function yl(e,t){if(dl(e,t))return null;const n=[];for(let i=0;i<t;++i)-1===e.indexOf(i)&&n.push(i);return e.forEach(e=>n.push(e)),n}function bl(e){return e.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function vl(e,t){const n=[];for(let i=t-e;i<t;++i)n.push(i);return n}const _l=ts({moments_:function(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=q(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=Zr(e,"x","moments")).shape),i=cl(e,n,t);let r=i.shape;t||(r=gl(i.shape,n));const s=na(ma(js(e,"float32"),_o(i,r)));return{mean:i,variance:cl(s,n,t)}}});const xl=ts({neg_:function(e){const t={x:Zr(e,"x","neg")};return Hr.runKernel(fn,t)}});const wl=ts({notEqual_:function(e,t){let n=Zr(e,"a","notEqual","string_or_numeric"),i=Zr(t,"b","notEqual","string_or_numeric");[n,i]=Fr(n,i),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(gn,r)}});const Tl=ts({oneHot_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));const s={indices:Zr(e,"indices","oneHot","int32")},a={dtype:r,depth:t,onValue:n,offValue:i};return Hr.runKernel(_n,s,a)}});function kl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(ce(e),"complex64"===t){const t=kl(e,"float32"),n=kl(e,"float32");return ns(t,n)}const n=oe(B(e),t);return Hr.makeTensor(n,e,t)}function Sl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(ce(e),"complex64"===t){const t=Sl(e,"float32"),n=kl(e,"float32");return ns(t,n)}const n=ae(B(e),t);return Hr.makeTensor(n,e,t)}const Cl=ts({onesLike_:function(e){const t={x:Zr(e,"x","onesLike")};return Hr.runKernel(vn,t)}});const Il=ts({pad_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Zr(e,"x","pad");if(0===i.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:t,constantValue:n},s={x:i};return Hr.runKernel(wn,s,r)}});const El=ts({prelu_:function(e,t){const n={x:Zr(e,"x","prelu"),alpha:Zr(t,"alpha","prelu")};return Hr.runKernel(kn,n)}});var Nl=n(53);class Al{constructor(e,t,n,i,r){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const s=r||Math.random();this.random=Nl.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let i,r,s;do{i=2*this.random()-1,r=2*this.random()-1,s=i*i+r*r}while(s>=1||0===s);const a=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*a,t=this.mean+this.stdDev*r*a,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Rl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=Nl.alea(i)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const Dl=ts({randomNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(ce(e),null!=i&&"bool"===i)throw new Error("Unsupported data type ".concat(i));const s=new Al(t,n,i,!1,r),a=Vs(e,i);for(let o=0;o<a.values.length;o++)a.values[o]=s.nextValue();return a.toTensor()}});const Ol=ts({randomUniform_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",r=arguments.length>4?arguments[4]:void 0;ce(e);const s=Vs(e,i),a=new Rl(t,n,null,r);for(let o=0;o<s.values.length;o++)s.values[o]=a.nextValue();return s.toTensor()}});function Ll(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");const r={start:e,stop:t,step:n,dtype:i};return Hr.runKernel(Nn,{},r)}const Pl=ts({relu_:function(e){const t={x:Zr(e,"x","relu")};return Hr.runKernel(Dn,t)}});const Fl=ts({reverse_:function(e,t){const n={x:Zr(e,"x","reverse")},i={dims:t};return Hr.runKernel(Bn,n,i)}});const Ml=ts({selu_:function(e){const t={x:Zr(e,"x","selu")};return Hr.runKernel(qn,t)}});const Ul=ts({separableConv2d_:function(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC";const o=Zr(e,"x","separableConv2d"),l=Zr(t,"depthwiseFilter","separableConv2d"),c=Zr(n,"pointwiseFilter","separableConv2d");let u=o,h=!1;if(3===o.rank&&(h=!0,u=_o(o,[1,o.shape[0],o.shape[1],o.shape[2]])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");F(4===u.rank,()=>"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(u.rank,".")),F(4===l.rank,()=>"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(l.rank,".")),F(4===c.rank,()=>"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(l.rank,".")),F(1===c.shape[0],()=>"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")),F(1===c.shape[1],()=>"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],"."));const d=l.shape[2],p=l.shape[3];F(c.shape[2]===d*p,()=>"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(d*p,", ")+"but got ".concat(c.shape[2],"."));const f=jo(u,l,i,r,a,s),g=Lo(f,c,1,"valid",a);return h?_o(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});const Bl=ts({sigmoid_:function(e){const t={x:Zr(e,"x","sigmoid","float32")};return Hr.runKernel($n,t)}});const zl=ts({slice_:function(e,t,n){const i=Zr(e,"x","slice","string_or_numeric");if(0===i.rank)throw new Error("Slicing scalar is not possible");const r={x:i},s={begin:t,size:n};return Hr.runKernel(Xn,r,s)}});const Vl=ts({slice1d_:function(e,t,n){const i=Zr(e,"x","slice1d");return F(1===i.rank,()=>"slice1d expects a rank-1 tensor, but got a rank-".concat(i.rank," tensor")),zl(i,[t],[n])}});const jl=ts({slice2d_:function(e,t,n){const i=Zr(e,"x","slice2d");return F(2===i.rank,()=>"slice2d expects a rank-2 tensor, but got a rank-".concat(i.rank," tensor")),zl(i,t,n)}});const Wl=ts({slice3d_:function(e,t,n){const i=Zr(e,"x","slice3d");return F(3===i.rank,()=>"slice3d expects a rank-3 tensor, but got a rank-".concat(i.rank," tensor")),zl(i,t,n)}});const Hl=ts({slice4d_:function(e,t,n){const i=Zr(e,"x","slice4d");return F(4===i.rank,()=>"slice4d expects a rank-4 tensor, but got a rank-".concat(i.rank," tensor")),zl(i,t,n)}});const Gl=ts({softmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=Zr(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));const i={logits:n},r={dim:t};return Hr.runKernel(ii,i,r)}});const ql=ts({softplus_:function(e){const t={x:Zr(e,"x","softplus")};return Hr.runKernel(Jn,t)}});const Xl=ts({split_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i={x:Zr(e,"x","split")},r={numOrSizeSplits:t,axis:n};return Hr.runKernel(ni,i,r)}});const Kl=ts({squeeze_:function(e,t){const n=Zr(e,"x","squeeze","string_or_numeric");return _o(n,X(n.shape,t).newShape)}});const Yl=ts({stack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=es(e,"tensors","stack","string_or_numeric");F(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&F(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const i=n,r={axis:t};return Hr.runKernel(xn,i,r)}});const Ql=ts({tanh_:function(e){const t={x:Zr(e,"x","tanh","float32")};return Hr.runKernel(bi,t)}});function $l(e,t){U(e);const n=Qr(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return is(e,null,n,t)}function Jl(e,t,n){if(U(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const i=Qr(e,n);if(2!==i.length&&1!==i.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===i.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return is(e,t,i,n)}const Zl=ts({truncatedNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(ce(e),null!=i&&"bool"===i)throw new Error("Unsupported data type $ { dtype }");const s=new Al(t,n,i,!0,r),a=Vs(e,i);for(let o=0;o<a.values.length;o++)a.values[o]=s.nextValue();return a.toTensor()}});const ec=ts({unstack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Zr(e,"x","unstack","string_or_numeric");F(t>=-n.shape.length&&t<n.shape.length,()=>"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")"));const i={value:n},r={axis:t};return Hr.runKernel(ki,i,r)}});const tc=ts({where_:function(e,t,n){const i=Zr(t,"a","where"),r=Zr(n,"b","where"),s=Zr(e,"condition","where","bool"),a=xa(xa(s.shape,i.shape),r.shape),o={condition:Io(s,a),t:Io(i,a),e:Io(r,a)};return Hr.runKernel(Gn,o)}});const nc=ts({imag_:function(e){const t={input:Zr(e,"input","imag")};return Hr.runKernel(Ut,t)}});const ic=ts({real_:function(e){const t={input:Zr(e,"input","real")};return Hr.runKernel(An,t)}});const rc=ts({transpose_:function(e,t,n){const i=Zr(e,"x","transpose");if(null==t&&(t=i.shape.map((e,t)=>t).reverse()),F(i.rank===t.length,()=>"Error in transpose: rank of input ".concat(i.rank," ")+"must match length of perm ".concat(t,".")),t.forEach(e=>{F(e>=0&&e<i.rank,()=>"All entries in 'perm' must be between 0 and ".concat(i.rank-1)+" but got ".concat(t))}),i.rank<=1)return i.clone();const r={x:i},s={perm:t};return"complex64"===i.dtype?Xs(()=>{let e=ic(i),t=nc(i);return e=Hr.runKernel(wi,{x:e},s),t=Hr.runKernel(wi,{x:t},s),n&&(t=xl(t)),ns(e,t)}):Hr.runKernel(wi,r,s)}});const sc=ts({dropout_:function(e,t,n,i){const r=Zr(e,"x","dropout");if(F("float32"===r.dtype,()=>"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(r.dtype," tensor instead.")),F(t>=0&&t<1,()=>"rate must be a float in the range [0, 1), but got ".concat(t,".")),0===t)return e instanceof Tr?r.clone():r;const s=function(e,t){if(null==t)return e.shape.slice();if(z(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let i=0;i<e.shape.length;i++)null==t[i]&&null!=e.shape[i]?n.push(e.shape[i]):n.push(t[i]);return n}return t}(r,n),a=1-t,o=Zs(Yo($s(Ol(s,0,1,"float32",i),a)),a);return ea(r,o)}});const ac=ts({fft_:function(e){F("complex64"===e.dtype,()=>"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,"."));const t={input:e};return Hr.runKernel(Ct,t)}});const oc=ts({rfft_:function(e,t){F("float32"===e.dtype,()=>"The dtype for rfft() must be real value but got ".concat(e.dtype));let n=e.shape[e.shape.length-1];const i=e.size/n;let r;if(null!=t&&t<n){const i=e.shape.map(e=>0),s=e.shape.map(e=>e);s[e.shape.length-1]=t,r=zl(e,i,s),n=t}else if(null!=t&&t>n){const i=e.shape.map(e=>e);i[e.shape.length-1]=t-n,r=No([e,kl(i)],e.shape.length-1),n=t}else r=e;const s=ia(r),a=_o(ns(r,s),[i,n]),o=ac(a),l=Math.floor(n/2)+1,c=ic(o),u=nc(o),h=Xl(c,[l,n-l],c.shape.length-1),d=Xl(u,[l,n-l],u.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=l,_o(ns(h[0],d[0]),p)}});const lc=ts({ifft_:function(e){F("complex64"===e.dtype,()=>"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,"."));const t={input:e};return Hr.runKernel(Mt,t)}});const cc=ts({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let i;if(t<=2){const r=_o(e,[n,t]);i=lc(r)}else{const r=[n,2*(t-1)],s=_o(ic(e),[n,t]),a=_o(nc(e),[n,t]),o=Fl(zl(s,[0,1],[n,t-2]),1),l=ea(Fl(zl(a,[0,1],[n,t-2]),1),sa(-1)),c=No([s,o],1),u=No([a,l],1),h=_o(ns(c,u),[r[0],r[1]]);i=lc(h)}if(i=ic(i),3===e.rank&&0!==e.shape[0]){const t=i,n=e.shape[0];i=_o(i,[n,i.shape[0]/n,i.shape[1]]),t.dispose()}return i}});const uc=ts({conv2DBackpropFilter_:function(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",a=arguments.length>6?arguments[6]:void 0,o=e;3===e.rank&&(o=_o(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=_o(t,[1,t.shape[0],t.shape[1],t.shape[2]])),F(4===o.rank,()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(o.shape,".")),F(4===l.rank,()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(l.shape,".")),F(4===n.length,()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,"."));const c="NHWC"===s?o.shape[3]:o.shape[1],u="NHWC"===s?l.shape[3]:l.shape[1];F(c===n[2],()=>"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")),F(u===n[3],()=>"Error in conv2dDerFilter: depth of dy (".concat(u,") must ")+"match output depth for filter (".concat(n[3],").")),vo("conv2dDerFilter",r,a);const h={x:o,dy:l},d={strides:i,pad:r,dataFormat:s,dimRoundingMode:a,filterShape:n};return Hr.runKernel($e,h,d)}});const hc=ts({relu6_:function(e){const t={x:Zr(e,"x","relu6")};return Hr.runKernel(Un,t)}});const dc=ts({step_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:Zr(e,"x","step")},i={alpha:t};return Hr.runKernel(Ii,n,i)}});function pc(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return ea(e,dc(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function fc(e,t){let n=t;const i=_a(e.shape,t.shape);return i.length>0&&(n=il(n,i)),_o(n,e.shape)}function gc(e,t,n,i){if("linear"===t)return e;if("relu"===t)return Pl(e);if("elu"===t)return Wo(e);if("relu6"===t)return hc(e);if("prelu"===t)return El(e,n);if("leakyrelu"===t)return Zo(e,i);if("sigmoid"===t)return Bl(e);throw new Error("Unknown fused activation ".concat(t,"."))}const mc=(e,t)=>!(e>0)||"linear"===t;const yc=ts({fusedConv2d_:function(e){let{x:t,filter:n,strides:i,pad:r,dataFormat:s="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:u,leakyreluAlpha:h}=e;if(c=c||"linear",!1===mc(Hr.state.gradientDepth,c)){F("NHWC"===s,()=>"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.");let e=Lo(t,n,i,r,s,a,o);return null!=l&&(e=$s(e,l)),gc(e,c,u,h)}const d=Zr(t,"x","conv2d","float32"),p=Zr(n,"filter","conv2d","float32");let f=d,g=!1;3===d.rank&&(g=!0,f=_o(d,[1,d.shape[0],d.shape[1],d.shape[2]])),F(4===f.rank,()=>"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(f.rank,".")),F(4===p.rank,()=>"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(p.rank,".")),vo("fused conv2d",r,o);const m="NHWC"===s?f.shape[3]:f.shape[1];F(p.shape[2]===m,()=>"Error in conv2d: depth of input (".concat(m,") must match ")+"input depth for filter ".concat(p.shape[2],".")),F(mo(i,a),()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'"));const y=oo(f.shape,p.shape,i,a,r,o);let b,v;if(null!=l&&(b=Zr(l,"bias","fused conv2d"),[b]=Fr(b,d),"NHWC"===s?xa(y.outShape,b.shape):(F(b.shape.length<=1,()=>"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(b.shape.length,".")),F(0===b.shape.length||b.shape[0]===y.outChannels||1===b.shape[0],()=>"Error in fused conv2d: bias shape (".concat(b.shape,") is not ")+"compatible with the number of output channels "+"(".concat(y.outChannels,")")))),null!=u){const e=u.shape;if(F(e.length<=1||3===e.length,()=>"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(e.length,".")),1===e.length)F(1===e[0]||e[0]===y.outChannels,()=>"Error in fused conv2d: PReLU activation weights "+"(".concat(e,") is not compatible with the number of output ")+"channels (".concat(y.outChannels,")."));else if(3===e.length)try{xa(e,y.outShape)}catch($F){const n="Error in fused conv2d: PReLU activation weights (".concat(e,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(y.outShape,").");throw Error(n)}v=Zr(u,"prelu weights","fused conv2d")}const _=(e,t)=>{F("NHWC"===s,()=>"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported."));const[n,o,l,u]=t,h=pc(e,l,c);F(go(a),()=>"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(a,"'"));const d=[Fo(o.shape,h,n,i,r),uc(o,h,n.shape,i,r)];if(null!=u){const e=fc(u,h);d.push(e)}return d},x={x:f,filter:p,bias:b,preluActivationWeights:v},w={strides:i,pad:r,dataFormat:s,dilations:a,dimRoundingMode:o,activation:c,leakyreluAlpha:h};if(null==l){const e=ra((e,t,n)=>{let i=Hr.runKernel(Ri,x,w);return n([t,e,i]),g&&(i=_o(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:_}});return e(f,p)}{const e=ra((e,t,n,i)=>{let r=Hr.runKernel(Ri,x,w);return i([t,e,r,n]),g&&(r=_o(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:_}});return e(f,p,b)}}});const bc=ts({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],a=arguments.length>6?arguments[6]:void 0,o=e;3===e.rank&&(o=_o(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=_o(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={x:o,dy:l},u={strides:i,pad:r,dimRoundingMode:a,dilations:s,filterShape:n};return Hr.runKernel(ut,c,u)}});const vc=ts({depthwiseConv2dNativeBackpropInput_:function(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],a=arguments.length>6?arguments[6]:void 0,o=t,l=!1;3===t.rank&&(l=!0,o=_o(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={dy:o,filter:n},u={strides:i,pad:r,dimRoundingMode:a,dilations:s,inputShape:e},h=Hr.runKernel(ht,c,u);return l?_o(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});const _c=ts({fusedMatMul_:function(e){let{a:t,b:n,transposeA:i=!1,transposeB:r=!1,bias:s,activation:a="linear",preluActivationWeights:o,leakyreluAlpha:l=.2}=e;if(!1===mc(Hr.state.gradientDepth,a)){let e=al(t,n,i,r);return null!=s&&(e=$s(e,s)),gc(e,a,o,l)}let c=Zr(t,"a","fused matMul"),u=Zr(n,"b","fused matMul");[c,u]=Fr(c,u);const h=i?c.shape[c.rank-2]:c.shape[c.rank-1],d=r?u.shape[u.rank-1]:u.shape[u.rank-2],p=i?c.shape[c.rank-1]:c.shape[c.rank-2],f=r?u.shape[u.rank-2]:u.shape[u.rank-1],g=c.shape.slice(0,-2),m=u.shape.slice(0,-2),y=B(g),b=B(m);F(h===d,()=>"Error in fused matMul: inner shapes (".concat(h,") and (")+"".concat(d,") of Tensors with shapes ").concat(c.shape," and ")+"".concat(u.shape," and transposeA=").concat(i)+" and transposeB=".concat(r," must match."));const v=xa(c.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,f]),_=_o(c,i?[y,h,p]:[y,p,h]),x=_o(u,r?[b,f,d]:[b,d,f]);let w,T;null!=s&&(w=Zr(s,"bias","fused matMul"),[w]=Fr(w,c),xa(v,w.shape)),null!=o&&(T=Zr(o,"prelu weights","fused matMul"));const k=(e,t)=>{const[n,o,l,c]=t,u=pc(_o(e,l.shape),l,a);let h,d;if(i||r?!i&&r?(h=al(u,o,!1,!1),d=al(u,n,!0,!1)):i&&!r?(h=al(o,u,!1,!0),d=al(n,u,!1,!1)):(h=al(o,u,!0,!0),d=al(u,n,!0,!0)):(h=al(u,o,!1,!0),d=al(n,u,!0,!1)),null!=s){return[h,d,fc(c,u)]}return[h,d]},S={a:_,b:x,bias:w,preluActivationWeights:T},C={transposeA:i,transposeB:r,activation:a,leakyreluAlpha:l};if(null==s){const e=ra((e,t,n)=>{const i=Hr.runKernel(Ai,S,C);return n([e,t,i]),{value:_o(i,v),gradFunc:k}});return e(_,x)}{const e=ra((e,t,n,i)=>{const r=Hr.runKernel(Ai,S,C);return i([e,t,r,n]),{value:_o(r,v),gradFunc:k}});return e(_,x,w)}}});const xc=ts({cropAndResize_:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const a=Zr(e,"image","cropAndResize"),o=Zr(t,"boxes","cropAndResize","float32"),l=Zr(n,"boxInd","cropAndResize","int32"),c=o.shape[0];F(4===a.rank,()=>"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(a.rank,".")),F(2===o.rank&&4===o.shape[1],()=>"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(o.shape,".")),F(1===l.rank&&l.shape[0]===c,()=>"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(o.shape,".")),F(2===i.length,()=>"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(i.length,".")),F(i[0]>=1&&i[1]>=1,()=>"cropSize must be atleast [1,1], but was ".concat(i)),F("bilinear"===r||"nearest"===r,()=>"method must be bilinear or nearest, but was ".concat(r));const u={image:a,boxes:o,boxInd:l},h={method:r,extrapolationValue:s,cropSize:i};return Hr.runKernel(at,u,h)}});const wc=ts({flipLeftRight_:function(e){const t=Zr(e,"image","flipLeftRight","float32");F(4===t.rank,()=>"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,"."));const n={image:t};return Hr.runKernel(Et,n,{})}});const Tc=ts({grayscaleToRGB_:function(e){const t=Zr(e,"image","grayscaleToRGB"),n=t.rank-1,i=t.shape[n];F(t.rank>=2,()=>"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")),F(1===i,()=>"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(i,"."));const r=new Array(t.rank);return r.fill(1,0,n),r[n]=3,Xo(t,r)}});const kc=ts({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=n.map((e,t)=>Zr(e,"tensors".concat(t),"einsum")),s={equation:e};return Hr.runKernel(bt,r,s)}});const Sc=ts({rgbToGrayscale_:function(e){const t=Zr(e,"image","RGBToGrayscale"),n=t.rank-1,i=t.shape[n];F(t.rank>=2,()=>"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")),F(3===i,()=>"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(i,"."));const r=t.dtype,s=js(t,"float32"),a=$l([.2989,.587,.114]);let o;switch(t.rank){case 2:o=kc("ij,j->i",s,a);break;case 3:o=kc("ijk,k->ij",s,a);break;case 4:o=kc("ijkl,l->ijk",s,a);break;case 5:o=kc("ijklm,m->ijkl",s,a);break;case 6:o=kc("ijklmn,n->ijklm",s,a);break;default:throw new Error("Not a valid tensor rank.")}return o=qo(o,-1),js(o,r)}});const Cc=ts({rotateWithOffset_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const r=Zr(e,"image","rotateWithOffset","float32");F(4===r.rank,()=>"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(r.rank,"."));const s={image:r},a={radians:t,fillValue:n,center:i};return Hr.runKernel(Ni,s,a)}});function Ic(e,t,n,i,r,s){null==i&&(i=.5),null==r&&(r=Number.NEGATIVE_INFINITY),null==s&&(s=0);const a=e.shape[0];return n=Math.min(n,a),F(0<=i&&i<=1,()=>"iouThreshold must be in [0, 1], but was '".concat(i,"'")),F(2===e.rank,()=>"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")),F(4===e.shape[1],()=>"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])),F(1===t.rank,()=>"scores must be a 1D tensor"),F(t.shape[0]===a,()=>"scores has incompatible shape with boxes. Expected ".concat(a,", ")+"but was ".concat(t.shape[0])),F(0<=s&&s<=1,()=>"softNmsSigma must be in [0, 1], but was '".concat(s,"'")),{maxOutputSize:n,iouThreshold:i,scoreThreshold:r,softNmsSigma:s}}const Ec=ts({nonMaxSuppression_:function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const s=Zr(e,"boxes","nonMaxSuppression","float32"),a=Zr(t,"scores","nonMaxSuppression","float32"),o=Ic(s,a,n,i,r);n=o.maxOutputSize,i=o.iouThreshold,r=o.scoreThreshold;const l={maxOutputSize:n,iouThreshold:i,scoreThreshold:r};return Hr.runKernel(mn,{boxes:s,scores:a},l)}});function Nc(e,t,n){const i=function(e,t,n){return function(e,t,n){let i=0,r=e.length,s=0,a=!1;for(;i<r;){s=i+(r-i>>>1);const o=n(t,e[s]);o>0?i=s+1:(r=s,a=!o)}return a?i:-i-1}(e,t,n||Ac)}(e,t,n),r=i<0?-(i+1):i;e.splice(r,0,t)}function Ac(e,t){return e>t?1:e<t?-1:0}function Rc(e,t,n,i,r){return Lc(e,t,n,i,r,0)}function Dc(e,t,n,i,r,s){return Lc(e,t,n,i,r,0,!1,s,!0)}function Oc(e,t,n,i,r,s){return Lc(e,t,n,i,r,s,!0)}function Lc(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const c=[];for(let m=0;m<t.length;m++)t[m]>r&&c.push({score:t[m],boxIndex:m,suppressBeginIndex:0});c.sort(Mc);const u=s>0?-.5/s:0,h=[],d=[];for(;h.length<n&&c.length>0;){const t=c.pop(),{score:n,boxIndex:s,suppressBeginIndex:a}=t;if(n<r)break;let o=!1;for(let l=h.length-1;l>=a;--l){const n=Pc(e,s,h[l]);if(n>=i){o=!0;break}if(t.score=t.score*Fc(i,u,n),t.score<=r)break}t.suppressBeginIndex=h.length,o||(t.score===n?(h.push(s),d.push(t.score)):t.score>r&&Nc(c,t,Mc))}const p=h.length,f=n-p;o&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const g={selectedIndices:h};return a&&(g.selectedScores=d),l&&(g.validOutputs=p),g}function Pc(e,t,n){const i=e.subarray(4*t,4*t+4),r=e.subarray(4*n,4*n+4),s=Math.min(i[0],i[2]),a=Math.min(i[1],i[3]),o=Math.max(i[0],i[2]),l=Math.max(i[1],i[3]),c=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),p=(o-s)*(l-a),f=(h-c)*(d-u);if(p<=0||f<=0)return 0;const g=Math.max(s,c),m=Math.max(a,u),y=Math.min(o,h),b=Math.min(l,d),v=Math.max(y-g,0)*Math.max(b-m,0);return v/(p+f-v)}function Fc(e,t,n){const i=Math.exp(t*n*n);return n<=e?i:0}function Mc(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const Uc=async function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const s=Zr(e,"boxes","nonMaxSuppressionAsync"),a=Zr(t,"scores","nonMaxSuppressionAsync"),o=Ic(s,a,n,i,r);n=o.maxOutputSize,i=o.iouThreshold,r=o.scoreThreshold;const l=await Promise.all([s.data(),a.data()]),c=l[0],u=l[1],{selectedIndices:h}=Rc(c,u,n,i,r);return s!==e&&s.dispose(),a!==t&&a.dispose(),$l(h,"int32")};const Bc=ts({nonMaxSuppressionWithScore_:function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const a=Zr(e,"boxes","nonMaxSuppression"),o=Zr(t,"scores","nonMaxSuppression"),l=Ic(a,o,n,i,r,s);n=l.maxOutputSize,i=l.iouThreshold,r=l.scoreThreshold,s=l.softNmsSigma;const c={boxes:a,scores:o},u={maxOutputSize:n,iouThreshold:i,scoreThreshold:r,softNmsSigma:s},h=Hr.runKernel(bn,c,u);return{selectedIndices:h[0],selectedScores:h[1]}}});const zc=async function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const a=Zr(e,"boxes","nonMaxSuppressionAsync"),o=Zr(t,"scores","nonMaxSuppressionAsync"),l=Ic(a,o,n,i,r,s);n=l.maxOutputSize,i=l.iouThreshold,r=l.scoreThreshold,s=l.softNmsSigma;const c=await Promise.all([a.data(),o.data()]),u=c[0],h=c[1],{selectedIndices:d,selectedScores:p}=Oc(u,h,n,i,r,s);return a!==e&&a.dispose(),o!==t&&o.dispose(),{selectedIndices:$l(d,"int32"),selectedScores:$l(p)}};const Vc=ts({nonMaxSuppressionPadded_:function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=Zr(e,"boxes","nonMaxSuppression"),o=Zr(t,"scores","nonMaxSuppression"),l=Ic(a,o,n,i,r,null),c={boxes:a,scores:o},u={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:s},h=Hr.runKernel(yn,c,u);return{selectedIndices:h[0],validOutputs:h[1]}}});const jc=async function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=Zr(e,"boxes","nonMaxSuppressionAsync"),o=Zr(t,"scores","nonMaxSuppressionAsync"),l=Ic(a,o,n,i,r,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,[d,p]=await Promise.all([a.data(),o.data()]),{selectedIndices:f,validOutputs:g}=Dc(d,p,c,u,h,s);return a!==e&&a.dispose(),o!==t&&o.dispose(),{selectedIndices:$l(f,"int32"),validOutputs:sa(g,"int32")}};const Wc=ts({resizeBilinear_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=Zr(e,"images","resizeBilinear");F(3===r.rank||4===r.rank,()=>"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(r.rank,".")),F(2===t.length,()=>"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")),F(!1===i||!1===n,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=r,a=!1;3===r.rank&&(a=!0,s=_o(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const[]=t,o={images:s},l={alignCorners:n,halfPixelCenters:i,size:t},c=Hr.runKernel(Fn,o,l);return a?_o(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const Hc=ts({resizeNearestNeighbor_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=Zr(e,"images","resizeNearestNeighbor");F(3===r.rank||4===r.rank,()=>"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(r.rank,".")),F(2===t.length,()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")),F("float32"===r.dtype||"int32"===r.dtype,()=>"`images` must have `int32` or `float32` as dtype"),F(!1===i||!1===n,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=r,a=!1;3===r.rank&&(a=!0,s=_o(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const[]=t,o={images:s},l={alignCorners:n,halfPixelCenters:i,size:t},c=Hr.runKernel(Ln,o,l);return a?_o(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const Gc=ts({bincount_:function(e,t,n){const i=Zr(e,"x","bincount"),r=Zr(t,"weights","bincount");F("int32"===i.dtype,()=>"Error in bincount: input "+"dtype must be int32, but got ".concat(i.dtype)),F(n>=0,()=>"size must be non-negative, but got ".concat(n,".")),F(r.size===i.size||0===r.size,()=>"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(i.shape,", weights shape: ")+"".concat(r.shape,"."));const s={x:i,weights:r},a={size:n};return Hr.runKernel(Ve,s,a)}});const qc=ts({lessEqual_:function(e,t){let n=Zr(e,"a","lessEqual","string_or_numeric"),i=Zr(t,"b","lessEqual","string_or_numeric");[n,i]=Fr(n,i),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(Ht,r)}});const Xc=ts({round_:function(e){const t={x:Zr(e,"x","round")};return Hr.runKernel(zn,t)}});const Kc=ts({threshold_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const r=Zr(e,"image","threshold"),s=r.shape[0]*r.shape[1];let a,o,l,c,u=ea($l([i]),255);if(F(3===r.rank,()=>"Error in threshold: image must be rank 3,"+"but got rank ".concat(r.rank,".")),F(3===r.shape[2]||1===r.shape[2],()=>"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(r.shape[2],".")),F("int32"===r.dtype||"float32"===r.dtype,()=>"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(r.dtype,".")),F("otsu"===t||"binary"===t,()=>"Method must be binary or otsu, but was ".concat(t)),3===r.shape[2]){[a,o,l]=Xl(r,[1,1,1],-1);const e=ea(a,.2989),t=ea(o,.587),n=ea(l,.114);c=$s($s(e,t),n)}else c=e;if("otsu"===t){u=function(e,t){let n,i,r,s,a,o,l=$l([-1]),c=$l([0]),u=$l([0]);for(let h=0;h<e.size-1;h++){n=zl(e,0,h+1),i=zl(e,h+1),a=Zs(il(n),t),o=Zs(il(i),t);const d=il(ea(n,Ll(0,n.size)));r=Zs(d,il(n));const p=pa(i.shape,n.size),f=$s(Ll(0,i.size),p),g=ea(i,f);s=Zs(il(g),il(i));const m=ma(r,s),y=ma(r,s),b=ea(a,o);u=ea(ea(b,m),y);const v=$o(u,c);c=tc(v,u,c),l=tc(v,$l([h]),l)}return l}(Gc(js(Xc(c),"int32"),rs([]),256),s)}const h=n?qc(c,u):$o(c,u);return js(ea(h,255),"int32")}});const Yc=ts({transform_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0;const a=Zr(e,"image","transform","float32"),o=Zr(t,"transforms","transform","float32");F(4===a.rank,()=>"Error in transform: image must be rank 4,"+"but got rank ".concat(a.rank,".")),F(2===o.rank&&(o.shape[0]===a.shape[0]||1===o.shape[0])&&8===o.shape[1],()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),F(null==s||2===s.length,()=>"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(s,"."));const l={image:a,transforms:o},c={interpolation:n,fillMode:i,fillValue:r,outputShape:s};return Hr.runKernel(xi,l,c)}});const Qc=ts({less_:function(e,t){let n=Zr(e,"a","less","string_or_numeric"),i=Zr(t,"b","less","string_or_numeric");[n,i]=Fr(n,i),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(Wt,r)}});const $c=ts({bandPart_:function(e,t,n){const i=Zr(e,"a","bandPart");F(i.rank>=2,()=>"bandPart(): Rank must be at least 2, got ".concat(i.rank,"."));const r=i.shape,[s,a]=i.shape.slice(-2);let o,l;"number"===typeof t?(F(t%1===0,()=>"bandPart(): numLower must be an integer, got ".concat(t,".")),F(t<=s,()=>"bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(s,").")),o=Zr(t<0?s:t,"numLower","bandPart")):(F("int32"===t.dtype,()=>"bandPart(): numLower's dtype must be an int32."),o=tc(Qc(t,0),s,hl(t,s))),"number"===typeof n?(F(n%1===0,()=>"bandPart(): numUpper must be an integer, got ".concat(n,".")),F(n<=a,()=>"bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(a,").")),l=Zr(n<0?a:n,"numUpper","bandPart")):(F("int32"===n.dtype,()=>"bandPart(): numUpper's dtype must be an int32."),l=tc(Qc(n,0),a,hl(n,a)));const c=_o(Ll(0,s,1,"int32"),[-1,1]),u=Ll(0,a,1,"int32"),h=ma(c,u),d=sl(qc(h,o),Jo(h,xl(l))),p=kl([s,a],i.dtype);return _o(Yl(ec(_o(i,[-1,s,a])).map(e=>tc(d,e,p))),r)}});function Jc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return ba(e);if(1!==e.rank&&null===n)return Jc(_o(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return il(ba(e),n);if(t===1/0)return nl(ba(e),n);if(t===-1/0)return ul(ba(e),n);if("euclidean"===t||2===t)return ta(il(ga(ba(e),sa(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return nl(il(ba(e),n[0]),n[1]-1);if(t===1/0)return nl(il(ba(e),n[1]),n[0]);if(t===-1/0)return ul(il(ba(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return ta(il(na(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}const Zc=ts({norm_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=Jc(e=Zr(e,"x","norm"),t,n);let s=r.shape;if(i){const t=q(n,e.shape);s=gl(r.shape,t)}return _o(r,s)}});const eu=ts({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,F(null!=e&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const n=e[0].shape[0];for(let t=1;t<e.length;++t)F(e[t].shape[0]===n,()=>"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")"))}else t=!0,e=Xl(e,e.shape[0],0).map(e=>Kl(e,[0]));F(e.length<=e[0].shape[0],()=>"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],")."));const n=[],i=e;for(let r=0;r<e.length;++r)n.push(Hr.tidy(()=>{let e=i[r];if(r>0)for(let t=0;t<r;++t){const i=ea(il(ea(n[t],e)),n[t]);e=ma(e,i)}return Zs(e,Zc(e,"euclidean"))}));return t?Yl(n,0):n}});function tu(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Hr.tidy(()=>{F(2===e.shape.length,()=>"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor."));const n=e.shape[0],i=e.shape[1];let r=Ko(n),s=Ws(e);const a=Jl([[1]],[1,1]);let o=Ws(a);const l=n>=i?i:n;for(let e=0;e<l;++e){const t=s,l=o,c=r;[o,s,r]=Hr.tidy(()=>{const t=zl(s,[e,e],[n-e,1]),l=Zc(t),c=zl(s,[e,e],[1,1]),u=tc($o(c,0),Jl([[-1]]),Jl([[1]])),h=ma(c,ea(u,l)),d=Zs(t,h);o=1===d.shape[0]?Ws(a):No([a,zl(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const p=xl(Zs(al(u,h),l)),f=zl(s,[e,0],[n-e,i]),g=ea(p,o),m=rc(o);if(0===e)s=ma(f,al(g,al(m,f)));else{const t=ma(f,al(g,al(m,f)));s=No([zl(s,[0,0],[e,i]),t],0)}const y=rc(g),b=zl(r,[0,e],[n,r.shape[1]-e]);if(0===e)r=ma(b,al(al(b,o),y));else{const t=ma(b,al(al(b,o),y));r=No([zl(r,[0,0],[n,e]),t],1)}return[o,s,r]}),Ks([t,l,c])}return!t&&n>i&&(r=zl(r,[0,0],[n,i]),s=zl(s,[0,0],[i,i])),[r,s]})}const nu=ts({qr_:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(F(e.rank>=2,()=>"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)),2===e.rank)return tu(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((e,t)=>e*t),i=ec(_o(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),r=[],s=[];i.forEach(e=>{const[n,i]=tu(e,t);r.push(n),s.push(i)});return[_o(Yl(r,0),e.shape),_o(Yl(s,0),e.shape)]}}});var iu;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(iu||(iu={}));const ru=ts({squaredDifference_:function(e,t){let n=Zr(e,"a","squaredDifference"),i=Zr(t,"b","squaredDifference");[n,i]=Fr(n,i),xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(ci,r,{})}});const su=ts({logSumExp_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Zr(e,"x","logSumExp"),r=q(t,i.shape),s=nl(i,r,!0),a=ma(i,s),o=Go(a),l=il(o,r),c=el(l),u=$s(_o(s,c.shape),c);if(n){const e=gl(u.shape,r);return _o(u,e)}return u}});const au={flipLeftRight:wc,grayscaleToRGB:Tc,resizeNearestNeighbor:Hc,resizeBilinear:Wc,rgbToGrayscale:Sc,rotateWithOffset:Cc,cropAndResize:xc,nonMaxSuppression:Ec,nonMaxSuppressionAsync:Uc,nonMaxSuppressionWithScore:Bc,nonMaxSuppressionWithScoreAsync:zc,nonMaxSuppressionPadded:Vc,nonMaxSuppressionPaddedAsync:jc,threshold:Kc,transform:Yc},ou={bandPart:$c,gramSchmidt:eu,qr:nu};const lu=class{static sgd(e){return new ka(e)}static momentum(e,t){return new Sa(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}static rmsprop(e){return new Ca(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}static adam(){return new ya(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}static adadelta(){return new da(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}static adamax(){return new Ta(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}static adagrad(e){return new fa(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}},cu="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:e=>e();function uu(){return new Promise(e=>cu(()=>e()))}function hu(e,t){const n=e[0].length;e.forEach((e,t)=>{F(e.length===n,()=>"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")"))}),F(t>=0&&t<n,()=>"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,"."));const i=e[0];e.forEach((e,r)=>{for(let s=0;s<n;s++)F(s===t||e[s]===i[s],()=>"Error in concat".concat(n,"D: Shape of tensors[").concat(r,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(i,") ")+"along the non-concatenated axis ".concat(r,"."))})}function du(e,t){const n=e[0].slice();for(let i=1;i<e.length;i++)n[t]+=e[i][t];return n}var pu;function fu(e,t,n){let i=new Array;if(null==n&&null==t)return i;if(null==t)for(;i.length<e+n.length;)i.push(-1);else i=t.slice();if(null==n)return i;if(e+n.length!==i.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(i.length));for(let r=1;r<n.length;++r){const s=n[r],a=i[i.length-n.length+r],o=i[a];if(s>=0)if(o>=0){if(o!==s)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(r+e,"] = ").concat(s," but shape[").concat(r+e,"] = ").concat(o))}else i[a]=s}return i}function gu(e){const t={FIRST_DIM_SIZE:pu.FIRST_DIM_SIZE,VALUE_ROWIDS:pu.VALUE_ROWIDS,ROW_LENGTHS:pu.ROW_LENGTHS,ROW_SPLITS:pu.ROW_SPLITS,ROW_LIMITS:pu.ROW_LIMITS,ROW_STARTS:pu.ROW_STARTS},n=[];for(const i of e){if(!(i in t))break;n.push(t[i])}return n}function mu(e){return 0===e.length?0:e[0]===pu.FIRST_DIM_SIZE?e.length-1:e.length}function yu(e,t){if(null==e||null==t)return;const n=e.length,i=t.length;if(n>=i)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(i,")"));for(let r=0;r<Math.min(n,i-1);++r){const n=e[r],i=t[r+1];if(n>=0&&i>=0&&1!==n&&n!==i)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(r-e.length,"] = ").concat(n," but ragged tensor input.flatValues.shape[").concat(r-e.length,"] = ").concat(i))}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(pu||(pu={}));const bu=30;function vu(e){return e<=bu?e:ne(e,Math.floor(Math.sqrt(e)))}function _u(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function xu(e,t,n){let i=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])i=i.concat(t.slice(0)),i.push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);const n=t.length;for(let r=0;r<n;++r)i=i.concat([e[r+1]/t[r],t[r]]);i=i.concat(e.slice(n+1))}return i}function wu(e,t){const n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(let i=t+1;i<e;++i)i<=2*t?(n.push(i),n.push(i-(t+1))):n.push(i)}else{const i=[],r=[];for(let n=1;n<e;++n)n>=2*t+1||n%2===1?r.push(n):i.push(n);n.push(...i),n.push(0),n.push(...r)}return n}function Tu(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=[];i?r.push(e[0]/n):r.push(e[0]*n);for(let s=1;s<e.length;++s)s<=t.length?i?r.push(t[s-1]*e[s]):r.push(e[s]/t[s-1]):r.push(e[s]);return r}function ku(e,t){const n=[0];for(let i=0;i<t;++i)n.push(e[i][0]);return n}function Su(e,t,n){const i=e.slice(0,1);for(let r=0;r<n;++r)i.push(e[r+1]-t[r][0]-t[r][1]);return i}function Cu(e,t){const n=e.shape.length,i=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(i<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(i,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[i-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[i-1]," vs. ").concat(n));if(0===B(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));const r=t.shape,s=r[r.length-1];let a=1;for(let h=0;h<r.length-1;++h)a*=r[h];const o=e.shape,l=r.slice();l.pop();let c=1;for(let h=s;h<n;++h)c*=o[h],l.push(o[h]);const u=[...ie(e.shape).map(e=>e/c),1].slice(0,s);return[l,a,c,u]}function Iu(e,t,n){const i=t.rank>1?t.shape[t.rank-1]:1,r=t.rank>1?t.rank-1:1,s="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(i,", and batchDim: ").concat(r,".");if(n.rank<r)throw new Error(s+" update.rank < ".concat(r,". "));if(e.length<i+(n.rank-r))throw new Error(s+" Output shape length < ".concat(i+(n.rank-r)));if(n.rank!==r+e.length-i)throw new Error(s+" update.rank != ".concat(r+e.length-i));for(let a=0;a<r;++a)if(n.shape[a]!==t.shape[a])throw new Error(s+" updates.shape[".concat(a,"] (").concat(n.shape[a],") != indices.shape[").concat(a,"] (").concat(t.shape[a],")."));for(let a=0;a<n.rank-r;++a)if(n.shape[a+r]!==e[a+i])throw new Error(s+" updates.shape[".concat(a+r,"] (").concat(n.shape[a+r],") != shape[").concat(a+r,"] (").concat(e[a+r],")"))}function Eu(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Iu(n,t,e)}function Nu(e,t,n){const i=t.shape.length,r=i>1?t.shape[i-1]:1,s=n.length;let a=1;for(let l=r;l<s;++l)a*=n[l];const o=r<1?1:r;return{sliceRank:r,numUpdates:B(t.shape)/o,sliceSize:a,strides:[...ie(n.slice(0,r)),1],outputSize:B(n)}}const Au=1.7580993408473768,Ru=1.0507009873554805,Du=.3275911,Ou=.254829592,Lu=-.284496736,Pu=1.421413741,Fu=-1.453152027,Mu=1.061405429;function Uu(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));const n=new Float32Array(2*e.length);for(let i=0;i<n.length;i+=2)n[i]=e[i/2],n[i+1]=t[i/2];return n}function Bu(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let i=0;i<e.length;i+=2)t[i/2]=e[i],n[i/2]=e[i+1];return{real:t,imag:n}}function zu(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),i=new Float32Array(t);for(let r=0;r<e.length;r+=4)n[Math.floor(r/4)]=e[r],i[Math.floor(r/4)]=e[r+1];return{real:n,imag:i}}function Vu(e){const t=Math.floor(e.length/4),n=new Float32Array(t),i=new Float32Array(t);for(let r=2;r<e.length;r+=4)n[Math.floor(r/4)]=e[r],i[Math.floor(r/4)]=e[r+1];return{real:n,imag:i}}function ju(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Wu(e,t,n,i){e[2*i]=t,e[2*i+1]=n}function Hu(e,t){const n=new Float32Array(e/2),i=new Float32Array(e/2);for(let r=0;r<Math.ceil(e/2);r++){const s=(t?2:-2)*Math.PI*(r/e);n[r]=Math.cos(s),i[r]=Math.sin(s)}return{real:n,imag:i}}function Gu(e,t,n){const i=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(i),imag:Math.sin(i)}}const qu="->",Xu=/->/g,Ku=",",Yu="...";function Qu(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(Xu,"").length)/qu.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(qu,'").'));const[i,r]=e.split(qu);F(-1===i.indexOf(Yu),()=>'The ellipsis notation ("'.concat(Yu,'") is not supported yet.'));const s=i.split(Ku),a=s.length;if(t!==a)throw new Error("Expected ".concat(a," input tensors, received ").concat(t));if(a>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let h=0;h<r.length;++h){const e=r[h];if(!s.some(t=>-1!==t.indexOf(e)))throw new Error("Output subscripts contain the label ".concat(e," ")+"not present in the input subscripts.");-1===o.indexOf(e)&&o.push(e)}for(let h=0;h<i.length;++h){const e=i[h];-1===o.indexOf(e)&&e!==Ku&&o.push(e)}const l=new Array(s.length);for(let h=0;h<a;++h){if(new Set(s[h].split("")).size!==s[h].length)throw new Error("Found duplicate axes in input component ".concat(s[h],". ")+"Support for duplicate axes in input is not implemented yet.");l[h]=[];for(let e=0;e<s[h].length;++e)l[h].push(o.indexOf(s[h][e]))}const c=o.length,u=[];for(let h=r.length;h<c;++h)u.push(h);return{allDims:o,summedDims:u,idDims:l}}function $u(e,t){let n=new Array(e);n.fill(-1);for(let r=0;r<t.length;++r)n[t[r]]=r;const i=[];for(let r=0;r<e;++r)-1===n[r]&&i.push(r);return n=n.filter(e=>-1!==e),{permutationIndices:n,expandDims:i}}function Ju(e,t,n){const i=new Array(e);for(let r=0;r<n.length;++r){const e=n[r].shape;for(let n=0;n<t[r].length;++n)void 0===i[t[r][n]]?i[t[r][n]]=e[n]:F(i[t[r][n]]===e[n],()=>"Expected dimension ".concat(i[t[r][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(e),", ")+"but got dimension ".concat(e[n]))}}function Zu(e,t){const n=e,i=[];let r=0;0===e.length&&n.push(-1),r=e.length+1;for(let a=0;a<r;++a)i.push([]);const s=[];for(let a=0;a<n.length;++a){const e=th(t,n[a]);for(const t of e)-1===s.indexOf(t)&&(i[a].push(t),s.push(t))}return{path:n,steps:i}}function eh(e){return e.every((e,t)=>e===t)}function th(e,t){const n=[];for(let i=0;i<e.length;++i)0!==e[i].length&&-1===e[i].indexOf(t)&&-1!==t||n.push(i);return n}function nh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if("number"===typeof t)F(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),i=new Array(t).fill(e.shape[n]/t);else{const r=t.reduce((e,t)=>(-1===t&&(e+=1),e),0);F(r<=1,()=>"There should be only one negative value in split array.");const s=t.indexOf(-1);if(-1!==s){const i=t.reduce((e,t)=>t>0?e+t:e);t[s]=e.shape[n]-i}F(e.shape[n]===t.reduce((e,t)=>e+t),()=>"The sum of sizes must match the size of the axis dimension."),i=t}return i}function ih(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function rh(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function sh(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function ah(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function oh(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function lh(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function ch(e,t){const n=B(e),i=B(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(i,". inputShape=").concat(e," outputShape= ").concat(t)}function uh(e,t){const n=B(e),i=B(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(i,". inputShape=").concat(e," outputShape=").concat(t)}function hh(){return"segment ids must be >= 0"}function dh(){return"segment ids are not increasing"}function ph(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function fh(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function gh(e,t){let n,i=!1;for(e<=bu?(n=e,i=!0):n=ne(e,Math.floor(Math.sqrt(e)));!i;)n>t||n===e?i=!0:n=ne(e,n+1);return n}function mh(e,t,n){const i=[],r=e.length;for(let s=0;s<r;s++)s!==t?i.push(e[s]):i.push(n);return i}function yh(e,t,n,i){const r=t.shape.length,s=e.shape.length;if(0!==i&&(i<-r||i>r))throw new Error("Expect batchDims in the range of [-".concat(r,", ").concat(r,"], but got ").concat(i));if(i<0&&(i+=r),i>s)throw new Error("batchDims (".concat(i,") must be less than rank(x) (\n    ").concat(s,")."));if(n<i)throw new Error("batchDims (".concat(i,") must be less than or equal to axis (").concat(n,")."));for(let h=0;h<i;++h)if(e.shape[h]!==t.shape[h])throw new Error("x.shape[".concat(h,"]: ").concat(e.shape[h]," should be equal to indices.shape[").concat(h,"]: ").concat(t.shape[h],"."));const a=e.shape[n],o=[];let l=1,c=1,u=1;for(let h=0;h<i;++h)o.push(e.shape[h]),l*=e.shape[h];for(let h=i;h<n;h++)o.push(e.shape[h]),c*=e.shape[h];for(let h=i;h<r;h++)o.push(t.shape[h]);for(let h=n+1;h<s;h++)o.push(e.shape[h]),u*=e.shape[h];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:a,outputShape:o}}function bh(e){try{return e.map(e=>lr(e))}catch(sX){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(sX))}}function vh(e){return e.map(e=>or(e))}function _h(e,t){const n=[];for(let s=0;s<t.length;s++)t[s]&&n.push(s);const i=Vs(e,"int32"),r=Vs([n.length,e.length],"int32");for(let s=0;s<n.length;s++){const t=i.indexToLoc(n[s]),a=s*e.length;r.values.set(t,a)}return r.toTensor()}!function(){for(const e of Ia)ua(e)}();const xh={kernelName:xe,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(e,dc(js(n,"float32"),-1))}}},wh={kernelName:we,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=na(js(n,"float32")),i=ta(ma(sa(1),t));return xl(Zs(e,i))}}}},Th={kernelName:Te,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=ta(ma(na(js(n,"float32")),1));return Zs(e,t)}}}},kh={kernelName:ke,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=xa(n.shape,i.shape);return{a:()=>{let t=e;const i=_a(n.shape,r);return i.length>0&&(t=il(t,i)),_o(t,n.shape)},b:()=>{let t=e;const n=_a(i.shape,r);return n.length>0&&(t=il(t,n)),_o(t,i.shape)}}}},Sh={kernelName:Se,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((t,i)=>{n[i]=()=>e.clone()}),n}},Ch={kernelName:Ee,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ia(n)}}},Ih={kernelName:Ne,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ia(n)}}},Eh={kernelName:Ae,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Zs(e,ta(ma(sa(1),na(js(n,"float32")))))}}},Nh={kernelName:Re,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=ta($s(sa(1),na(js(n,"float32"))));return Zs(e,t)}}}},Ah={kernelName:Le,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=xa(n.shape,i.shape);return{a:()=>{const t=$s(na(n),na(i));let s=ea(e,Zs(i,t));const a=_a(n.shape,r);return a.length>0&&(s=il(s,a)),_o(s,n.shape)},b:()=>{const t=$s(na(n),na(i));let s=xl(ea(e,Zs(n,t)));const a=_a(i.shape,r);return a.length>0&&(s=il(s,a)),_o(s,i.shape)}}}},Rh={kernelName:De,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Zs(e,$s(na(js(n,"float32")),1))}}},Dh={kernelName:Oe,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Zs(e,ma(sa(1),na(js(n,"float32"))))}}};const Oh=ts({avgPool3dGrad_:function(e,t,n,i,r,s){const a=Zr(e,"dy","avgPool3dGrad"),o=Zr(t,"input","avgPool3dGrad");let l=a,c=o,u=!1;4===o.rank&&(u=!0,l=_o(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),c=_o(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),F(5===l.rank,()=>"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")),F(5===c.rank,()=>"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")),vo("avgPool3dGrad",r,s);const h={dy:l,input:c},d={filterSize:n,strides:i,pad:r,dimRoundingMode:s},p=Hr.runKernel(Ue,h,d);return u?_o(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),Lh={kernelName:Me,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{filterSize:r,strides:s,pad:a,dimRoundingMode:o}=n;return{x:()=>Oh(e,i,r,s,a,o)}}};const Ph=ts({avgPoolGrad_:function(e,t,n,i,r){const s=Zr(e,"dy","avgPoolGrad"),a=Zr(t,"input","avgPoolGrad");F(a.rank===s.rank,()=>"Rank of input (".concat(a.rank,") does not match rank of dy (").concat(s.rank,")"));let o=a,l=s,c=!1;3===a.rank&&(c=!0,o=_o(a,[1,a.shape[0],a.shape[1],a.shape[2]]),l=_o(s,[1,s.shape[0],s.shape[1],s.shape[2]])),F(4===l.rank,()=>"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(l.rank,".")),F(4===o.rank,()=>"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(o.rank,"."));const u={dy:l,input:o},h={filterSize:n,strides:i,pad:r},d=Hr.runKernel(Fe,u,h);return c?_o(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Fh={kernelName:Pe,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{filterSize:r,strides:s,pad:a}=n;return{x:()=>Ph(e,i,r,s,a)}}},Mh={kernelName:Be,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[i,r]=t,{transposeA:s,transposeB:a}=n;return s||a?!s&&a?{a:()=>al(e,r,!1,!1),b:()=>al(e,i,!0,!1)}:s&&!a?{a:()=>al(r,e,!1,!0),b:()=>al(i,e,!1,!1)}:{a:()=>al(r,e,!0,!0),b:()=>al(e,i,!0,!0)}:{a:()=>al(e,r,!1,!0),b:()=>al(i,e,!0,!1)}}};const Uh=ts({spaceToBatchND_:function(e,t,n){const i=Zr(e,"x","spaceToBatchND");F(i.rank>=1+t.length,()=>"input rank ".concat(i.rank," should be > than [blockShape] ").concat(t.length)),F(n.length===t.length,()=>"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)),F(i.shape.reduce((e,i,r)=>r>0&&r<=t.length?e&&(i+n[r-1][0]+n[r-1][1])%t[r-1]===0:e,!0),()=>"input spatial dimensions ".concat(i.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString()));const r={x:i},s={blockShape:t,paddings:n};return Hr.runKernel(ti,r,s)}}),Bh={kernelName:ze,gradFunc:(e,t,n)=>{const{blockShape:i,crops:r}=n;return{x:()=>Uh(e,i,r)}}},zh={kernelName:"BroadcastTo",gradFunc:(e,t,n)=>{const i=n,r=i.inputShape,s=i.shape,a=Array.from(s);for(let l=r.length-1;l>=0;l--)if(r[l]===s[l])a[l]=1;else if(1!==r[l])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(s,"]."));const o=[];for(let l=0;l<a.length;l++)a[l]>1&&o.push(l);return{x:()=>il(e,o,!0)}}},Vh={kernelName:He,gradFunc:e=>({x:()=>e.clone()})},jh={kernelName:Ge,gradFunc:e=>({x:()=>ia(e)})},Wh={kernelName:qe,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{clipValueMin:r,clipValueMax:s}=n;return{x:()=>tc(sl(Jo(i,r),qc(i,s)),e,ia(e))}}},Hh={kernelName:Ke,inputsToSave:["x"],gradFunc:xh.gradFunc},Gh={kernelName:Ye,saveAllInputs:!0,gradFunc:(e,t,n)=>{const i=t.map(e=>e.shape),{axis:r}=n,s=q(r,t[0].shape)[0],a=i.map(e=>e[s]);return Xl(e,a,s).map(e=>()=>e)}},qh={kernelName:Qe,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,{dilations:s,strides:a,pad:o,dataFormat:l}=n;return F(go(s),()=>"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(s,"'")),{x:()=>Fo(i.shape,e,r,a,o,l),filter:()=>uc(i,e,r.shape,a,o,l)}}},Xh={kernelName:Je,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,{strides:s,pad:a,dataFormat:o,dimRoundingMode:l}=n;return{dy:()=>Lo(e,r,s,a,o,1,l),filter:()=>uc(e,i,r.shape,s,a,o,l)}}};const Kh=ts({conv3DBackpropFilter_:function(e,t,n,i,r){let s=e;4===e.rank&&(s=_o(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let a=t;4===a.rank&&(a=_o(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),F(5===s.rank,()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(s.shape,".")),F(5===a.rank,()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(a.shape,".")),F(5===n.length,()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")),F(s.shape[4]===n[3],()=>"Error in conv3dDerFilter: depth of input ".concat(s.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")),F(a.shape[4]===n[4],()=>"Error in conv3dDerFilter: depth of dy (".concat(a.shape[4],") must ")+"match output depth for filter (".concat(n[4],")."));const o={x:s,dy:a},l={strides:i,pad:r,filterShape:n};return Hr.runKernel(et,o,l)}}),Yh={kernelName:Ze,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:i,strides:r,pad:s}=n;F(go(i),()=>"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(i,"'"));const[a,o]=t;return{x:()=>Bo(a.shape,e,o,r,s),filter:()=>Kh(a,e,o.shape,r,s)}}};const Qh=ts({sin_:function(e){const t={x:Zr(e,"x","sin","float32")};return Hr.runKernel(Kn,t)}}),$h={kernelName:nt,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(xl(Qh(js(n,"float32"))),e)}}};const Jh=ts({sinh_:function(e){const t={x:Zr(e,"x","sinh")};return Hr.runKernel(Yn,t)}}),Zh={kernelName:it,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(Jh(js(n,"float32")),e)}}};const ed=ts({cumsum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r={x:Zr(e,"x","cumsum")},s={axis:t,exclusive:n,reverse:i};return Hr.runKernel(st,r,s)}}),td={kernelName:st,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{axis:r,exclusive:s,reverse:a}=n;return{x:()=>{const t=yl([r],i.rank);let n=ed(e,r,s,!a);return null!=t&&(n=rc(n,t)),n}}}},nd={kernelName:ct,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:i,strides:r,pad:s,dimRoundingMode:a}=n,o=null==i?[1,1]:i;F(go(o),()=>"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(o,"'"));const[l,c]=t;return F(4===l.rank,()=>"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(l.rank,".")),F(4===c.rank,()=>"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(c.rank,".")),F(l.shape[3]===c.shape[2],()=>"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(l.shape[3],") must match the inChannels dimension ")+"in filter ".concat(c.shape[2],".")),F(mo(r,o),()=>"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(r," and dilations ")+"'".concat(o,"'.")),vo("depthwiseConv2d",s,a),{x:()=>vc(l.shape,e,c,r,s,o,a),filter:()=>bc(l,e,c.shape,r,s,o,a)}}},id={kernelName:pt,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,s={x:i,filter:r,dy:e},a={x:i,filter:r,dy:e};return{x:()=>Hr.runKernel(ft,s,n),filter:()=>Hr.runKernel(gt,a,n)}}},rd={kernelName:vt,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,i={dy:e,y:n};return{x:()=>Hr.runKernel(_t,i)}}},sd={kernelName:xt,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,i=ea(Go(xl(na(n))),2/Math.sqrt(Math.PI));return{x:()=>ea(e,i)}}},ad={kernelName:Tt,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(e,n)}}},od={kernelName:kt,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>_o(e,n.shape)}}},ld={kernelName:St,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(e,Go(n))}}},cd={kernelName:Nt,gradFunc:e=>({x:()=>ia(e)})},ud={kernelName:At,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=xa(n.shape,i.shape);return{a:()=>{const t=Zs(e,js(i,"float32")),s=_a(n.shape,r);return s.length>0?_o(il(t,s),n.shape):t},b:()=>{let t=ea(e,js(n,"float32"));const s=_a(i.shape,r);s.length>0&&(t=_o(il(t,s),i.shape));const a=na(i);return xl(Zs(t,js(a,"float32")))}}}};const hd=ts({rsqrt_:function(e){const t={x:Zr(e,"x","rsqrt","float32")};return Hr.runKernel(Vn,t)}}),dd={kernelName:Rt,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:i}=n,[r,s,a,o]=t,l=null==o?sa(1):o,c=_a(s.shape,r.shape),u=[];if(1===s.rank){for(let e=0;e<r.shape.length-1;++e)u.push(r.shape[e]);u.push(1)}const h=ma(r,s),d=ea(e,l),p=hd($s(a,sa(i))),f=ea(ea(ea(p,p),p),sa(-.5));return{x:()=>1===s.rank?_o(ea(ea(e,Xo(_o(p,[1,1,1,s.shape[0]]),u)),l),r.shape):_o(ea(ea(e,p),l),r.shape),mean:()=>{let e=ea(ea(p,sa(-1)),d);return 1===s.rank&&(e=il(e,c)),_o(e,s.shape)},variance:()=>{let e=ea(ea(f,h),d);return 1===s.rank&&(e=il(e,c)),_o(e,s.shape)},scale:()=>{const t=ea(h,p);let n=ea(e,t);return 1===s.rank&&(n=il(n,c)),_o(n,s.shape)},offset:()=>{let t=e;return 1===s.rank&&(t=il(t,c)),_o(t,s.shape)}}}};const pd=ts({unsortedSegmentSum_:function(e,t,n){const i=Zr(e,"x","unsortedSegmentSum"),r=Zr(t,"segmentIds","unsortedSegmentSum","int32");F(V(n),()=>"numSegments must be of dtype int");const s={x:i,segmentIds:r},a={numSegments:n};return Hr.runKernel(Si,s,a)}}),fd={kernelName:Dt,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[i,r]=t,{axis:s}=n,a=q(s,i.shape)[0];return{x:()=>{const t=i.shape,n=r.size,o=t.slice(0,a),l=o.length,c=t.slice(s,t.length).slice(1),u=c.length,h=gd(0,l),d=gd(l+1,l+1+u),p=md([o,[n],c]),f=_o(e,p),g=_o(r,[n]),m=md([[l],h,d]),y=rc(f,m);let b=pd(y,g,i.shape[a]);const v=bl(m);return b=rc(b,v),b},indices:()=>r}}};function gd(e,t){const n=[];for(let i=e;i<t;++i)n.push(i);return n}function md(e){const t=[];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)t.push(e[n][i]);return t}const yd={kernelName:Pt,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>ia(n),b:()=>ia(i)}}},bd={kernelName:Ft,gradFunc:e=>({x:()=>js(e,"float32")})},vd={kernelName:Bt,gradFunc:e=>({x:()=>ia(e)})},_d={kernelName:zt,gradFunc:e=>({x:()=>ia(e)})},xd={kernelName:Vt,gradFunc:e=>({x:()=>ia(e)})},wd={kernelName:jt,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{alpha:r}=n,s=$o(i,0);return{x:()=>tc(s,e,ea(e,r))}}},Td={kernelName:Xt,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Zs(e,$s(n,1))}}},kd={kernelName:qt,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Zs(e,js(n,"float32"))}}},Sd={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i]=t,{axis:r}=n;return{logits:()=>{const t=Go(i);return ma(e,ea(il(e,r,!0),t))}}}};const Cd=ts({localResponseNormalizationBackprop_:function(e,t,n){const i={x:e,y:t,dy:n},r={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return Hr.runKernel(Jt,i,r)}}),Id={kernelName:$t,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{depthRadius:s,bias:a,alpha:o,beta:l}=n;return{x:()=>Cd(i,r,e,s,a,o,l)}}};function Ed(e,t,n,i){return t.rank<n.rank&&(t=_o(t,gl(t.shape,i))),e.rank<n.rank&&(e=_o(e,gl(e.shape,i))),{x:()=>ea(e,js(Ho(n,t),e.dtype))}}const Nd={kernelName:Zt,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const i=n,{reductionIndices:r}=i,s=t[0],a=Ed(e,t[1],s,q(r,s.shape));return{x:()=>a.x()}}},Ad={kernelName:en,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>ea(e,js(Jo(n,i),"float32")),b:()=>ea(e,js(Qc(n,i),"float32"))}}};const Rd=ts({maxPool3dGrad_:function(e,t,n,i,r,s,a){const o=Zr(e,"dy","maxPool3dGrad"),l=Zr(t,"input","maxPool3dGrad"),c=Zr(n,"output","maxPool3dGrad");let u=o,h=l,d=c,p=!1;4===l.rank&&(p=!0,u=_o(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),h=_o(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=_o(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),F(5===u.rank,()=>"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")),F(5===h.rank,()=>"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(h.rank,".")),F(5===d.rank,()=>"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,".")),vo("maxPool3dGrad",s,a);const f={dy:u,input:h,output:d},g={filterSize:i,strides:r,pad:s,dimRoundingMode:a},m=Hr.runKernel(sn,f,g);return p?_o(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),Dd={kernelName:rn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=n;return{x:()=>Rd(e,i,r,s,a,o,l)}}};const Od=ts({maxPoolGrad_:function(e,t,n,i,r,s,a){const o=Zr(e,"dy","maxPoolGrad"),l=Zr(t,"input","maxPoolGrad"),c=Zr(n,"output","maxPoolGrad");F(l.rank===o.rank,()=>"Rank of input (".concat(l.rank,") does not match rank of dy ")+"(".concat(o.rank,")")),F(4===o.rank,()=>"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(o.rank,".")),F(4===l.rank,()=>"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(l.rank,".")),vo("maxPoolGrad",s,a);const u={dy:o,input:l,output:c},h={filterSize:i,strides:r,pad:s,dimRoundingMode:a};return Hr.runKernel(nn,u,h)}}),Ld={kernelName:tn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{filterSize:s,strides:a,pad:o}=n;return{x:()=>Od(e,i,r,s,a,o)}}},Pd={kernelName:on,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{axis:r}=n,s=q(r,i.shape),a=B(fl(i.shape,s)[1]);return{x:()=>{const t=i.shape.slice();s.forEach(e=>{t[e]=1});const n=_o(e,t);return Zs(ea(n,Sl(i.shape,"float32")),a)}}}},Fd={kernelName:ln,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const i=n,{axis:r}=i,[s,a]=t,o=Ed(e,a,s,q(r,s.shape));return{x:()=>o.x()}}},Md={kernelName:cn,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>ea(e,js(qc(n,i),"float32")),b:()=>ea(e,js($o(n,i),"float32"))}}},Ud={kernelName:un,inputsToSave:["x"],gradFunc:(e,t,n)=>{const i=t[0],{paddings:r}=n,s=r.map(e=>e[0]);return{x:()=>zl(e,s,i.shape)}}},Bd={kernelName:hn,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=xa(n.shape,i.shape);return{a:()=>{const t=_a(n.shape,r);return t.length>0?_o(il(e,t),n.shape):e},b:()=>{const t=ea(e,xl(Yo(Zs(n,i)))),s=_a(i.shape,r);return s.length>0?_o(il(t,s),i.shape):t}}}},zd={kernelName:pn,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=xa(n.shape,i.shape);return{a:()=>{const t=ea(e,js(i,"float32")),s=_a(n.shape,r);return s.length>0?_o(il(t,s),n.shape):t},b:()=>{const t=ea(e,js(n,"float32")),s=_a(i.shape,r);return s.length>0?_o(il(t,s),i.shape):t}}}},Vd={kernelName:fn,gradFunc:e=>({x:()=>xl(e)})},jd={kernelName:_n,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>kl(n.shape,"float32")}}},Wd={kernelName:vn,gradFunc:e=>({x:()=>ia(e)})},Hd={kernelName:xn,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:i}=n;return ec(e,i).map(e=>()=>e)}},Gd={kernelName:wn,inputsToSave:["x"],gradFunc:(e,t,n)=>{const i=t[0],{paddings:r}=n,s=r.map(e=>e[0]);return{x:()=>zl(e,s,i.shape)}}},qd={kernelName:Tn,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,i,r]=t,s=n,a=i,o=xa(s.shape,a.shape);return{a:()=>{const t=js(a,"float32");let n=ea(e,ea(t,ga(s,ma(t,sa(1)))));const i=_a(s.shape,o);return i.length>0&&(n=il(n,i)),_o(n,s.shape)},b:()=>{const t=$o(s,0),n=tc(t,el(s),ia(s));let i=ea(e,ea(r,n));const l=_a(a.shape,o);return l.length>0&&(i=il(i,l)),_o(i,a.shape)}}}},Xd={kernelName:kn,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,i]=t,r=$o(n,0);return{x:()=>tc(r,e,ea(e,i)),alpha:()=>{let t=tc(r,ia(e),ea(e,n));const s=_a(i.shape,e.shape);return s.length>0&&(t=il(t,s)),_o(t,i.shape)}}}};const Kd=ts({cumprod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r={x:Zr(e,"x","cumprod")},s={axis:t,exclusive:n,reverse:i};return Hr.runKernel(rt,r,s)}});function Yd(e,t,n){const i=e.shape.length,r=i-n.length,s=yl(n,i);let a=e;null!=s&&(a=rc(e,s));const o=a.shape.slice(),l=o.splice(i-n.length,n.length).reduce((e,t)=>e*t,1);o.push(l);let c=function(e,t,n){const i=e.shape.slice();i[n]=1;const r=_o(t,i),s=Kd(e,n,!0,!1),a=Kd(e,n,!0,!0),o=ea(s,a);return ea(r,o)}(a.reshape(o),t,r);if(c=c.reshape(a.shape),null!=s){const e=bl(s);c=rc(c,e)}return c}const Qd={kernelName:Sn,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{axis:r}=n;let s=[];return s=void 0===r||null===r?i.shape.map((e,t)=>t):"number"===typeof r?[r]:r,{x:()=>Yd(i,e,s)}}},$d={kernelName:yt,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=xa(n.shape,i.shape);return{a:()=>{const t=Zs(e,js(i,"float32")),s=_a(n.shape,r);return s.length>0?_o(il(t,s),n.shape):t},b:()=>{let t=ea(e,js(n,"float32"));const s=_a(i.shape,r);s.length>0&&(t=_o(il(t,s),i.shape));const a=na(i);return xl(Zs(t,js(a,"float32")))}}}},Jd={kernelName:Rn,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Zs(e,xl(na(n)))}}},Zd={kernelName:Un,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,i=ea(qc(n,6),dc(n));return{x:()=>ea(e,js(i,"float32"))}}},ep={kernelName:Dn,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(e,js(dc(n),"float32"))}}},tp={kernelName:On,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>_o(e,n.shape)}}},np={kernelName:Fn,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[i]=t,r={dy:e,images:i};return{images:()=>Hr.runKernel(Mn,r,n)}}},ip={kernelName:Ln,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[i]=t,r={dy:e,images:i};return{images:()=>Hr.runKernel(Pn,r,n)}}},rp={kernelName:Bn,gradFunc:(e,t,n)=>{const{dims:i}=n,r=q(i,e.shape);return{x:()=>Fl(e,r)}}},sp={kernelName:zn,gradFunc:e=>({x:()=>ia(e)})},ap={kernelName:Vn,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>xl(Zs(e,ea(ga(n,1.5),2)))}}};const op=ts({logicalNot_:function(e){const t={x:Zr(e,"x","logicalNot","bool")};return Hr.runKernel(Yt,t)}}),lp={kernelName:Gn,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>js(ia(n),"float32"),t:()=>ea(e,js(n,e.dtype)),e:()=>ea(e,js(op(n),e.dtype))}}},cp={kernelName:qn,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=$o(n,sa(0)),i=sa(Au),r=sa(Ru),s=ea(e,r),a=ea(ea(e,i),Go(js(n,"float32")));return tc(t,s,a)}}}},up={kernelName:$n,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(e,ea(n,ma(sa(1),n)))}}},hp={kernelName:Qn,gradFunc:e=>({x:()=>ia(e)})};const dp=ts({cos_:function(e){const t={x:Zr(e,"x","cos","float32")};return Hr.runKernel(nt,t)}}),pp={kernelName:Kn,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(dp(js(n,"float32")),e)}}};const fp=ts({cosh_:function(e){const t={x:Zr(e,"x","cosh","float32")};return Hr.runKernel(it,t)}}),gp={kernelName:Yn,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(fp(js(n,"float32")),e)}}},mp={kernelName:Xn,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{begin:r,size:s}=n,a=i.shape,[o,l]=Ja(i,r,s),c=[];for(let u=0;u<e.rank;u++)c.push([o[u],a[u]-o[u]-l[u]]);return{x:()=>Il(e,c)}}},yp={kernelName:ii,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i]=t,{dim:r}=n,s=ea(e,i);return{logits:()=>ma(s,ea(il(s,[r],true),i))}}},bp={kernelName:Jn,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(e,Bl(n))}}};const vp=ts({batchToSpaceND_:function(e,t,n){const i=Zr(e,"x","batchToSpaceND"),r=t.reduce((e,t)=>e*t);F(i.rank>=1+t.length,()=>"input rank is ".concat(i.rank," but should be > than blockShape.length ").concat(t.length)),F(n.length===t.length,()=>"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)),F(i.shape[0]%r===0,()=>"input tensor batch is ".concat(i.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(r));const s={x:i},a={blockShape:t,crops:n};return Hr.runKernel(ze,s,a)}}),_p={kernelName:ti,gradFunc:(e,t,n)=>{const{blockShape:i,paddings:r}=n;return{x:()=>vp(e,i,r)}}},xp={kernelName:ni,gradFunc:(e,t,n)=>{const{axis:i}=n;return{x:()=>No(e,i)}}},wp={kernelName:Zn,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Zs(e,ea(ta(js(n,"float32")),2))}}},Tp={kernelName:ui,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(e,ea(js(n,"float32"),2))}}},kp={kernelName:ci,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=sa(2);return{a:()=>ea(e,ea(r,ma(n,i))),b:()=>ea(e,ea(r,ma(i,n)))}}},Sp={kernelName:mi,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=xa(n.shape,i.shape);return{a:()=>{let t=e;const i=_a(n.shape,r);return i.length>0&&(t=il(t,i)),_o(t,n.shape)},b:()=>{let t=e;const n=_a(i.shape,r);return n.length>0&&(t=il(t,n)),_o(xl(t),i.shape)}}}},Cp={kernelName:ei,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,r=i.shape.slice(),{axis:s}=n;q(s,i.shape).forEach(e=>{r[e]=1});const a=_o(e,r),o=ea(a,Sl(i.shape,"float32"));return{x:()=>o}}},Ip={kernelName:yi,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Zs(e,na(dp(n)))}}},Ep={kernelName:bi,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ea(ma(sa(1),na(n)),e)}}},Np={kernelName:vi,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{reps:r}=n;return{x:()=>{let t=ia(i);if(1===i.rank)for(let n=0;n<r[0];++n)t=$s(t,zl(e,[n*i.shape[0]],[i.shape[0]]));else if(2===i.rank)for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)t=$s(t,zl(e,[n*i.shape[0],s*i.shape[1]],[i.shape[0],i.shape[1]]));else if(3===i.rank)for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)for(let a=0;a<r[2];++a)t=$s(t,zl(e,[n*i.shape[0],s*i.shape[1],a*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else{if(4!==i.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(i.rank," tensors yet."));for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)for(let a=0;a<r[2];++a)for(let o=0;o<r[3];++o)t=$s(t,zl(e,[n*i.shape[0],s*i.shape[1],a*i.shape[2],o*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]))}return t}}}},Ap={kernelName:Si,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=wa(t,ia(t)),i=Qo(e,n);let r=Jo(t,sa(0,"int32"));const s=i.rank-r.rank;for(let o=0;o<s;++o)r=qo(r,o+1);r=sl(r,Sl(i.shape,"bool"));const a=ia(i);return tc(r,i,a)}(e,n)}}};const Rp=[xh,wh,Th,kh,Sh,Ch,Ih,Eh,Nh,Ah,Rh,Dh,Lh,Fh,Mh,Bh,zh,Vh,jh,Wh,Hh,Gh,Xh,qh,Yh,$h,Zh,td,nd,id,$d,rd,sd,ad,od,ld,ud,cd,dd,fd,yd,bd,vd,_d,xd,wd,Td,kd,Sd,Id,Nd,Nd,Ad,Dd,Ld,Pd,Fd,Md,Ud,Bd,zd,Vd,jd,Wd,Hd,Gd,Gd,qd,Xd,Qd,Jd,Zd,ep,tp,np,ip,rp,sp,ap,lp,cp,up,hp,pp,gp,mp,yp,bp,_p,_p,xp,xp,wp,kp,Tp,{kernelName:Ii,gradFunc:e=>({x:()=>ia(e)})},Sp,Cp,Ip,Ep,Np,{kernelName:wi,gradFunc:(e,t,n)=>{const i=n,{perm:r}=i,s=bl(r);return{x:()=>rc(e,s)}}},{kernelName:ki,gradFunc:(e,t,n)=>{const i=n,{axis:r}=i;return{value:()=>Yl(e,r)}}},Ap,{kernelName:Ci,gradFunc:e=>({x:()=>ia(e)})}];for(const n of Rp)Vi(n);kr().prototype.abs=function(){return this.throwIfDisposed(),ba(this)};const Dp=ts({acos_:function(e){const t={x:Zr(e,"x","acos")};return Hr.runKernel(we,t)}});kr().prototype.acos=function(){return this.throwIfDisposed(),Dp(this)};const Op=ts({acosh_:function(e){const t={x:Zr(e,"x","acosh")};return Hr.runKernel(Te,t)}});kr().prototype.acosh=function(){return this.throwIfDisposed(),Op(this)},kr().prototype.add=function(e){return this.throwIfDisposed(),$s(this,e)},kr().prototype.all=function(e,t){return this.throwIfDisposed(),to(this,e,t)},kr().prototype.any=function(e,t){return this.throwIfDisposed(),no(this,e,t)},kr().prototype.argMax=function(e){return this.throwIfDisposed(),io(this,e)};const Lp=ts({argMin_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:Zr(e,"x","argMin")},i={axis:t};return Hr.runKernel(Ne,n,i)}});kr().prototype.argMin=function(e){return this.throwIfDisposed(),Lp(this,e)},kr().prototype.asScalar=function(){return this.throwIfDisposed(),F(1===this.size,()=>"The array must have only 1 element."),_o(this,[])},kr().prototype.asType=function(e){return this.throwIfDisposed(),js(this,e)},kr().prototype.as1D=function(){return this.throwIfDisposed(),_o(this,[this.size])},kr().prototype.as2D=function(e,t){return this.throwIfDisposed(),_o(this,[e,t])},kr().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),_o(this,[e,t,n])},kr().prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),_o(this,[e,t,n,i])},kr().prototype.as5D=function(e,t,n,i,r){return this.throwIfDisposed(),_o(this,[e,t,n,i,r])};const Pp=ts({asin_:function(e){const t={x:Zr(e,"x","asin")};return Hr.runKernel(Ae,t)}});kr().prototype.asin=function(){return this.throwIfDisposed(),Pp(this)};const Fp=ts({asinh_:function(e){const t={x:Zr(e,"x","asinh")};return Hr.runKernel(Re,t)}});kr().prototype.asinh=function(){return this.throwIfDisposed(),Fp(this)};const Mp=ts({atan_:function(e){const t={x:Zr(e,"x","atan")};return Hr.runKernel(De,t)}});kr().prototype.atan=function(){return this.throwIfDisposed(),Mp(this)};const Up=ts({atan2_:function(e,t){let n=Zr(e,"a","atan2"),i=Zr(t,"b","atan2");[n,i]=Fr(n,i);const r={a:n,b:i};return Hr.runKernel(Le,r)}});kr().prototype.atan2=function(e){return this.throwIfDisposed(),Up(this,e)};const Bp=ts({atanh_:function(e){const t={x:Zr(e,"x","atanh")};return Hr.runKernel(Oe,t)}});kr().prototype.atanh=function(){return this.throwIfDisposed(),Bp(this)},kr().prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),xo(this,e,t,n,i)},kr().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),vp(this,e,t)},kr().prototype.batchNorm=function(e,t,n,i,r){return this.throwIfDisposed(),To(this,e,t,n,i,r)},kr().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Io(this,e)},kr().prototype.cast=function(e){return this.throwIfDisposed(),js(this,e)};const zp=ts({ceil_:function(e){const t={x:Zr(e,"x","ceil","float32")};return Hr.runKernel(Ge,t)}});kr().prototype.ceil=function(){return this.throwIfDisposed(),zp(this)},kr().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Eo(this,e,t)},kr().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Tr&&(e=[e]),No([this,...e],t)},kr().prototype.conv1d=function(e,t,n,i,r,s){return this.throwIfDisposed(),Po(this,e,t,n,i,r,s)},kr().prototype.conv2dTranspose=function(e,t,n,i,r){return this.throwIfDisposed(),Mo(this,e,t,n,i,r)},kr().prototype.conv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),Lo(this,e,t,n,i,r,s)},kr().prototype.cos=function(){return this.throwIfDisposed(),dp(this)},kr().prototype.cosh=function(){return this.throwIfDisposed(),fp(this)},kr().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Kd(this,e,t,n)},kr().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),ed(this,e,t,n)};const Vp=ts({depthToSpace_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC";const i=Zr(e,"x","depthToSpace","float32"),r="NHWC"===n?i.shape[1]:i.shape[2],s="NHWC"===n?i.shape[2]:i.shape[3],a="NHWC"===n?i.shape[3]:i.shape[1];F(t>1,()=>"blockSize should be > 1 for depthToSpace, but was: ".concat(t)),F(r*t>=0,()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(r," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(i.shape)),F(s*t>=0,()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(s," and ").concat(t," for depthToSpace with input shape\n        ").concat(i.shape)),F(a%(t*t)===0,()=>"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(a," for depthToSpace with input shape ").concat(i.shape));const o={x:i},l={blockSize:t,dataFormat:n};return Hr.runKernel(lt,o,l)}});kr().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Vp(this,e,t)},kr().prototype.depthwiseConv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),jo(this,e,t,n,i,r,s)};const jp=ts({dilation2d_:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC";const a=Zr(e,"x","dilation2d"),o=Zr(t,"filter","dilation2d");F(3===a.rank||4===a.rank,()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(a.rank,".")),F(3===o.rank,()=>"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(o.rank,".")),F("NHWC"===s,()=>"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(s));let l=a,c=!1;3===a.rank&&(l=_o(a,[1,a.shape[0],a.shape[1],a.shape[2]]),c=!0),F(l.shape[3]===o.shape[2],()=>"Error in dilation2d:  input and filter must have the same depth: ".concat(l.shape[3]," vs ").concat(o.shape[2]));const u={x:l,filter:o},h={strides:n,pad:i,dilations:r},d=Hr.runKernel(pt,u,h);return c?_o(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});kr().prototype.dilation2d=function(e,t,n,i,r){return this.throwIfDisposed(),jp(this,e,t,n,i,r)};const Wp=ts({divNoNan_:function(e,t){let n=Zr(e,"a","div"),i=Zr(t,"b","div");[n,i]=Fr(n,i);const r=Zs(n,i),s=ia(r),a=Ho(i,s);return tc(a,s,r)}});kr().prototype.divNoNan=function(e){return this.throwIfDisposed(),Wp(this,e)},kr().prototype.div=function(e){return this.throwIfDisposed(),Zs(this,e)};const Hp=ts({dot_:function(e,t){const n=Zr(e,"t1","dot"),i=Zr(t,"t2","dot");F((1===n.rank||2===n.rank)&&(1===i.rank||2===i.rank),()=>"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(i.rank,"."));const r=1===n.rank?n.size:n.shape[1],s=1===i.rank?i.size:i.shape[0];if(F(r===s,()=>"Error in dot: inner dimensions of inputs must match, but got "+"".concat(r," and ").concat(s,".")),1===n.rank&&1===i.rank){const e=_o(n,[1,-1]),t=_o(i,[-1,1]),r=al(e,t);return _o(r,[])}if(1===n.rank&&2===i.rank){const e=_o(n,[1,-1]),t=_o(i,[i.shape[0],i.shape[1]]),r=al(e,t);return _o(r,[r.size])}if(2===n.rank&&1===i.rank){const e=_o(i,[-1,1]),t=al(n,e);return _o(t,[t.size])}{const e=_o(i,[i.shape[0],i.shape[1]]);return al(n,e)}}});kr().prototype.dot=function(e){return this.throwIfDisposed(),Hp(this,e)},kr().prototype.elu=function(){return this.throwIfDisposed(),Wo(this)},kr().prototype.equal=function(e){return this.throwIfDisposed(),Ho(this,e)};const Gp=ts({erf_:function(e){let t=Zr(e,"x","erf");F("int32"===t.dtype||"float32"===t.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=js(t,"float32"));const n={x:t};return Hr.runKernel(xt,n)}});kr().prototype.erf=function(){return this.throwIfDisposed(),Gp(this)};const qp=ts({euclideanNorm_:function(e){return Zc(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});kr().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),qp(this,e,t)},kr().prototype.exp=function(){return this.throwIfDisposed(),Go(this)},kr().prototype.expandDims=function(e){return this.throwIfDisposed(),qo(this,e)};const Xp=ts({expm1_:function(e){const t={x:Zr(e,"x","expm1")};return Hr.runKernel(St,t)}});kr().prototype.expm1=function(){return this.throwIfDisposed(),Xp(this)},kr().prototype.fft=function(){return this.throwIfDisposed(),ac(this)},kr().prototype.flatten=function(){return this.throwIfDisposed(),_o(this,[this.size])},kr().prototype.floor=function(){return this.throwIfDisposed(),Yo(this)},kr().prototype.floorDiv=function(e){return this.throwIfDisposed(),Js(this,e)},kr().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Qo(this,e,t,n)},kr().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Jo(this,e)},kr().prototype.greater=function(e){return this.throwIfDisposed(),$o(this,e)},kr().prototype.ifft=function(){return this.throwIfDisposed(),lc(this)},kr().prototype.irfft=function(){return this.throwIfDisposed(),cc(this)};const Kp=ts({isFinite_:function(e){const t={x:Zr(e,"x","isFinite")};return Hr.runKernel(Bt,t)}});kr().prototype.isFinite=function(){return this.throwIfDisposed(),Kp(this)};const Yp=ts({isInf_:function(e){const t={x:Zr(e,"x","isInf")};return Hr.runKernel(zt,t)}});kr().prototype.isInf=function(){return this.throwIfDisposed(),Yp(this)};const Qp=ts({isNaN_:function(e){const t={x:Zr(e,"x","isNaN")};return Hr.runKernel(Vt,t)}});kr().prototype.isNaN=function(){return this.throwIfDisposed(),Qp(this)},kr().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Zo(this,e)},kr().prototype.lessEqual=function(e){return this.throwIfDisposed(),qc(this,e)},kr().prototype.less=function(e){return this.throwIfDisposed(),Qc(this,e)};const $p=ts({localResponseNormalization_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const s=Zr(e,"x","localResponseNormalization");F(4===s.rank||3===s.rank,()=>"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(s.rank,".")),F(V(t),()=>"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,"."));let a=s,o=!1;3===s.rank&&(o=!0,a=_o(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const l={x:a},c={depthRadius:t,bias:n,alpha:i,beta:r},u=Hr.runKernel($t,l,c);return o?_o(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});kr().prototype.localResponseNormalization=function(e,t,n,i){return this.throwIfDisposed(),$p(this,e,t,n,i)};const Jp=ts({logSigmoid_:function(e){const t=Zr(e,"x","logSigmoid"),n=ra(e=>({value:xl(ql(xl(e))),gradFunc:t=>ea(t,Bl(xl(e)))}));return n(t)}});kr().prototype.logSigmoid=function(){return this.throwIfDisposed(),Jp(this)},kr().prototype.logSoftmax=function(e){return this.throwIfDisposed(),rl(this,e)},kr().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),su(this,e,t)},kr().prototype.log=function(){return this.throwIfDisposed(),el(this)},kr().prototype.log1p=function(){return this.throwIfDisposed(),tl(this)},kr().prototype.logicalAnd=function(e){return this.throwIfDisposed(),sl(this,e)},kr().prototype.logicalNot=function(){return this.throwIfDisposed(),op(this)};const Zp=ts({logicalOr_:function(e,t){const n=Zr(e,"a","logicalOr","bool"),i=Zr(t,"b","logicalOr","bool");xa(n.shape,i.shape);const r={a:n,b:i};return Hr.runKernel(Qt,r)}});kr().prototype.logicalOr=function(e){return this.throwIfDisposed(),Zp(this,e)};const ef=ts({logicalXor_:function(e,t){const n=Zr(e,"a","logicalXor","bool"),i=Zr(t,"b","logicalXor","bool");return xa(n.shape,i.shape),sl(Zp(e,t),op(sl(e,t)))}});kr().prototype.logicalXor=function(e){return this.throwIfDisposed(),ef(this,e)},kr().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),al(this,e,t,n)},kr().prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),ol(this,e,t,n,i)},kr().prototype.max=function(e,t){return this.throwIfDisposed(),nl(this,e,t)},kr().prototype.maximum=function(e){return this.throwIfDisposed(),wa(this,e)},kr().prototype.mean=function(e,t){return this.throwIfDisposed(),cl(this,e,t)},kr().prototype.min=function(e,t){return this.throwIfDisposed(),ul(this,e,t)},kr().prototype.minimum=function(e){return this.throwIfDisposed(),hl(this,e)};const tf=ts({mirrorPad_:function(e,t,n){F("reflect"===n||"symmetric"===n,()=>"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,"."));const i=Zr(e,"x","mirrorPad");if(0===i.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");F(t.length===i.rank,()=>"Padding doesn't match input. Must be ".concat(i.rank,". ")+"Got ".concat(t.length,"."));const r="reflect"===n?1:0;for(let o=0;o<i.rank;o++)F(2===t[o].length,()=>"Invalid number of paddings. Must be length of 2 each."),F(t[o][0]>=0&&t[o][0]<=i.shape[o]-r&&t[o][1]>=0&&t[o][1]<=i.shape[o]-r,()=>"Padding in dimension ".concat(o," cannot be greater than or equal ")+"to ".concat(i.shape[o]-r," or less than 0 for input of ")+"shape ".concat(i.shape));const s={paddings:t,mode:n},a={x:i};return Hr.runKernel(un,a,s)}});kr().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),tf(this,e,t)};const nf=ts({mod_:function(e,t){let n=Zr(e,"a","mod"),i=Zr(t,"b","mod");[n,i]=Fr(n,i);const r={a:n,b:i};return Hr.runKernel(hn,r)}});kr().prototype.mod=function(e){return this.throwIfDisposed(),nf(this,e)},kr().prototype.mul=function(e){return this.throwIfDisposed(),ea(this,e)},kr().prototype.neg=function(){return this.throwIfDisposed(),xl(this)},kr().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Zc(this,e,t,n)},kr().prototype.notEqual=function(e){return this.throwIfDisposed(),wl(this,e)},kr().prototype.oneHot=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Tl(this,e,t,n)},kr().prototype.onesLike=function(){return this.throwIfDisposed(),Cl(this)},kr().prototype.pad=function(e,t){return this.throwIfDisposed(),Il(this,e,t)};const rf=ts({pool_:function(e,t,n,i,r,s,a){null==r&&(r=[1,1]),null==s&&(s=1),0===i&&(i="valid");const o=Zr(e,"x","maxPool");let l=o,c=!1;3===o.rank&&(c=!0,l=_o(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(mo(s,r),()=>"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(r,"'"));const u=so(l.shape,t,s,r,i),h=[u.dilationHeight,u.dilationWidth];let d;d="same"===i?function(e,t){const n=e.map((e,n)=>e+(e-1)*(t[n]-1)),i=n.map(e=>e-1),r=i.map(e=>Math.floor(e/2)),s=i.map((e,t)=>e-r[t]);return i.map((e,t)=>[r[t],s[t]])}([u.filterHeight,u.filterWidth],h):[[0,0],[0,0]];const p=1===h[0]&&1===h[1],[f,g]=function(e,t,n){const i=n.map(e=>e[0]),r=n.map(e=>e[1]),s=e.concat(i,r),a=t.map((e,t)=>(e-s[t]%e)%e),o=r.map((e,t)=>e+a[t]),l=t.map((e,t)=>[i[t],o[t]]),c=t.map((e,t)=>[0,a[t]]);return[l,c]}([u.inHeight,u.inWidth],h,d),m=p?i:"valid",y=p?l:Uh(l,h,f),b=("avg"===n?()=>xo(y,t,s,m,a):()=>ol(y,t,s,m,a))(),v=p?b:vp(b,h,g);return c?_o(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});kr().prototype.pool=function(e,t,n,i,r,s){return this.throwIfDisposed(),rf(this,e,t,n,i,r,s)},kr().prototype.pow=function(e){return this.throwIfDisposed(),ga(this,e)},kr().prototype.prelu=function(e){return this.throwIfDisposed(),El(this,e)};const sf=ts({prod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Zr(e,"x","prod");"bool"===i.dtype&&(i=js(i,"int32"));const r={x:i},s={axis:t,keepDims:n};return Hr.runKernel(Sn,r,s)}});kr().prototype.prod=function(e,t){return this.throwIfDisposed(),sf(this,e,t)};const af=ts({reciprocal_:function(e){const t={x:Zr(e,"x","reciprocal")};return Hr.runKernel(Rn,t)}});kr().prototype.reciprocal=function(){return this.throwIfDisposed(),af(this)},kr().prototype.relu=function(){return this.throwIfDisposed(),Pl(this)},kr().prototype.relu6=function(){return this.throwIfDisposed(),hc(this)},kr().prototype.reshapeAs=function(e){return this.throwIfDisposed(),_o(this,e.shape)},kr().prototype.reshape=function(e){return this.throwIfDisposed(),_o(this,e)},kr().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Wc(this,e,t,n)},kr().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Hc(this,e,t,n)},kr().prototype.reverse=function(e){return this.throwIfDisposed(),Fl(this,e)},kr().prototype.rfft=function(){return this.throwIfDisposed(),oc(this)},kr().prototype.round=function(){return this.throwIfDisposed(),Xc(this)},kr().prototype.rsqrt=function(){return this.throwIfDisposed(),hd(this)},kr().prototype.selu=function(){return this.throwIfDisposed(),Ml(this)},kr().prototype.separableConv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),Ul(this,e,t,n,i,r,s)},kr().prototype.sigmoid=function(){return this.throwIfDisposed(),Bl(this)};const of=ts({sign_:function(e){const t={x:Zr(e,"x","sign")};return Hr.runKernel(Qn,t)}});kr().prototype.sign=function(){return this.throwIfDisposed(),of(this)},kr().prototype.sin=function(){return this.throwIfDisposed(),Qh(this)},kr().prototype.sinh=function(){return this.throwIfDisposed(),Jh(this)},kr().prototype.slice=function(e,t){return this.throwIfDisposed(),zl(this,e,t)},kr().prototype.softmax=function(e){return this.throwIfDisposed(),Gl(this,e)},kr().prototype.softplus=function(){return this.throwIfDisposed(),ql(this)},kr().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Uh(this,e,t)},kr().prototype.split=function(e,t){return this.throwIfDisposed(),Xl(this,e,t)},kr().prototype.sqrt=function(){return this.throwIfDisposed(),ta(this)},kr().prototype.square=function(){return this.throwIfDisposed(),na(this)},kr().prototype.squaredDifference=function(e){return this.throwIfDisposed(),ru(this,e)},kr().prototype.squeeze=function(e){return this.throwIfDisposed(),Kl(this,e)},kr().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof Tr?[this,e]:[this,...e];return Yl(n,t)},kr().prototype.step=function(e){return this.throwIfDisposed(),dc(this,e)};const lf=ts({stridedSlice_:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;const c={x:Zr(e,"x","stridedSlice","string_or_numeric")},u={begin:t,end:n,strides:i,beginMask:r,endMask:s,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};return Hr.runKernel(di,c,u)}});kr().prototype.stridedSlice=function(e,t,n,i,r,s,a,o){return this.throwIfDisposed(),lf(this,e,t,n,i,r,s,a,o)},kr().prototype.sub=function(e){return this.throwIfDisposed(),ma(this,e)},kr().prototype.sum=function(e,t){return this.throwIfDisposed(),il(this,e,t)};const cf=ts({tan_:function(e){const t={x:Zr(e,"x","tan","float32")};return Hr.runKernel(yi,t)}});kr().prototype.tan=function(){return this.throwIfDisposed(),cf(this)},kr().prototype.tanh=function(){return this.throwIfDisposed(),Ql(this)},kr().prototype.tile=function(e){return this.throwIfDisposed(),Xo(this,e)},kr().prototype.toBool=function(){return this.throwIfDisposed(),js(this,"bool")},kr().prototype.toFloat=function(){return this.throwIfDisposed(),js(this,"float32")},kr().prototype.toInt=function(){return this.throwIfDisposed(),js(this,"int32")};const uf=ts({topk_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=Zr(e,"x","topk");if(0===i.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const r=i.shape[i.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>r)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(r,") ")+"but got ".concat(t));const s={x:i},a={k:t,sorted:n},[o,l]=Hr.runKernel(_i,s,a);return{values:o,indices:l}}});kr().prototype.topk=function(e,t){return this.throwIfDisposed(),uf(this,e,t)},kr().prototype.transpose=function(e){return this.throwIfDisposed(),rc(this,e)};const hf=ts({unique_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Zr(e,"x","unique","string_or_numeric");F(n.rank>0,()=>"The input tensor must be at least 1D");const i={x:n},r={axis:t},[s,a]=Hr.runKernel(Ti,i,r);return{values:s,indices:a}}});kr().prototype.unique=function(e){return this.throwIfDisposed(),hf(this,e)},kr().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),pd(this,e,t)},kr().prototype.unstack=function(e){return this.throwIfDisposed(),ec(this,e)},kr().prototype.where=function(e,t){return this.throwIfDisposed(),tc(e,this,t)},kr().prototype.zerosLike=function(){return this.throwIfDisposed(),ia(this)};class df extends Error{constructor(e){super(e),Object.setPrototypeOf(this,df.prototype)}}class pf extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pf.prototype)}}class ff extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ff.prototype)}}class gf extends Error{constructor(e){super(e),Object.setPrototypeOf(this,gf.prototype)}}class mf extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mf.prototype)}}Error;class yf{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}function bf(e,t){if(Array.isArray(e)){let n=[];for(let i=0;i<t;i++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function vf(e,t){if(!e)throw new mf(t)}function _f(e,t){let n=0;for(const i of e)i===t&&n++;return n}function xf(e){return 1===e.length?e[0]:e}function wf(e){return Array.isArray(e)?e:[e]}function Tf(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function kf(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Sf={};function Cf(e){if(null===e||void 0===e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function If(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach(e=>If(e));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"===typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!==typeof t.value?If(t):e[n]=t.value)}}}function Ef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){const r=e;let s;if(r in n)s=n[r];else if(r in Sf)s=Sf[r];else if(s=t[r],null==s)throw new ff("Unknown ".concat(i,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(i," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(i," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return s}{const s=e;if(null==s.className||null==s.config)throw new ff("".concat(i,": Improper config format: ")+"".concat(JSON.stringify(s),".\n")+"'className' and 'config' must set.");const a=s.className;let o,l;if(a in n?[o,l]=n[a]:a in Sf?[o,l]=Sf.className:a in t&&([o,l]=t[a]),null==o)throw new ff("Unknown ".concat(i,": ").concat(a,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(i," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(i," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=l){const e={};for(const n of Object.keys(Sf))e[n]=Sf[n];for(const r of Object.keys(n))e[r]=n[r];s.config.customObjects=e;const t=Object.assign({},Sf);for(const r of Object.keys(n))Sf[r]=n[r];If(s.config);const i=l(o,s.config,n,r);return Sf=Object.assign({},t),i}{const e=Object.assign({},Sf);for(const i of Object.keys(n))Sf[i]=n[i];const t=new o(s.config);return Sf=Object.assign({},e),t}}}function Nf(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Af(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function Rf(e){if(null==e)throw new ff("Invalid value in obj: ".concat(JSON.stringify(e)));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function Df(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new ff("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Of(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return vf(n>=0),vf(i>=n),Array.isArray(e)&&e.length>=n&&e.length<=i&&e.every(e=>typeof e===t)}function Lf(e,t){Array.isArray(e)?(F(e.length>0,()=>"".concat(t," is unexpectedly an empty array.")),e.forEach((e,n)=>Lf(e,"element ".concat(n+1," of ").concat(t)))):F(Number.isInteger(e)&&e>0,()=>"Expected ".concat(t," to be a positive integer, but got ")+"".concat(Pf(e),"."))}function Pf(e){return null===e?"null":Array.isArray(e)?"["+e.map(e=>Pf(e)).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function Ff(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}let Mf=0;function Uf(){return Mf++}const Bf={};function zf(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in Bf||(Bf[e]=0),Bf[e]+=1,e+Bf[e].toString()}const Vf=["channelsFirst","channelsLast"],jf=["nearest","bilinear"],Wf=["valid","same","causal"],Hf=["max","avg"],Gf=["sum","mul","concat","ave"],qf=new Map;function Xf(e){Df(Vf,"DataFormat",e)}function Kf(e){Df(Wf,"PaddingMode",e)}function Yf(e){Df(Hf,"PoolMode",e)}const Qf=[];function $f(e,t){Qf.push(e);try{const e=t();return Qf.pop(),e}catch($F){throw Qf.pop(),$F}}function Jf(e){if(!tg(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Qf.length?"":Qf.join("/")+"/")+e}function Zf(e){if(!tg(e))throw new Error("Not a valid tensor name: '"+e+"'");qf.has(e)||qf.set(e,0);const t=qf.get(e);if(qf.set(e,qf.get(e)+1),t>0){const n="".concat(e,"_").concat(t);return qf.set(n,1),n}return e}const eg=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function tg(e){return!!e.match(eg)}function ng(e){return e===parseInt(e.toString(),10)}function ig(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let i=1;for(let r=t;r<n;++r)i*=e[r];return i}function rg(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const i=e[n];i<t&&(t=i)}return t}function sg(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const i=e[n];i>t&&(t=i)}return t}function ag(e,t){if(t<e)throw new ff("end (".concat(t,") < begin (").concat(e,") is forbidden."));const n=[];for(let i=e;i<t;++i)n.push(i);return n}let og;function lg(){return null==og&&(og=Hr.backend.epsilon()),og}function cg(e,t){return js(e,t)}function ug(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),_o(e,n)}function hg(e,t,n){return Xs(()=>{switch(e.rank){case 1:return Vl(e,t,n);case 2:return jl(e,[t,0],[n,e.shape[1]]);case 3:return Wl(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Hl(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return zl(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return zl(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new ff("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function dg(e,t,n){return Xs(()=>{switch(e.rank){case 1:return Vl(e,t,n);case 2:return jl(e,[0,t],[e.shape[0],n]);case 3:return Wl(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Hl(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new ff("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function pg(e,t,n,i){return Xs(()=>{switch(e.rank){case 1:return Vl(e,t,n);case 2:switch(i){case 1:return hg(e,t,n);case 2:return dg(e,t,n);default:throw new ff("The axis is not within the rank of the tensor "+"".concat(i))}case 3:switch(i){case 1:return hg(e,t,n);case 2:return Wl(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return dg(e,t,n);default:throw new ff("The axis is not within the rank of the tensor "+"".concat(i))}case 4:switch(i){case 1:return hg(e,t,n);case 2:return Hl(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Hl(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return dg(e,t,n);default:throw new ff("The axis is not within the rank of the tensor "+"".concat(i))}default:throw new ff("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function fg(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(t=e[0].rank,n=0!==t?t:0),n===e[0].rank&&(n=-1),No(e,n)}function gg(e,t){switch(e.rank){case 1:return Ao([e,t]);case 2:return Ro([e,t],0);case 3:return Do([e,t],0);case 4:return Oo([e,t],0);default:throw new ff("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function mg(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new ff("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return Xo(e,t)}function yg(e){return Dl(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function bg(e,t,n,i){if(e.rank<2||t.rank<2)throw new gf("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new gf("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape))}if(2===e.rank&&2===t.rank){return _c({a:e,b:t,transposeA:!1,transposeB:!1,bias:i?xg(e.rank,i,"channelsLast"):null,activation:n})}{const r=e.shape.slice(),s=r.pop();e=_o(e,[-1,s]);const a=t.shape.slice(),o=a.pop(),l=a.pop(),c=[...a,o],u=Array.from({length:t.rank},(e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n);t=_o(rc(t,u),[l,-1]);const h=[...r,...c];return _o(_c({a:e,b:t,transposeA:!1,transposeB:!1,bias:i?xg(e.rank,i,"channelsLast"):null,activation:n}),h)}}function vg(e,t,n){return Xs(()=>(t=Array.isArray(t)?$l(t,"int32"):js(t,"int32"),Qo(e,t,n)))}function _g(e){return ea(e,e)}function xg(e,t,n){const i=t.shape;if(1!==t.rank&&t.rank!==e)throw new ff("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===i.length?_o(t,[1,i[0],1,1,1]):_o(t,[1,i[3],i[0],i[1],i[2]]);if("channelsLast"===n)return 1===i.length?_o(t,[1,1,1,1,i[0]]):_o(t,[1].concat(i))}else if(4===e){if("channelsFirst"===n)return 1===i.length?_o(t,[1,i[0],1,1]):_o(t,[1,i[2],i[0],i[1]]);if("channelsLast"===n)return 1===i.length?_o(t,[1,1,1,i[0]]):_o(t,[1].concat(i))}else if(3===e){if("channelsFirst"===n)return 1===i.length?_o(t,[1,i[0],1]):_o(t,[1,i[1],i[0]]);if("channelsLast"===n)return 1===i.length?_o(t,[1,1,i[0]]):_o(t,[1].concat(i))}else if(e<3)return t;throw new ff("Unsupported input rank by biasAdd: ".concat(t.rank))}function wg(e,t,n){return Xs(()=>(null==n&&(n="channelsLast"),Xf(n),$s(e,xg(e.rank,t,n))))}function Tg(e,t,n,i){return Xs(()=>sc(e,t,n,i))}function kg(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}const Sg=["fanIn","fanOut","fanAvg"],Cg=["normal","uniform","truncatedNormal"];class Ig extends la{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Eg extends Ig{apply(e,t){return kl(e,t)}}Eg.className="Zeros",ua(Eg);class Ng extends Ig{apply(e,t){return Sl(e,t)}}Ng.className="Ones",ua(Ng);class Ag extends Ig{constructor(e){if(super(),"object"!==typeof e)throw new ff("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new ff("config must have value set but got ".concat(e));this.value=e.value}apply(e,t){return Xs(()=>ea(sa(this.value),Sl(e,t)))}getConfig(){return{value:this.value}}}Ag.className="Constant",ua(Ag);class Rg extends Ig{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Ol(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Rg.className="RandomUniform",ua(Rg);class Dg extends Ig{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new gf("randomNormal does not support dType ".concat(t,"."));return yg(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Dg.className="RandomNormal",ua(Dg);class Og extends Ig{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new gf("truncatedNormal does not support dType ".concat(t,"."));return Zl(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Og.className="TruncatedNormal",ua(Og);class Lg extends Ig{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return Xs(()=>{if(2!==e.length||e[0]!==e[1])throw new ff("Identity matrix initializer can only be used for 2D square matrices.");return ea(this.gain,Ko(e[0]))})}getConfig(){return{gain:this.gain}}}Lg.className="Identity",ua(Lg);class Pg extends Ig{constructor(e){if(super(),e.scale<0)throw new ff("scale must be a positive float. Got: ".concat(e.scale));var t;this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,t=this.mode,Df(Sg,"FanMode",t),this.distribution=null==e.distribution?"normal":e.distribution,function(e){Df(Cg,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e){let t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Xf(i),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===i){const i=ig(e,2);t=e[1]*i,n=e[0]*i}else if("channelsLast"===i){const i=ig(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{const i=ig(e);t=Math.sqrt(i),n=Math.sqrt(i)}return[t,n]}(e),i=n[0],r=n[1];let s=this.scale;if("fanIn"===this.mode?s/=Math.max(1,i):"fanOut"===this.mode?s/=Math.max(1,r):s/=Math.max(1,(i+r)/2),"normal"===this.distribution){const n=Math.sqrt(s);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new gf("".concat(this.getClassName()," does not support dType ").concat(t,"."));return Zl(e,0,n,t,this.seed)}{const n=Math.sqrt(3*s);return Ol(e,-n,n,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Pg.className="VarianceScaling",ua(Pg);class Fg extends Pg{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Pg.className}}Fg.className="GlorotUniform",ua(Fg);class Mg extends Pg{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Pg.className}}Mg.className="GlorotNormal",ua(Mg);class Ug extends Pg{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Pg.className}}Ug.className="HeNormal",ua(Ug);class Bg extends Pg{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Pg.className}}Bg.className="HeUniform",ua(Bg);class zg extends Pg{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Pg.className}}zg.className="LeCunNormal",ua(zg);class Vg extends Pg{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Pg.className}}Vg.className="LeCunUniform",ua(Vg);class jg extends Ig{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return Xs(()=>{if(e.length<2)throw new gf("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));const n=B(e.slice(0,-1)),i=e[e.length-1],r=n*i;r>this.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(this.ELEMENTS_WARN_SLOW," (").concat(r,") elements: ")+"Slowness may result.");const s=yg([Math.max(i,n),Math.min(i,n)],0,1,t,this.seed),a=ou.qr(s,!1);let o=a[0];const l=a[1].flatten().stridedSlice([0],[Math.min(i,n)*Math.min(i,n)],[Math.min(i,n)+1]);return o=ea(o,l.sign()),n<i&&(o=o.transpose()),ea(sa(this.gain),o.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}jg.className="Orthogonal",ua(jg);const Wg={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Hg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ef(e,ca.getMap().classNameMap,t,"initializer")}function Gg(e){return Cf(e)}function qg(e){if("string"===typeof e){const t=e in Wg?Wg[e]:e;if("GlorotNormal"===t)return new Mg;if("GlorotUniform"===t)return new Fg;if("HeNormal"===t)return new Ug;if("HeUniform"===t)return new Bg;if("LeCunNormal"===t)return new zg;if("LeCunUniform"===t)return new Vg;{const e={};return e.className=t,e.config={},Hg(e)}}return e instanceof Ig?e:Hg(e)}function Xg(e){return Array.isArray(e)&&Array.isArray(e[0])}function Kg(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Yg(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new ff("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Qg(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new ff("Expected exactly 1 Shape; got ".concat(e.length))}return e}function $g(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce((e,t)=>e*t);return t}const Jg="Variable";class Zg{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Jg,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=Uf(),n=null==n?Jg:n,this.originalName=Jf(n),this.name=Zf(this.originalName),this.trainable_=i,this.constraint=r,this.val=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return Hr.makeVariable(e,t,n,i)}(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function em(e){return e.map(e=>e.read())}function tm(e){e.forEach(e=>{e[0].write(e[1])})}class nm{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class im{constructor(e,t,n,i,r,s,a){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=i,this.callArgs=r,this.outputTensorIndex=a,this.id=Uf(),null!=s&&(this.originalName=Jf(s),this.name=Zf(this.originalName)),this.rank=t.length}}let rm=0;class sm{constructor(e,t){this.callArgs=t,this.id=rm++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let am=0;class om extends la{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=am++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=Tf(e)+"_"+zf(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new pf("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new ff("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}getInputAt(e){return xf(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return xf(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new df("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new df("Layer ".concat(this.name)+" is not connected, no input to return.");return xf(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new df("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new df("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return xf(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=wf(e),null==this.inputSpec||0===this.inputSpec.length)return;const t=wf(this.inputSpec);if(e.length!==t.length)throw new ff("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(let n=0;n<e.length;n++){const i=e[n],r=t[n];if(null==r)continue;const s=i.rank;if(null!=r.ndim&&s!==r.ndim)throw new ff("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(r.ndim,", found ndim=").concat(s));if(null!=r.maxNDim&&s>r.maxNDim)throw new ff("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(r.maxNDim,", found ndim=").concat(s));if(null!=r.minNDim&&s<r.minNDim)throw new ff("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(r.minNDim,", found ndim=").concat(s,"."));if(null!=r.dtype&&i.dtype!==r.dtype)throw new ff("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(r.dtype,", found dtype=").concat(i.dtype,"."));if(r.axes){const e=i.shape;for(const t in r.axes){const i=Number(t),s=r.axes[t],a=i>=0?e[i]:e[e.length+i];if(null!=s&&-1===[s,null].indexOf(a))throw new ff("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(i," of input shape to ")+"have value ".concat(s," but got shape ").concat(e,"."))}}if(null!=r.shape)for(let e=0;e<r.shape.length;++e){const t=r.shape[e],s=i.shape[e];if(null!=t&&null!=s&&t!==s)throw new ff("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(r.shape,", ")+"found shape=".concat(i.shape,"."))}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=wf(e);let i=!0;for(const s of n)if(!(s instanceof im)){i=!1;break}let r=!0;for(const s of n)if(s instanceof im){r=!1;break}if(i===r)throw new ff("Arguments to apply() must be all SymbolicTensors or all Tensors");return $f(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of wf(e))t.push(n.shape);this.build(xf(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&r&&(this._refCount=1)}if(this.assertInputCompatibility(e),r){let i=this.call(e,t);const r=wf(i),s=[];for(let e of r)-1!==n.indexOf(e)&&(e=e.clone()),s.push(e);if(i=xf(s),null!=this.activityRegularizer)throw new gf("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}{const n=function(e){e=wf(e);const t=[];for(const n of e)t.push(n.shape);return xf(t)}(e),i=this.computeOutputShape(n);let r;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),r=null!=i&&i.length>0&&Array.isArray(i[0])?i.map((n,i)=>new im(s,n,this,wf(e),t,this.name,i)):new im(s,i,this,wf(e),t,this.name),this.addInboundNode(e,r,null,null,n,i,t),this._refCount++,null!=this.activityRegularizer)throw new gf("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}})}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{let t=!1;this.batchInputShape.forEach((n,i)=>{null!=n&&null!=e[i]&&e[i]!==n&&(t=!0)}),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new df("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new df("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}countParams(){if(!this.built)throw new pf("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return $g(this.weights)}build(e){this.built=!0}getWeights(){return em(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}setWeights(e){Xs(()=>{const t=this.weights;if(t.length!==e.length)throw new ff('You called setWeights(weights) on layer "'.concat(this.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(t.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0===t.length)return;const n=[],i=em(t);for(let r=0;r<i.length;++r){const s=i[r],a=t[r],o=e[r];if(!z(s.shape,o.shape))throw new ff("Layer weight shape ".concat(s.shape," ")+"not compatible with provided weight shape ".concat(o.shape));n.push([a,o])}tm(n)})}addWeight(e,t,n,i,r,s,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new ff("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(i=null!=o?o():qg("zeros"));const l=i.apply(t,n),c=new Zg(l,n,e,s,a);return l.dispose(),null!=r&&this.addLoss(()=>r.apply(c.read())),null==s&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=wf(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach(e=>{if(null!=e)throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.")})}return null}return t}addInboundNode(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const o=wf(e);t=wf(t),n=wf(n),i=wf(i),r=Kg(r),s=Kg(s);const l=[],c=[],u=[];for(const h of o)l.push(h.sourceLayer),c.push(h.nodeIndex),u.push(h.tensorIndex);new sm({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:u,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:i,inputShapes:r,outputShapes:s},a);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}dispose(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();let e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function lm(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const i=lm(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of i)-1===t.indexOf(e)&&t.push(e)}return t}}}class cm extends om{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:zf("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new ff("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new ff("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new ff("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const i=new im(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new sm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new ff("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}cm.className="InputLayer",ua(cm);class um{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof um)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new ff("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return js(t,e.dtype)}catch(sX){throw new ff("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof im){if(null==this.id2Value[e.id])throw new ff("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new ff("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}}getMask(e){if(e instanceof im){if(null==this.id2Value[e.id])throw new ff("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new ff("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&Ks(this.id2Mask)}}const hm=new yf,dm=new yf;function pm(e,t,n,i){const r=null!=n&&n.training,s=Array.isArray(e),a=s?e:[e],o=a.map(e=>e.name),l=[],c=t.names();for(const f of o)-1!==c.indexOf(f)?l.push(t.getValue(f)):l.push(null);null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);const u=o.join(",")+"|"+t.names().sort().join(",");let h,d=hm.get(u);if(null==d){const e=function(e,t){F(null!=e&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],i={};if(1===e.length){const r=gm(e[0],t);n=r.sorted,i=r.recipientMap}else{const r=new Set;for(const s of e){const{sorted:e,recipientMap:a}=gm(s,t);for(const t of e)r.has(t.name)||(n.push(t),r.add(t.name));for(const t in a)null==i[t]&&(i[t]=new Set),a[t].forEach(e=>i[t].add(e))}}return{sorted:n,recipientCounts:fm(i)}}(a,t);d=e.sorted,h=e.recipientCounts,hm.put(u,d),dm.put(u,h)}h={},r||Object.assign(h,dm.get(u));const p=new um(t);for(let f=0;f<d.length;++f){if(null!=i){const e=qs().numTensors;e>i.maxNumTensors&&(i.maxNumTensors=e),e<i.minNumTensors&&(i.minNumTensors=e)}const e=d[f],s=e.sourceLayer;if(s instanceof cm)continue;const a=[],c=[],u=[];let g=!1;for(const n of e.inputs){const e=p.getValue(n),i=p.getMask(n);a.push(e),c.push(i),null!=i&&(g=!0),r||(h[n.name]--,0!==h[n.name]||t.hasKey(n)||-1!==o.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||u.push(e))}g&&((n=n||{}).mask=c[0]);const m=wf(s.apply(a,n));let y=null;s.supportsMasking&&(y=s.computeMask(a,c));const b=mm(e),v=Array.isArray(b)?b:[b];for(let t=0;t<v.length;++t){p.hasKey(v[t])||p.add(v[t],m[t],Array.isArray(y)?y[0]:y);const e=o.indexOf(v[t].name);-1!==e&&(l[e]=m[t])}r||Ks(u)}return p.disposeMasks(),s?l:l[0]}function fm(e){const t={};for(const n in e)t[n]=e[n].size;return t}function gm(e,t){const n=new Set,i=[],r={};for(const o of t.names())n.add(o);const s=[],a=[];for(s.push(e);s.length>0;){const e=s[s.length-1];if(n.has(e.name)){s.pop();continue}const t=a[a.length-1]===s.length-1;if(0===e.inputs.length||t)s.pop(),i.push(e),n.add(e.name),t&&a.pop();else{a.push(s.length-1);for(const t of e.inputs)null==r[t.name]&&(r[t.name]=new Set),r[t.name].add(e.name),n.has(t.name)||s.push(t)}}return{sorted:i,recipientMap:r}}function mm(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const i of e.sourceLayer.inboundNodes[t].outputTensors)if(i.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}function ym(e,t){return Xs(()=>ta(il(ea(e,e),t,!0)))}me().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,function(e){null!=hm&&hm.setMaxEntries(e),null!=dm&&dm.setMaxEntries(e)});class bm extends la{getConfig(){return{}}}class vm extends bm{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Xs(()=>{const t=ym(e,this.axis),n=Eo(t,0,this.maxValue);return ea(e,Zs(n,$s(lg(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}vm.className="MaxNorm",ua(vm);class _m extends bm{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Xs(()=>Zs(e,$s(lg(),ym(e,this.axis))))}getConfig(){return{axis:this.axis}}}_m.className="UnitNorm",ua(_m);class xm extends bm{apply(e){return Pl(e)}}xm.className="NonNeg",ua(xm);class wm extends bm{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Xs(()=>{const t=ym(e,this.axis),n=$s(ea(this.rate,Eo(t,this.minValue,this.maxValue)),ea(1-this.rate,t));return ea(e,Zs(n,$s(lg(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}wm.className="MinMaxNorm",ua(wm);const Tm={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function km(e){return Cf(e)}function Sm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ef(e,ca.getMap().classNameMap,t,"constraint")}function Cm(e){if(null==e)return null;if("string"===typeof e){return Sm({className:e in Tm?Tm[e]:e,config:{}})}return e instanceof bm?e:Sm(e)}async function Im(e){if(null==e)return;const t=[],n=[],i=[];for(const r in e){const s=e[r];if("number"!==typeof s){const e=s;t.push(e.data()),n.push(r),i.push(e)}}if(t.length>0){const r=await Promise.all(t);for(let t=0;t<r.length;++t)e[n[t]]=r[t][0];Ks(i)}}function Em(e){if(null!=e)for(const t in e){const n=e[t];"number"!==typeof n&&n.dispose()}}var Nm;!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Nm||(Nm={}));class Am{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class Rm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class Dm extends Am{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const i in t){const e=t[i];if("number"===typeof e)this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+e*n;else{let t;i in this.totals?t=this.totals[i]:this.totals[i]=0;const r=Xs(()=>$s(this.totals[i],ea(e,n)));this.totals[i]=r,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"===typeof this.totals[n]?t[n]=this.totals[n]/this.seen:Xs(()=>{const e=ea(Zs(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),Ys(t[n])}))}}class Om extends Am{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const r in this.history){const i=this.history[r];for(let s=0;s<i.length;++s)if("number"!==typeof i[s]){const a=i[s];e.push(a.data()),t.push(r),n.push(s)}}const i=await Promise.all(e);for(let r=0;r<i.length;++r){this.history[t[r]][n[r]].dispose(),this.history[t[r]][n[r]]=i[r][0]}}}class Lm extends Am{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||uu,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Z(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let i,r=null!=n?n():ar();return function(){const s=null!=n?n():ar();return s-r<t||(r=s,i=e(...arguments)),i}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const i=[];null!=this.yield&&(await Im(n),i.push(this.yield(e,t,n))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await Im(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await Im(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await Im(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await Im(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):Z(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await Im(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await Im(e),await this.trainEnd(e))}}function Pm(e,t){if(null==e&&(e={}),e instanceof Am)return[e];if(Array.isArray(e)&&e[0]instanceof Am)return e;return wf(e).map(e=>new Lm(e,t))}class Fm{constructor(){}static registerCallbackConstructor(e,t){F(e>=0&&Number.isInteger(e),()=>"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)),Fm.checkForDuplicate(t),null==Fm.constructors[e]&&(Fm.constructors[e]=[]),Fm.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Fm.constructors){Fm.constructors[+t].forEach(t=>{if(t===e)throw new ff("Duplicate callback constructor.")})}}static clear(){Fm.constructors={}}static createCallbacks(e){const t=[];for(const n in Fm.constructors){const i=+n;e>=i&&t.push(...Fm.constructors[i])}return t.map(e=>new e)}}function Mm(e,t,n,i,r,s,a,o,l){const c=new Om,u=[new Dm,...Fm.createCallbacks(t)];null!=e&&u.push(...e),u.push(c);const h=new Rm(u);return h.setParams({epochs:n,initialEpoch:i,samples:r,steps:s,batchSize:a,verbose:t,doValidation:o,metrics:l}),{callbackList:h,history:c}}function Um(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ef(e,ca.getMap().classNameMap,t,"layer",n)}function Bm(e,t){return Xs(()=>{"float32"!==e.dtype&&(e=js(e,"float32"));const n=il(_g(e),t,!0),i=pa(n.shape,lg()),r=ta(wa(n,i));return Zs(e,r)})}function zm(e,t){return Xs(()=>cl(_g(ma(t,e)),-1))}function Vm(e,t){return Xs(()=>cl(ba(ma(t,e)),-1))}function jm(e,t){return Xs(()=>{const n=ma(e,t),i=Eo(ba(e),lg(),Number.MAX_VALUE),r=ba(Zs(n,i));return ea(100,cl(r,-1))})}function Wm(e,t){return Xs(()=>{const n=Eo(t,lg(),Number.MAX_VALUE),i=el($s(1,n)),r=Eo(e,lg(),Number.MAX_VALUE),s=el($s(1,r));return cl(_g(ma(i,s)),-1)})}function Hm(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Xs(()=>{if(n)t=Gl(t);else{const e=il(t,t.shape.length-1,!0);t=Zs(t,e)}return t=Eo(t,lg(),1-lg()),xl(il(ea(js(e,"float32"),el(t)),t.shape.length-1))})}function Gm(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Xs(()=>{const i=js(Yo(function(e){const t=[ig(e.shape)];return _o(e,t)}(e)),"int32"),r=(t=Eo(t,lg(),1-lg())).shape;return Hm(_o(Tl(i,r[r.length-1]),r),t,n)})}function qm(e,t){return Xs(()=>{let n;return n=Eo(t,lg(),1-lg()),n=el(Zs(n,ma(1,n))),cl(function(e,t){if(!z(e.shape,t.shape))throw new ff("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Xs(()=>{const n=Pl(t),i=xl(ba(t));return $s(ma(n,ea(t,e)),tl(Go(i)))})}(e,n),-1)})}function Xm(e,t){return Xs(()=>{const n=Eo(e,lg(),1),i=Eo(t,lg(),1);return il(ea(e,el(Zs(n,i))),-1)})}function Km(e,t){return Xs(()=>{const n=Bm(e,-1),i=Bm(t,-1),r=ea(n,i);return xl(il(r,-1))})}Fm.constructors={};const Ym={meanSquaredError:zm,meanAbsoluteError:Vm,meanAbsolutePercentageError:jm,meanSquaredLogarithmicError:Wm,squaredHinge:function(e,t){return Xs(()=>{const n=wa(0,ma(1,ea(e,t)));return cl(_g(n),-1)})},hinge:function(e,t){return Xs(()=>{const n=wa(0,ma(1,ea(e,t)));return cl(n,-1)})},categoricalHinge:function(e,t){return Xs(()=>{const n=il(ea(e,t),-1),i=nl(ea(ma(1,e),t),-1);return wa(0,$s(1,ma(i,n)))})},logcosh:function(e,t){return Xs(()=>{const n=Math.log(2),i=ma(t,e),r=ma($s(i,ql(ea(-2,i))),n);return cl(r,-1)})},categoricalCrossentropy:Hm,sparseCategoricalCrossentropy:Gm,binaryCrossentropy:qm,kullbackLeiblerDivergence:Xm,poisson:function(e,t){return Xs(()=>{const n=el($s(lg(),t));return cl(ma(t,ea(e,n)),-1)})},cosineProximity:Km};function Qm(e){if("string"===typeof e){if(e in Ym)return Ym[e];let t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new ff(t)}return e}function $m(e,t){return Xs(()=>{const n=ea(.5,Cl(t)),i=cg($o(t,n),e.dtype);return cl(Ho(e,i),-1)})}function Jm(e,t){return Xs(()=>cg(Ho(io(e,-1),io(t,-1)),"float32"))}function Zm(e,t){return Xs(()=>js(il(sl(Ho(e,1),Ho(t,1))),"float32"))}function ey(e,t){return qm(e,t)}function ty(e,t){return e.rank===t.rank&&(e=Kl(e,[e.rank-1])),(t=io(t,-1)).dtype!==e.dtype&&(t=js(t,e.dtype)),js(Ho(e,t),"float32")}const ny=Hm,iy=Gm,ry={binaryAccuracy:$m,categoricalAccuracy:Jm,precision:function(e,t){return Xs(()=>{const n=Zm(e,t),i=function(e,t){return Xs(()=>js(il(sl(Ho(e,0),Ho(t,1))),"float32"))}(e,t),r=$s(n,i);return js(tc($o(r,0),Zs(n,r),0),"float32")})},categoricalCrossentropy:ny,sparseCategoricalCrossentropy:iy,mse:zm,MSE:zm,mae:Vm,MAE:Vm,mape:jm,MAPE:jm,cosine:Km};function sy(e){if("string"===typeof e&&e in ry)return ry[e];if("string"!==typeof e&&null!=e)return e;throw new ff("Unknown metric ".concat(e))}function ay(e){if(vf(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;{let t;for(const n of Object.keys(Ym))if(Ym[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(ry))if(ry[n]===e){t=n;break}return void 0!==t?t:e.name}}const oy=1048576;function ly(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!cy(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>oy&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(oy,"."))}}function cy(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!==typeof n)return!1;if(!cy(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!cy(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function uy(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log;const r=function(e){let t=!0;const n=[],i=[];for(const r in e.nodesByDepth)n.push(e.nodesByDepth[r]);for(const r of n){if(r.length>1||1===r.length&&r[0].inboundLayers.length>1){t=!1;break}i.push(...r)}if(t)for(const r of e.layers){let e=!1;for(const n of r.inboundNodes)if(-1!==i.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),s=["Layer (type)","Input Shape","Output shape","Param #"];let a;if(r?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(e=>Math.floor(t*e))),!r){s.push("Receives inputs"),a=[];for(const t in e.nodesByDepth)a.push(...e.nodesByDepth[t])}i("_".repeat(t)),hy(s,n,i),i("=".repeat(t));const o=e.layers;for(let u=0;u<o.length;++u)r?dy(o[u],n,i):py(o[u],n,a,i),i((u===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const l=function(e){let t;t=null!=e.collectedTrainableWeights?$g(e.collectedTrainableWeights):$g(e.trainableWeights);return t}(e),c=$g(e.nonTrainableWeights);i("Total params: ".concat(l+c)),i("Trainable params: ".concat(l)),i("Non-trainable params: ".concat(c)),i("_".repeat(t))}function hy(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,i="";for(let r=0;r<e.length;++r)r>0&&(i=i.slice(0,i.length-1)+" "),i+=e[r],i=i.slice(0,t[r]),i+=" ".repeat(t[r]-i.length);n(i)}function dy(e,t,n){let i,r;try{r=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(sX){r="multiple"}try{i=JSON.stringify(e.outputShape)}catch(sX){i="multiple"}const s=e.name,a=e.getClassName();hy(["".concat(s," (").concat(a,")"),r,i,e.countParams().toString()],t,n)}function py(e,t,n,i){let r,s;try{s=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(sX){s="multiple"}try{r=JSON.stringify(e.outputShape)}catch(sX){r="multiple"}const a=[];for(const u of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(let e=0;e<u.inboundLayers.length;++e){const t=u.inboundLayers[e].name,n=u.nodeIndices[e],i=u.tensorIndices[e];a.push("".concat(t,"[").concat(n,"][").concat(i,"]"))}const o=e.name,l=e.getClassName(),c=0===a.length?"":a[0];hy(["".concat(o," (").concat(l,")"),s,r,e.countParams().toString(),c],t,i);for(let u=1;u<a.length;++u)hy(["","","","",a[u]],t,i)}function fy(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function gy(e,t){if(null===e)return null;if("string"===typeof e)return kf(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],i=e.length;for(let r=0;r<i;++r){const i=e[r];fy(t,r,i)?n.push(i):n.push(gy(i,t))}return n}{const t={};for(const n of Object.keys(e)){const i=e[n];if("name"===n&&"string"===typeof i)t[n]=i;else{const e=kf(n);t[e]=gy(i,e)}}return t}}function my(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return Tf(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],i=e.length;for(let r=0;r<i;++r){const i=e[r];fy(t,r,i)?n.push(i):n.push(my(i,t))}return n}{const t={};for(const n of Object.keys(e)){const i=e[n],r=Tf(n);t[r]="name"!==n&&"className"!==n||"string"!==typeof i?my(i,n):i}return t}}const yy="4.9.0";class by extends om{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=zf(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Af(this.inputs).length!==this.inputs.length)throw new ff("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(this.inputs.map(e=>e.name)));Af(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(this.outputs.map(e=>e.name))),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const e=y.sourceLayer,t=y.nodeIndex,n=y.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const y of this.inputs){const e=y.sourceLayer,t=y.nodeIndex,n=y.tensorIndex;vf(0===t,"input layer has >1 nodes"),vf(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const t=this.inputLayers[y];if(!(t instanceof cm))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(y," (0-based) originates ")+"from layer type ".concat(t.getClassName(),"."));this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map(e=>e.shape),this.internalOutputShapes=this.outputs.map(e=>e.shape);const t={},n={},i={},r={},s={},a=[],o=(e,t,n,i,r,l)=>{null!=i&&null!=r&&null!=l||(i=e.sourceLayer,r=e.nodeIndex,l=e.tensorIndex);const c=i.inboundNodes[r];if(-1!==n.indexOf(c))throw new pf("The tensor ".concat(e.name,' at layer "').concat(i.name,'" ')+"is part of a cycle.");if(-1!==t.indexOf(c))return;this.containerNodes.add(by.nodeKey(i,r)),i.id in s||(s[i.id]=Object.keys(s).length),-1===n.indexOf(c)&&n.push(c);const u=c.inboundLayers.length;for(let s=0;s<u;s++){const e=c.inputTensors[s],i=c.inboundLayers[s],r=c.nodeIndices[s],a=c.tensorIndices[s];o(e,t,n,i,r,a)}for(t.push(c);n.indexOf(c)>=0;)n.splice(n.indexOf(c),1);a.push(c)},l=[],c=[];for(const y of this.outputs)o(y,l,c);const u=a.slice().reverse();for(const y of u){n[y.id]=y,y.id in t||(t[y.id]=0);let e=t[y.id];const s=null==i[y.outboundLayer.id]?0:i[y.outboundLayer.id];e=Math.max(e,s),i[y.outboundLayer.id]=e,r[y.outboundLayer.id]=y.outboundLayer,t[y.id]=e;for(let i=0;i<y.inboundLayers.length;i++){const r=y.inboundLayers[i],s=y.nodeIndices[i],a=r.inboundNodes[s],o=null==t[a.id]?0:t[a.id];t[a.id]=Math.max(e+1,o),n[a.id]=a}}const h={};for(const y in t){const e=t[y];e in h||(h[e]=[]),h[e].push(n[y])}const d={};for(const y in i){const e=i[y];e in d||(d[e]=[]),d[e].push(r[y])}let p=Object.keys(d).map(e=>parseInt(e,10)).sort(Nf);this.layers=[];for(const y of p){const e=d[y];e.sort((e,t)=>{const n=s[e.id],i=s[t.id];return n<i?-1:n>i?1:0});for(const t of e)t instanceof by&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,p=Object.keys(h).map(e=>parseInt(e,10)).sort(Nf);const f=this.inputs.slice(),g=[];for(const y of p)for(const e of h[y]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===f.indexOf(n))throw new pf("Graph disconnected: cannot obtain value for tensor ".concat(n)+' at layer "'.concat(t.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(g));for(const t of e.outputTensors)f.push(t);g.push(t.name)}}this.nodesByDepth=h;const m=this.layers.map(e=>e.name);for(const y of m){const e=m.filter(e=>e===y).length;if(1!==e)throw new pf('The name "'.concat(y,'" is used ').concat(e," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(m))}this.outboundNodes=[],this.inboundNodes=[],new sm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(e=>null),outputMasks:this.outputs.map(e=>null),inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs.map(e=>e.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(t=>t.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new ff("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n={};let i=0;const r=Object.keys(e)[0].split("/"),s=!isNaN(parseInt(r[r.length-1],10));for(const o of this.layers)for(const[e,t]of o.weights.entries()){const r=s?"".concat(t.name.split("/").slice(0,-1).join("/")+"/").concat(e):t.originalName;if(null!=n[r])throw new ff("Duplicate weight name: ".concat(r));n[r]=t,i++}const a=[];for(const o in e){let i=o;if(null==n[o]){const e=o.split("/");i=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[i])a.push([n[i],e[o]]);else if(t)throw new ff("Provided weight data has no target variable: ".concat(o));delete n[i]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new ff("".concat(e.length," of ").concat(i," weights are not set: ")+"".concat(e))}tm(a)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(yy),t.backend="TensorFlow.js",t}toJSON(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=my(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return Xs(()=>{e=wf(e);const n=new um;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return pm(this.outputs,n,t)})}computeMask(e,t){return Xs(()=>{let n;return e=wf(e),n=null==t?bf(null,e.length):wf(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){const t=Kg(e);if(t.length!==this.inputLayers.length)throw new ff("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));const n={};for(let a=0;a<t.length;a++){const e=this.inputLayers[a],i=t[a];n[e.name+"_0_0"]=i}const i=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(Nf);if(i.length>1)for(const a of i){const e=this.nodesByDepth[a];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map(e=>e.id).indexOf(e.id))continue;const i=[];for(let a=0;a<t.inboundLayers.length;a++){const e=t.inboundLayers[a],r=t.nodeIndices[a],s=t.tensorIndices[a],o=n["".concat(e.name,"_").concat(r,"_").concat(s)];i.push(o)}const r=Kg(e.computeOutputShape(xf(i))),s=e.inboundNodes.indexOf(t);for(let t=0;t<r.length;t++){n["".concat(e.name,"_").concat(s,"_").concat(t)]=r[t]}}}const r=[],s=[];for(let a=0;a<this.outputLayers.length;a++){const e=this.outputLayers[a],t=this.outputLayersNodeIndices[a],n=this.outputLayersTensorIndices[a],i="".concat(e.name,"_").concat(t,"_").concat(n);s.push(i)}for(let a=0;a<s.length;a++){const e=s[a];vf(e in n),r.push(n[e])}return xf(r)}runInternalGraph(e,t){null==t&&(t=bf(null,e.length));const n={};for(let o=0;o<this.inputs.length;++o){const i=this.inputs[o],r=e[o],s=t[o];n[i.id]=[r,s]}const i=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(Nf);for(const o of i){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer,i=t.inputTensors,r=t.outputTensors,s=new Array;for(const t of i)t.id in n&&s.push(n[t.id]);if(s.length===i.length){let i,a,o,l,c={};if(null!=t.callArgs&&(c=t.callArgs),1===s.length){const[t,n]=s[0];null==c.mask&&(c.mask=n),o=wf(e.call(t,c)),l=wf(e.computeMask(t,n)),i=[t],a=[n]}else i=s.map(e=>e[0]),a=s.map(e=>e[1]),null==c.mask&&(c.mask=a),o=wf(e.call(i,c)),l=wf(e.computeMask(i,a));if(e.activityRegularizer)throw new gf("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<r.length;++e){const t=r[e],i=o[e],s=l[e];n[t.id]=[i,s]}}}}const r=[],s=[],a=[];for(const o of this.outputs){vf(o.id in n,"Could not compute output ".concat(o.name," : ").concat(o.id));const[e,t]=n[o.id];a.push(e.shape),r.push(e),s.push(t)}return[r,s,a]}buildNodeConversionMap(e){const t={};let n;for(const i of this.layers){n=i instanceof by?1:0;for(let e=0;e<i.inboundNodes.length;e++){const r=by.nodeKey(i,e);this.containerNodes.has(r)&&(t[r]=n,n+=1)}}return t}getLayer(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new ff("Provide either a layer name or layer index");if("number"===typeof e)return this.findLayer(e);for(const n of this.layers)if(n.name===e)return n;throw new ff("No such layer: ".concat(e))}findLayer(e){if(this.layers.length<=e)throw new ff("Was asked to retrieve layer at index ".concat(e,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[e]}calculateLosses(){return Xs(()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const i=by.nodeKey(t,n);this.containerNodes.has(i)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const s of this.layers){const e=s.getClassName(),i=s.getConfig(),r=[];for(let n=0;n<s.inboundNodes.length;n++){const e=s.inboundNodes[n],i=by.nodeKey(s,n);let a={};if(this.containerNodes.has(i)){if(e.callArgs)try{JSON.stringify(e.callArgs),a=e.callArgs}catch(sX){console.warn("Layer ".concat(s.name," was passed ")+"non-serializable keyword arguments: "+"".concat(e.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),a={}}if(e.inboundLayers.length>0){const n=[];for(let i=0;i<e.inboundLayers.length;i++){const r=e.inboundLayers[i],s=e.nodeIndices[i],o=e.tensorIndices[i];let l=t[by.nodeKey(r,s)];null==l&&(l=0),n.push([r.name,l,o,a])}r.push(n)}}}const a={};a.name=s.name,a.className=e,a.config=i,a.inboundNodes=r,n.push(a)}e.layers=n;const i=[];for(let s=0;s<this.inputLayers.length;s++){const e=this.inputLayers[s],n=this.inputLayersNodeIndices[s],r=by.nodeKey(e,n);if(!this.containerNodes.has(r))continue;let a=t[r];null!==a&&void 0!==a||(a=0);const o=this.inputLayersTensorIndices[s];i.push([e.name,a,o])}e.inputLayers=i;const r=[];for(let s=0;s<this.outputLayers.length;s++){const e=this.outputLayers[s],n=this.outputLayersNodeIndices[s],i=by.nodeKey(e,n);if(!this.containerNodes.has(i))continue;let a=t[i];null!==a&&void 0!==a||(a=0);const o=this.outputLayersTensorIndices[s];r.push([e.name,a,o])}return e.outputLayers=r,e}static fromConfig(e,t){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i={},r={};function s(e,t){e.name in r?r[e.name].push(t):r[e.name]=[t]}function a(e,t){const n=[];let r;for(const a of t){const o=a[0],l=a[1],c=a[2];if(r=null==a[3]?{}:a[3],!(o in i))return void s(e,t);const u=i[o];if(u.inboundNodes.length<=l)return void s(e,t);const h=u.inboundNodes[l];n.push(h.outputTensors[c])}n.length>0&&e.apply(xf(n),r)}function o(e){const r=e.name,a=Um(e,null!=t.customObjects?t.customObjects:{});a.setFastWeightInitDuringBuild(n),i[r]=a;e.inboundNodes.forEach(e=>{if(!(e instanceof Array))throw new ff("Corrupted configuration, expected array for nodeData: ".concat(e));s(a,e)})}const l=t.name,c=t.layers;for(const f of c)o(f);for(;!Rf(r);)for(const e of c){const t=i[e.name];if(t.name in r){const e=r[t.name];delete r[t.name];for(const n of e)a(t,n)}}const u=[],h=[],d=t.inputLayers;for(const f of d){const e=f[0],t=f[1],n=f[2];vf(e in i);const r=i[e].inboundNodes[t].outputTensors;u.push(r[n])}const p=t.outputLayers;for(const f of p){const e=f[0],t=f[1],n=f[2];vf(e in i);const r=i[e].inboundNodes[t].outputTensors;h.push(r[n])}return new e({inputs:u,outputs:h,name:l})}get stateful(){if(this._stateful)throw new ff("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Xs(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function vy(e,t,n){const i=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>null);if(1===i)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==i)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(i," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){const n=[];return t.forEach(t=>{t in e?n.push(e[t]):n.push(null)}),n}throw new Error("The model has multiple (".concat(i,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(i," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function _y(e,t){return vy(e,t,"classWeight")}async function xy(e,t,n,i){if(null!=t||null!=i)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=Xs(()=>{if(1===e.shape.length)return Ws(e);if(2===e.shape.length){if(e.shape[1]>1){return io(e,1)}if(1===e.shape[1])return _o(e,[e.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(e.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(e.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),i=Array.from(await t.data());Ks(t);const r=[];return i.forEach(e=>{if(null==n[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");r.push(n[e])}),$l(r,"float32")}return null}function wy(e,t){return ea(e,t)}function Ty(e,t){let n,i;const r=t;n=r.xs,i=r.ys,F(null!=n&&null!=i,()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t));const s=ky("input",e.inputNames,n),a=ky("output",e.outputNames,i),o=s[0].shape[0];F(s.length===e.inputs.length,()=>"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(s.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")),F(a.length===e.outputs.length,()=>"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(a.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")"));for(let l=0;l<s.length;l++)F(s[l].shape[0]===o,()=>"Batch size mismatch: input "+"".concat(e.inputNames[l]," has ").concat(s[l].shape[0],"; ")+"expected  ".concat(o," based on input ").concat(e.inputNames[0],"."));for(let l=0;l<a.length;l++)F(a[l].shape[0]===o,()=>"Batch size mismatch: output "+"".concat(e.outputNames[l]," has ").concat(a[l].shape[0],"; ")+"expected  ".concat(o," based on input ").concat(e.inputNames[0],"."));return{xs:s,ys:a}}function ky(e,t,n){if(n instanceof Tr)return[n];if(Array.isArray(n))return F(n.length===t.length,()=>"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")),n;{const i=[];for(const r of t){if(null==n[r])throw new ff("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(r,"'."));i.push(n[r])}return i}}async function Sy(e,t,n){const i=null!=n.batchesPerEpoch;if(F(null!=e.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),F(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),F(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(n.epochs)),F(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(n.batchesPerEpoch)),F(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const r=null!=n.validationData;let s,a;if(r)if(Cy(n.validationData))F(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(n.validationBatches));else{const e=function(e){if(3===e.length)throw new gf("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);s=e.xs,a=e.ys}const o=e.makeTrainFunction(),l=e.getDedupedMetricsNames();let c;c=r?l.slice().concat(l.map(e=>"val_"+e)):l.slice();const u=Pm(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:d,history:p}=Mm(u,h,n.epochs,null,null,function(e,t){let n=null;null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size);return n}(t,n),null,r,c);d.setModel(e),e.history=p,await d.onTrainBegin(),e.stopTraining_=!1;let f=null==n.initialEpoch?0:n.initialEpoch,g=await t.iterator();for(;f<n.epochs;){const c={};await d.onEpochBegin(f);let u=0,h=0;for(i||(g=await t.iterator());!i||u<n.batchesPerEpoch;){const t=await g.next();if(i&&t.done){console.warn("You provided `batchesPerEpoch` as "+"".concat(n.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(u," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(n.batchesPerEpoch*n.epochs," batches). ")+"You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:i,ys:r}=Ty(e,t.value),s={};s.batch=h,s.size=i[0].shape[0],await d.onBatchBegin(h,s);const a=[];if(null!=n.classWeight){const t=_y(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)a.push(await xy(r[e],null,t[e]))}const c=i.concat(r).concat(a),p=o(c);Ks(c);for(let e=0;e<l.length;++e){const t=l[e],n=p[e];s[t]=n,Ys(n)}await d.onBatchEnd(h,s),Em(s),h++,u++}if(i?u>=n.batchesPerEpoch:t.done){if(r){let t;t=Cy(n.validationData)?wf(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):wf(e.evaluate(s,a,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)c["val_".concat(e.metricsNames[n])]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(f,c),f++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function Cy(e){return"function"===typeof e.iterator}function Iy(e){F(e>0&&Number.isInteger(e),()=>"batchSize is required to be a positive integer, but got ".concat(e))}function Ey(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(e=>hg(e,t,n-t)):hg(e,t,n-t)}function Ny(e,t){return Xs(()=>null==e?null:Array.isArray(e)?e.map(e=>Ny(e,t)):vg(e,"int32"===t.dtype?t:js(t,"int32")))}function Ay(e,t){const n=[];let i=0,r=null;for(;i<e;)r=i+t,r>=e&&(r=e),n.push([i,r]),i=r;return n}function Ry(e){const t=[];e instanceof Tr&&(e=[e]);for(let n=0;n<e.length;++n){const i=e[n];if(1===i.rank)t.push(ug(i,1));else{if(0===i.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(i)}}return t}function Dy(e,t){if(null==e)return;const n=[];if(t instanceof Tr)n.push(t.id);else if(Array.isArray(t))t.forEach(e=>n.push(e.id));else if(null!=t)for(const r in t){const e=t[r];n.push(e.id)}const i=[];if(e instanceof Tr)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach(e=>{-1===n.indexOf(e.id)&&i.push(e)});else if(null!=e)for(const r in e){const t=e[r];-1===n.indexOf(t.id)&&i.push(t)}i.forEach(e=>{e.isDisposed||e.dispose()})}function Oy(e){return Array.isArray(e)}function Ly(e){return!function(e){return e instanceof Tr}(e)&&!Oy(e)}function Py(e,t,n){let i,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){let t=!1;if(Oy(e)&&e.length>0)t=!0;else if(Ly(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new ff("Error when checking model ".concat(s," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map(e=>null);if(Ly(e)){i=[];for(const n of t){if(null==e[n])throw new ff('No data provided for "'.concat(n,'". Need data for each key in: ')+"".concat(t));i.push(e[n])}}else if(Oy(e)){if(e.length!==t.length)throw new ff("Error when checking model ".concat(s,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));i=e}else{if(t.length>1)throw new ff("The model ".concat(s," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));i=[e]}if(i=Ry(i),null!=n)for(let a=0;a<t.length;++a){if(null==n[a])continue;const e=i[a];if(e.shape.length!==n[a].length)throw new ff("Error when checking ".concat(s,": expected ").concat(t[a]," ")+"to have ".concat(n[a].length," dimension(s). but got array with ")+"shape ".concat(e.shape));for(let t=0;t<n[a].length;++t){if(0===t&&!r)continue;const i=e.shape[t],o=n[a][t];if(null!=o&&o>=0&&i!==o)throw new ff("".concat(s," expected a batch of elements where each ")+"example has shape [".concat(n[a].slice(1,n[a].length),"] ")+"(i.e.,tensor shape [*,".concat(n[a].slice(1,n[a].length),"])")+" but the ".concat(s," received an input with ").concat(e.shape[0])+" examples, each with shape [".concat(e.shape.slice(1,e.shape.length),"]")+" (tensor shape [".concat(e.shape,"])"))}}return i}function Fy(e,t,n){let i,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new ff("Error when checking model ".concat(s,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));i=e}else{if(t.length>1)throw new ff("The model expects ".concat(t.length," ").concat(s," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));i=[e]}if(null!=n)for(let a=0;a<t.length;++a){if(null==n[a])continue;const e=i[a];if(e.shape.length!==n[a].length)throw new ff("Error when checking ".concat(s,": expected ").concat(t[a]," ")+"to have ".concat(n[a].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(e.shape)));for(let i=0;i<n[a].length;++i){if(0===i&&!r)continue;const o=e.shape[i],l=n[a][i];if(null!=l&&l!==o)throw new ff("Error when checking ".concat(s,": expected ")+"".concat(t[a]," to have shape ").concat(JSON.stringify(n[a])," but ")+"got array with shape ".concat(JSON.stringify(e.shape),"."))}}}class My extends by{constructor(e){super(e),this.isTraining=!1}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new ff("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");uy(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>lu.adagrad(.01),Adadelta:()=>lu.adadelta(1,.95,lg()),Adam:()=>lu.adam(.001,.9,.999,lg()),Adamax:()=>lu.adamax(.002,.9,.999,lg(),0),RMSProp:()=>lu.rmsprop(.001,.9,0,lg()),SGD:()=>lu.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new ff("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ha))throw new ff("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ff("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));const n=e.loss;t=n.map(e=>Qm(e))}else{const n=Qm(e.loss);this.outputs.forEach(e=>{t.push(n)})}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new ff('Unknown entry in loss dictionary: "'.concat(t,'". ')+"Only expected the following keys: ".concat(this.outputNames));for(const n of this.outputNames)null==e.loss[n]&&console.warn('Output "'.concat(n,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(n," during training")),t.push(Qm(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let s=0;s<this.outputs.length;++s){const e=this.internalOutputShapes[s],t=this.outputNames[s];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[s])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],$f("loss",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}});const i=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>[]);let n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map(e=>n);{const e=[];for(const i of t){let t=n.hasOwnProperty(i)?n[i]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),r=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};$f("metric",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,i,s;for(const a of t){if("string"===typeof a&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(a)){const t=this.internalOutputShapes[e];let r;1===t[t.length-1]||this.lossFunctions[e]===qm?-1!==["accuracy","acc"].indexOf(a)?i=$m:-1!==["crossentropy","ce"].indexOf(a)&&(i=ey):this.lossFunctions[e]===Gm?-1!==["accuracy","acc"].indexOf(a)?i=ty:-1!==["crossentropy","ce"].indexOf(a)&&(i=iy):-1!==["accuracy","acc"].indexOf(a)?i=Jm:-1!==["crossentropy","ce"].indexOf(a)&&(i=ny),-1!==["accuracy","acc"].indexOf(a)?r="acc":-1!==["crossentropy","ce"].indexOf(a)&&(r="ce"),s=i,n=""+r}else{const e=sy(a);s=e,n=""+ay(a)}let t;$f(n,()=>{t=s}),r(e,n,t)}})(i[e])}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=null==n.batchSize?32:n.batchSize;Iy(i);const r=this.standardizeUserDataXY(e,t,!0,i);try{const e=r[0].concat(r[1]);this.makeTestFunction();const t=this.testFunction;return xf(this.testLoop(t,e,i,n.verbose,n.steps))}finally{Dy(r[0],e),Dy(r[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const i=null!=(n=n||{}).batches,r=e.testFunction;let s=[];if(n.verbose>0)throw new gf("Verbose mode is not implemented yet.");F(!i||n.batches>0&&Number.isInteger(n.batches),()=>"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(n.batches)));const a="function"===typeof t.next?t:await t.iterator();let o=0,l=0;for(;!i||l<n.batches;){const t=await a.next();if(s=Xs(()=>{if(t.value){const{xs:n,ys:i}=Ty(e,t.value),a=n.concat(i),c=Xs(()=>r(a));if(Ks(a),0===l)for(let e=0;e<c.length;++e)s.push(sa(0));const u=a[0].shape[0];for(let e=0;e<c.length;++e){const t=c[e],n=s[e];s[e]=Xs(()=>$s(s[e],ea(u,t))),l>0&&Ks(n)}Ks(c),o+=u,++l}return s}),t.done){i&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(n.batches," batches). ")+"You may need to use the repeat() function when building your dataset.");break}}for(let c=0;c<s.length;++c){const e=s[c];s[c]=Zs(s[c],o),Ks(e)}return xf(s)}(this,e,t)}checkNumSamples(e,t,n){let i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(i=null,null!=t)throw new ff("If ".concat(r," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new ff("Either the input data should have a defined shape, or "+"".concat(r," shoud be specified."));i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new ff("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),i=n?t:[t],r=this.retrieveSymbolicTensors(i),s=new um;if(e instanceof Tr&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ff("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(let t=0;t<this.inputs.length;++t)s.add(this.inputs[t],e[t])}else for(const o of this.inputs){const t=e[o.name];if(null==t)throw new ff("No value is provided for the model's input ".concat(o.name));s.add(o,t)}const a=pm(r,s);return n?a:a[0]}retrieveSymbolicTensors(e){const t=bf(null,e.length);let n=e.length;for(const i of this.layers){const r=Array.isArray(i.output)?i.output:[i.output],s=r.map(e=>e.name);for(let i=0;i<e.length;++i){const a=s.indexOf(e[i]);if(-1!==a&&(t[i]=r[a],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach((t,i)=>{null==t&&n.push(e[i])}),new ff("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(n)))}return t}predictLoop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Xs(()=>{const i=this.checkNumSamples(e);if(n)throw new gf("Verbose predictLoop() is not implemented yet.");const r=Ay(i,t),s=this.outputs.map(e=>[]);for(let t=0;t<r.length;++t){const n=Xs(()=>{const n=r[t][0],i=r[t][1],s=Ey(e,n,i),a=[];if(Array.isArray(s))for(let e=0;e<s.length;++e)a.push({key:this.inputs[e],value:s[e]});else a.push({key:this.inputs[0],value:s});const o=new um(a);return pm(this.outputs,o)});n.forEach((e,t)=>s[t].push(e))}return xf(s.map(e=>No(e,0)))})}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Ry(e);Fy(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return Iy(e),this.predictLoop(n,e)}finally{Dy(n,e)}}predictOnBatch(e){Fy(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t){let n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new pf("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let r=0;r<this.feedOutputShapes.length;++r){const e=this.feedOutputShapes[r];this.feedLossFns[r]===Gm?i.push(e.slice(0,e.length-1).concat([1])):i.push(e)}if(function(e,t){const n=Af(e.map(e=>e.shape[0]));n.sort();const i=Af(t.map(e=>e.shape[0]));if(i.sort(),n.length>1)throw new ff("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(e=>e.shape))));if(i.length>1)throw new ff("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map(e=>e.shape))));if(n.length>0&&i.length>0&&!z(n,i))throw new ff("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(i[0]," target ")+"sample(s).")}(e=Py(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=Py(t,this.feedOutputNames,i,!1,"target")),function(e,t,n){const i=[zm,qm,Hm];for(let r=0;r<e.length;++r){const s=e[r],a=t[r],o=n[r];if(null!=a){if(a===Hm&&1===s.shape[s.shape.length-1])throw new ff("You are passing a target array of shape ".concat(s.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==i.indexOf(a)){const e=s.shape.slice(1),t=o.slice(1);for(let n=0;n<e.length;++n){const i=e[n],r=t[n];if(null!=r&&i!==r)throw new ff("A target Tensor with shape ".concat(s.shape," was passed for an ")+"output of shape ".concat(o,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new ff("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}async standardizeUserData(e,t,n,i){let r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5?arguments[5]:void 0;const[a,o]=this.standardizeUserDataXY(e,t,r,s);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=i){const e=_y(i,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await xy(o[t],null,e[t]))}return[a,o,l]}testLoop(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;return Xs(()=>{const s=this.checkNumSamples(t,n,r,"steps"),a=[];if(i>0)throw new gf("Verbose mode is not implemented yet.");if(null!=r)throw new gf("steps mode in testLoop() is not implemented yet");{const i=Ay(s,n),r=$l(ag(0,s));for(let n=0;n<i.length;++n){const s=i[n][0],o=i[n][1],l=hg(r,s,o-s),c=Ny(t,l),u=e(c);if(0===n)for(let e=0;e<u.length;++e)a.push(sa(0));for(let e=0;e<u.length;++e){const t=u[e];a[e]=$s(a[e],ea(o-s,t))}}for(let e=0;e<a.length;++e)a[e]=Zs(a[e],s)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const i=e[n];let r=i;if(_f(e,i)>1){const t=_f(e.slice(0,n),i);r+="_".concat(t)}t.push(r)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),s=[],a=this.collectedTrainableWeights.map(e=>e.read()),o=this.optimizer_.minimize(()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const a=new um(e),o=pm(this.outputs,a,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(i[n],o[n]);null!=r[n]&&(e=wy(e,r[n]));const s=cl(e);t.push(s),l=0===n?e:$s(l,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],r=this.metricsTensors[n][1];e=cl(t(i[r],o[r]))}Ys(e),s.push(e)}return l=cl(l),this.calculateLosses().forEach(e=>{l=$s(l,e)}),l},!0,a);return[o].concat(s)}}makeTestFunction(){this.testFunction=e=>Xs(()=>{const t=[];let n;const i=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let e=0;e<this.inputs.length;++e)s.push({key:this.inputs[e],value:i[e]});const a=new um(s),o=pm(this.outputs,a);for(let e=0;e<this.lossFunctions.length;++e){const i=this.lossFunctions[e],s=cl(i(r[e],o[e]));n=0===e?s:$s(n,s),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],i=this.metricsTensors[e][1],s=cl(n(r[i],o[i]));t.push(s)}return t})}async fit(e,t){let n,i,r,s,a,o,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;try{const d=null==h.batchSize?32:h.batchSize;Iy(d);const p=!1,f=await this.standardizeUserData(e,t,h.sampleWeight,h.classWeight,p,d);n=f[0],i=f[1],u=f[2];let g,m=!1;if(null!=h.validationData&&h.validationData.length>0){if(m=!0,2!==h.validationData.length)throw 3===h.validationData.length?new gf("validationData including sample weights is not supported yet."):new ff("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(h.validationData," is invalid."));a=h.validationData[0],o=h.validationData[1];const e=!0,t=await this.standardizeUserData(a,o,null,null,e,d);l=t[0],c=t[1],g=l.concat(c)}else if(null!=h.validationSplit&&h.validationSplit>0&&h.validationSplit<1){m=!0;const e=Math.floor(n[0].shape[0]*(1-h.validationSplit)),t=n[0].shape[0];l=Ey(n,e,t),r=n,n=Ey(n,0,e),c=Ey(i,e,t),s=i,i=Ey(i,0,e),g=l.concat(c)}else null!=h.validationSteps&&(m=!0);const y=n.concat(i).concat(u);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let _,x;m?(this.makeTestFunction(),_=this.testFunction,x=v.slice().concat(v.map(e=>"val_"+e))):(_=null,g=[],x=v.slice());const w=Pm(h.callbacks,h.yieldEvery);return await this.fitLoop(b,y,v,d,h.epochs,h.verbose,w,_,g,h.shuffle,x,h.initialEpoch,null,null)}finally{this.isTraining=!1,Dy(n,e),Dy(i,t),Dy(r,e),Dy(s,t),Dy(l,a),Dy(c,o),null!=u&&Ks(u)}}async fitLoop(e,t,n,i,r,s,a,o,l,c,u,h,d,p){null==i&&(i=32),null==r&&(r=1),null==c&&(c=!0),null==h&&(h=0);let f=!1;if(null!=o&&null!=l&&(f=!0),null!=p&&(f=!0,null==d))throw new ff("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(t,i,d,"steps_per_epoch");let m;null!=g&&(m=ag(0,g)),null==s&&(s=1);const{callbackList:y,history:b}=Mm(a,s,r,h,g,d,i,f,u);y.setModel(this),this.history=b,await y.onTrainBegin(),this.stopTraining_=!1;for(let v=h;v<r;++v){await y.onEpochBegin(v);const r={};if(null!=d)throw new gf("stepsPerEpoch mode is not implemented yet.");{if("batch"===c)throw new gf("batch shuffling is not implemneted yet");c&&D(m);const s=$l(m),a=Ay(g,i);for(let c=0;c<a.length;++c){const u={};if(await y.onBatchBegin(c,u),Xs(()=>{const h=a[c][0],d=a[c][1],p=hg(s,h,d-h);u.batch=c,u.size=d-h;const g=Ny(t,p),m=e(g);for(let e=0;e<n.length;++e){const t=n[e],i=m[e];u[t]=i,Ys(i)}if(c===a.length-1&&f){const e=this.testLoop(o,l,i);for(let t=0;t<n.length;++t){const i=n[t],s=e[t];Ys(s),r["val_"+i]=s}}}),await y.onBatchEnd(c,u),Em(u),this.stopTraining_)break}s.dispose()}if(await y.onEpochEnd(v,r),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return Sy(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),i=n[0],r=n[1],s=this.makeTrainFunction()(i.concat(r)),a=[];for(const o of s){const e=await o.data();a.push(e[0])}return Ks(s),Dy(n[0],e),Dy(n[1],t),xf(a)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,i=n?this.trainableWeights:this.weights,r=this.getWeights(n);for(let s=0;s<i.length;++s)n&&!i[s].trainable||t.push({name:i[s].originalName,tensor:r[s]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=qs().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-qs().numTensors}return e}getLossIdentifiers(){let e;if("string"===typeof this.loss)e=Tf(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!==typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(e=>Tf(e))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const i of t){if("string"!==typeof n[i])throw new Error("Serialization of non-string loss is not supported.");e[i]=Tf(n[i])}}return e}getMetricIdentifiers(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[Tf(ay(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Tf(ay(e)));{const e={};for(const t in this.metrics)e[t]=Tf(ay(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Um(gy(e.optimizer_config));let n,i;if("string"===typeof e.loss)n=kf(e.loss);else if(Array.isArray(e.loss))n=e.loss.map(e=>kf(e));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=kf(e.loss[t])}if(Array.isArray(e.metrics))i=e.metrics.map(e=>kf(e));else if(null!=e.metrics){i={};for(const t in e.metrics)i[t]=kf(e.metrics[t])}this.compile({loss:n,metrics:i,optimizer:t})}async save(e,t){if("string"===typeof e){const t=(n=e,ps.getSaveHandlers(n));if(0===t.length)throw new ff("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new ff("Found more than one (".concat(t.length,") save handlers for ")+"URL '".concat(e,"'"));e=t[0]}var n;if(null==e.save)throw new ff("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const i=await as(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(yy),convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:n}=await as(await this.optimizer.getWeights(),e);i.specs.push(...n),i.data=(s=[i.data,t],ss.join(s))}var s;if(null!=this.userDefinedMetadata){const e=!0;ly(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=i.data,r.weightSpecs=i.specs,e.save(r)}setUserDefinedMetadata(e){ly(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}My.className="Model",ua(My);class Uy extends My{}Uy.className="Functional",ua(Uy);class By extends My{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:zf("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(e=>e<0))throw new ff("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}add(e){const t=e instanceof By||e instanceof My;let n;if(t){if(n=e,1!==n.outputs.length)throw new ff("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new ff("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new ff("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new ff("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new cm({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new ff("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new ff("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=lm(this.outputs[0])}this.inboundNodes=[],new sm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:bf(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(Qg(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new My({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new pf("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new pf("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new pf("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new pf("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t){let n,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new ff("Legacy serialization format not supported yet.");n=t}else F(null!=t.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),n=t.layers,delete t.layers,r=t;const s=new e(r);if(!(s instanceof By))throw new gf("Sequential.fromConfig called on non-Sequential input: ".concat(s));for(const a of n){const e=Um(a,void 0,i);i&&e.setFastWeightInitDuringBuild(!0),s.add(e)}return s}set stopTraining(e){if(null==this.model)throw new ff("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new ff("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}By.className="Sequential",ua(By);class zy extends la{getConfig(){return{}}}class Vy extends zy{apply(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new gf("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return Wo(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}Vy.className="elu",ua(Vy);class jy extends zy{apply(e){return Ml(e)}}jy.className="selu",ua(jy);class Wy extends zy{apply(e){return Pl(e)}}Wy.className="relu",ua(Wy);class Hy extends zy{apply(e){return Xs(()=>hl(6,Pl(e)))}}Hy.className="relu6",ua(Hy);class Gy extends zy{apply(e){return e}}Gy.className="linear",ua(Gy);class qy extends zy{apply(e){return Bl(e)}}qy.className="sigmoid",ua(qy);class Xy extends zy{apply(e){return function(e){return Xs(()=>{const t=$s(.5,ea(.2,e));return Eo(t,0,1)})}(e)}}Xy.className="hardSigmoid",ua(Xy);class Ky extends zy{apply(e){return ql(e)}}Ky.className="softplus",ua(Ky);class Yy extends zy{apply(e){return function(e){return Xs(()=>Zs(e,$s(ba(e),1)))}(e)}}Yy.className="softsign",ua(Yy);class Qy extends zy{apply(e){return Ql(e)}}Qy.className="tanh",ua(Qy);class $y extends zy{apply(e){return Gl(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}$y.className="softmax",ua($y);class Jy extends zy{apply(e){return rl(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}Jy.className="logSoftmax",ua(Jy);class Zy extends zy{apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Xs(()=>ea(Bl(ea(e,t)),e))}}Zy.className="swish",ua(Zy);class eb extends zy{apply(e){return Xs(()=>ea(e,Ql(ql(e))))}}function tb(e){return e.getClassName()}function nb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ef(e,ca.getMap().classNameMap,t,"activation")}function ib(e){if(null==e){const e={className:"linear",config:{}};return nb(e)}if("string"===typeof e){const t={};return t.className=e,t.config={},nb(t)}return e instanceof zy?e:nb(e)}function rb(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}eb.className="mish",ua(eb);class sb extends la{}class ab extends sb{constructor(e){super(),rb(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return Xs(()=>{let t=kl([1]);return this.hasL1&&(t=$s(t,il(ea(this.l1,ba(e))))),this.hasL2&&(t=$s(t,il(ea(this.l2,_g(e))))),_o(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}ab.className="L1L2",ua(ab);const ob={l1l2:"L1L2"};function lb(e){return Cf(e)}function cb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ef(e,ca.getMap().classNameMap,t,"regularizer")}function ub(e){if(null==e)return null;if("string"===typeof e){return cb({className:e in ob?ob[e]:e,config:{}})}return e instanceof sb?e:cb(e)}class hb extends om{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=Yg(e);let n=Pl(e);return null!=this.maxValue&&(n=Eo(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}hb.className="ReLU",ua(hb);class db extends om{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=Yg(e);return Zo(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}db.className="LeakyReLU",ua(db);class pb extends om{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=qg(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=ub(e.alphaRegularizer),this.alphaConstraint=Cm(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new ff("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=Qg(e)).slice(1);if(null!=this.sharedAxes)for(const i of this.sharedAxes)t[i-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let i=1;i<e.length;++i)n[i]=e[i];this.inputSpec=[new nm({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=Yg(e),El(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Gg(this.alphaInitializer),alphaRegularizer:lb(this.alphaRegularizer),alphaConstraint:km(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}pb.className="PReLU",ua(pb);class fb extends om{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new gf("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=Yg(e);return Wo(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}fb.className="ELU",ua(fb);class gb extends om{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=Yg(e);return ea(n,js($o(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}gb.className="ThresholdedReLU",ua(gb);class mb extends om{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new $y).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){const n=Yg(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function yb(e,t,n){if("number"===typeof e)return bf(e,t);if(e.length!==t)throw new ff("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(let i=0;i<t;++i){const r=e[i];if(!ng(r))throw new ff("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(r))}return e}function bb(e,t,n,i){if(null==e)return e;let r;return r="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((r+i-1)/i)}function vb(e,t,n,i){if(null==e)return null;if("valid"===i)e=e*t+sg([n-t,0]);else{if("same"!==i)throw new ff("Unsupport padding mode: ".concat(i,"."));e*=t}return e}function _b(e,t){return Xs(()=>(Xf(t),"channelsFirst"===t?rc(e,[0,2,3,1]):e))}function xb(e,t){return Xs(()=>(Xf(t),"channelsFirst"===t?rc(e,[0,2,3,4,1]):e))}function wb(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Xs(()=>{if(null==s&&(s="channelsLast"),Xf(s),3!==e.shape.length)throw new ff("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new ff("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new ff("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===s&&(e=rc(e,[0,2,1])),"causal"===r)throw new gf("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=Po(e,t,i,"same"===r?"same":"valid","NWC",a);return null!=n&&(o=wg(o,n)),o})}function Tb(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Xs(()=>{if(null==s&&(s="channelsLast"),Xf(s),3!==e.rank&&4!==e.rank)throw new ff("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new ff("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));let l=_b(e,s);if("causal"===r)throw new gf("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=yc({x:l,filter:t,strides:i,pad:"same"===r?"same":"valid",dilations:a,dataFormat:"NHWC",bias:n,activation:o}),"channelsFirst"===s&&(l=rc(l,[0,3,1,2])),l})}function kb(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;return Xs(()=>{if(null==s&&(s="channelsLast"),Xf(s),4!==e.rank&&5!==e.rank)throw new ff("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new ff("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));let o=xb(e,s);if("causal"===r)throw new gf("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=Uo(o,t,i,"same"===r?"same":"valid","NDHWC",a),null!=n&&(o=wg(o,n)),"channelsFirst"===s&&(o=rc(o,[0,4,1,2,3])),o})}mb.className="Softmax",ua(mb);class Sb extends om{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Sb.verifyArgs(t),this.rank=e,Lf(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new gf("Convolution layer for rank other than 1, 2, or 3 (".concat(this.rank,") is ")+"not implemented yet.");if(this.kernelSize=yb(t.kernelSize,e,"kernelSize"),this.strides=yb(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,Kf(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Xf(this.dataFormat),this.activation=ib(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=qg(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Cm(t.biasConstraint),this.biasRegularizer=ub(t.biasRegularizer),this.activityRegularizer=ub(t.activityRegularizer),this.dilationRate=yb(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new ff("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(this.dilationRate)));if(2===this.rank){if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new ff("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}else if(3===this.rank)if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new ff("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}static verifyArgs(e){if(vf("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!Of(e.kernelSize,"number",1,3))throw new ff("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:tb(this.activation),useBias:this.useBias,biasInitializer:Gg(this.biasInitializer),biasRegularizer:lb(this.biasRegularizer),activityRegularizer:lb(this.activityRegularizer),biasConstraint:km(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Cb extends Sb{constructor(e,t){super(e,t),this.kernel=null,Cb.verifyArgs(t),this.filters=t.filters,Lf(this.filters,"filters"),this.kernelInitializer=qg(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Cm(t.kernelConstraint),this.kernelRegularizer=ub(t.kernelRegularizer)}build(e){e=Qg(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new ff("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));const n=e[t],i=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return Xs(()=>{let t;e=Yg(e);const n=null==this.bias?null:this.bias.read(),i=Ff(this.activation.getClassName());if(null!=i&&2===this.rank)t=Tb(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(1===this.rank)t=wb(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=Tb(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new gf("convolutions greater than 3D are not implemented yet.");t=kb(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t})}computeOutputShape(e){e=Qg(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let r=0;r<n.length;++r){const e=bb(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(e)}let i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t),i.push(this.filters)):(i.push(this.filters),i=i.concat(t)),i}getConfig(){const e={filters:this.filters,kernelInitializer:Gg(this.kernelInitializer),kernelRegularizer:lb(this.kernelRegularizer),kernelConstraint:km(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new ff("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}class Ib extends Cb{constructor(e){super(2,e),Ib.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!Of(e.kernelSize,"number",1,2))throw new ff("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}Ib.className="Conv2D",ua(Ib);class Eb extends Cb{constructor(e){super(3,e),Eb.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new ff("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}Eb.className="Conv3D",ua(Eb);class Nb extends Ib{constructor(e){if(super(e),this.inputSpec=[new nm({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new ff("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(4!==(e=Qg(e)).length)throw new ff("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new ff("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new nm({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return Xs(()=>{let t=Yg(e);if(4!==t.shape.length)throw new ff("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,i=n[0];let r,s;"channelsFirst"===this.dataFormat?(r=2,s=3):(r=1,s=2);const a=n[r],o=n[s],l=this.kernelSize[0],c=this.kernelSize[1],u=this.strides[0],h=this.strides[1],d=[i,vb(a,u,l,this.padding),vb(o,h,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=rc(t,[0,2,3,1]));let p=Mo(t,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=rc(p,[0,3,1,2])),null!=this.bias&&(p=wg(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p})}computeOutputShape(e){const t=(e=Qg(e)).slice();let n,i,r;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3):(n=3,i=1,r=2);const s=this.kernelSize[0],a=this.kernelSize[1],o=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[i]=vb(t[i],o,s,this.padding),t[r]=vb(t[r],l,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Nb.className="Conv2DTranspose",ua(Nb);class Ab extends Eb{constructor(e){if(super(e),this.inputSpec=[new nm({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new ff("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(5!==(e=Qg(e)).length)throw new ff("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new ff("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new nm({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return Xs(()=>{let t=Yg(e);if(5!==t.shape.length)throw new ff("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,i=n[0];let r,s,a;"channelsFirst"===this.dataFormat?(a=2,r=3,s=4):(a=1,r=2,s=3);const o=n[a],l=n[r],c=n[s],u=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],f=this.strides[1],g=this.strides[2],m=[i,vb(o,p,u,this.padding),vb(l,f,h,this.padding),vb(c,g,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=rc(t,[0,2,3,4,1]));let y=zo(t,this.kernel.read(),m,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=rc(y,[0,4,1,2,3])),null!==this.bias&&(y=wg(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y})}computeOutputShape(e){const t=(e=Qg(e)).slice();let n,i,r,s;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3,s=4):(n=4,i=1,r=2,s=3);const a=this.kernelSize[0],o=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],u=this.strides[1],h=this.strides[2];return t[n]=this.filters,t[i]=vb(t[i],c,a,this.padding),t[r]=vb(t[r],u,o,this.padding),t[s]=vb(t[s],h,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Ab.className="Conv3DTranspose",ua(Ab);class Rb extends Cb{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new ff("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new ff("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new ff("SeparableConv".concat(this.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(t.padding)));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=qg(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=ub(t.depthwiseRegularizer),this.depthwiseConstraint=Cm(t.depthwiseConstraint),this.pointwiseInitializer=qg(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=ub(t.pointwiseRegularizer),this.pointwiseConstraint=Cm(t.pointwiseConstraint)}build(e){if((e=Qg(e)).length<this.rank+2)throw new ff("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new ff("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));const n=e[t],i=this.kernelSize.concat([n,this.depthMultiplier]),r=[];for(let a=0;a<this.rank;++a)r.push(1);r.push(n*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new nm({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return Xs(()=>{let t;if(e=Yg(e),1===this.rank)throw new gf("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=rc(e,[0,2,3,1])),t=Ul(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=wg(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=rc(t,[0,3,1,2])),t})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Gg(this.depthwiseInitializer),e.pointwiseInitializer=Gg(this.pointwiseInitializer),e.depthwiseRegularizer=lb(this.depthwiseRegularizer),e.pointwiseRegularizer=lb(this.pointwiseRegularizer),e.depthwiseConstraint=km(this.depthwiseConstraint),e.pointwiseConstraint=km(this.pointwiseConstraint),e}}Rb.className="SeparableConv";class Db extends Rb{constructor(e){super(2,e)}}Db.className="SeparableConv2D",ua(Db);class Ob extends Cb{constructor(e){super(1,e),Ob.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!Of(e.kernelSize,"number",1,1))throw new ff("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}Ob.className="Conv1D",ua(Ob);class Lb extends om{constructor(e){super(e),"number"===typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return Xs(()=>{if(e=Yg(e),"channelsLast"===this.dataFormat){const t=pg(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return pg(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=pg(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return pg(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Lb.className="Cropping2D",ua(Lb);class Pb extends om{constructor(e){var t;super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Xf(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,t=this.interpolation,Df(jf,"InterpolationFormat",t)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return Xs(()=>{let t=Yg(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=rc(t,[0,2,3,1]);const e=this.size[0]*n[2],i=this.size[1]*n[3],r="nearest"===this.interpolation?au.resizeNearestNeighbor(t,[e,i]):au.resizeBilinear(t,[e,i]);return rc(r,[0,3,1,2])}{const e=this.size[0]*n[1],i=this.size[1]*n[2];return"nearest"===this.interpolation?au.resizeNearestNeighbor(t,[e,i]):au.resizeBilinear(t,[e,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}Pb.className="UpSampling2D",ua(Pb);class Fb extends Sb{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=qg(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Cm(e.depthwiseConstraint),this.depthwiseRegularizer=ub(e.depthwiseRegularizer)}build(e){if((e=Qg(e)).length<4)throw new ff("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new ff("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));const n=e[t],i=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Xs(()=>{let t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;return Xs(()=>{null==r&&(r="channelsLast"),Xf(r);let a=_b(e,r);if(4!==e.rank)throw new ff("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new ff("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return a=jo(a,t,n,"same"===i?"same":"valid","NHWC",s),"channelsFirst"===r&&(a=rc(a,[0,3,1,2])),a})}(e=Yg(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=wg(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t})}computeOutputShape(e){e=Qg(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],i="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=bb(t,this.kernelSize[0],this.padding,this.strides[0]),s=bb(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],i,r,s]:[e[0],r,s,i]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Gg(this.depthwiseInitializer),e.depthwiseRegularizer=lb(this.depthwiseRegularizer),e.depthwiseConstraint=km(this.depthwiseRegularizer),e}}function Mb(e,t,n,i){if(Array.isArray(e)){if(null!=t||null!=n)throw new ff("When inputs is an array, neither initialState or constants should be provided");null!=i&&(n=e.slice(e.length-i,e.length),e=e.slice(0,e.length-i)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function r(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=r(t),constants:n=r(n)}}function Ub(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return Xs(()=>{const l=t.shape.length;if(l<3)throw new ff("Input should be at least 3D, but is ".concat(l,"D."));const c=[1,0].concat(ag(2,l));if(t=rc(t,c),null!=s)throw new gf("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=r&&(r=js(js(r,"bool"),"float32"),r.rank===l-1&&(r=qo(r,-1)),r=rc(r,c)),i&&(t=Fl(t,0),null!=r&&(r=Fl(r,0)));const u=[];let h,d=n;const p=t.shape[0],f=ec(t);let g,m;null!=r&&(g=ec(r));for(let t=0;t<p;++t){const n=f[t],i=Xs(()=>e(n,d));if(null==r)h=i[0],d=i[1];else{const e=Xs(()=>{const e=g[t],n=ma(Cl(e),e),r=$s(ea(i[0],e),ea(d[0],n)),s=d.map((t,r)=>$s(ea(i[1][r],e),ea(t,n)));return{output:r,newStates:s}});h=e.output,d=e.newStates}o&&u.push(h)}if(o){m=Yl(u,1)}return[h,m,d]})}Fb.className="DepthwiseConv2D",ua(Fb);class Bb extends om{constructor(e){let t;if(super(e),null==e.cell)throw new ff("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new Xb({cells:e.cell}):e.cell,null==t.stateSize)throw new ff("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new nm({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return ag(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(e=>null)}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Xg(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let i;if(i=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const i of t)n.push([e[0],i]);return[i].concat(n)}return i}computeMask(e,t){return Xs(()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map(e=>null);return[e].concat(t)}return e})}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new gf("Constants support is not implemented in RNN yet.");Xg(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new nm({shape:[t,null,...n]});const i=[e[0]].concat(e.slice(2));let r;if(this.cell.build(i),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!z(this.stateSpec.map(e=>e.shape[e.shape.length-1]),r))throw new ff("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map(e=>new nm({shape:[null,e]}));this.stateful&&this.resetStates()}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Xs(()=>{if(!this.stateful)throw new df("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new ff("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>kl([n,e])):this.states_=[kl([n,this.cell.stateSize])];else if(null==e)Ks(this.states_),null!=this.keptStates&&(Ks(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>kl([n,e])):this.states_[0]=kl([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ff("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===t?this.keptStates.push(this.states_.slice()):Ks(this.states_);for(let t=0;t<this.states_.length;++t){const i=e[t],r=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,s=[n,r];if(!z(i.shape,s))throw new ff("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(s,", received shape=").concat(i.shape));this.states_[t]=i}}this.states_=this.states_.map(e=>Ys(e.clone()))})}apply(e,t){let n=null==t?null:t.initialState,i=null==t?null:t.constants;null==t&&(t={});const r=Mb(e,n,i,this.numConstants);e=r.inputs,n=r.initialState,i=r.constants;let s=[],a=[];if(null!=n){t.initialState=n,s=s.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new nm({shape:e.shape}));a=a.concat(this.stateSpec)}null!=i&&(t.constants=i,s=s.concat(i),this.numConstants=i.length);if(s[0]instanceof im){const n=[e].concat(s),i=this.inputSpec.concat(a),r=this.inputSpec;this.inputSpec=i;const o=super.apply(n,t);return this.inputSpec=r,o}return super.apply(e,t)}call(e,t){return Xs(()=>{const n=null==t?null:t.mask,i=null==t?null:t.training;let r=null==t?null:t.initialState;e=Yg(e),null==r&&(r=this.stateful?this.states_:this.getInitialState(e));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==s)throw new ff("RNN Layer has ".concat(s," state(s) but was passed ")+"".concat(r.length," initial state(s)."));this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},o=Ub((e,t)=>{const n=this.cell.call([e].concat(t),a);return[n[0],n.slice(1)]},e,r,this.goBackwards,n,null,this.unroll,this.returnSequences),l=o[0],c=o[1],u=o[2];this.stateful&&this.resetStates(u,i);const h=this.returnSequences?c:l;return this.returnState?[h].concat(u):h})}getInitialState(e){return Xs(()=>{let t=kl(e.shape);return t=il(t,[1,2]),t=ug(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>e>1?mg(t,[1,e]):t):this.cell.stateSize>1?[mg(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===Bb.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=Um(t.cell,n);return new e(Object.assign(t,{cell:i}))}}Bb.className="RNN",ua(Bb);class zb extends om{}class Vb extends zb{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Lf(this.units,"units"),this.activation=ib(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=qg(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=qg(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=qg(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=ub(e.kernelRegularizer),this.recurrentRegularizer=ub(e.recurrentRegularizer),this.biasRegularizer=ub(e.biasRegularizer),this.kernelConstraint=Cm(e.kernelConstraint),this.recurrentConstraint=Cm(e.recurrentConstraint),this.biasConstraint=Cm(e.biasConstraint),this.dropout=rg([1,sg([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=rg([1,sg([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qg(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Xs(()=>{if(2!==e.length)throw new ff("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));let n=e[1];e=e[0];const i=null!=t.training&&t.training;let r;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Kb({ones:()=>Cl(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Kb({ones:()=>Cl(n),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,a=this.recurrentDropoutMask;r=bg(null!=s?ea(e,s):e,this.kernel.read()),null!=this.bias&&(r=wg(r,this.bias.read())),null!=a&&(n=ea(n,a));let o=$s(r,bg(n,this.recurrentKernel.read()));return null!=this.activation&&(o=this.activation.apply(o)),[o,o]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:tb(this.activation),useBias:this.useBias,kernelInitializer:Gg(this.kernelInitializer),recurrentInitializer:Gg(this.recurrentInitializer),biasInitializer:Gg(this.biasInitializer),kernelRegularizer:lb(this.kernelRegularizer),recurrentRegularizer:lb(this.recurrentRegularizer),biasRegularizer:lb(this.biasRegularizer),activityRegularizer:lb(this.activityRegularizer),kernelConstraint:km(this.kernelConstraint),recurrentConstraint:km(this.recurrentConstraint),biasConstraint:km(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Vb.className="SimpleRNNCell",ua(Vb);class jb extends Bb{constructor(e){e.cell=new Vb(e),super(e)}call(e,t){return Xs(()=>{null!=this.cell.dropoutMask&&(Ks(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ks(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,r=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:r})})}static fromConfig(e,t){return new e(t)}}jb.className="SimpleRNN",ua(jb);class Wb extends zb{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ff("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Lf(this.units,"units"),this.activation=ib(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ib(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=qg(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=qg(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=qg(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=ub(e.kernelRegularizer),this.recurrentRegularizer=ub(e.recurrentRegularizer),this.biasRegularizer=ub(e.biasRegularizer),this.kernelConstraint=Cm(e.kernelConstraint),this.recurrentConstraint=Cm(e.recurrentConstraint),this.biasConstraint=Cm(e.biasConstraint),this.dropout=rg([1,sg([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=rg([1,sg([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=Qg(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Xs(()=>{if(2!==e.length)throw new ff("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=null!=t.training&&t.training;let i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Kb({ones:()=>Cl(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Kb({ones:()=>Cl(i),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,s=this.recurrentDropoutMask;let a,o,l;0<this.dropout&&this.dropout<1&&(e=ea(e,r[0]));let c=bg(e,this.kernel.read());this.useBias&&(c=wg(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=ea(i,s[0]));const u=this.recurrentKernel.read(),[h,d]=Xl(u,[2*this.units,this.units],u.rank-1),p=bg(i,h),[f,g,m]=Xl(c,3,c.rank-1),[y,b]=Xl(p,2,p.rank-1);a=this.recurrentActivation.apply($s(f,y)),o=this.recurrentActivation.apply($s(g,b));const v=bg(ea(o,i),d);l=this.activation.apply($s(m,v));const _=$s(ea(a,i),ea($s(1,xl(a)),l));return[_,_]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:tb(this.activation),recurrentActivation:tb(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Gg(this.kernelInitializer),recurrentInitializer:Gg(this.recurrentInitializer),biasInitializer:Gg(this.biasInitializer),kernelRegularizer:lb(this.kernelRegularizer),recurrentRegularizer:lb(this.recurrentRegularizer),biasRegularizer:lb(this.biasRegularizer),activityRegularizer:lb(this.activityRegularizer),kernelConstraint:km(this.kernelConstraint),recurrentConstraint:km(this.recurrentConstraint),biasConstraint:km(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Wb.className="GRUCell",ua(Wb);class Hb extends Bb{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Wb(e),super(e)}call(e,t){return Xs(()=>{null!=this.cell.dropoutMask&&(Ks(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ks(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,r=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:r})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}Hb.className="GRU",ua(Hb);class Gb extends zb{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Lf(this.units,"units"),this.activation=ib(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ib(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=qg(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=qg(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=qg(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=ub(e.kernelRegularizer),this.recurrentRegularizer=ub(e.recurrentRegularizer),this.biasRegularizer=ub(e.biasRegularizer),this.kernelConstraint=Cm(e.kernelConstraint),this.recurrentConstraint=Cm(e.recurrentConstraint),this.biasConstraint=Cm(e.biasConstraint),this.dropout=rg([1,sg([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=rg([1,sg([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=Qg(e))[e.length-1];let i;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;i=new((t=class extends Ig{apply(t,i){const r=e.apply([n]),s=(new Ng).apply([n]),a=e.apply([2*n]);return gg(gg(r,s),a)}}).className="CustomInit",t)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return Xs(()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new ff("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));let i=e[1];const r=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Kb({ones:()=>Cl(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Kb({ones:()=>Cl(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,a=this.recurrentDropoutMask;let o,l,c,u;0<this.dropout&&this.dropout<1&&(e=ea(e,s[0]));let h=bg(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=ea(i,a[0])),h=$s(h,bg(i,this.recurrentKernel.read())),this.useBias&&(h=wg(h,this.bias.read()));const[d,p,f,g]=Xl(h,4,h.rank-1);o=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),c=$s(ea(l,r),ea(o,this.activation.apply(f))),u=this.recurrentActivation.apply(g);const m=ea(u,this.activation.apply(c));return[m,m,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:tb(this.activation),recurrentActivation:tb(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Gg(this.kernelInitializer),recurrentInitializer:Gg(this.recurrentInitializer),biasInitializer:Gg(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:lb(this.kernelRegularizer),recurrentRegularizer:lb(this.recurrentRegularizer),biasRegularizer:lb(this.biasRegularizer),activityRegularizer:lb(this.activityRegularizer),kernelConstraint:km(this.kernelConstraint),recurrentConstraint:km(this.recurrentConstraint),biasConstraint:km(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Gb.className="LSTMCell",ua(Gb);class qb extends Bb{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Gb(e),super(e)}call(e,t){return Xs(()=>{null!=this.cell.dropoutMask&&(Ks(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ks(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,r=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:r})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}qb.className="LSTM",ua(qb);class Xb extends zb{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return Xs(()=>{let n=e.slice(1);const i=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?i.push(n.splice(0,e.stateSize.length)):i.push(n.splice(0,1));i.reverse();const r=[];let s;for(let a=0;a<this.cells.length;++a){const o=this.cells[a];n=i[a],s=0===a?[e[0]].concat(n):[s[0]].concat(n),s=o.call(s,t),r.push(s.slice(1))}n=[];for(const e of r.slice().reverse())n.push(...e);return[s[0]].concat(n)})}build(e){let t;Xg(e)&&(e=e[0]),this.cells.forEach((n,i)=>{$f("RNNCell_".concat(i),()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map(e=>({className:e.getClassName(),config:e.getConfig()}))};return Object.assign(Object.assign({},e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=[];for(const r of t.cells)i.push(Um(r,n));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return em(e)}setWeights(e){const t=[];for(const n of this.cells){const i=n.weights.length,r=e.splice(i);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],r[e]])}tm(t)}}function Kb(e){const{ones:t,rate:n,training:i=!1,count:r=1,dropoutFunc:s}=e,a=()=>null!=s?s(t(),n):Tg(t(),n),o=()=>kg(a,t,i);if(!r||r<=1)return Ys(o().clone());return Array(r).fill(void 0).map(o).map(e=>Ys(e.clone()))}Xb.className="StackedRNNCells",ua(Xb);var Yb=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class Qb extends Bb{constructor(e){if(e.unroll)throw new gf("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new gf("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new nm({ndim:5})]}call(e,t){return Xs(()=>{if(null!=this.cell.dropoutMask&&(Ks(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ks(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new ff("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,i=null==t?null:t.training,r=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:r})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return Xs(()=>{const{stateSize:t}=this.cell,n=e.shape,i=this.computeSingleOutputShape(n),r=kl([i[0],...i.slice(2)]);return Array.isArray(t)?Array(t.length).fill(r):[r]})}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Xs(()=>{if(!this.stateful)throw new df("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,i=this.computeSingleOutputShape(n),r=[i[0],...i.slice(2)];if(null==n[0])throw new ff("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>kl(r)):this.states_=[kl(r)];else if(null==e)Ks(this.states_),null!=this.keptStates&&(Ks(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>kl(r)):this.states_[0]=kl(r);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ff("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));t?this.keptStates.push(this.states_.slice()):Ks(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],i=r;if(!z(n.shape,i))throw new ff("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(i,", received shape=").concat(n.shape));this.states_[t]=n}}this.states_=this.states_.map(e=>Ys(e.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:i,padding:r,strides:s,dilationRate:a}=this.cell,o="channelsFirst"===t,l=e[o?3:2],c=e[o?4:3],u=bb(l,i[0],r,s[0],a[0]),h=bb(c,i[1],r,s[1],a[1]);return[...e.slice(0,2),...o?[n,u,h]:[u,h,n]]}}Qb.className="ConvRNN2D";class $b extends Gb{constructor(e){const{filters:t,kernelSize:n,strides:i,padding:r,dataFormat:s,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Lf(this.filters,"filters"),this.kernelSize=yb(n,2,"kernelSize"),this.kernelSize.forEach(e=>Lf(e,"kernelSize")),this.strides=yb(i||1,2,"strides"),this.strides.forEach(e=>Lf(e,"strides")),this.padding=r||"valid",Kf(this.padding),this.dataFormat=s||"channelsLast",Xf(this.dataFormat),this.dilationRate=yb(a||1,2,"dilationRate"),this.dilationRate.forEach(e=>Lf(e,"dilationRate"))}build(e){var t;e=Qg(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new ff("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));const i=e[n],r=this.kernelSize.concat([i,4*this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const s=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",s,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,i=this.filters;e=new((t=class extends Ig{apply(e,t){return fg([n.apply([i]),Sl([i]),n.apply([2*i])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return Xs(()=>{if(3!==e.length)throw new ff("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=t.training||!1,i=e[0],r=e[1],s=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Kb({ones:()=>Cl(i),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,o=(e,t,n)=>t&&t[n]?ea(t[n],e):e;let l=o(i,a,0),c=o(i,a,1),u=o(i,a,2),h=o(i,a,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Kb({ones:()=>Cl(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let p=o(r,d,0),f=o(r,d,1),g=o(r,d,2),m=o(r,d,3);const[y,b,v,_]=Xl(this.kernel.read(),4,3),[x,w,T,k]=this.useBias?Xl(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,y,x,this.padding),c=this.inputConv(c,b,w,this.padding),u=this.inputConv(u,v,T,this.padding),h=this.inputConv(h,_,k,this.padding);const[S,C,I,E]=Xl(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,S),f=this.recurrentConv(f,C),g=this.recurrentConv(g,I),m=this.recurrentConv(m,E);const N=this.recurrentActivation.apply($s(l,p)),A=this.recurrentActivation.apply($s(c,f)),R=$s(ea(A,s),ea(N,this.activation.apply($s(u,g)))),D=ea(this.recurrentActivation.apply($s(h,m)),this.activation.apply(R));return[D,D,R]})}getConfig(){const e=super.getConfig(),{units:t}=e,n=Yb(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),i)}inputConv(e,t,n,i){const r=Lo(e,t,this.strides,i||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?wg(r,n,this.dataFormat):r}recurrentConv(e,t){return Lo(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}$b.className="ConvLSTM2DCell",ua($b);class Jb extends Qb{constructor(e){const t=new $b(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}Jb.className="ConvLSTM2D",ua(Jb);class Zb extends om{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let i=0;i<this.noiseShape.length;++i)n.push(null==this.noiseShape[i]?t[i]:this.noiseShape[i]);return n}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);const n=Yg(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,i=this.getNoiseShape(n);return kg(()=>Tg(n,this.rate,i,this.seed),()=>n,e)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Zb.className="Dropout",ua(Zb);class ev extends Zb{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}ev.className="SpatialDropout1D",ua(ev);class tv extends om{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Lf(this.units,"units"),this.activation=ib(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=qg(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=qg(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Cm(e.kernelConstraint),this.biasConstraint=Cm(e.biasConstraint),this.kernelRegularizer=ub(e.kernelRegularizer),this.biasRegularizer=ub(e.biasRegularizer),this.activityRegularizer=ub(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=Qg(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=Qg(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);const n=Yg(e),i=Ff(this.activation.getClassName());let r;return null!=i?r=bg(n,this.kernel.read(),i,this.bias?this.bias.read():null):(r=bg(n,this.kernel.read()),null!=this.bias&&(r=wg(r,this.bias.read())),null!=this.activation&&(r=this.activation.apply(r))),r})}getConfig(){const e={units:this.units,activation:tb(this.activation),useBias:this.useBias,kernelInitializer:Gg(this.kernelInitializer),biasInitializer:Gg(this.biasInitializer),kernelRegularizer:lb(this.kernelRegularizer),biasRegularizer:lb(this.biasRegularizer),activityRegularizer:lb(this.activityRegularizer),kernelConstraint:km(this.kernelConstraint),biasConstraint:km(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}tv.className="Dense",ua(tv);class nv extends om{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Qg(e);for(const t of e.slice(1))if(null==t)throw new ff('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],ig(e,1)]}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);let n=Yg(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=rc(n,e)}return function(e){if(e.rank<=1)throw new ff("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));const t=[e.shape[0],ig(e.shape,1)];return _o(e,t)}(n)})}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}nv.className="Flatten",ua(nv);class iv extends om{constructor(e){super(e),this.supportsMasking=!0,this.activation=ib(e.activation)}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);const n=Yg(e);return this.activation.apply(n)})}getConfig(){const e={activation:tb(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}iv.className="Activation",ua(iv);class rv extends om{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return Xs(()=>function(e,t){return Xs(()=>{if(2!==e.shape.length)throw new ff("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return mg(ug(e,1),[1,t,1])})}(e=Yg(e),this.n))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}rv.className="RepeatVector",ua(rv);class sv extends om{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",i=t.slice();let r=1,s=null;for(let o=0;o<i.length;++o){const e=i[o];if(this.isUnknown(e)){if(null!==s)throw new ff("Can only specifiy one unknown dimension.");s=o}else r*=e}const a=ig(e);if(null!==s){if(0===r||a%r!==0)throw new ff(n);i[s]=a/r}else if(a!==r)throw new ff(n);return i}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);const n=Yg(e),i=n.shape,r=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return _o(n,r)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}sv.className="Reshape",ua(sv);class av extends om{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));const t=ag(1,e.dims.length+1);if(!z(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new nm({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=Qg(e)).slice();return this.dims.forEach((n,i)=>{t[i+1]=e[n]}),t}call(e,t){return rc(Yg(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}av.className="Permute",ua(av);class ov extends om{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=Yg(e);return no(wl(n,this.maskValue),-1)}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);const n=Yg(e),i=no(wl(n,this.maskValue),-1,!0);return ea(n,js(i,n.dtype))})}}ov.className="Masking",ua(ov);class lv extends om{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(wf(e.inputLength))}this.inputDim=e.inputDim,Lf(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Lf(this.outputDim,"outputDim"),this.embeddingsInitializer=qg(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=ub(e.embeddingsRegularizer),this.activityRegularizer=ub(e.activityRegularizer),this.embeddingsConstraint=Cm(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return Xs(()=>this.maskZero?(e=Yg(e),wl(e,ia(e))):null)}computeOutputShape(e){if(e=Qg(e),null==this.inputLength)return[...e,this.outputDim];const t=wf(this.inputLength);if(t.length!==e.length-1)throw new ff('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));{let n=0;for(let i=0;i<t.length;++i){const r=t[i],s=e[i+1];if(null!=r&&null!=s&&r!==s)throw new ff('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==r&&(t[n]=s),n++}}return[e[0],...t,this.outputDim]}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);let n=Yg(e);"int32"!==n.dtype&&(n=cg(n,"int32"));const i=vg(this.embeddings.read(),_o(n,[n.size]));return _o(i,Qg(this.computeOutputShape(n.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Gg(this.embeddingsInitializer),embeddingsRegularizer:lb(this.embeddingsRegularizer),activityRegularizer:lb(this.activityRegularizer),embeddingsConstraint:km(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}lv.className="Embedding",ua(lv);class cv extends om{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new gf}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let i=0;i<t.length;++i){const r=e[e.length-t.length+i],s=t[i];if(null==r||null==s||r<0||s<0)n.push(null);else if(1===r)n.push(s);else if(1===s)n.push(r);else{if(r!==s)throw new ff("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(r)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Qg(e)]),e.length<2)throw new ff("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));let t=[];for(const r of e)null!=r&&null!==r[0]&&t.push(r[0]);if(t=Af(t),t.length>1)throw new ff("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));let n=null==e[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const t=null==e[r]?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const i=e.map(e=>e.length);-1===e.indexOf(null)&&1===Af(i).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return Xs(()=>{if(this.reshapeRequired){const t=[],n=e.map(e=>e.rank);if(-1===n.indexOf(null)){const i=sg(n);for(let n of e){const e=n.rank;for(let t=0;t<i-e;++t)n=ug(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const s of e){const e=s.rank;if(null==e){const e=s.shape,i=e[0],r=e.slice(1).concat([i]);let a=_o(s,[i].concat(ig(e.slice(1))));a=rc(a,[1,0]),a=_o(a,r),t.push(a),n=!0}else if(e>1){const i=ag(1,e).concat([0]);t.push(rc(s,i)),n=!0}else t.push(s)}let i=this.mergeFunction(t);const r=i.rank;if(n)if(null==r){const e=i.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));i=_o(rc(_o(i,[-1,t]),[1,0]),n)}else if(r>1){const e=[r-1].concat(ag(0,r-1));i=rc(i,e)}return i}}return this.mergeFunction(e)})}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let i=1;i<e.length;++i){const n=null==e[i]?null:e[i].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const i of e)null!=i&&null!==i[0]&&n.push(i[0]);return n=Af(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return Xs(()=>{if(null==t)return null;if(!Array.isArray(t))throw new ff("`mask` should be an Array");if(!Array.isArray(e))throw new ff("`inputs` should be an Array");if(t.length!==e.length)throw new ff("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every(e=>null==e))return null;t=t.map(e=>null==e?e:qo(e,0));let n=t[0];for(let e=1;e<t.length-1;++e)n=sl(n,t[e]);return n})}}class uv extends cv{constructor(e){super(e)}mergeFunction(e){return Xs(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=$s(t,e[n]);return t})}}uv.className="Add",ua(uv);class hv extends cv{constructor(e){super(e)}mergeFunction(e){return Xs(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=ea(t,e[n]);return t})}}hv.className="Multiply",ua(hv);class dv extends cv{constructor(e){super(e)}mergeFunction(e){return Xs(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=$s(t,e[n]);return ea(1/e.length,t)})}}dv.className="Average",ua(dv);class pv extends cv{constructor(e){super(e)}mergeFunction(e){return Xs(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=wa(t,e[n]);return t})}}pv.className="Maximum",ua(pv);class fv extends cv{constructor(e){super(e)}mergeFunction(e){return Xs(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=hl(t,e[n]);return t})}}fv.className="Minimum",ua(fv);class gv extends cv{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new ff("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const i of e)if(null!=i){t=!1;break}if(t)return;const n=[];for(let i=0;i<e.length;++i){const t=e[i].slice();t.splice(this.axis,1);let r=!1;for(const e of n)if(z(e,t)){r=!0;break}r||n.push(t)}if(n.length>1)throw new ff("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Xs(()=>fg(e,this.axis))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new ff("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),i=this.axis<0?n.length+this.axis:this.axis;for(const r of t.slice(1)){if(null==n[i]||null==r[i]){n[i]=null;break}n[i]+=r[i]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new ff("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ff("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new ff("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return Xs(()=>{let n=!0;if(t.forEach(e=>{null==e||(n=!1)}),n)return null;const i=[];for(let s=0;s<e.length;++s)null==t[s]?i.push(js(Cl(e[s]),"bool")):t[s].rank<e[s].rank?i.push(qo(t[s],-1)):i.push(t[s]);const r=No(i,this.axis);return to(r,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function mv(e,t){for(;e<0;)e+=t;return e}gv.className="Concatenate",ua(gv);class yv extends cv{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){F(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new gf("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,n);if(t[i[0]]!==n[i[1]])throw new ff("Dimension incompatibility: "+"".concat(t[i[0]]," !== ").concat(n[i[1]]))}mergeFunction(e){if(2!==e.length)throw new ff("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));let t,n=e[0],i=e[1];return t=Array.isArray(this.axes)?this.axes.map((t,n)=>mv(t,e[n].shape.length)):[mv(this.axes,n.shape.length),mv(this.axes,i.shape.length)],this.normalize&&(n=Bm(n,t[0]),i=Bm(i,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new gf("batchDot is not implemented for tensors of 4D or higher rank yet");if(F(e.shape.length>=2,()=>"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)),F(e.shape.length>=2,()=>"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new gf("batchDot is not implemented for complex64-type Tensors yet.");const i=e.shape.length,r=t.shape.length;null==n&&(n=[i-1,r-2]);const s=n;return Xs(()=>{let n,a;if(i>r){n=i-r;const e=[];for(let t=0;t<n;++t)e.push(1);t=_o(t,t.shape.concat(e))}else if(r>i){n=r-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=_o(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)a=s[0]===s[1]?il(ea(e,t),s[0]):il(ea(rc(e,[1,0]),t),s[1]);else{const n=s[0]!==e.shape.length-1,i=s[1]===t.shape.length-1;a=al(e,t,n,i)}if(n>0){let e;e=i>r?i+r-3:i-1;const t=[];for(let i=e;i<e+n;++i)t.push(i);a=Kl(a,t)}return 1===a.shape.length&&(a=qo(a,1)),a})}(n,i,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[mv(this.axes,e.length),mv(this.axes,t.length)],n}computeOutputShape(e){F(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new gf("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,n);t.splice(i[0],1),n.splice(i[1],1),n.splice(0,1);const r=t.concat(n);return 1===r.length&&r.push(1),r}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}yv.className="Dot",ua(yv);class bv extends om{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);const n=Yg(e);return kg(()=>$s(yg(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}}bv.className="GaussianNoise",ua(bv);class vv extends om{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Xs(()=>{this.invokeCallHook(e,t);const n=Yg(e);if(this.rate>0&&this.rate<1){return kg(()=>{const e=Math.sqrt(this.rate/(1-this.rate));return ea(n,yg(n.shape,1,e))},()=>n,t.training||!1)}return n})}}vv.className="GaussianDropout",ua(vv);class _v extends om{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Yg(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Xs(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e),i=()=>{const t=Yg(e),i=-1.7580993408473766;let r=Jo(Ol(n),this.rate);r=cg(r,"float32");const s=((1-this.rate)*(1+this.rate*i**2))**-.5,a=-s*i*this.rate,o=$s(ea(t,r),ea($s(r,-1),i));return $s(ea(o,s),a)};return kg(i,()=>Yg(e),t.training||!1)}return e})}}function xv(e,t,n,i,r){let s,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)s=ko(e,t,n,i,r,a);else if(3===e.rank)s=So(e,t,n,i,r,a);else{if(4!==e.rank)throw new gf("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");s=Co(e,t,n,i,r,a)}return s}function wv(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return z(i.slice().sort(),ag(0,e.rank-1))?function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Xs(()=>{const s=_l(e,i),a=s.mean,o=s.variance;return[xv(e,a,o,n,t,r),a,o]})}(e,t,n,i,r):function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Xs(()=>{const s=_l(e,i),a=s.mean,o=s.variance,l=[];for(const t of ag(0,e.rank))-1!==i.indexOf(t)?l.push(1):l.push(e.shape[t]);const c=_o(a,l),u=_o(o,l),h=null==t?null:_o(t,l),d=null==n?null:_o(n,l);return[xv(e,c,u,d,h,r),a,o]})}(e,t,n,i,r)}_v.className="AlphaDropout",ua(_v);class Tv extends om{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=qg(e.betaInitializer||"zeros"),this.gammaInitializer=qg(e.gammaInitializer||"ones"),this.movingMeanInitializer=qg(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=qg(e.movingVarianceInitializer||"ones"),this.betaConstraint=Cm(e.betaConstraint),this.gammaConstraint=Cm(e.gammaConstraint),this.betaRegularizer=ub(e.betaRegularizer),this.gammaRegularizer=ub(e.gammaRegularizer)}build(e){e=Qg(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new ff("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new nm({ndim:e.length,axes:{[t]:n}})];const i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return Xs(()=>{const n=null!=t.training&&t.training,i=Yg(e),r=i.shape,s=r.length,a=ag(0,s),o=this.axis>=0?this.axis:this.axis+s;a.splice(o,1);const l=bf(1,s);l[o]=r[o];const c=a.slice();c.sort();const u=!z(c,ag(0,s).slice(0,s-1));if(!n)return(()=>{if(u){const e=_o(this.movingMean.read(),l),t=_o(this.movingVariance.read(),l),n=this.center?_o(this.beta.read(),l):null,r=this.scale?_o(this.gamma.read(),l):null;return xv(i,e,t,n,r,this.epsilon)}return xv(i,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,p]=wv(i,this.gamma.read(),this.beta.read(),a,this.epsilon),f=(e,t,n)=>{Xs(()=>{const i=1-n,r=e.read(),s=ea(ma(r,t),i);e.write(ma(r,s))})};return(()=>{f(this.movingMean,d,this.momentum),f(this.movingVariance,p,this.momentum)})(),h})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Gg(this.betaInitializer),gammaInitializer:Gg(this.gammaInitializer),movingMeanInitializer:Gg(this.movingMeanInitializer),movingVarianceInitializer:Gg(this.movingVarianceInitializer),betaRegularizer:lb(this.betaRegularizer),gammaRegularizer:lb(this.gammaRegularizer),betaConstraint:km(this.betaConstraint),gammaConstraint:km(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Tv.className="BatchNormalization",ua(Tv);class kv extends om{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"===typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received ".concat(this.axis))}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(this.axis)));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(this.axis)))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=qg(e.betaInitializer||"zeros"),this.gammaInitializer=qg(e.gammaInitializer||"ones"),this.betaRegularizer=ub(e.betaRegularizer),this.gammaRegularizer=ub(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=Qg(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=t);for(const r of this.axis)if(r<0||r>=t)throw new Error("Invalid axis: ".concat(r));if(this.axis.length!==Af(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));const n=this.axis.map(t=>e[t]),i=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,t){const n=Yg(e),i=n.shape,r=i.length;return Xs(()=>{let{mean:e,variance:t}=_l(n,this.axis,!0);const s=bf(1,r);for(const n of this.axis)s[n]=i[n];const a=e=>null!=e&&e.shape.length!==r?_o(e,s):e;let o=this.scale?a(this.gamma.read()):null,l=this.center?a(this.beta.read()):null;const c=[],u=[];for(let n=0;n<r;++n)-1!==this.axis.indexOf(n)?(c.push(i[n]),u.push(1)):(c.push(1),u.push(i[n]));return e=Xo(e,c),t=Xo(t,c),null!=o&&(o=Xo(o,u)),null!=l&&(l=Xo(l,u)),xv(n,e,t,l,o,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Gg(this.betaInitializer),gammaInitializer:Gg(this.gammaInitializer),betaRegularizer:lb(this.betaRegularizer),gammaRegularizer:lb(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}kv.className="LayerNormalization",ua(kv);class Sv extends om{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new ff("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));let t,n;if("number"===typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new ff("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(t=e.padding[0],2!==e.padding[1].length)throw new ff("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new nm({ndim:4})]}computeOutputShape(e){let t,n;return e=Qg(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return Xs(()=>function(e,t,n){return Xs(()=>{if(4!==e.rank)throw new ff("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new ff("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new ff("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");let i;return i="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],Il(e,i)})}(Yg(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function Cv(e,t,n,i,r,s){return Xs(()=>{let a;Xf(r),Yf(s),Kf(i),null==n&&(n=[1,1]),null==i&&(i="valid"),null==r&&(r="channelsLast"),null==s&&(s="max"),e=_b(e,r);const o="same"===i?"same":"valid";return a="max"===s?ol(e,t,n,o):xo(e,t,n,o),"channelsFirst"===r&&(a=rc(a,[0,3,1,2])),a})}function Iv(e,t,n,i,r,s){return Xs(()=>{let a;Xf(r),Yf(s),Kf(i),null==n&&(n=[1,1,1]),null==i&&(i="valid"),null==r&&(r="channelsLast"),null==s&&(s="max"),e=xb(e,r);const o="same"===i?"same":"valid";return a="max"===s?ll(e,t,n,o):wo(e,t,n,o),"channelsFirst"===r&&(a=rc(a,[0,4,1,2,3])),a})}Sv.className="ZeroPadding2D",ua(Sv);class Ev extends om{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"===typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new ff("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));this.poolSize=e.poolSize}if(Lf(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"===typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new ff("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));this.strides=e.strides}Lf(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,Kf(this.padding),this.inputSpec=[new nm({ndim:3})]}computeOutputShape(e){const t=bb((e=Qg(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return Xs(()=>{this.invokeCallHook(e,t),e=ug(Yg(e),2);const n=this.poolingFunction(Yg(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Kl(n,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class Nv extends Ev{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Xf(r),Kf(i),Cv(e,t,n,i,r,"max")}}Nv.className="MaxPooling1D",ua(Nv);class Av extends Ev{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Xf(r),Kf(i),Cv(e,t,n,i,r,"avg")}}Av.className="AveragePooling1D",ua(Av);class Rv extends om{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new ff("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides];Lf(this.poolSize,"poolSize"),Lf(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Xf(this.dataFormat),Kf(this.padding),this.inputSpec=[new nm({ndim:4})]}computeOutputShape(e){e=Qg(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=bb(t,this.poolSize[0],this.padding,this.strides[0]),n=bb(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return Xs(()=>(this.invokeCallHook(e,t),this.poolingFunction(Yg(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Dv extends Rv{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Xf(r),Kf(i),Cv(e,t,n,i,r,"max")}}Dv.className="MaxPooling2D",ua(Dv);class Ov extends Rv{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Xf(r),Kf(i),Cv(e,t,n,i,r,"avg")}}Ov.className="AveragePooling2D",ua(Ov);class Lv extends om{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new ff("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Lf(this.poolSize,"poolSize"),Lf(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Xf(this.dataFormat),Kf(this.padding),this.inputSpec=[new nm({ndim:5})]}computeOutputShape(e){e=Qg(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],i="channelsFirst"===this.dataFormat?e[4]:e[3];return t=bb(t,this.poolSize[0],this.padding,this.strides[0]),n=bb(n,this.poolSize[1],this.padding,this.strides[1]),i=bb(i,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,i]:[e[0],t,n,i,e[4]]}call(e,t){return Xs(()=>(this.invokeCallHook(e,t),this.poolingFunction(Yg(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Pv extends Lv{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Xf(r),Kf(i),Iv(e,t,n,i,r,"max")}}Pv.className="MaxPooling3D",ua(Pv);class Fv extends Lv{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Xf(r),Kf(i),Iv(e,t,n,i,r,"avg")}}Fv.className="AveragePooling3D",ua(Fv);class Mv extends om{constructor(e){super(e),this.inputSpec=[new nm({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new gf}}class Uv extends Mv{constructor(e){super(e||{})}call(e,t){return Xs(()=>{const t=Yg(e);return cl(t,1)})}}Uv.className="GlobalAveragePooling1D",ua(Uv);class Bv extends Mv{constructor(e){super(e||{})}call(e,t){return Xs(()=>{const t=Yg(e);return nl(t,1)})}}Bv.className="GlobalMaxPooling1D",ua(Bv);class zv extends om{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Xf(this.dataFormat),this.inputSpec=[new nm({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new gf}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Vv extends zv{call(e,t){return Xs(()=>{const t=Yg(e);return"channelsLast"===this.dataFormat?cl(t,[1,2]):cl(t,[2,3])})}}Vv.className="GlobalAveragePooling2D",ua(Vv);class jv extends zv{call(e,t){return Xs(()=>{const t=Yg(e);return"channelsLast"===this.dataFormat?nl(t,[1,2]):nl(t,[2,3])})}}jv.className="GlobalMaxPooling2D",ua(jv);class Wv extends om{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=Um(t.layer,n);delete t.layer;const r={layer:i};return Object.assign(r,t),new e(r)}}class Hv extends Wv{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=Qg(e)).length<3)throw new ff("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=Qg(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),i=e[1];return[n[0],i].concat(n.slice(1))}call(e,t){return Xs(()=>Ub((e,n)=>[Yg(this.layer.call(e,t)),[]],e=Yg(e),[],!1,null,null,!1,!0)[1])}}Hv.className="TimeDistributed",ua(Hv);class Gv extends Wv{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=Um(n),t.goBackwards=!0!==t.goBackwards;const i={};var r;if(i.className=e.layer.getClassName(),i.config=t,this.backwardLayer=Um(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,r=this.mergeMode,Df(Gf,"BidirectionalMergeMode",r),e.weights)throw new gf("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,i,r=this.forwardLayer.computeOutputShape(e);return Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),this.returnState?(i=r.slice(1),t=r[0]):t=r[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(i).concat(i.slice()):[t].concat(i).concat(i.slice()):xf(n)}apply(e,t){let n=null==t?null:t.initialState,i=null==t?null:t.constants;null==t&&(t={});const r=Mb(e,n,i,this.numConstants);if(e=r.inputs,n=r.initialState,i=r.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==i)return super.apply(e,t);const s=[],a=[];if(null!=n){const e=n.length;if(e%2>0)throw new ff("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,s.push(...n);const i=n.map(e=>new nm({shape:e.shape}));this.forwardLayer.stateSpec=i.slice(0,e/2),this.backwardLayer.stateSpec=i.slice(e/2),a.push(...i)}if(null!=i)throw new gf("Support for constants in Bidirectional layers is not implemented yet.");const o=s[0]instanceof im;for(const l of s)if(l instanceof im!==o)throw new ff("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){const n=[e].concat(s),i=this.inputSpec.concat(a),r=this.inputSpec;this.inputSpec=i;const o=super.apply(n,t);return this.inputSpec=r,o}return super.apply(e,t)}call(e,t){return Xs(()=>{const n=t.initialState;let i,r,s,a;if(null==n)i=this.forwardLayer.call(e,t),r=this.backwardLayer.call(e,t);else{const s=n.slice(0,n.length/2),a=n.slice(n.length/2);i=this.forwardLayer.call(e,Object.assign(t,{initialState:s})),r=this.backwardLayer.call(e,Object.assign(t,{initialState:a}))}return this.returnState&&(Array.isArray(i)&&(s=i.slice(1).concat(r.slice(1))),i=i[0],r=r[0]),this.returnSequences&&(r=Fl(r,1)),"concat"===this.mergeMode?a=fg([i,r]):"sum"===this.mergeMode?a=$s(i,r):"ave"===this.mergeMode?a=ea(.5,$s(i,r)):"mul"===this.mergeMode?a=ea(i,r):null==this.mergeMode&&(a=[i,r]),this.returnState?null==this.mergeMode?a.concat(s):[a].concat(s):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){$f(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),$f(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map(e=>null);return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=Um(t.layer);if(delete t.layer,null!=t.numConstants)throw new gf("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=t;return i.layer=n,new e(i)}}Gv.className="Bidirectional",ua(Gv);class qv extends om{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Xs(()=>("float32"!==(e=Yg(e)).dtype&&(e=cg(e,"float32")),$s(ea(e,this.scale),this.offset)))}}qv.className="Rescaling",ua(qv);const{resizeBilinear:Xv,cropAndResize:Kv}=au;class Yv extends om{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,i,r,s,a,o){return Xs(()=>{let l,c=!1;const u=[t/s,n/a,(i+t)/s,(r+n)/a],h=[];3===e.rank?(c=!0,l=Yl([e])):l=e;for(let e=0;e<l.shape[0];e++)h.push(u);const d=rs(h,[h.length,4]),p=Ll(0,h.length,1,"int32"),f=Kv(l,d,p,[i,r],"nearest");return cg(c?Yg(ec(f)):f,o)})}upsize(e,t,n,i){return Xs(()=>cg(Xv(e,[t,n]),i))}call(e,t){return Xs(()=>{const t=Yg(e),n=t.dtype,i=t.shape,r=i[i.length-3],s=i[i.length-2];let a=0;r!==this.height&&(a=Math.floor((r-this.height)/2));let o=0;return s!==this.width&&(o=Math.floor((s-this.width)/2),0===o&&(o=1)),a>=0&&o>=0?this.centerCrop(t,a,o,this.height,this.width,r,s,n):this.upsize(e,this.height,this.width,n)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=Qg(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}Yv.className="CenterCrop",ua(Yv);class Qv extends om{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return null==(e=Qg(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return Xs(()=>{let n;if("int32"!==(e=Yg(e)).dtype&&(e=cg(e,"int32")),"undefined"!==typeof t.countWeights){if("count"!==this.outputMode)throw new ff("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));n=Yg(t.countWeights)}const i=nl(e),r=ul(e),s=$o(this.numTokens,i).bufferSync().get(0),a=Jo(r,0).bufferSync().get(0);if(!s||!a)throw new ff("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(this.numTokens));return function(e,t,n,i){let r=Yg(e);if("int32"!==r.dtype&&(r=cg(r,"int32")),"int"===t)return r;const s=r.shape;if(0===r.rank&&(r=qo(r,-1)),"oneHot"===t&&1!==r.shape[r.shape.length-1]&&(r=qo(r,-1)),r.rank>2)throw new ff("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(t," and input shape ").concat(s)+" which would result in output rank ".concat(r.rank,"."));const a=["multiHot","oneHot"].includes(t),o=r;let l;if(l=Vo(o,"undefined"!==typeof i&&"count"===t?i:[],n,a),"tfIdf"!==t)return l;if(i)return ea(l,i);throw new ff("When outputMode is 'tfIdf', weights must be provided.")}(e,this.outputMode,this.numTokens,n)})}}Qv.className="CategoryEncoding",ua(Qv);const $v=new Set(["bilinear","nearest"]);class Jv extends om{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation){if(!$v.has(e.interpolation))throw new ff("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));this.interpolation=e.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){const t=(e=Qg(e))[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Xs(()=>{const t=[this.height,this.width];if("bilinear"===this.interpolation)return au.resizeBilinear(e,t,!this.cropToAspectRatio);if("nearest"===this.interpolation)return au.resizeNearestNeighbor(e,t,!this.cropToAspectRatio);throw new Error("Interpolation is ".concat(this.interpolation," but only ").concat([...$v]," are supported"))})}}Jv.className="Resizing",ua(Jv);class Zv{constructor(e){this.seed=e}next(){if(void 0!==this.seed)return this.seed++}}Zv.className="RandomSeed";class e_ extends om{constructor(e){super(e),this.randomGenerator=new Zv(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}e_.className="BaseRandomLayer";const t_=new Set(["bilinear","nearest"]);class n_ extends e_{constructor(e){super(e);const{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new ff("Invalid factor: ".concat(this.factor,". Must be positive number or tuple of 2 numbers"));this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new ff("factor must have values larger than -1. Got: ".concat(this.factor));if(this.widthUpper<this.widthLower)throw new ff("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(this.widthUpper,".\n        Got lower bound: ").concat(this.widthLower,"\n      "));if(n){if(!t_.has(n))throw new ff("Invalid interpolation parameter: ".concat(n," is not implemented"));this.interpolation=n}}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=Qg(e))[2];return[this.imgHeight,-1,t]}call(e,t){return Xs(()=>{const t=Yg(e);this.imgHeight=t.shape[t.shape.length-3];const n=t.shape[t.shape.length-2];this.widthFactor=Ol([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*n;i=Math.round(i);const r=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return au.resizeBilinear(e,r);case"nearest":return au.resizeNearestNeighbor(e,r);default:throw new Error("Interpolation is ".concat(this.interpolation,"\n          but only ").concat([...t_]," are supported"))}})}}n_.className="RandomWidth",ua(n_);var i_,r_;me().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(i_||(i_={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(r_||(r_={}));Error;new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function s_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(i.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const r=t(e);if(r.recurse&&null!==r.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(r.recurse){if(c_(e)){const r=Array.isArray(e)?[]:{};i.add(e);for(const s in e){const a=s_(e[s],t,n,i);r[s]=a}return i.delete(e),e.__proto__&&(r.__proto__=e.__proto__),r}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,r.value),r.value}function a_(e){return o_(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:l_)}function o_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;const i=e[0];if(n.has(i))throw new Error("Circular references are not supported.");const r=t(e);if(r.recurse&&null!==r.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(r.recurse){if(c_(i)){const r=Array.isArray(i)?[]:{};n.add(i);for(const s in i){const i=e.map(e=>e[s]),a=o_(i,t,n);r[s]=a}return n.delete(i),r}throw new Error("Can't recurse into non-iterable type: ".concat(i))}return r.value}function l_(e){return null===e?null:c_(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function c_(e){let t=!1;if(me().get("IS_BROWSER"))t=e instanceof TextDecoder;else{const{StringDecoder:i}=n(551);t=e instanceof i}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof Tr)&&!(e instanceof Promise)&&!t)}function u_(e){return function(e,t){return s_(e,t)}(e,h_)}function h_(e){return e instanceof Tr?{value:e.clone(),recurse:!1}:c_(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class d_{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class p_ extends d_{constructor(){super(p_.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let i=0;i<n;i++)t[i]=this.get(this.wrap(this.begin+i));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function f_(e){return new b_(e)}function g_(e,t){return new N_(e,t)}p_.INITIAL_CAPACITY=32;class m_{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new S_(this,e)}filter(e){return new T_(this,e)}map(e){return new k_(this,e)}mapAsync(e){return new C_(this,e)}serialMapAsync(e){return new C_(this,e).serial()}flatmap(e){return new E_(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(e=>!0===e)}rowMajorBatch(e){return new w_(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}columnMajorBatch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l_;return this.rowMajorBatch(e,t).map(e=>a_(e,n))}concatenate(e,t){return new N_(new y_([this,e]),t)}take(e){return e<0||null==e?this:new x_(this,e)}skip(e){return e<0||null==e?this:new __(this,e)}prefetch(e){return new R_(this,e)}shuffle(e,t){return new D_(this,e,t)}serial(){return new v_(this)}}class y_ extends m_{constructor(e){super(),this.items=e,this.trav=0}summary(){return"Array of ".concat(this.items.length," items")}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:u_(e),done:!1}}}class b_ extends m_{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch($F){throw $F.message="Error thrown while iterating through a dataset: ".concat($F.message),$F}}}class v_ extends m_{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Serial")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class __ extends m_{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Skip")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;Ks(e.value)}return this.upstream.next()}}class x_ extends m_{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return"".concat(this.upstream.summary()," -> Take")}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class w_ extends m_{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class T_ extends m_{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Filter")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;Ks(e.value)}}}class k_ extends m_{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Map")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=Ur(e.value),n=this.transform(e.value),i=Ur(n);for(const r of t)Mr(r,i)||r.dispose();return{value:n,done:!1}}}class S_ extends m_{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> handleErrors")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch($F){if(!this.handler($F))return{value:null,done:!0}}}}class C_ extends m_{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> AsyncMap")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=Ur(e.value),n=await this.transform(e.value),i=Ur(n);for(const r of t)Mr(r,i)||r.dispose();return{value:n,done:!1}}}class I_ extends m_{constructor(){super(),this.outputQueue=new p_,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class E_ extends I_{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Flatmap")}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=Ur(e.value),n=this.transform(e.value),i=Ur(n);this.outputQueue.pushAll(n);for(const r of t)Mr(r,i)||r.dispose();return!0}}class N_ extends m_{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var A_;!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(A_||(A_={}));class R_ extends m_{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new d_(t)}summary(){return"".concat(this.upstream.summary()," -> Prefetch")}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class D_ extends R_{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=Nl.alea(n||ar().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class O_{constructor(){this.size=null}batch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this;let i;return F(e>0,()=>"batchSize needs to be positive, but it is\n      ".concat(e)),i=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),L_(async()=>(await n.iterator()).columnMajorBatch(e,t,P_),i)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,L_(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,L_(async()=>(await t.iterator()).filter(t=>Xs(()=>e(t))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return L_(async()=>(await t.iterator()).map(t=>Xs(()=>e(t))),this.size)}mapAsync(e){const t=this;return L_(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return L_(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,L_(async()=>g_(f_(async()=>({value:await t.iterator(),done:!1})).take(e)),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,L_(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));const i=this,r=Nl.alea(t||ar().toString());return L_(async()=>{let t=r.int32();return n&&(t+=r.int32()),(await i.iterator()).shuffle(e,t.toString())},this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,L_(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function L_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new class extends O_{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function P_(e){if(null===e)return null;if(function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof Tr||cr(e);var t}(e[0])){return{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Tr?Yl(e):rs(e)}(e),recurse:!1}}return{value:null,recurse:!0}}O_.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function F_(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&F("complex64"!==e.dtype,()=>"".concat(t," does not support complex64 tensors in the CPU backend."))})}const M_=_h;class U_ extends A{nextDataId(){return U_.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new N(this,Gs())}write(e,t,n){this.firstUse&&(this.firstUse=!1,me().get("IS_NODE")&&Oi("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:n,refCount:1}),i}makeTensorInfo(e,t,n){let i;if("string"===t&&null!=n&&n.length>0&&J(n[0])){const r=n.map(e=>or(e));i=this.write(r,e,t)}else i=this.write(n,e,t);return{dataId:i,shape:e,dtype:t}}refCount(e){if(this.data.has(e)){return this.data.get(e).refCount}return 0}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,i,r){this.data.set(e,{values:t,dtype:i,refCount:r})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return Uu(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return function(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>lr(e));return Vs(e.shape,e.dtype,n)}catch(uG){throw new Error("Failed to decode encoded string bytes into utf-8")}return Vs(e.shape,e.dtype,t)}makeOutput(e,t,n){return Gs().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=ar();e();return{kernelMs:ar()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){F_([e],"where");const t=this.readSync(e.dataId);return M_(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}U_.nextDataId=0;function B_(e){return(t,n,i)=>{const r=Y(n,t.length);for(let s=0;s<t.length;++s)r[s]=e(t[s],i);return r}}function z_(e,t,n){return V_(e,B_(t),n)}function V_(e,t,n){return i=>{let{inputs:r,attrs:s,backend:a}=i;const{x:o}=r;F_(o,e);const l=a,c=l.data.get(o.dataId).values;let u;if("string"===o.dtype){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");u=bh(c)}else u=c;const h=n||o.dtype,d=t(u,h,s);return l.makeTensorInfo(o.shape,h,d)}}Qs("cpu",()=>new U_,1);const j_=z_(vt,e=>e>=0?e:Math.exp(e)-1),W_={kernelName:vt,backendName:"cpu",kernelFunc:j_};function H_(e){const{inputs:t,backend:n}=e,{x:i}=t;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const G_={kernelName:Ft,backendName:"cpu",kernelFunc:H_};function q_(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{alpha:s}=i;F_([r],"leakyRelu");const a=B(r.shape),o=n.data.get(r.dataId).values,l=K("float32",a);for(let c=0;c<o.length;c++)l[c]=o[c]<0?s*o[c]:o[c];return n.makeTensorInfo(r.shape,"float32",l)}const X_={kernelName:jt,backendName:"cpu",kernelFunc:q_};function K_(e){return(t,n,i,r,s)=>{const a=xa(t,n),o=a.length,l=ie(a),c=K(s,B(a)),u=t.length,h=n.length,d=ie(t),p=ie(n),f=va(t,a),g=va(n,a);if(f.length+g.length===0)for(let m=0;m<c.length;++m)c[m]=e(i[m%i.length],r[m%r.length]);else for(let m=0;m<c.length;++m){const t=he(m,o,l),n=t.slice(-u);f.forEach(e=>n[e]=0);const s=ue(n,u,d),a=t.slice(-h);g.forEach(e=>a[e]=0);const y=ue(a,h,p);c[m]=e(i[s],r[y])}return[c,a]}}const Y_=K_((e,t)=>e<0?t*e:e);function Q_(e){const{inputs:t,backend:n}=e,{x:i,alpha:r}=t;F_([i,r],"prelu");const s=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values,[o,l]=Y_(i.shape,r.shape,s,a,"float32");return n.makeTensorInfo(l,"float32",o)}const $_={kernelName:kn,backendName:"cpu",kernelFunc:Q_},J_=z_(Dn,e=>Math.max(0,e)),Z_={kernelName:Dn,backendName:"cpu",kernelFunc:J_},ex=z_(Un,e=>Math.min(Math.max(0,e),6)),tx={kernelName:Un,backendName:"cpu",kernelFunc:ex},nx=B_(e=>1/(1+Math.exp(-e))),ix=z_($n,e=>1/(1+Math.exp(-e))),rx={kernelName:$n,backendName:"cpu",kernelFunc:ix};function sx(e,t,n,i,r){if("linear"===n)return H_({inputs:{x:t},backend:e});if("relu"===n)return J_({inputs:{x:t},backend:e});if("elu"===n)return j_({inputs:{x:t},backend:e});if("relu6"===n)return ex({inputs:{x:t},backend:e});if("prelu"===n)return Q_({inputs:{x:t,alpha:i},backend:e});if("leakyrelu"===n)return q_({inputs:{x:t},backend:e,attrs:{alpha:r}});if("sigmoid"===n)return ix({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function ax(e){const{inputs:t,backend:n}=e,{real:i,imag:r}=t,s=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values,o=n.makeTensorInfo(i.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(i.shape,"float32",s),imag:n.makeTensorInfo(r.shape,"float32",a)},o}const ox={kernelName:Xe,backendName:"cpu",kernelFunc:ax};function lx(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){return ax({inputs:{real:lx(e,t,"float32"),imag:lx(e,t,"float32")},backend:e})}const i=oe(B(t),n);return e.makeTensorInfo(t,n,i)}function cx(e){const{inputs:t,backend:n}=e,{input:i}=t,r=n.data.get(i.dataId).complexTensorInfos.real,s=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,s)}const ux={kernelName:An,backendName:"cpu",kernelFunc:cx};function hx(e,t,n,i){if("int32"===i){return[t,"int32",Int32Array.from(e)]}if("bool"===i){const i=sr([0],n),[r,s]=K_((e,t)=>e!==t?1:0)(t,[],e,i,"bool");return[s,"bool",r]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(i))}function dx(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{dtype:s}=i;if("complex64"===s){if("complex64"===r.dtype)return H_({inputs:{x:r},backend:n});const e=lx(n,r.shape,r.dtype),t=dx({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),i=ax({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),i}if("complex64"===r.dtype){const e=cx({inputs:{input:r},backend:n}),t=dx({inputs:{x:e},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(e),t}if(!Q(r.dtype,s)){const e=H_({inputs:{x:r},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:s}}const a=n.data.get(r.dataId).values,[o,l,c]=hx(a,r.shape,r.dtype,s);return n.makeTensorInfo(o,l,c)}const px={kernelName:He,backendName:"cpu",kernelFunc:dx};function fx(e,t,n,i){return null==n?n=>{let{inputs:r,backend:s}=n;const{a:a,b:o}=r,l=s;F_([a,o],e);const c=l.data.get(a.dataId).values,u=l.data.get(o.dataId).values,h="string"===a.dtype?bh(c):c,d="string"===a.dtype?bh(u):u,p=i||a.dtype,[f,g]=t(a.shape,o.shape,h,d,p);return l.makeTensorInfo(g,p,f)}:e=>{let{inputs:r,backend:s}=e;const{a:a,b:o}=r,l=s;if("complex64"===a.dtype||"complex64"===o.dtype){const e=dx({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),t=l.data.get(e.dataId),i=t.complexTensorInfos.real,r=t.complexTensorInfos.imag,s=l.data.get(i.dataId).values,c=l.data.get(r.dataId).values,u=dx({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(u.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,f=l.data.get(d.dataId).values,g=l.data.get(p.dataId).values,[m,y,b]=n(a.shape,o.shape,s,c,f,g),v=l.makeTensorInfo(b,"float32",m),_=l.makeTensorInfo(b,"float32",y),x=ax({inputs:{real:v,imag:_},backend:l});return l.disposeIntermediateTensorInfo(e),l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo(_),x}{const e=l.data.get(a.dataId).values,n=l.data.get(o.dataId).values,r=i||a.dtype,[s,c]=t(a.shape,o.shape,e,n,r);return l.makeTensorInfo(c,r,s)}}}function gx(e){return(t,n,i,r,s,a)=>{const o=xa(t,n),l=B(o),c=o.length,u=ie(o),h=K("float32",l),d=K("float32",l),p=va(t,o),f=va(n,o),g=Uu(i,r),m=Uu(s,a),y=t.length,b=ie(t),v=n.length,_=ie(n);if(p.length+f.length===0)for(let x=0;x<h.length;x++){const t=x%g.length,n=x%m.length,i=e(g[2*t],g[2*t+1],m[2*n],m[2*n+1]);h[x]=i.real,d[x]=i.imag}else for(let x=0;x<h.length;x++){const t=he(x,c,u),n=t.slice(-y);p.forEach(e=>n[e]=0);const i=ue(n,y,b),r=t.slice(-v);f.forEach(e=>r[e]=0);const s=ue(r,v,_),a=e(g[2*i],g[2*i+1],m[2*s],m[2*s+1]);h[x]=a.real,d[x]=a.imag}return[h,d,o]}}const mx=K_((e,t)=>e+t),yx=gx((e,t,n,i)=>({real:e+n,imag:t+i})),bx=fx(ke,mx,yx),vx={kernelName:ke,backendName:"cpu",kernelFunc:bx};function _x(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{shape:s}=i,a=B(r.shape),o=G(s,a),l=B(o);F(a===l,()=>"The new shape (".concat(o,") has ").concat(l," elements and the old ")+"shape (".concat(r.shape,") has ").concat(a," elements. The new shape and old ")+"shape must have the same number of elements."),n.incRef(r.dataId);const c=n.data.get(r.dataId);if(null!=c.complexTensorInfos){const e=c.complexTensorInfos.real,t=c.complexTensorInfos.imag;e.shape=o,t.shape=o}return{dataId:r.dataId,shape:o,dtype:r.dtype}}const xx={kernelName:On,backendName:"cpu",kernelFunc:_x};function wx(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s}=t,{transposeA:a,transposeB:o}=i;F_([r,s],"matMul");const l=r.shape.length,c=s.shape.length,u=a?r.shape[l-2]:r.shape[l-1],h=o?s.shape[c-1]:s.shape[c-2],d=a?r.shape[l-1]:r.shape[l-2],p=o?s.shape[c-2]:s.shape[c-1],f=r.shape.slice(0,-2),g=s.shape.slice(0,-2),m=B(f),y=B(g),b=xa(r.shape.slice(0,-2),s.shape.slice(0,-2)).concat([d,p]);F(u===h,()=>"Error in matMul: inner shapes (".concat(u,") and (")+"".concat(h,") of Tensors with shapes ").concat(r.shape," and ")+"".concat(s.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match."));const v=o?[y,p,h]:[y,h,p],_=_x({inputs:{x:r},backend:n,attrs:{shape:a?[m,u,d]:[m,d,u]}}),x=_x({inputs:{x:s},backend:n,attrs:{shape:v}}),w=a?_.shape[1]:_.shape[2],T=a?_.shape[2]:_.shape[1],k=o?x.shape[1]:x.shape[2],S=Math.max(m,y),C=n.data.get(_.dataId).values,I=n.data.get(x.dataId).values,E=ie(_.shape),N=ie(x.shape),[A,R,D]=a?[E[0],1,E[1]]:[E[0],E[1],1],[O,L,P]=o?[1,N[1],N[0]]:[N[1],1,N[0]],M=T*k,U=Vs([S,T,k],_.dtype),z=U.values,V=n.blockSize;for(let F=0;F<S;F++){const e=F%m,t=F%y;for(let n=0;n<T;n+=V){const i=Math.min(n+V,T);for(let r=0;r<k;r+=V){const s=Math.min(r+V,k);for(let a=0;a<w;a+=V){const o=Math.min(a+V,w);for(let l=n;l<i;l++)for(let n=r;n<s;n++){let i=0;for(let r=a;r<o;r++){i+=C[e*A+l*R+r*D]*I[r*O+n*L+t*P]}z[F*M+(l*k+n)]+=i}}}}}return n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(x),n.makeTensorInfo(b,U.dtype,U.values)}const Tx={kernelName:Be,backendName:"cpu",kernelFunc:wx};const kx={kernelName:Ai,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s,bias:a,preluActivationWeights:o}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=i;let d,p,f;const g=[];d=wx({inputs:{a:r,b:s},attrs:{transposeA:l,transposeB:c},backend:n}),a&&(p=bx({inputs:{a:d,b:a},backend:n}),g.push(d),d=p),u&&(f=sx(n,d,u,o,h),g.push(d),d=f);for(const m of g)n.disposeIntermediateTensorInfo(m);return d}};function Sx(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const Cx={kernelName:xe,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;F_(t,"abs");let i=new Float32Array(B(t.shape));return i=Sx(n.data.get(t.dataId).values),n.makeOutput(i,t.shape,t.dtype)}},Ix=z_(we,e=>Math.acos(e)),Ex={kernelName:we,backendName:"cpu",kernelFunc:Ix},Nx=z_(Te,e=>Math.acosh(e)),Ax={kernelName:Te,backendName:"cpu",kernelFunc:Nx};const Rx={kernelName:Se,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,i=t;F_(t,"addN");const r=i.map(e=>n.data.get(e.dataId).values),s=Vs(i[0].shape,i[0].dtype),a=s.values;for(let o=0;o<i.length;o++){const e=r[o];for(let t=0;t<a.length;t++)a[t]+=e[t]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}};function Dx(e,t,n,i,r){const s=t.length,a=B(t),o=ie(t),l=ie(r),c=K(n,B(r));for(let u=0;u<a;++u){const t=he(u,s,o),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[i[e]];c[ue(n,s,l)]=e[u]}return c}function Ox(e){const{inputs:t,attrs:n,backend:i}=e,{x:r}=t,{perm:s}=n;F_(r,"transpose");const a=r.shape.length,o=new Array(a);for(let c=0;c<o.length;c++)o[c]=r.shape[s[c]];const l=Dx(i.data.get(r.dataId).values,r.shape,r.dtype,s,o);return{dataId:i.write(l,o,r.dtype),shape:o,dtype:r.dtype}}const Lx={kernelName:wi,backendName:"cpu",kernelFunc:Ox};const Px={kernelName:Ce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;F_(r,"all");const o=q(s,r.shape);let l=o;const c=yl(l,r.shape.length);let u=r;null!=c&&(u=Ox({inputs:{x:r},backend:n,attrs:{perm:c}}),l=vl(l.length,r.shape.length)),ml("all",l,u.shape.length);const[h,d]=fl(u.shape,l),p=B(d),f=oe(B(h),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=g[e];for(let n=0;n<p;++n){const i=g[e+n];t=t&&i}f[y]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,f);if(a){const e=_x({inputs:{x:m},backend:n,attrs:{shape:gl(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}};const Fx={kernelName:Ie,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;F_(r,"any");const o=q(s,r.shape);let l=o;const c=yl(l,r.shape.length);let u=r;null!=c&&(u=Ox({inputs:{x:r},backend:n,attrs:{perm:c}}),l=vl(l.length,r.shape.length)),ml("any",l,u.shape.length);const[h,d]=fl(u.shape,l),p=B(d),f=oe(B(h),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=g[e];for(let n=0;n<p;++n){const i=g[e+n];t=t||i}f[y]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,f);if(a){const e=_x({inputs:{x:m},backend:n,attrs:{shape:gl(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}};const Mx={kernelName:Ee,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s}=i;F_(r,"argMax");let a=q(s,r.shape);const o=yl(a,r.shape.length);let l=r;const c=[];null!=o&&(l=Ox({inputs:{x:r},backend:n,attrs:{perm:o}}),c.push(l),a=vl(a.length,l.shape.length)),a=[a[0]],ml("argMax",a,l.shape.length);const[u,h]=fl(l.shape,a),d=oe(B(u),"int32"),p=B(h),f=n.data.get(l.dataId).values;for(let g=0;g<d.length;++g){const e=g*p;let t=f[e],n=0;for(let i=0;i<p;++i){const r=f[e+i];r>t&&(t=r,n=i)}d[g]=n}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",d)}};const Ux={kernelName:Ne,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s}=i;F_(r,"argMin");let a=q(s,r.shape);const o=yl(a,r.shape.length);let l=r;const c=[];null!=o&&(l=Ox({inputs:{x:r},backend:n,attrs:{perm:o}}),c.push(l),a=vl(a.length,l.shape.length)),a=[a[0]],ml("argMin",a,l.shape.length);const[u,h]=fl(l.shape,a),d=oe(B(u),"int32"),p=B(h),f=n.data.get(l.dataId).values;for(let g=0;g<d.length;++g){const e=g*p;let t=f[e],n=0;for(let i=0;i<p;++i){const r=f[e+i];r<t&&(t=r,n=i)}d[g]=n}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",d)}},Bx=z_(Ae,e=>Math.asin(e)),zx={kernelName:Ae,backendName:"cpu",kernelFunc:Bx},Vx=z_(Re,e=>Math.asinh(e)),jx={kernelName:Re,backendName:"cpu",kernelFunc:Vx},Wx=z_(De,e=>Math.atan(e)),Hx={kernelName:De,backendName:"cpu",kernelFunc:Wx},Gx=K_((e,t)=>Math.atan2(e,t)),qx=fx(Le,Gx),Xx={kernelName:Le,backendName:"cpu",kernelFunc:qx},Kx=z_(Oe,e=>Math.atanh(e)),Yx={kernelName:Oe,backendName:"cpu",kernelFunc:Kx};function Qx(e,t,n,i,r,s){const a=r.strideHeight,o=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,f="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Vs(r.outShape,n),m=g.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let _=0;_<r.batchSize;++_){const t=_*y,n=_*i[0];for(let g=0;g<r.inChannels;++g)for(let y=0;y<r.outHeight;++y){const _=y*a-d,x=Math.max(0,_),w=Math.min(r.inHeight,u+_),T=t+y*b;for(let t=0;t<r.outWidth;++t){const a=t*o-p,u=Math.max(0,a),d=Math.min(r.inWidth,h+a);let y=f,b=0,_=0;for(let t=x;t<w;t+=l){const r=n+t*i[1];for(let t=u;t<d;t+=c){const n=e[r+t*i[2]+g];"max"===s&&n>y?y=n:"avg"===s&&(b+=n,_++)}if(isNaN(y))break}m[T+t*v+g]="avg"===s?b/_:y}}}return g}function $x(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=Vs(i.outShape,"int32"),o=i.strideHeight,l=i.strideWidth,c=i.dilationHeight,u=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,p=i.padInfo.top,f=i.padInfo.left,g=Vs(t,n,e);for(let m=0;m<i.batchSize;++m)for(let e=0;e<i.inChannels;++e)for(let t=0;t<i.outHeight;++t){const n=t*o-p;let y=n;for(;y<0;)y+=c;const b=Math.min(i.inHeight,h+n);for(let o=0;o<i.outWidth;++o){const h=o*l-f;let p=h;for(;p<0;)p+=u;const v=Math.min(i.inWidth,d+h);let _=Number.NEGATIVE_INFINITY,x=-1;for(let t=y;t<b;t+=c){const a=t-n;for(let n=p;n<v;n+=u){const o=n-h,l=g.get(m,t,n,e);l>_&&(_=l,x=r?s?((m*i.inHeight+t)*i.inWidth+n)*i.inChannels+e:(t*i.inWidth+n)*i.inChannels+e:a*d+o)}}a.set(x,m,t,o,e)}}return a}function Jx(e,t,n,i,r,s){const a=r.strideDepth,o=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,g=r.padInfo.front,m=r.padInfo.top,y=r.padInfo.left,b="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Vs(r.outShape,n),_=v.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],w=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],k=r.outShape[4];for(let S=0;S<r.batchSize;++S){const t=S*x,n=S*i[0];for(let v=0;v<r.inChannels;++v)for(let x=0;x<r.outDepth;++x){const S=x*a-g;let C=S;for(;C<0;)C+=c;const I=Math.min(r.inDepth,d+S),E=t+x*w;for(let t=0;t<r.outHeight;++t){const a=t*o-m;let d=a;for(;d<0;)d+=u;const g=Math.min(r.inHeight,p+a),x=E+t*T;for(let t=0;t<r.outWidth;++t){const a=t*l-y;let o=a;for(;o<0;)o+=h;const p=Math.min(r.inWidth,f+a),m=x+t*k;let w=b,T=0,S=0;for(let t=C;t<I;t+=c){const r=n+t*i[1];for(let t=d;t<g;t+=u){const n=r+t*i[2];for(let t=o;t<p;t+=h){const r=e[n+t*i[3]+v];if("max"===s&&r>w?w=r:"avg"===s&&(T+=r,S++),isNaN(w))break}if(isNaN(w))break}if(isNaN(w))break}_[m+v]="avg"===s?T/Math.max(S,1):w}}}}return v}const Zx={kernelName:Pe,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;F_(r,"avgPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=i;F(mo(a,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(1,"'"));const c=so(r.shape,s,a,1,o,l);let u;if(1===c.filterWidth&&1===c.filterHeight&&z(c.inShape,c.outShape))u=H_({inputs:{x:r},backend:n});else{const e=n.data.get(r.dataId).values,t=ie(r.shape),i=Qx(e,r.shape,r.dtype,t,c,"avg");u=n.makeTensorInfo(c.outShape,r.dtype,i.values)}return u}};const ew={kernelName:Me,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=i;F_(r,"avgPool3d");const u=ao(r.shape,s,a,1,o,l,c),h=Jx(n.data.get(r.dataId).values,r.shape,r.dtype,ie(r.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};const tw={kernelName:Ue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=i;F_([r,s],"avgPool3DGrad");const u=ao(s.shape,a,o,1,l,c),h=u.strideDepth,d=u.strideHeight,p=u.strideWidth,f=u.filterDepth,g=u.filterHeight,m=u.filterWidth,y=u.dilationDepth,b=u.dilationHeight,v=u.dilationWidth,_=u.effectiveFilterDepth,x=u.effectiveFilterHeight,w=u.effectiveFilterWidth,T=_-1-u.padInfo.front,k=w-1-u.padInfo.left,S=x-1-u.padInfo.top,C=Vs(s.shape,"float32"),I=1/(f*g*m),E=n.bufferSync(r);for(let N=0;N<u.batchSize;++N)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let i=0;i<u.inWidth;++i){const r=t-T,s=n-S,a=i-k;let o=0;for(let t=0;t<_;t+=y){const n=(r+t)/h;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let t=0;t<x;t+=b){const i=(s+t)/d;if(!(i<0||i>=u.outHeight||Math.floor(i)!==i))for(let t=0;t<w;t+=v){const r=(a+t)/p;if(r<0||r>=u.outWidth||Math.floor(r)!==r)continue;o+=E.get(N,n,i,r,e)}}}C.set(o*I,N,t,n,i,e)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}};const nw={kernelName:Fe,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,a=s;F_([r,s],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=i,u=so(a.shape,o,l,1,c),h=u.strideHeight,d=u.strideWidth,p=u.filterHeight,f=u.filterWidth,g=u.dilationHeight,m=u.dilationWidth,y=u.effectiveFilterHeight,b=u.effectiveFilterWidth,v=b-1-u.padInfo.left,_=y-1-u.padInfo.top,x=Vs(a.shape,"float32"),w=1/(p*f),T=n.data.get(r.dataId).values,k=Vs(r.shape,"float32",T);for(let S=0;S<u.batchSize;++S)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inHeight;++t)for(let n=0;n<u.inWidth;++n){const i=t-_,r=n-v;let s=0;for(let t=0;t<y;t+=g){const n=(i+t)/h;if(!(n<0||n>=u.outHeight||Math.floor(n)!==n))for(let t=0;t<b;t+=m){const i=(r+t)/d;if(i<0||i>=u.outWidth||Math.floor(i)!==i)continue;s+=k.get(S,n,i,e)}}x.set(s*w,S,t,n,e)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};const iw={kernelName:Rt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,scale:s,offset:a,mean:o,variance:l}=t;F(o.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(null==a||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(null==s||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),F_([r,o,l,s,a],"batchNorm");let{varianceEpsilon:c}=i;null==c&&(c=.001);const u=n.data.get(r.dataId).values,h=n.data.get(o.dataId).values,d=n.data.get(l.dataId).values,p=s?n.data.get(s.dataId).values:new Float32Array([1]),f=a?n.data.get(a.dataId).values:new Float32Array([0]),g=new Float32Array(u.length),m=f.length,y=p.length,b=d.length,v=h.length;let _=0,x=0,w=0,T=0;for(let k=0;k<u.length;++k)g[k]=f[_++]+(u[k]-h[x++])*p[w++]/Math.sqrt(d[T++]+c),_>=m&&(_=0),x>=v&&(x=0),w>=y&&(w=0),T>=b&&(T=0);return n.makeTensorInfo(r.shape,r.dtype,g)}};function rw(e,t,n,i,r){const s=Qa(i,t,n),a=B(n),o=ie(i);if(s){const n=$a(t,o);return"string"===r?e.slice(n,n+a):e.subarray(n,n+a)}const l=Vs(i,r,"string"===r?bh(e):e),c=Vs(n,r);for(let u=0;u<c.size;++u){const e=c.indexToLoc(u),n=e.map((e,n)=>e+t[n]);c.set(l.get(...n),...e)}return"string"===r?vh(c.values):c.values}function sw(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{begin:s,size:a}=i;F_(r,"slice");const[o,l]=Ja(r,s,a);Ua(r,o,l);const c=rw(n.data.get(r.dataId).values,o,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,c)}const aw={kernelName:Xn,backendName:"cpu",kernelFunc:sw};const ow={kernelName:ze,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockShape:s,crops:a}=i;F_([r],"batchToSpaceND");const o=s.reduce((e,t)=>e*t),l=xu(r.shape,s,o),c=wu(l.length,s.length),u=Tu(r.shape,s,o),h=ku(a,s.length),d=Su(u,a,s.length),p=_x({inputs:{x:r},backend:n,attrs:{shape:l}}),f=Ox({inputs:{x:p},backend:n,attrs:{perm:c}}),g=_x({inputs:{x:f},backend:n,attrs:{shape:u}}),m=sw({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}};function lw(e,t,n,i,r){const s=B(i),a=oe(r,n);for(let o=0;o<e.length;o++){const n=e[o];if(n<0)throw new Error("Input x must be non-negative!");n>=r||(a[n]+=s>0?t[o]:1)}return a}function cw(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e.shape[0],s=e.shape[1],a=Vs([r,n],t.dtype);for(let o=0;o<r;o++)for(let r=0;r<s;r++){const s=e.get(o,r);if(s<0)throw new Error("Input x must be non-negative!");s>=n||(i?a.set(1,o,s):t.size>0?a.set(a.get(o,s)+t.get(o,r),o,s):a.set(a.get(o,s)+1,o,s))}return a}const uw={kernelName:Ve,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a}=i,o=lw(n.data.get(r.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,o)}},hw=K_((e,t)=>e&t),dw={kernelName:je,backendName:"cpu",kernelFunc:fx(je,hw)};const pw={kernelName:We,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:i,s1:r}=t,s=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values,o=xa(Array.from(s),Array.from(a));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},fw=B_(e=>Math.ceil(e)),gw=V_(Ge,fw),mw={kernelName:Ge,backendName:"cpu",kernelFunc:gw},yw=z_(qe,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),bw={kernelName:qe,backendName:"cpu",kernelFunc:yw},vw={kernelName:Ke,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,i=new Float32Array(B(t.shape)),r=n.data.get(t.dataId),s=r.complexTensorInfos.real,a=r.complexTensorInfos.imag,o=n.data.get(s.dataId).values,l=n.data.get(a.dataId).values;for(let c=0;c<o.length;c++){const e=o[c],t=l[c];i[c]=Math.hypot(e,t)}return n.makeOutput(i,t.shape,"float32")}};function _w(e,t,n,i){const r=Y(n,B(t));if(i&&"string"!==n){let t=0;e.forEach(e=>{const n=B(e.shape);r.set(e.vals,t),t+=n})}else{let i=0;e.forEach(e=>{const s="string"===n?bh(e.vals):e.vals;let a=0;for(let n=0;n<e.shape[0];++n){const o=n*t[1]+i;for(let t=0;t<e.shape[1];++t)r[o+t]=s[a++]}i+=e.shape[1]})}return r}function xw(e){const{inputs:t,backend:n}=e,{input:i}=t,r=n.data.get(i.dataId).complexTensorInfos.imag,s=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,s)}const ww={kernelName:Ut,backendName:"cpu",kernelFunc:xw};function Tw(e){const{inputs:t,backend:n,attrs:i}=e,{axis:r}=i,s=q(r,t[0].shape)[0],a=t.map(e=>e.shape);hu(a,s);let o=du(t.map(e=>e.shape),s);if(0===B(o))return n.makeTensorInfo(o,t[0].dtype,[]);const l=t.filter(e=>B(e.shape)>0);if(1===l.length)return H_({inputs:{x:l[0]},backend:n});if("complex64"===l[0].dtype){const e=l.map(e=>cx({inputs:{input:e},backend:n})),t=l.map(e=>xw({inputs:{input:e},backend:n})),i=Tw({inputs:e,backend:n,attrs:{axis:s}}),r=Tw({inputs:t,backend:n,attrs:{axis:s}}),a=ax({inputs:{real:i,imag:r},backend:n});return e.forEach(e=>n.disposeIntermediateTensorInfo(e)),t.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),a}const c=l.map(e=>{const t=B(e.shape.slice(s));return _x({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}),u=c.map(e=>({vals:n.data.get(e.dataId).values,shape:e.shape}));o=du(c.map(e=>e.shape),1);const h=1===c[0].shape[0],d=_w(u,o,t[0].dtype,h),p=du(l.map(e=>e.shape),s),f=n.makeTensorInfo(p,t[0].dtype,d);return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),f}const kw={kernelName:Ye,backendName:"cpu",kernelFunc:Tw};function Sw(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dataFormat:l,dilations:c,dimRoundingMode:u}=i;F_([r,s],"conv2d");const h=bo(l),d=oo(r.shape,s.shape,a,c,o,u,!1,h),p=d.filterHeight,f=d.filterWidth,g=d.dilationHeight,m=d.dilationWidth,y=d.padInfo.left,b=d.padInfo.top,v="channelsLast"===d.dataFormat,_=new vr(d.outShape,r.dtype),x=ie(r.shape),w=ie(s.shape),T=x[0],k=v?x[1]:x[2],S=v?x[2]:1,C=v?1:x[1],I=_.strides[0],E=v?_.strides[1]:_.strides[2],N=v?_.strides[2]:1,A=v?1:_.strides[1],R=n.data.get(r.dataId).values,D=n.data.get(s.dataId).values,O=_.values;for(let L=0;L<d.batchSize;++L){const e=L*T,t=L*I;for(let n=0;n<d.outHeight;++n){const i=t+n*E,r=n*d.strideHeight-b;for(let t=0;t<p;++t){const n=r+t*g;if(n<0||n>=d.inHeight)continue;const s=t*w[0],a=e+n*k;for(let e=0;e<d.outWidth;++e){const t=i+e*N,n=e*d.strideWidth-y;for(let e=0;e<f;++e){const i=n+e*m;if(i<0||i>=d.inWidth)continue;const r=a+i*S;let o=s+e*w[1];for(let e=0;e<d.inChannels;++e){const n=R[r+e*C];for(let e=0;e<d.outChannels;++e)O[t+e*A]+=n*D[o+e];o+=d.outChannels}}}}}}return n.makeTensorInfo(_.shape,_.dtype,O)}const Cw={kernelName:Qe,backendName:"cpu",kernelFunc:Sw};const Iw={kernelName:$e,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:u}=i;F_([r,s],"conv2dBackpropFilter");const h=bo(l),d=oo(r.shape,u,a,1,o,c,!1,h),{strideHeight:p,strideWidth:f,filterHeight:g,filterWidth:m}=d,y="channelsLast"===d.dataFormat,b=new vr(d.filterShape,"float32"),v=d.padInfo.left,_=d.padInfo.top,x=n.data.get(r.dataId).values,w=n.data.get(s.dataId).values,T=new vr(r.shape,r.dtype,x),k=new vr(s.shape,s.dtype,w);for(let S=0;S<g;++S){const e=Math.max(0,Math.ceil((_-S)/p)),t=Math.min(d.outHeight,(d.inHeight+_-S)/p);for(let n=0;n<m;++n){const i=Math.max(0,Math.ceil((v-n)/f)),r=Math.min(d.outWidth,(d.inWidth+v-n)/f);for(let s=0;s<d.inChannels;++s)for(let a=0;a<d.outChannels;++a){let o=0;for(let l=0;l<d.batchSize;++l)for(let c=e;c<t;++c){const e=S+c*p-_;for(let t=i;t<r;++t){const i=n+t*f-v;o+=y?T.get(l,e,i,s)*k.get(l,c,t,a):T.get(l,s,e,i)*k.get(l,a,c,t)}}b.set(o,S,n,s,a)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const Ew={kernelName:Je,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{inputShape:a,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=i;F_([r,s],"conv2dBackpropInput");const h=ie(s.shape),d=ie(r.shape);let p=bo(c);const f=oo(a,s.shape,o,1,l,u,!1,p),g=new vr(f.inShape,"float32"),m=g.values,y=n.data.get(r.dataId).values,b=n.data.get(s.dataId).values,[v,_,x]=h,{batchSize:w,filterHeight:T,filterWidth:k,inChannels:S,inHeight:C,inWidth:I,outChannels:E,outHeight:N,outWidth:A,strideHeight:R,strideWidth:D}=f;p=f.dataFormat;const O=T-1-f.padInfo.top,L=k-1-f.padInfo.left,P="channelsLast"===p,F=g.strides[0],M=P?g.strides[1]:g.strides[2],U=P?g.strides[2]:1,B=P?1:g.strides[1],z=d[0],V=P?d[1]:d[2],j=P?d[2]:1,W=P?1:d[1];for(let H=0;H<w;++H)for(let e=0;e<S;++e)for(let t=0;t<C;++t){const n=t-O,i=Math.max(0,Math.ceil(n/R)),r=Math.min(N,(T+n)/R);for(let s=0;s<I;++s){const a=s-L,o=Math.max(0,Math.ceil(a/D)),l=Math.min(A,(k+a)/D);let c=0;for(let t=i;t<r;++t){const i=t*R-n;for(let n=o;n<l;++n){const r=z*H+V*t+j*n,s=v*(T-1-i)+_*(k-1-(n*D-a))+x*e;for(let e=0;e<E;++e){c+=y[r+W*e]*b[s+e]}}}m[F*H+M*t+U*s+B*e]=c}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};const Nw={kernelName:Ze,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l}=i;F_([r,s],"conv3d");const c=lo(r.shape,s.shape,a,l,o),{filterDepth:u,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:g,padInfo:m}=c,y=m.front,b=m.left,v=m.top,_=new vr(c.outShape,r.dtype),x=n.data.get(r.dataId).values,w=n.data.get(s.dataId).values,T=_.values,k=ie(r.shape),S=ie(s.shape);for(let C=0;C<c.batchSize;++C){const e=C*k[0],t=C*_.strides[0];for(let n=0;n<c.outDepth;++n){const i=t+n*_.strides[1],r=n*c.strideDepth-y;for(let t=0;t<u;++t){const n=r+t*p;if(n<0||n>=c.inDepth)continue;const s=t*S[0],a=e+n*k[1];for(let e=0;e<c.outHeight;++e){const t=i+e*_.strides[2],n=e*c.strideHeight-v;for(let e=0;e<h;++e){const i=n+e*f;if(i<0||i>=c.inHeight)continue;const r=s+e*S[1],o=a+i*k[2];for(let e=0;e<c.outWidth;++e){const n=t+e*c.outChannels,i=e*c.strideWidth-b;for(let e=0;e<d;++e){const t=i+e*g;if(t<0||t>=c.inWidth)continue;const s=r+e*S[2],a=o+t*c.inChannels;let l=s;for(let e=0;e<c.inChannels;++e){const t=x[a+e];for(let e=0;e<c.outChannels;++e)T[n+e]+=t*w[l+e];l+=c.outChannels}}}}}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}};const Aw={kernelName:et,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,pad:o,filterShape:l}=i;F_([r,s],"conv3dBackpropFilterV2");const c=ie(r.shape),u=ie(s.shape),h=lo(r.shape,l,a,1,o),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,g=h.filterDepth,m=h.filterHeight,y=h.filterWidth,b=new vr(h.filterShape,"float32"),v=b.values,[_,x,w,T]=b.strides,k=n.data.get(s.dataId).values,[S,C,I,E]=u,N=n.data.get(r.dataId).values,[A,R,D,O]=c,L=h.padInfo.front,P=h.padInfo.left,F=h.padInfo.top;for(let M=0;M<g;++M){const e=Math.max(0,Math.ceil((L-M)/d)),t=Math.min(h.outDepth,(h.inDepth+L-M)/d),n=M*_;for(let i=0;i<m;++i){const r=Math.max(0,Math.ceil((F-i)/p)),s=Math.min(h.outHeight,(h.inHeight+F-i)/p),a=i*x+n;for(let n=0;n<y;++n){const o=Math.max(0,Math.ceil((P-n)/f)),l=Math.min(h.outWidth,(h.inWidth+P-n)/f),c=n*w+a;for(let a=0;a<h.inChannels;++a){const u=a*T+c;for(let c=0;c<h.outChannels;++c){let g=0;for(let u=0;u<h.batchSize;++u){const h=u*A,m=u*S;for(let u=e;u<t;++u){const e=(M+u*d-L)*R+h,t=u*C+m;for(let u=r;u<s;++u){const r=(i+u*p-F)*D+e,s=u*I+t;for(let e=o;e<l;++e){const t=e*E+s;g+=N[(n+e*f-P)*O+r+a]*k[t+c]}}}}v[u+c]=g}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const Rw={kernelName:tt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{pad:a,strides:o,inputShape:l}=i;F_([r],"conv3dBackpropInputV2");const c=ie(r.shape),u=ie(s.shape),h=lo(l,s.shape,o,1,a),d=new vr(h.inShape,"float32"),p=d.values,[f,g,m,y]=d.strides,b=n.data.get(r.dataId).values,[v,_,x,w]=c,T=n.data.get(s.dataId).values,[k,S,C,I]=u,{batchSize:E,filterDepth:N,filterHeight:A,filterWidth:R,inChannels:D,inDepth:O,inHeight:L,inWidth:P,outChannels:F,outDepth:M,outHeight:U,outWidth:B,strideDepth:z,strideHeight:V,strideWidth:j}=h,W=N-1-h.padInfo.front,H=A-1-h.padInfo.top,G=R-1-h.padInfo.left;for(let q=0;q<E;++q)for(let e=0;e<D;++e)for(let t=0;t<O;++t){const n=t-W,i=Math.max(0,Math.ceil(n/z)),r=Math.min(M,(N+n)/z);for(let s=0;s<L;++s){const a=s-H,o=Math.max(0,Math.ceil(a/V)),l=Math.min(U,(A+a)/V);for(let c=0;c<P;++c){const u=c-G,h=Math.max(0,Math.ceil(u/j)),d=Math.min(B,(R+u)/j);let E=0;for(let t=i;t<r;++t){const i=t*z-n;for(let n=o;n<l;++n){const r=n*V-a;for(let s=h;s<d;++s){const a=v*q+_*t+x*n+w*s,o=k*(N-1-i)+S*(A-1-r)+C*(R-1-(s*j-u))+I*e;for(let e=0;e<F;++e){E+=b[a+e]*T[o+e]}}}}p[f*q+g*t+m*s+y*c+e]=E}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},Dw=z_(nt,e=>Math.cos(e)),Ow={kernelName:nt,backendName:"cpu",kernelFunc:Dw},Lw=z_(it,e=>Math.cosh(e)),Pw={kernelName:it,backendName:"cpu",kernelFunc:Lw};const Fw={kernelName:at,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{image:r,boxes:s,boxInd:a}=t,{cropSize:o,method:l,extrapolationValue:c}=i,[u,h,d,p]=r.shape,f=s.shape[0],[g,m]=o,y=Vs([f,g,m,p],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(a.dataId).values,_=n.data.get(r.dataId).values,x=ie(r.shape),w=ie(y.shape);for(let T=0;T<f;T++){const e=4*T,t=b[e],n=b[e+1],i=b[e+2],r=b[e+3],s=v[T];if(s>=u)continue;const a=g>1?(i-t)*(h-1)/(g-1):0,o=m>1?(r-n)*(d-1)/(m-1):0;for(let u=0;u<g;u++){const e=g>1?t*(h-1)+u*a:.5*(t+i)*(h-1);if(e<0||e>h-1)for(let t=0;t<m;t++)for(let e=0;e<p;e++){const n=e+t*w[2]+u*w[1]+T*w[0];y.values[n]=c}else if("bilinear"===l){const t=Math.floor(e),i=Math.ceil(e),a=e-t;for(let e=0;e<m;e++){const l=m>1?n*(d-1)+e*o:.5*(n+r)*(d-1);if(l<0||l>d-1){for(let t=0;t<p;t++){const n=t+e*w[2]+u*w[1]+T*w[0];y.values[n]=c}continue}const h=Math.floor(l),f=Math.ceil(l),g=l-h;for(let n=0;n<p;n++){let r=n+h*x[2]+t*x[1]+s*x[0];const o=_[r];r=n+f*x[2]+t*x[1]+s*x[0];const l=_[r];r=n+h*x[2]+i*x[1]+s*x[0];const c=_[r];r=n+f*x[2]+i*x[1]+s*x[0];const d=o+(l-o)*g,p=c+(_[r]-c)*g;r=n+e*w[2]+u*w[1]+T*w[0],y.values[r]=d+(p-d)*a}}}else for(let t=0;t<m;++t){const i=m>1?n*(d-1)+t*o:.5*(n+r)*(d-1);if(i<0||i>d-1){for(let e=0;e<p;e++){const n=e+t*w[2]+u*w[1]+T*w[0];y.values[n]=c}continue}const a=Math.round(i),l=Math.round(e);for(let e=0;e<p;e++){const n=e+a*x[2]+l*x[1]+s*x[0],i=e+t*w[2]+u*w[1]+T*w[0];y.values[i]=_[n]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};const Mw={kernelName:rt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,exclusive:a,reverse:o}=i;F_(r,"cumprod");const l=yl([s],r.shape.length);let c=r;null!=l&&(c=Ox({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=vl(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(u));const h=Dr(c.dtype,"int32"),d=ae(B(c.shape),h),p=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],g=o?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let y=0;y<p.length;y+=f)for(let e=0;e<f;e++){const t=g(y,e);if(0===e)d[t]=a?1:p[t];else{const n=g(y,e-1);d[t]=a?p[n]*d[n]:p[t]*d[n]}}const m=n.makeTensorInfo(c.shape,h,d);if(null!=l){const e=Ox({inputs:{x:m},backend:n,attrs:{perm:bl(l)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(c),e}return m}};const Uw={kernelName:st,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,exclusive:a,reverse:o}=i;F_(r,"cumsum");const l=yl([s],r.shape.length);let c=r;null!=l&&(c=Ox({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=vl(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(u));const h=Dr(c.dtype,"int32"),d=oe(B(c.shape),h),p=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],g=o?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let y=0;y<p.length;y+=f)for(let e=0;e<f;e++){const t=g(y,e);if(0===e)d[t]=a?0:p[t];else{const n=g(y,e-1);d[t]=a?p[n]+d[n]:p[t]+d[n]}}const m=n.makeTensorInfo(c.shape,h,d);if(null!=l){const e=Ox({inputs:{x:m},backend:n,attrs:{perm:bl(l)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(c),e}return m}};const Bw={kernelName:ot,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a,binaryOutput:o}=i;if(1===r.shape.length){const e=lw(n.data.get(r.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,e)}if(2===r.shape.length){const e=cw(n.bufferSync(r),n.bufferSync(s),a,o);return n.makeTensorInfo(e.shape,s.dtype,e.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(r.shape.length,"."))}};const zw={kernelName:lt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockSize:s,dataFormat:a}=i;F("NHWC"===a,()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(a));const o=r.shape[0],l=r.shape[1],c=r.shape[2],u=r.shape[3],h=l*s,d=c*s,p=u/(s*s),f=n.data.get(r.dataId).values,g=new Float32Array(o*h*d*p);let m=0;for(let y=0;y<o;++y)for(let e=0;e<h;++e){const t=Math.floor(e/s),n=e%s;for(let e=0;e<d;++e){const i=Math.floor(e/s),r=(n*s+e%s)*p;for(let e=0;e<p;++e){const n=e+r+u*(i+c*(t+l*y));g[m++]=f[n]}}}return n.makeTensorInfo([o,h,d,p],r.dtype,g)}};function Vw(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l,dimRoundingMode:c}=i;F_([r,s],"depthwiseConv2DNative");const u=ie(r.shape),h=ie(s.shape);let d=l;null==d&&(d=[1,1]),F(mo(a,d),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(a," and dilations '").concat(d,"'"));const p=oo(r.shape,s.shape,a,d,o,c,!0),{filterHeight:f,filterWidth:g,dilationHeight:m,dilationWidth:y,padInfo:b}=p,v=b.left,_=b.top,x=p.outChannels/p.inChannels,w=new vr(p.outShape,r.dtype),T=n.data.get(r.dataId).values,k=n.data.get(s.dataId).values,S=w.values;for(let C=0;C<p.batchSize;++C){const e=C*u[0],t=C*w.strides[0];for(let n=0;n<p.outHeight;++n){const i=t+n*w.strides[1],r=n*p.strideHeight-_;for(let t=0;t<f;++t){const n=r+t*m;if(n<0||n>=p.inHeight)continue;const s=t*h[0],a=e+n*u[1];for(let e=0;e<p.outWidth;++e){const t=i+e*w.strides[2],n=e*p.strideWidth-v;for(let e=0;e<g;++e){const i=n+e*y;if(i<0||i>=p.inWidth)continue;const r=s+e*h[1],o=a+i*p.inChannels;let l=t,c=r;for(let e=0;e<p.inChannels;++e){const t=T[o+e];for(let e=0;e<x;++e)S[l+e]+=t*k[c+e];l+=x,c+=x}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const jw={kernelName:ct,backendName:"cpu",kernelFunc:Vw};const Ww={kernelName:ut,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:c,filterShape:u}=i;F_([r,s],"depthwiseConv2dNativeBackpropFilter");const h=oo(r.shape,u,a,o,l,c,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:g}=h,m=new vr(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,_=n.data.get(r.dataId).values,x=new vr(r.shape,r.dtype,_),w=n.data.get(s.dataId).values,T=new vr(s.shape,s.dtype,w);for(let k=0;k<f;++k){const e=Math.max(0,Math.ceil((b-k)/d)),t=Math.min(h.outHeight,(h.inHeight+b-k)/d);for(let n=0;n<g;++n){const i=Math.max(0,Math.ceil((y-n)/p)),r=Math.min(h.outWidth,(h.inWidth+y-n)/p);for(let s=0;s<h.outChannels;++s){const a=Math.trunc(s/v),o=s%v;let l=0;for(let c=0;c<h.batchSize;++c)for(let o=e;o<t;++o){const e=k+o*d-b;for(let t=i;t<r;++t){const i=n+t*p-y;l+=x.get(c,e,i,a)*T.get(c,o,t,s)}}m.set(l,k,n,a,o)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};const Hw={kernelName:ht,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:c,inputShape:u}=i;F_([r,s],"depthwiseConv2DNativeBackpropInput");const h=ie(r.shape),d=ie(s.shape),p=oo(u,s.shape,a,o,l,c,!0),f=new vr(p.inShape,"float32"),g=f.values,[m,y,b]=f.strides,v=n.data.get(r.dataId).values,[_,x,w]=h,T=n.data.get(s.dataId).values,[k,S,C]=d,{batchSize:I,filterHeight:E,filterWidth:N,inChannels:A,inHeight:R,inWidth:D,outChannels:O,outHeight:L,outWidth:P,strideHeight:F,strideWidth:M}=p,U=E-1-p.padInfo.top,B=N-1-p.padInfo.left,z=O/A;for(let V=0;V<I;++V)for(let e=0;e<A;++e)for(let t=0;t<R;++t){const n=t-U,i=Math.max(0,Math.ceil(n/F)),r=Math.min(L,(E+n)/F);for(let s=0;s<D;++s){const a=s-B,o=Math.max(0,Math.ceil(a/M)),l=Math.min(P,(N+a)/M);let c=0;for(let t=i;t<r;++t){const i=t*F-n;for(let n=o;n<l;++n){const r=_*V+x*t+w*n,s=k*(E-1-i)+S*(N-1-(n*M-a))+C*e;for(let t=0;t<z;++t){c+=v[r+(e*z+t)]*T[s+t]}}}g[m*V+y*t+b*s+e]=c}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};const Gw={kernelName:dt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t,r=B(i.shape),s=n.data.get(i.dataId).values,a=Vs([r,r],i.dtype),o=a.values;for(let c=0;c<s.length;c++)o[c*r+c]=s[c];const l=[...i.shape,...i.shape];return n.makeTensorInfo(l,a.dtype,a.values)}},qw={kernelName:pt,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:i}=e;const{x:r,filter:s}=t,{strides:a,pad:o,dilations:l}=i,c=n,u=c.data.get(r.dataId).values,h=r.shape.length,d=c.data.get(s.dataId).values,p=s.shape.length,{batchSize:f,inHeight:g,inWidth:m,inChannels:y,outHeight:b,outWidth:v,padInfo:_,strideHeight:x,strideWidth:w,filterHeight:T,filterWidth:k,dilationHeight:S,dilationWidth:C,outShape:I}=ro(r.shape,s.shape,a,o,"NHWC",l),E=B(I),N=I.length,A=Y(r.dtype,E);for(let R=0;R<f;++R)for(let e=0;e<b;++e){const t=e*x-_.top;for(let n=0;n<v;++n){const i=n*w-_.left;for(let a=0;a<y;++a){let o=Number.MIN_SAFE_INTEGER;for(let e=0;e<T;++e){const n=t+e*S;if(n>=0&&n<g)for(let t=0;t<k;++t){const l=i+t*C;if(l>=0&&l<m){const i=ue([R,n,l,a],h,ie(r.shape)),c=ue([e,t,a],p,ie(s.shape)),f=u[i]+d[c];f>o&&(o=f)}}}A[ue([R,e,n,a],N,ie(I))]=o}}}return{dataId:c.write(sr(A,r.dtype),I,r.dtype),shape:I,dtype:r.dtype}}},Xw={kernelName:gt,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:i}=e;const{x:r,filter:s,dy:a}=t,{strides:o,pad:l,dilations:c}=i,u=n,h=se(r.shape,u.data.get(r.dataId).values),d=se(s.shape,u.data.get(s.dataId).values),{batchSize:p,inHeight:f,inWidth:g,inChannels:m,outHeight:y,outWidth:b,padInfo:v,strideHeight:_,strideWidth:x,filterHeight:w,filterWidth:T,dilationHeight:k,dilationWidth:S,outShape:C}=ro(r.shape,s.shape,o,l,"NHWC",c);F(a.rank===C.length,()=>"Error in ".concat(gt,", dy ")+"must have the same rank as output ".concat(C.length,", but got ")+"".concat(a.rank));const I=se(C,u.data.get(a.dataId).values),E=le(s.shape,s.dtype);for(let N=0;N<p;++N)for(let e=0;e<y;++e){const t=e*_-v.top;for(let n=0;n<b;++n){const i=n*x-v.left;for(let r=0;r<m;++r){let s=Number.MIN_SAFE_INTEGER,a=0,o=0;for(let e=0;e<w;++e){const n=t+e*k;if(n>=0&&n<f)for(let t=0;t<T;++t){const l=i+t*S;if(l>=0&&l<g){const i=h[N][n][l][r]+d[e][t][r];i>s&&(s=i,a=e,o=t)}}}E[a][o][r]+=I[N][e][n][r]}}}return{dataId:u.write(sr(E,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}},Kw={kernelName:ft,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:i}=e;const{x:r,filter:s,dy:a}=t,{strides:o,pad:l,dilations:c}=i,u=n,h=se(r.shape,u.data.get(r.dataId).values),d=se(s.shape,u.data.get(s.dataId).values),{batchSize:p,inHeight:f,inWidth:g,inChannels:m,outHeight:y,outWidth:b,padInfo:v,strideHeight:_,strideWidth:x,filterHeight:w,filterWidth:T,dilationHeight:k,dilationWidth:S,outShape:C}=ro(r.shape,s.shape,o,l,"NHWC",c);F(a.rank===C.length,()=>"Error in ".concat(ft,", dy ")+"must have the same rank as output ".concat(C.length,", but got ")+"".concat(a.rank));const I=se(C,u.data.get(a.dataId).values),E=le(r.shape,r.dtype);for(let N=0;N<p;++N)for(let e=0;e<y;++e){const t=e*_-v.top;for(let n=0;n<b;++n){const i=n*x-v.left;for(let r=0;r<m;++r){let s=Number.MIN_SAFE_INTEGER,a=t<0?0:t,o=i<0?0:i;for(let e=0;e<w;++e){const n=t+e*k;if(n>=0&&n<f)for(let t=0;t<T;++t){const l=i+t*S;if(l>=0&&l<g){const i=h[N][n][l][r]+d[e][t][r];i>s&&(s=i,a=n,o=l)}}}E[N][a][o][r]+=I[N][e][n][r]}}}return{dataId:u.write(sr(E,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};const Yw={kernelName:mt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{image:r}=t,{canvas:s,options:a}=i,{contextOptions:o,imageOptions:l}=a||{},c=(null===l||void 0===l?void 0:l.alpha)||1,u=(null===o||void 0===o?void 0:o.contextType)||"2d";if("2d"!==u)throw new Error("Context type ".concat(o.contextType," is not supported by the CPU backend."));const h=s.getContext(u,(null===o||void 0===o?void 0:o.contextAttributes)||{});if(null==h)throw new Error("Could not get the context with ".concat(u," type."));const[d,p]=r.shape.slice(0,2),f=2===r.shape.length?1:r.shape[2],g=n.data.get(r.dataId).values,m="float32"===r.dtype?255:1,y=new Uint8ClampedArray(p*d*4);for(let v=0;v<d*p;++v){const e=[0,0,0,255*c];for(let n=0;n<f;n++){const t=g[v*f+n];if("float32"===r.dtype){if(t<0||t>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(t,"."))}else if("int32"===r.dtype&&(t<0||t>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(t,"."));1===f?(e[0]=t*m,e[1]=t*m,e[2]=t*m):e[n]=t*m}const t=4*v;y[t+0]=Math.round(e[0]),y[t+1]=Math.round(e[1]),y[t+2]=Math.round(e[2]),y[t+3]=Math.round(e[3])}s.width=p,s.height=d;const b=new ImageData(y,p,d);return h.putImageData(b,0,0),r}},Qw=K_((e,t)=>e*t),$w=gx((e,t,n,i)=>({real:e*n-t*i,imag:e*i+t*n})),Jw=fx(pn,Qw,$w),Zw={kernelName:pn,backendName:"cpu",kernelFunc:Jw};function eT(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;let o;F_(r,"sum"),o="bool"===r.dtype?dx({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):H_({inputs:{x:r},backend:n});const l=o.shape.length,c=q(s,o.shape),u=yl(c,l);let h=c,d=o;null!=u&&(d=Ox({inputs:{x:o},backend:n,attrs:{perm:u}}),h=vl(h.length,l)),ml("sum",h,d.shape.length);const[p,f]=fl(d.shape,h);let g=lx(n,p,Dr(d.dtype,"int32"));const m=B(f),y=n.data.get(g.dataId).values,b=n.data.get(d.dataId).values;for(let v=0;v<y.length;++v){const e=v*m;let t=0;for(let n=0;n<m;++n)t+=b[e+n];y[v]=t}if(a){const e=g;g=_x({inputs:{x:g},backend:n,attrs:{shape:gl(g.shape,c)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(o),null!=u&&n.disposeIntermediateTensorInfo(d),g}const tT={kernelName:ei,backendName:"cpu",kernelFunc:eT};const nT={kernelName:bt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{equation:r}=i,s=t,{allDims:a,summedDims:o,idDims:l}=Qu(r,s.length);Ju(a.length,l,s);const{path:c,steps:u}=Zu(o,l),h=u.length;let d=null,p=a.length;const f=[];for(let g=0;g<h;++g){for(const e of u[g]){const{permutationIndices:t,expandDims:i}=$u(p,l[e]);let r;eh(t)?r=s[e]:(r=Ox({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),f.push(r));const a=r.shape.slice();for(let e=0;e<i.length;++e)a.splice(i[e],0,1);z(r.shape,a)||(r=_x({inputs:{x:r},backend:n,attrs:{shape:a}}),f.push(r)),null===d?d=r:(d=Jw({inputs:{a:r,b:d},backend:n}),f.push(d))}g<h-1&&(c[g]>=0&&(d=eT({inputs:{x:d},backend:n,attrs:{axis:c[g]-(a.length-p),keepDims:!1}}),f.push(d)),p--)}for(const g of f)g!==d&&n.disposeIntermediateTensorInfo(g);return d}};const iT={kernelName:_t,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:i,y:r}=t;F_([i,r],"eluGrad");const s=new Float32Array(B(r.shape)),a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values;for(let l=0;l<a.length;++l){const e=a[l];s[l]=e>=0?o[l]:o[l]*(e+1)}return n.makeTensorInfo(r.shape,"float32",s)}},rT=K_((e,t)=>e===t?1:0),sT=fx(wt,rT,null,"bool"),aT={kernelName:wt,backendName:"cpu",kernelFunc:sT},oT=Du,lT=Ou,cT=Lu,uT=Pu,hT=Fu,dT=Mu,pT=z_(xt,e=>{const t=Math.sign(e),n=Math.abs(e),i=1/(1+oT*n);return t*(1-((((dT*i+hT)*i+uT)*i+cT)*i+lT)*i*Math.exp(-n*n))}),fT={kernelName:xt,backendName:"cpu",kernelFunc:pT},gT=B_(e=>Math.exp(e)),mT=V_(Tt,gT,"float32"),yT={kernelName:Tt,backendName:"cpu",kernelFunc:mT};function bT(e){const{inputs:t,backend:n,attrs:i}=e,{input:r}=t,{dim:s}=i,a=r.shape.length,o=r.shape.slice();let l=s;return s<0&&(F(-(a+1)<=s,()=>"Axis must be in the interval [".concat(-(a+1),", ").concat(a,"]")),l=a+s+1),o.splice(l,0,1),_x({inputs:{x:r},backend:n,attrs:{shape:o}})}const vT={kernelName:kt,backendName:"cpu",kernelFunc:bT},_T=B_(e=>Math.expm1(e)),xT=V_(St,_T),wT={kernelName:St,backendName:"cpu",kernelFunc:xT},TT=K_((e,t)=>e/t),kT=fx(yt,TT),ST={kernelName:yt,backendName:"cpu",kernelFunc:kT},CT=K_((e,t)=>e-t),IT=gx((e,t,n,i)=>({real:e-n,imag:t-i})),ET=fx(mi,CT,IT),NT={kernelName:mi,backendName:"cpu",kernelFunc:ET};function AT(e,t,n){const i=e.shape,r=i[0],s=i[1],a=n.data.get(e.dataId),o=a.complexTensorInfos.real,l=a.complexTensorInfos.imag,c=[r,s],u=B(c),h=K("float32",u),d=K("float32",u);for(let m=0;m<r;m++){const e=sw({inputs:{x:o},backend:n,attrs:{begin:[m,0],size:[1,s]}}),i=sw({inputs:{x:l},backend:n,attrs:{begin:[m,0],size:[1,s]}}),r=ax({inputs:{real:e,imag:i},backend:n}),{real:a,imag:c}=RT(r,t,n),u=Uu(a,c);for(let t=0;t<s;t++){const e=ju(u,t);h[m*s+t]=e.real,d[m*s+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r)}const p=n.makeTensorInfo(c,"float32",h),f=n.makeTensorInfo(c,"float32",d),g=ax({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}function RT(e,t,n){const i=B(e.shape),r=n.data.get(e.dataId),s=n.data.get(r.complexTensorInfos.real.dataId).values,a=n.data.get(r.complexTensorInfos.imag.dataId).values;if(0===((o=i)&o-1)){const r=DT(s,a,i,t,n),o=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(o,"float32",r.real),t=n.makeTensorInfo(o,"float32",r.imag),s=n.makeTensorInfo([],"float32",rr(i,"float32")),a=H_({inputs:{x:s},backend:n}),l=ST.kernelFunc({inputs:{a:e,b:s},backend:n}),c=ST.kernelFunc({inputs:{a:t,b:a},backend:n}),u=n.data.get(l.dataId).values,h=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),{real:u,imag:h}}return r}{const e=function(e,t,n){const i=new Float32Array(2*t);for(let r=0;r<t;r++){let s=0,a=0;for(let i=0;i<t;i++){const o=Gu(r*i,t,n),l=ju(e,i);s+=l.real*o.real-l.imag*o.imag,a+=l.real*o.imag+l.imag*o.real}n&&(s/=t,a/=t),Wu(i,s,a,r)}return i}(Uu(s,a),i,t);return Bu(e)}var o}function DT(e,t,n,i,r){if(1===n)return{real:e,imag:t};const s=Uu(e,t),a=n/2,o=zu(s),l=o.real,c=o.imag,u=[l.length],h=r.makeTensorInfo(u,"float32",l),d=r.makeTensorInfo(u,"float32",c),p=ax({inputs:{real:h,imag:d},backend:r}),f=Vu(s),g=f.real,m=f.imag,y=[g.length],b=r.makeTensorInfo(y,"float32",g),v=r.makeTensorInfo(y,"float32",m),_=ax({inputs:{real:b,imag:v},backend:r}),x=DT(l,c,a,i,r),w=x.real,T=x.imag,k=[w.length],S=r.makeTensorInfo(k,"float32",w),C=r.makeTensorInfo(k,"float32",T),I=ax({inputs:{real:S,imag:C},backend:r}),E=DT(g,m,a,i,r),N=E.real,A=E.imag,R=[N.length],D=r.makeTensorInfo(R,"float32",N),O=r.makeTensorInfo(R,"float32",A),L=ax({inputs:{real:D,imag:O},backend:r}),P=Hu(n,i),F=[P.real.length],M=r.makeTensorInfo(F,"float32",P.real),U=r.makeTensorInfo(F,"float32",P.imag),B=ax({inputs:{real:M,imag:U},backend:r}),z=Jw({inputs:{a:B,b:L},backend:r}),V=bx({inputs:{a:I,b:z},backend:r}),j=ET({inputs:{a:I,b:z},backend:r}),W=cx({inputs:{input:V},backend:r}),H=cx({inputs:{input:j},backend:r}),G=xw({inputs:{input:V},backend:r}),q=xw({inputs:{input:j},backend:r}),X=Tw({inputs:[W,H],backend:r,attrs:{axis:0}}),K=Tw({inputs:[G,q],backend:r,attrs:{axis:0}}),Y=r.data.get(X.dataId).values,Q=r.data.get(K.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(U),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(V),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(K),{real:Y,imag:Q}}const OT={kernelName:Ct,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t,r=B(i.shape),s=i.shape[i.shape.length-1],a=_x({inputs:{x:i},backend:n,attrs:{shape:[r/s,s]}}),o=AT(a,!1,n),l=_x({inputs:{x:o},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),l}};function LT(e){const{backend:t,attrs:n}=e,{shape:i,value:r,dtype:s}=n,a=s||ee(r),o=Y(a,B(i));return function(e,t){e.fill(t)}(o,r),t.makeTensorInfo(i,a,o)}const PT={kernelName:It,backendName:"cpu",kernelFunc:LT};const FT={kernelName:Et,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:i}=e;const{image:r}=t,s=i,a=K(r.dtype,B(r.shape)),[o,l,c,u]=r.shape,h=s.data.get(r.dataId).values;for(let d=0;d<o;d++){const e=d*c*l*u;for(let t=0;t<l;t++){const n=t*(c*u);for(let t=0;t<c;t++){const i=t*u;for(let r=0;r<u;r++){const s=Math.round(c-t-1),o=e+n+i+r;let l=h[o];if(s>=0&&s<c){l=h[e+n+s*u+r]}a[o]=l}}}}return{dataId:s.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},MT=B_(e=>Math.floor(e)),UT=V_(Nt,MT),BT={kernelName:Nt,backendName:"cpu",kernelFunc:UT},zT=K_((e,t)=>Math.floor(e/t)),VT=fx(At,zT,null,"int32"),jT={kernelName:At,backendName:"cpu",kernelFunc:VT};const WT={kernelName:Ri,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i;let g=Sw({inputs:{x:r,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(a){const e=g;if("NCHW"===u&&1===a.shape.length&&1!==a.shape[0]){const e=_x({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=bx({inputs:{a:g,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else g=bx({inputs:{a:g,b:a},backend:n});n.disposeIntermediateTensorInfo(e)}if(p){const e=g;if("NCHW"===u&&"prelu"===p&&1===o.shape.length&&1!==o.shape[0]){const e=_x({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=sx(n,g,p,e,f),n.disposeIntermediateTensorInfo(e)}else g=sx(n,g,p,o,f);n.disposeIntermediateTensorInfo(e)}return g}};const HT={kernelName:Di,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i;let g=Vw({inputs:{x:r,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(a){const e=g;g=bx({inputs:{a:g,b:a},backend:n}),n.disposeIntermediateTensorInfo(e)}if(p){const e=g;g=sx(n,g,p,o,f),n.disposeIntermediateTensorInfo(e)}return g}};function GT(e,t,n,i,r,s,a,o,l){const c=Vs([i,s],n);for(let u=0;u<i;u++){const n=[];let i=0;for(let t=0;t<r;t++){const s=e[u*r+t];i+=s*a[t],n.push(s)}if(i<0||i>=l/s)throw new Error("Invalid indices: ".concat(n," does not index into ").concat(o));for(let e=0;e<s;e++)c.values[u*s+e]=t.get(...t.indexToLoc(i*s+e))}return c}const qT={kernelName:Ot,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:i,indices:r}=t,s=B(i.shape),a=r.shape,o=a[a.length-1],[l,c,u,h]=Cu(i,r);if(0===c)return n.makeTensorInfo(l,i.dtype,[]);const d=GT(n.data.get(r.dataId).values,n.bufferSync(i),i.dtype,c,o,u,h,i.shape,s);return n.makeTensorInfo(l,i.dtype,d.values)}};function XT(e,t,n){const i=Vs(n,e.dtype);for(let r=0;r<i.size;++r){const n=i.indexToLoc(r).slice(),s=n[0],a=n[2],o=t.locToIndex([s,a]);n[2]=t.values[o];const l=e.locToIndex(n);0<=l&&l<e.values.length&&(i.values[r]=e.values[l])}return i}const KT={kernelName:Dt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,indices:s}=t,{axis:a,batchDims:o}=i;F_([r,s],"gatherV2");const l=q(a,r.shape)[0],c=n.data.get(s.dataId).values,u=r.shape[l];for(let v=0;v<c.length;++v){const e=c[v];F(e<=u-1&&e>=0,()=>"GatherV2: the index value ".concat(e," is not in [0, ").concat(u-1,"]"))}let h=o;null==o&&(h=0);const d=B(s.shape),p=yh(r,s,l,h),f=_x({inputs:{x:r},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=_x({inputs:{x:s},backend:n,attrs:{shape:[p.batchSize,d/p.batchSize]}}),m=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize],y=n.bufferSync(g),b=XT(n.bufferSync(f),y,m);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(p.outputShape,b.dtype,b.values)}},YT=K_((e,t)=>e>t?1:0),QT=fx(Lt,YT,null,"bool"),$T={kernelName:Lt,backendName:"cpu",kernelFunc:QT},JT=K_((e,t)=>e>=t?1:0),ZT=fx(Pt,JT,null,"bool"),ek={kernelName:Pt,backendName:"cpu",kernelFunc:ZT};const tk={kernelName:Mt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t,r=B(i.shape),s=i.shape[i.shape.length-1],a=_x({inputs:{x:i},backend:n,attrs:{shape:[r/s,s]}}),o=AT(a,!0,n),l=_x({inputs:{x:o},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),l}},nk=z_(Bt,e=>Number.isFinite(e)?1:0,"bool"),ik={kernelName:Bt,backendName:"cpu",kernelFunc:nk},rk=z_(zt,e=>Math.abs(e)===1/0?1:0,"bool"),sk={kernelName:zt,backendName:"cpu",kernelFunc:rk},ak=z_(Vt,e=>Number.isNaN(e)?1:0,"bool"),ok={kernelName:Vt,backendName:"cpu",kernelFunc:ak},lk=K_((e,t)=>e<t?1:0),ck=fx(Wt,lk,null,"bool"),uk={kernelName:Wt,backendName:"cpu",kernelFunc:ck},hk=K_((e,t)=>e<=t?1:0),dk=fx(Ht,hk,null,"bool"),pk={kernelName:Ht,backendName:"cpu",kernelFunc:dk};function fk(e,t,n){const i=(t-e)/(n-1),r=oe(n,"float32");r[0]=e;for(let s=1;s<r.length;s++)r[s]=r[s-1]+i;return r}const gk={kernelName:Gt,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:i,stop:r,num:s}=n,a=fk(i,r,s);return t.makeTensorInfo([a.length],"float32",a)}},mk=B_(e=>Math.log(e)),yk=V_(qt,mk),bk={kernelName:qt,backendName:"cpu",kernelFunc:yk},vk=z_(Xt,e=>Math.log1p(e)),_k={kernelName:Xt,backendName:"cpu",kernelFunc:vk},xk=K_((e,t)=>e&&t),wk=fx(Kt,xk,null,"bool"),Tk={kernelName:Kt,backendName:"cpu",kernelFunc:wk},kk=z_(Yt,e=>e?0:1,"bool"),Sk={kernelName:Yt,backendName:"cpu",kernelFunc:kk},Ck=K_((e,t)=>e||t),Ik=fx(Qt,Ck,null,"bool"),Ek={kernelName:Qt,backendName:"cpu",kernelFunc:Ik};const Nk={kernelName:$t,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{depthRadius:s,bias:a,alpha:o,beta:l}=i;F_(r,"LRN");const c=r.shape[3],u=c-1,h=n.data.get(r.dataId).values,d=B(r.shape),p=new Float32Array(d);function f(e){const t=e%c;let n=e-t+Math.max(0,t-s);const i=e-t+Math.min(t+s,u);let r=0;for(;n<=i;n++){const e=h[n];r+=e*e}return r}for(let g=0;g<d;g++){const e=f(g),t=h[g]*Math.pow(a+o*e,-l);p[g]=t}return n.makeTensorInfo(r.shape,r.dtype,p)}};const Ak={kernelName:Jt,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,y:s,dy:a}=t,{depthRadius:o,bias:l,alpha:c,beta:u}=i;F_(a,"LRNGrad");const h=B(a.shape),d=a.shape[3],p=n.data.get(a.dataId).values,f=n.data.get(r.dataId).values,g=n.data.get(s.dataId).values,m=new Float32Array(h),y=h;for(let b=0;b<y;b++){const e=b%d,t=b-e+Math.max(0,e-o),n=b-e+Math.min(d,e+o+1);let i=0;for(let r=t;r<n;r++)i+=Math.pow(f[r],2);i=c*i+l;for(let r=t;r<n;r++){let e=-2*c*u*f[r]*g[b]/i;b===r&&(e+=Math.pow(i,-u)),e*=p[b],m[r]+=e}}return n.makeTensorInfo(a.shape,r.dtype,m)}};function Rk(e,t,n,i){const r=K(i,B(n));for(let s=0;s<r.length;++s){const n=s*t;let i=e[n];for(let r=0;r<t;++r){const t=e[n+r];(Number.isNaN(t)||t>i)&&(i=t)}r[s]=i}return r}function Dk(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{reductionIndices:s,keepDims:a}=i,o=n;let l=r.shape;const c=l.length,u=q(s,l);let h=u;const d=yl(h,c);let p=o.data.get(r.dataId).values;if(null!=d){const e=new Array(c);for(let t=0;t<e.length;t++)e[t]=l[d[t]];p=Dx(p,l,r.dtype,d,e),h=vl(h.length,c),l=e}F_(r,"max"),ml("max",h,c);const[f,g]=fl(l,h),m=Rk(p,B(g),f,r.dtype),y=o.write(m,f,r.dtype);let b=f;if(a){b=gl(f,u)}return{dataId:y,shape:b,dtype:r.dtype}}const Ok={kernelName:Zt,backendName:"cpu",kernelFunc:Dk},Lk=K_((e,t)=>Math.max(e,t)),Pk=fx(en,Lk),Fk={kernelName:en,backendName:"cpu",kernelFunc:Pk};const Mk={kernelName:tn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;F_(r,"maxPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=i;F(mo(a,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(1,"'"));const c=so(r.shape,s,a,1,o,l);let u;if(1===c.filterWidth&&1===c.filterHeight&&z(c.inShape,c.outShape))u=H_({inputs:{x:r},backend:n});else{const e=n.data.get(r.dataId).values,t=ie(r.shape),i=Qx(e,r.shape,r.dtype,t,c,"max");u=n.makeTensorInfo(c.outShape,r.dtype,i.values)}return u}};const Uk={kernelName:rn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=i;F_(r,"maxPool3d");const u=ao(r.shape,s,a,1,o,l,c),h=Jx(n.data.get(r.dataId).values,r.shape,r.dtype,ie(r.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};const Bk={kernelName:sn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=i;F_([r,s],"maxPool3DGrad");const u=ao(s.shape,a,o,1,l,c),h=function(e,t){const n=Vs(t.outShape,"int32"),i=t.strideDepth,r=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let m=0;m<t.inChannels;++m)for(let y=0;y<t.outDepth;++y){const b=y*i-d;let v=b;for(;v<0;)v+=a;const _=Math.min(t.inDepth,c+b);for(let i=0;i<t.outHeight;++i){const c=i*r-p;let d=c;for(;d<0;)d+=o;const x=Math.min(t.inHeight,u+c);for(let r=0;r<t.outWidth;++r){const p=r*s-f;let w=p;for(;w<0;)w+=l;const T=Math.min(t.inWidth,h+p);let k=Number.NEGATIVE_INFINITY,S=-1;for(let t=v;t<_;t+=a){const n=t-b;for(let i=d;i<x;i+=o){const r=i-c;for(let s=w;s<T;s+=l){const a=s-p,o=e.get(g,t,i,s,m);o>=k&&(k=o,S=n*u*h+r*u+a)}}}n.set(S,g,y,i,r,m)}}}return n}(n.bufferSync(s),u),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,g=u.dilationDepth,m=u.dilationHeight,y=u.dilationWidth,b=u.effectiveFilterDepth,v=u.effectiveFilterHeight,_=u.effectiveFilterWidth,x=b-1-u.padInfo.front,w=_-1-u.padInfo.left,T=v-1-u.padInfo.top,k=Vs(s.shape,"float32"),S=n.bufferSync(r);for(let C=0;C<u.batchSize;++C)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let i=0;i<u.inWidth;++i){const r=t-x,s=n-T,a=i-w;let o=0;for(let t=0;t<b;t+=g){const n=(r+t)/d;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let i=0;i<v;i+=m){const r=(s+i)/p;if(!(r<0||r>=u.outHeight||Math.floor(r)!==r))for(let s=0;s<_;s+=y){const l=(a+s)/f;if(l<0||l>=u.outWidth||Math.floor(l)!==l)continue;const c=b*v*_-1-h.get(C,n,r,l,e)===t*v*_+i*_+s?1:0;if(0===c)continue;o+=S.get(C,n,r,l,e)*c}}}k.set(o,C,t,n,i,e)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};const zk={kernelName:nn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s,output:a}=t,o=s;F_([s,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=i,d=so(o.shape,l,c,1,u,h),p=n.data.get(o.dataId).values,f=Vs(d.outShape,o.dtype,$x(p,o.shape,o.dtype,d).values),g=d.strideHeight,m=d.strideWidth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterHeight,_=d.effectiveFilterWidth,x=_-1-d.padInfo.left,w=v-1-d.padInfo.top,T=Vs(o.shape,"float32"),k=n.data.get(r.dataId).values,S=Vs(r.shape,"float32",k);for(let C=0;C<d.batchSize;++C)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inHeight;++t)for(let n=0;n<d.inWidth;++n){const i=t-w,r=n-x;let s=0;for(let t=0;t<v;t+=y){const n=(i+t)/g;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let i=0;i<_;i+=b){const a=(r+i)/m;if(a<0||a>=d.outWidth||Math.floor(a)!==a)continue;const o=v*_-1-f.get(C,n,a,e)===t*_+i?1:0;if(0===o)continue;s+=S.get(C,n,a,e)*o}}T.set(s,C,t,n,e)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};const Vk={kernelName:an,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:i}=e;const{x:r}=t,{filterSize:s,strides:a,pad:o,includeBatchInIndex:l}=n,c=i;F_(r,"MaxPoolWithArgmax");const u=c.data.get(r.dataId).values,h=so(r.shape,s,a,[1,1],o),[d,p]=function(e,t,n,i,r){const s=Qx(e,0,n,ie(t),r,"max"),a=$x(e,t,n,r,!0,i);return[s.values,a.values]}(u,r.shape,r.dtype,l,h),f=c.write(d,h.outShape,r.dtype),g=c.write(p,h.outShape,r.dtype);return[{dataId:f,shape:h.outShape,dtype:r.dtype},{dataId:g,shape:h.outShape,dtype:"int32"}]}};const jk={kernelName:on,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=q(s,r.shape),l=B(fl(r.shape,o)[1]),c=[],u=n.makeTensorInfo([],"float32",new Float32Array([l]));c.push(u);const h=dx({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});c.push(h);const d=kT({inputs:{a:h,b:u},backend:n});c.push(d);const p=eT({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:a}});return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}};const Wk={kernelName:ln,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;F_(r,"min");const o=q(s,r.shape);let l=o;const c=yl(l,r.shape.length);let u=r;null!=c&&(u=Ox({inputs:{x:r},backend:n,attrs:{perm:c}}),l=vl(l.length,r.shape.length)),ml("min",l,u.shape.length);const[h,d]=fl(u.shape,l),p=B(d),f=oe(B(h),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=g[e];for(let n=0;n<p;++n){const i=g[e+n];(Number.isNaN(i)||i<t)&&(t=i)}f[y]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,f);if(a){const e=_x({inputs:{x:m},backend:n,attrs:{shape:gl(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}},Hk=K_((e,t)=>Math.min(e,t)),Gk=fx(cn,Hk),qk={kernelName:cn,backendName:"cpu",kernelFunc:Gk};const Xk={kernelName:un,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{paddings:s,mode:a}=i;F_(r,"mirrorPad");const o=s.map((e,t)=>e[0]+r.shape[t]+e[1]),l=s.map(e=>e[0]),c=s.map((e,t)=>e[0]+r.shape[t]),u="reflect"===a?0:1,h=n.data.get(r.dataId).values,d=r.shape.length,p=ie(r.shape),f=B(o),g=o.length,m=ie(o),y=K(r.dtype,f);for(let b=0;b<f;b++){let e=he(b,g,m);for(let n=0;n<g;n++)e[n]<l[n]?e[n]=2*l[n]-e[n]-u:e[n]>=c[n]&&(e[n]=2*(c[n]-1)-e[n]+u);e=e.map((e,t)=>e-l[t]);const t=ue(e,d,p);y[b]=h[t]}return{dataId:n.write(y,o,r.dtype),shape:o,dtype:r.dtype}}},Kk=K_((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),Yk=fx(hn,Kk),Qk={kernelName:hn,backendName:"cpu",kernelFunc:Yk};function $k(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{dim:s}=i,a=r.shape.length;let o=s;if(-1===o&&(o=a-1),o!==a-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(a," and dim was ").concat(o));const l=q([o],r.shape),c=Dk({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=gl(c.shape,l),h=_x({inputs:{x:c},backend:n,attrs:{shape:u}}),d=ET({inputs:{a:r,b:h},backend:n}),p=mT({inputs:{x:d},backend:n}),f=eT({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),g=_x({inputs:{x:f},backend:n,attrs:{shape:u}}),m=kT({inputs:{a:p,b:g},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}const Jk={kernelName:ii,backendName:"cpu",kernelFunc:$k};const Zk={kernelName:dn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{numSamples:s,seed:a,normalized:o}=i;F_(r,"multinomial");const l=o?r:$k({inputs:{logits:r},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],h=n.data.get(l.dataId).values,d=[c,s],p=oe(B(d),"int32");for(let f=0;f<c;++f){const e=f*u,t=new Float32Array(u-1);t[0]=h[e];for(let r=1;r<t.length;++r)t[r]=t[r-1]+h[e+r];const n=Nl.alea(a.toString()),i=f*s;for(let r=0;r<s;++r){const e=n();p[i+r]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){p[i+r]=n;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",p)}};function eS(e,t,n){const i=rr(-1,n);return Qw([],t,i,e,n)}const tS={kernelName:fn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t;F_(i,"neg");const r=n.data.get(i.dataId).values,[s,a]=eS(r,i.shape,i.dtype);return n.makeTensorInfo(a,i.dtype,s)}},nS=Rc;const iS={kernelName:mn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=i;F_(r,"NonMaxSuppression");const c=n.data.get(r.dataId).values,u=n.data.get(s.dataId).values,{selectedIndices:h}=nS(c,u,a,o,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},rS=Dc;const sS={kernelName:yn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=i;F_(r,"NonMaxSuppressionPadded");const u=n.data.get(r.dataId).values,h=n.data.get(s.dataId).values,{selectedIndices:d,validOutputs:p}=rS(u,h,a,o,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},aS=Oc;const oS={kernelName:bn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=i;F_(r,"NonMaxSuppressionWithScore");const u=n.data.get(r.dataId).values,h=n.data.get(s.dataId).values,d=a,p=o,f=l,g=c,{selectedIndices:m,selectedScores:y}=aS(u,h,d,p,f,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}},lS=K_((e,t)=>e!==t?1:0),cS=fx(gn,lS,null,"bool"),uS={kernelName:gn,backendName:"cpu",kernelFunc:cS};const hS={kernelName:_n,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{indices:r}=t,{dtype:s,depth:a,onValue:o,offValue:l}=i;F_(r,"oneHot");const c=B(r.shape),u=new Float32Array(c*a);u.fill(l);const h=n.data.get(r.dataId).values;for(let d=0;d<c;++d)h[d]>=0&&h[d]<a&&(u[d*a+h[d]]=o);return n.makeTensorInfo([...r.shape,a],s,u)}};function dS(e){const{inputs:t,backend:n}=e,{x:i}=t;if("string"===i.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===i.dtype){const e=cx({inputs:{input:i},backend:n}),t=dS({inputs:{x:e},backend:n}),r=xw({inputs:{input:i},backend:n}),s=dS({inputs:{x:r},backend:n}),a=ax({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),a}return LT({backend:n,attrs:{shape:i.shape,value:0,dtype:i.dtype}})}const pS={kernelName:Ci,backendName:"cpu",kernelFunc:dS};const fS={kernelName:vn,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:i}=t,{x:r}=n;if("string"===r.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===r.dtype){const t=cx({inputs:{input:r},backend:i}),n=e({inputs:{x:t},backend:i}),s=xw({inputs:{input:r},backend:i}),a=dS({inputs:{x:s},backend:i}),o=ax({inputs:{real:n,imag:a},backend:i});return i.disposeIntermediateTensorInfo(t),i.disposeIntermediateTensorInfo(n),i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}return LT({backend:i,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}};function gS(e){const{inputs:t,backend:n,attrs:i}=e,{axis:r}=i;if(1===t.length)return bT({inputs:{input:t[0]},backend:n,attrs:{dim:r}});const s=t[0].shape,a=t[0].dtype;t.forEach(e=>{M(s,e.shape,"All tensors passed to stack must have matching shapes"),F(a===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=t.map(e=>{const t=bT({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t}),c=Tw({inputs:l,backend:n,attrs:{axis:r}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),c}const mS={kernelName:xn,backendName:"cpu",kernelFunc:gS};const yS={kernelName:wn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{paddings:s,constantValue:a}=i;F_(r,"pad");const o=s.map((e,t)=>e[0]+r.shape[t]+e[1]),l=s.map(e=>e[0]),c=n.data.get(r.dataId).values,u=B(r.shape),h=r.shape.length,d=ie(r.shape),p=B(o),f=o.length,g=ie(o),m=K(r.dtype,p);0!==a&&m.fill(a);for(let y=0;y<u;y++){const e=he(y,h,d).map((e,t)=>e+l[t]);m[ue(e,f,g)]=c[y]}return{dataId:n.write(m,o,r.dtype),shape:o,dtype:r.dtype}}},bS=K_((e,t)=>Math.pow(e,t)),vS=fx(Tn,bS),_S={kernelName:Tn,backendName:"cpu",kernelFunc:vS};function xS(e,t,n,i){const[r,s]=fl(e,i),a=Dr(t,"int32"),o=oe(B(r),a),l=B(s);for(let c=0;c<o.length;++c){const e=c*l;let t=1;for(let i=0;i<l;++i)t*=n[e+i];o[c]=t}return{outVals:o,outShape:r,outDtype:a}}const wS={kernelName:Sn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;F_(r,"prod");const o=r.shape.length,l=q(s,r.shape),c=yl(l,o);let u=l,h=r;const d=[];null!=c&&(h=Ox({inputs:{x:r},backend:n,attrs:{perm:c}}),d.push(h),u=vl(u.length,o));const p=n.data.get(h.dataId).values,{outVals:f,outShape:g,outDtype:m}=xS(h.shape,h.dtype,p,u);let y=g;return a&&(y=gl(g,l)),d.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(y,m,f)}};function TS(e,t,n,i){const r=[];let s=0;const a=t.length-1+n.length,o=new Array(a).fill(null).map(()=>[0]);!function(e,t){for(let n=0;n<e.length;++n){const i=e[n],r=n===e.length-1?t:e[n+1].length;if(0===i.length)throw new Error("Ragged splits may not be empty");if(i[0]<0)throw new Error("Ragged splits must be non-negative");if(i[i.length-1]>r)throw new Error("Ragged splits must not point past values");for(let e=1;e<i.length;++e)if(i[e-1]>i[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,i);let l=1;for(let c=0;c<t.length-1;++c){l*=t[c];const e=t[c+1];for(let t=1;t<l+1;++t)o[c].push(t*e)}for(let c=0;c<e.length;++c){let i=e[c],a=e[c]+1;for(let e=0;e<n.length;++e){const r=n[e],s=e+t.length-1;if(s>=0){const e=o[s],t=e[e.length-1]-r[i];for(let n=i;n<a;++n)o[s].push(r[n+1]+t)}i=r[i],a=r[a]}a!==i&&(r.push([i,a]),s+=a-i)}return{outSplits:o,valueSlices:r,numValues:s}}function kS(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let i=t;i<e.length;i++)n[t-1]*=e[i];return n}function SS(e,t,n,i,r){const s=t.slice();s[0]=r;const a=Y(n,B(s)),o=e.length;return function(e,t,n,i,r,s){const a=kS(t,2)[1],o=kS(s,2)[1];let l=0;for(const c of n)for(let t=c[0];t<c[1];++t){for(let n=0;n<i;++n)r[l*o+n]=e[t*a+n];++l}}(e,t,i,0===o?0:o/t[0],a,s),[a,s]}function CS(e,t,n,i,r,s,a,o){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((e,i)=>{if(e<0||e>=n){const r=he(i,t.length,ie(t)).join(",");throw new Error("indices[".concat(r,"] = ").concat(e," is not in [0, ").concat(n,")"))}})}(s,a,t[0][0]-1),0===i.length)throw new Error("params.rank must be nonzero");const l=i[0],{outSplits:c,valueSlices:u,numValues:h}=TS(s,a,e,l),d=function(e){const t=[];for(let n=0;n<e.length;++n){const i=Y("int32",e[n].length);t.push(i),e[n].forEach((e,t)=>i[t]=e)}return t}(c),p=SS(n,i,r,u,h);return[d,p[0],p[1]]}const IS={kernelName:Cn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{paramsNestedSplits:r,paramsDenseValues:s,indices:a}=t,{outputRaggedRank:o}=i,l=r.map(e=>n.data.get(e.dataId).values),c=r.map(e=>e.shape),u=n.data.get(s.dataId).values,h=n.data.get(a.dataId).values,[d,p,f]=CS(l,c,u,s.shape,s.dtype,h,a.shape),g=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),m=n.makeTensorInfo(f,s.dtype,p);return g.concat([m])}},ES=2147483647;function NS(e,t,n,i,r,s,a){if(t.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(a.length>1)throw new Error("deltas must be a scalar or vector");const o=0===t.length,l=0===r.length,c=0===a.length,u=[];o||u.push(t[0]),l||u.push(r[0]),c||u.push(a[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");const h=0===u.length?1:u[0],d=Y("int32",h+1);d[0]=0;for(let g=0;g<h;++g){const t=o?e[0]:e[g],n=l?i[0]:i[g],r=c?s[0]:s[g];if(0===r)throw new Error("Requires delta != 0");let a;if(r>0&&n<t||r<0&&n>t)a=0;else if(a=Math.ceil(Math.abs((n-t)/r)),a>ES)throw new Error("Requires ((limit - start) / delta) <= ".concat(ES));d[g+1]=d[g]+a}const p=Y(n,d[h]);let f=0;for(let g=0;g<h;++g){const t=d[g+1]-d[g];let n=o?e[0]:e[g];const i=c?s[0]:s[g];for(let e=0;e<t;++e)p[f++]=n,n+=i}return[d,p]}const AS={kernelName:In,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:i,limits:r,deltas:s}=t,a=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values,l=n.data.get(s.dataId).values,[c,u]=NS(a,i.shape,i.dtype,o,r.shape,l,s.shape);return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([u.length],i.dtype,u)]}};var RS=pu;class DS{constructor(e,t,n,i,r,s,a,o,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=i,this.valuesDType=r,this.defaultValue=s,this.defaultValueShape=a,this.rowPartitionValues=o,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=gu(c),this.raggedRank=mu(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===RS.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===RS.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case RS.VALUE_ROWIDS:return DS.getMaxWidthValueRowID(t);case RS.ROW_SPLITS:return DS.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(RS[this.getRowPartitionTypeByDimension(e-1)]))}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let i=0;i<t-1;++i){const t=e[i+1]-e[i];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,i=e[0],r=0;for(let s=1;s<t;++s){const t=e[s];t!==i&&(i=t,r=Math.max(s-n,r),n=s)}return Math.max(t-n,r)}tensorShapeFromTensor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return LS(e,n)}calculateOutputSize(e){const t=this.valuesShape;yu(this.defaultValueShape,t);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=fu(this.raggedRank,n,t);i[0]<0&&(i[0]=e);for(let r=1;r<=this.raggedRank;++r)i[r]<0&&(i[r]=this.getMaxWidth(r));return i}calculateFirstParentOutputIndex(e,t,n){const i=Math.min(e,n),r=[];let s=0;for(let a=0;a<i;++a,s+=t)r.push(s);for(let a=i;a<e;++a)r.push(-1);return F(r.length===e,()=>"Final length of result must be equal to firstDimension."),r}calculateOutputIndexRowSplit(e,t,n,i){const r=e.length,s=[];for(let a=0;a<r-1;++a){const r=e[a+1]-e[a];let o=Math.min(i,r),l=t[a];-1===l&&(o=0);for(let e=0;e<o;++e)s.push(l),l+=n;for(let e=0;e<r-o;++e)s.push(-1)}if(r>0&&s.length!==e[r-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(e,t,n,i){const r=e.length,s=[];if(0===r)return[];let a=0,o=e[0];if(o>=t.length)throw new Error("Got currentValueRowId=".concat(o,", which is not less than ").concat(t.length));let l=t[o];s.push(l);for(let c=1;c<r;++c){const r=e[c];if(r===o)l>=0&&(++a,a<i?l+=n:l=-1);else{if(a=0,o=r,r>=t.length)throw new Error("Got nextValueRowId=".concat(r," which is not less than ").concat(t.length));l=t[r]}s.push(l)}if(s.length!==e.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(e,t,n,i){const r=this.getRowPartitionTensor(e),s=this.getRowPartitionTypeByDimension(e);switch(s){case RS.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(r,t,n,i);case RS.ROW_SPLITS:if(r.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(r.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(r,t,n,i);default:throw new Error("Unsupported partition type: ".concat(RS[s]))}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case RS.FIRST_DIM_SIZE:return e[0];case RS.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case RS.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(RS[t]))}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let s=n.length-2;s>=0;--s)n[s]=n[s+1]*t[s+1];const i=LS(t,!1),r=Y(this.valuesDType,B(i));if(n[0]*t[0]>0){let s=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e){s=this.calculateOutputIndex(e-1,s,n[e],t[e])}this.setOutput(this.raggedRank,s,r,i)}return[i,r]}setOutput(e,t,n,i){if(0===n.length)return;const r=this.values,s=n;let a=i.slice();a=a.slice(e+1);const o=B(a),l=t.length;let c=this.defaultValue;if(c.length!==o&&1!==c.length){const e=this.defaultValueShape;Xs(()=>{const t=_o(c,e),n=Io(t,a);c=n.dataSync()})}let u=0,h=0,d=0;for(let p=0;p<=l;++p){let e=p<l?t[p]:-1;if(e!==d){if(h<d){const e=r.subarray(u*o);OS(s.subarray(h*o),e,(d-h)*o)}if(p>=l){const t=n.length;e=Math.floor(t/o)}if(e>d)if(1===this.defaultValue.length)s.subarray(d*o,e*o).fill(this.defaultValue[0]),d=e;else for(;e>d;){OS(s.slice(d*o),c,o),++d}e<0?(u=p+1,h=d):(u=p,h=d,d=h+1)}else++d}}}function OS(e,t,n){for(let i=0;i<n;i++)e[i]=t[i]}function LS(e,t){const n=[];for(let i of e){if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}n.push(i)}return n}function PS(e,t,n,i,r,s,a,o,l,c){return new DS(e,t,n,i,r,s,a,o,l,c).compute()}const FS={kernelName:En,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{shape:r,values:s,defaultValue:a,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=i,c=n.data.get(r.dataId).values,u=n.data.get(s.dataId).values,h=n.data.get(a.dataId).values,d=o.map(e=>n.data.get(e.dataId).values),p=o.map(e=>e.shape),[f,g]=PS(c,r.shape,u,s.shape,s.dtype,h,a.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,g)}};function MS(e,t,n,i){if(e===t||e<t&&n<0||t<e&&n>1)return oe(0,i);const r=oe(Math.abs(Math.ceil((t-e)/n)),i);t<e&&1===n&&(n=-1),r[0]=e;for(let s=1;s<r.length;s++)r[s]=r[s-1]+n;return r}const US={kernelName:Nn,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:i,stop:r,dtype:s,step:a}=n,o=MS(i,r,a,s);return t.makeTensorInfo([o.length],s,o)}},BS=z_(Rn,e=>1/e),zS={kernelName:Rn,backendName:"cpu",kernelFunc:BS};const VS={kernelName:Fn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r}=t,{alignCorners:s,halfPixelCenters:a,size:o}=i;F_(r,"resizeBilinear");const l=ie(r.shape),[c,u]=o,[h,d,p,f]=r.shape,g=n.data.get(r.dataId).values,m=new Float32Array(B([h,c,u,f])),y=[s&&c>1?d-1:d,s&&u>1?p-1:p],b=[s&&c>1?c-1:c,s&&u>1?u-1:u];let v=0;const _=y[0]/b[0],x=y[1]/b[1];for(let w=0;w<h;w++)for(let e=0;e<c;e++){let t;t=a?_*(e+.5)-.5:_*e;const n=Math.max(0,Math.floor(t)),i=t-n,r=Math.min(d-1,Math.ceil(t)),s=w*l[0]+n*l[1],o=w*l[0]+r*l[1];for(let e=0;e<u;e++){let t;t=a?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),r=t-n,c=Math.min(p-1,Math.ceil(t)),u=s+n*l[2],h=o+n*l[2],d=s+c*l[2],y=o+c*l[2];for(let e=0;e<f;e++){const t=g[u+e],n=g[h+e],s=t+(g[d+e]-t)*r,a=s+(n+(g[y+e]-n)*r-s)*i;m[v++]=a}}}return n.makeTensorInfo([h,c,u,f],"float32",m)}};const jS={kernelName:Mn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i;F_([s,r],"resizeBilinearGrad");const o=ie(r.shape),[l,c,u,h]=r.shape,[,d,p]=s.shape,f=new Float32Array(l*c*u*h),g=[a&&d>1?c-1:c,a&&p>1?u-1:u],m=[a&&d>1?d-1:d,a&&p>1?p-1:p],y=g[0]/m[0],b=g[1]/m[1],v=n.data.get(s.dataId).values;let _=0;for(let x=0;x<l;x++){const e=x*o[0];for(let t=0;t<d;t++){const n=t*y,i=Math.floor(n),r=Math.min(Math.ceil(n),c-1),s=e+i*o[1],a=e+r*o[1],l=n-i,d=1-l;for(let e=0;e<p;e++){const t=e*b,n=Math.floor(t),i=Math.min(Math.ceil(t),u-1),r=t-n,c=1-r,p=s+n*o[2],g=s+i*o[2],m=a+n*o[2],y=a+i*o[2],x=d*c,w=d*r,T=l*c,k=l*r;for(let e=0;e<h;e++){const t=v[_++];f[p+e]+=t*x,f[g+e]+=t*w,f[m+e]+=t*T,f[y+e]+=t*k}}}}return n.makeTensorInfo([l,u,c,h],"float32",f)}};const WS={kernelName:Ln,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r}=t,{alignCorners:s,halfPixelCenters:a,size:o}=i;F_(r,"resizeNearestNeighbor");const l=ie(r.shape),[c,u]=o,[h,d,p,f]=r.shape,g=n.data.get(r.dataId).values,m=new Float32Array(h*c*u*f),y=[s&&c>1?d-1:d,s&&u>1?p-1:p],b=[s&&c>1?c-1:c,s&&u>1?u-1:u],v=y[0]/b[0],_=y[1]/b[1];let x=0;for(let w=0;w<h;w++){const e=w*l[0];for(let t=0;t<c;t++){const n=a?v*(t+.5):v*t;let i=Math.min(d-1,s?Math.round(n):Math.floor(n));a&&(i=Math.max(0,i));const r=e+i*l[1];for(let e=0;e<u;e++){const t=a?_*(e+.5):_*e;let n=Math.min(p-1,s?Math.round(t):Math.floor(t));a&&(n=Math.max(0,n));const i=r+n*l[2];for(let e=0;e<f;e++){const t=g[i+e];m[x++]=t}}}}return n.makeTensorInfo([h,c,u,f],r.dtype,m)}};const HS={kernelName:Pn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i;F_([s,r],"resizeNearestNeighborGrad");const o=ie(r.shape),l=ie(s.shape),[c,u,h,d]=r.shape,[,p,f]=s.shape,g=new Float32Array(c*u*h*d),m=n.data.get(s.dataId).values,y=[a&&p>1?u-1:u,a&&f>1?h-1:h],b=[a&&p>1?p-1:p,a&&f>1?f-1:f],v=y[0]/b[0],_=y[1]/b[1],x=1/v,w=1/_,T=2*Math.ceil(x)+2,k=2*Math.ceil(w)+2;for(let S=0;S<c;S++){const e=S*o[0];for(let t=0;t<u;t++){const n=e+t*o[1],i=Math.floor(t*x),r=Math.floor(i-T/2);for(let s=0;s<h;s++){const i=n+s*o[2],c=Math.floor(s*w),y=Math.floor(c-k/2);for(let n=0;n<d;n++){let o=0;for(let i=0;i<T;i++){const c=i+r;if(c<0||c>=p)continue;const d=e+c*l[1],g=c*v;if(t===Math.min(u-1,a?Math.round(g):Math.floor(g)))for(let e=0;e<k;e++){const t=e+y;if(t<0||t>=f)continue;const i=d+t*l[2],r=t*_;s===Math.min(h-1,a?Math.round(r):Math.floor(r))&&(o+=m[i+n])}}g[i+n]=o}}}}return n.makeTensorInfo(r.shape,r.dtype,g)}};const GS={kernelName:Bn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{dims:s}=i;F_(r,"reverse");const a=r.shape.length,o=q(s,r.shape);if(0===a)return H_({inputs:{x:r},backend:n});const l=new vr(r.shape,r.dtype),c=n.bufferSync(r);for(let u=0;u<l.size;u++){const e=l.indexToLoc(u),t=e.slice();o.forEach(e=>t[e]=r.shape[e]-1-t[e]),l.set(c.get(...t),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},qS={kernelName:Ni,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:i}=e;const{image:r}=t,{radians:s,fillValue:a,center:o}=n,l=i,c=K(r.dtype,B(r.shape)),[u,h,d,p]=r.shape,[f,g]=_u(o,h,d),m=Math.sin(s),y=Math.cos(s),b=l.data.get(r.dataId).values;for(let v=0;v<u;v++){const e=v*d*h*p;for(let t=0;t<h;t++){const n=t*(d*p);for(let i=0;i<d;i++){const r=i*p;for(let s=0;s<p;s++){const o=[u,t,i,s],l=o[2],v=o[1];let _=(l-f)*y-(v-g)*m,x=(l-f)*m+(v-g)*y;_=Math.round(_+f),x=Math.round(x+g);let w=a;if("number"!==typeof a&&(w=3===s?255:a[s]),_>=0&&_<d&&x>=0&&x<h){w=b[e+x*(d*p)+_*p+s]}c[e+n+r+s]=w}}}}return{dataId:l.write(c,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},XS=z_(zn,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),KS={kernelName:zn,backendName:"cpu",kernelFunc:XS},YS=B_(e=>1/Math.sqrt(e)),QS=V_(Vn,YS),$S={kernelName:Vn,backendName:"cpu",kernelFunc:QS};function JS(e,t,n,i,r,s,a,o,l,c){const u=[i/r,r],h=e.values,d=t.values;if(0===i)return Vs(n,t.dtype);const p=l instanceof vr?l:Vs(u,t.dtype);"string"===typeof l||"number"===typeof l?p.values.fill(l):"boolean"===typeof l&&p.values.fill(+l);for(let f=0;f<s;f++){const e=[];let s=0;for(let t=0;t<a;t++){const n=h[f*a+t];e.push(n),s+=n*o[t]}if(s<0||s>=i/r)throw new Error("Invalid indices: ".concat(e," does not index into ").concat(n));for(let n=0;n<r;n++)c?p.values[s*r+n]+=d[f*r+n]:p.values[s*r+n]=0===t.rank?d[0]:d[f*r+n]}return p}const ZS={kernelName:jn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{indices:r,updates:s}=t,{shape:a}=i,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=Nu(0,r,a),d=JS(n.bufferSync(r),n.bufferSync(s),a,h,c,l,o,u,0,!0);return n.makeTensorInfo(a,d.dtype,d.values)}};function eC(e,t){let n=0,i=e.length,r=0;for(;n<i;)r=Math.floor((n+i)/2),e[r]<t?n=r+1:i=r;return i}function tC(e,t){let n=0,i=e.length,r=0;for(;n<i;)r=Math.floor((n+i)/2),e[r]<=t?n=r+1:i=r;return i}const nC={kernelName:Hn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{sortedSequence:r,values:s}=t,{side:a}=i,o=function(e,t,n,i,r,s){const a=Y("int32",n*r);for(let o=0;o<n;++o){const n=e.slice(o*i,(o+1)*i),l=o*r;for(let e=0;e<r;++e)a[l+e]="left"===s?eC(n,t[e+l]):tC(n,t[e+l])}return a}(n.data.get(r.dataId).values,n.data.get(s.dataId).values,r.shape[0],r.shape[1],s.shape[1],a);return n.makeTensorInfo(s.shape,"int32",o)}};const iC={kernelName:Gn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:i,t:r,e:s}=t;F_([i,r,s],"select");const a=i.shape.length,o=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(s.dataId).values,u=Dr(r.dtype,s.dtype),h=oe(B(r.shape),u);let d=0;const p=0===a||a>1||1===r.shape.length?1:B(r.shape.slice(1));for(let f=0;f<o.length;f++)for(let e=0;e<p;e++)1===o[f]?h[d++]=l[f]:h[d++]=c[f];return n.makeTensorInfo(r.shape,u,h)}},rC=Au,sC=Ru,aC=z_(qn,e=>e>=0?sC*e:rC*(Math.exp(e)-1)),oC={kernelName:qn,backendName:"cpu",kernelFunc:aC},lC=z_(Qn,e=>e<0?-1:e>0?1:0),cC={kernelName:Qn,backendName:"cpu",kernelFunc:lC},uC=z_(Kn,e=>Math.sin(e)),hC={kernelName:Kn,backendName:"cpu",kernelFunc:uC},dC=z_(Yn,e=>Math.sinh(e)),pC={kernelName:Yn,backendName:"cpu",kernelFunc:dC},fC=Math.log(1.1920928955078125e-7)+2,gC=z_(Jn,e=>{const t=e>-fC,n=e<fC,i=Math.exp(e);let r;return r=n?i:t?e:Math.log(1+i),r}),mC={kernelName:Jn,backendName:"cpu",kernelFunc:gC};const yC={kernelName:ti,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockShape:s,paddings:a}=i;F_([r],"spaceToBatchND");const o=B(s),l=[[0,0]];l.push(...a);for(let m=1+s.length;m<r.shape.length;++m)l.push([0,0]);const c=yS.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),u=xu(c.shape,s,o,!1),h=wu(u.length,s.length,!1),d=Tu(c.shape,s,o,!1),p=_x({inputs:{x:c},backend:n,attrs:{shape:u}}),f=Ox({inputs:{x:p},backend:n,attrs:{perm:h}}),g=_x({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}};function bC(e,t,n,i,r,s,a){const o=t[0],l=s[0],c=new Array(l),u=new Array(o),h=t[1];if(0===l){if(0!==o)throw new Error(ih(o));return[Y(n,0),[0,h],Y(r,0),c,u]}let d=!0,p=0;const f=new Array(l).fill(0);for(let m=0;m<o;++m){const t=e[m*h];if(t<0)throw new Error(rh(m,t));if(t>=l)throw new Error(sh(m,t,l));++f[t],d=d&&t>=p,p=t}let g=!0;for(let m=0;m<l;++m){const e=0===f[m];c[m]=e,g=g&&!e,f[m]=Math.max(f[m],1),m>0&&(f[m]+=f[m-1])}if(g&&d){const t=e,n=i;for(let e=0;e<o;++e)u[e]=e;return[t,[o,h],n,c,u]}{const t=f[l-1],s=Y(n,t*h),d=Y(r,t),p=new Array(l).fill(0);for(let n=0;n<o;++n){const t=e[n*h],r=p[t],a=(0===t?0:f[t-1])+r;p[t]++;for(let i=0;i<h;++i)s[a*h+i]=e[n*h+i];d[a]=i[n],u[n]=a}for(let e=0;e<l;++e){if(0===p[e]){const t=0===e?0:f[e-1];s[t*h+0]=e;for(let e=1;e<h;++e)s[t*h+e]=0;d[t]=a}}return[s,[t,h],d,c,u]}}const vC={kernelName:ri,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:i,values:r,denseShape:s,defaultValue:a}=t;if(1!==s.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(s.shape));if(2!==i.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(i.shape));if(1!==r.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(r.shape));if(0!==a.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(a.shape));const o=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(s.dataId).values,u=n.data.get(a.dataId).values[0],[h,d,p,f,g]=bC(o,i.shape,i.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(d,i.dtype,h),n.makeTensorInfo([d[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(e=>Number(e)))),n.makeTensorInfo([g.length],i.dtype,new Int32Array(g))]}};function _C(e,t,n,i,r){const s=B(i),a=t[0],o=r.length,l=[];let c=1,u=-1;for(let g=0;g<o;++g){const e=r[g];if(-1===e){if(-1!==u)throw new Error(ah(u,g));u=g,l.push(1)}else{if(e<0)throw new Error(oh(g,e));c*=e,l.push(e)}}if(-1!==u){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(s/c);if(c*e!==s)throw new Error(ch(i,l));l[u]=e}if(B(l)!==s)throw new Error(uh(i,l));const h=i.length,d=[];if(h>0){d[h-1]=1;for(let e=h-2;e>=0;--e)d[e]=d[e+1]*i[e+1]}const p=[];if(o>0){p[o-1]=1;for(let e=o-2;e>=0;--e)p[e]=p[e+1]*l[e+1]}const f=Y(n,a*o);for(let g=0;g<a;++g){let t=0;for(let n=0;n<h;++n)t+=e[g*h+n]*d[n];for(let e=0;e<o;++e)f[g*o+e]=Math.trunc(t/p[e]),t%=p[e]}return[f,[a,o],l]}const xC={kernelName:si,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:i,inputShape:r,newShape:s}=t;if(2!==i.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(i.shape));if(1!==r.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(r.shape));if(1!==s.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(s.shape));const a=Array.from(n.data.get(r.dataId).values),o=n.data.get(i.dataId).values,l=Array.from(n.data.get(s.dataId).values),[c,u,h]=_C(o,i.shape,i.dtype,a,l);return[n.makeTensorInfo(u,i.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};function wC(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const o=i.length,l=[t[0],e.length/t[0]],c=l[1],u=o>0?r[o-1]+1:0;if(u<0)throw new Error("segment ids must be >= 0");const h=t.slice();h[0]=u;const d=Y(n,h.reduce((e,t)=>e*t,1));if(0===o)return u>0&&d.fill(a),[d,h];if(u<=0)throw new Error("segment ids must be >= 0");let p=0,f=1,g=0,m=r[p];for(;;){let t=0;if(f<o){if(t=r[f],m===t){++f;continue}if(m>=t)throw new Error(dh())}if(m<0||m>=u)throw new Error(ph(m,u));m>g&&d.fill(a,g*c,m*c);for(let n=p;n<f;++n){const t=i[n];if(t<0||t>=l[0])throw new Error(fh(n,i[n],l[0]));for(let n=0;n<c;n++)d[m*c+n]+=e[t*c+n]}if(s)for(let e=0;e<c;e++)d[m*c+e]/=f-p;if(p=f,++f,g=m+1,m=t,f>o)break}return g<u&&d.fill(a,g*c,u*c),[d,h]}const TC={kernelName:ai,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(r.shape));if(1!==s.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(s.shape));if(r.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const a=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values,l=n.data.get(s.dataId).values,[c,u]=wC(a,i.shape,i.dtype,o,l,!0);return n.makeTensorInfo(u,i.dtype,c)}};const kC={kernelName:oi,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(r.shape));if(1!==s.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(s.shape));if(r.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const a=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values,l=n.data.get(s.dataId).values,[c,u]=wC(a,i.shape,i.dtype,o,l);return n.makeTensorInfo(u,i.dtype,c)}};const SC={kernelName:li,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{sparseIndices:r,sparseValues:s,defaultValue:a}=t,{outputShape:o}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=Nu(0,r,o),p=!1,f=n.bufferSync(r);let g;switch(s.dtype){case"bool":g=JS(f,n.bufferSync(s),o,d,u,c,l,h,Boolean(n.data.get(a.dataId).values[0]),p);break;case"float32":g=JS(f,n.bufferSync(s),o,d,u,c,l,h,n.data.get(a.dataId).values[0],p);break;case"int32":g=JS(f,n.bufferSync(s),o,d,u,c,l,h,n.data.get(a.dataId).values[0],p);break;case"string":g=JS(f,n.bufferSync(s),o,d,u,c,l,h,lr(n.data.get(a.dataId).values[0]),p);break;default:throw new Error("Unsupported type ".concat(s.dtype))}return n.makeTensorInfo(o,g.dtype,g.values)}};const CC={kernelName:ni,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{numOrSizeSplits:s,axis:a}=i,o=q(a,r.shape)[0],l=nh(r,s,o),c=new Array(r.shape.length).fill(0),u=r.shape.slice();return l.map(e=>{const t=[...u];t[o]=e;const i=sw({inputs:{x:r},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,i})}},IC=B_(e=>Math.sqrt(e)),EC=z_(Zn,e=>Math.sqrt(e)),NC={kernelName:Zn,backendName:"cpu",kernelFunc:EC},AC={kernelName:ui,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{x:i}=t,r=n;F_(i,"square");const s=r.data.get(i.dataId).values,a=new Float32Array(s.length);for(let o=0;o<s.length;++o){const e=s[o];a[o]=e*e}return{dataId:r.write(a,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},RC=K_((e,t)=>{const n=e-t;return n*n}),DC=fx(ci,RC),OC={kernelName:ci,backendName:"cpu",kernelFunc:DC},LC=B_((e,t)=>{const{pattern:n,replaceGlobal:i,rewrite:r}=t;return e.replace(new RegExp(n,i?"g":""),r)}),PC=V_(hi,LC),FC={kernelName:hi,backendName:"cpu",kernelFunc:PC},MC=z_(Ii,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),UC={kernelName:Ii,backendName:"cpu",kernelFunc:MC};function BC(e,t,n,i){const r=Vs(e,t.dtype);for(let s=0;s<r.size;s++){const e=r.indexToLoc(s),a=new Array(e.length);for(let t=0;t<a.length;t++)a[t]=e[t]*n[t]+i[t];r.set(t.get(...a),...e)}return r}const zC={kernelName:di,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{begin:s,end:a,strides:o,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=i;F_(r,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:b,end:v,strides:_}=Za(r.shape,s,a,o,l,c,u,h,d);let x;if(g)x=_x({inputs:{x:r},backend:n,attrs:{shape:f}});else if(m||y){F(r.shape.length>=1,()=>"Input must have rank at least 1, got: ".concat(r.shape.length));const e=za(b,v,_),t=sw({inputs:{x:r},backend:n,attrs:{begin:b,size:e}});x=_x({inputs:{x:t},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(t)}else{const e=BC(p,n.bufferSync(r),_,b);x=n.makeTensorInfo(f,e.dtype,e.values)}return x}};class VC{constructor(e,t,n,i,r,s){this.separator=or(e),this.nGramWidths=t,this.leftPad=or(n),this.rightPad=or(i),this.padWidth=r,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,i,r,s){for(let a=0;a<r;++a){const o=this.getPadWidth(s),l=Math.max(0,o-a),c=Math.max(0,o-(r-(a+1))),u=s-(l+c),h=t+(l>0?0:a-o);let d=0;d+=l*this.leftPad.length;for(let t=0;t<u;++t)d+=e[h+t].length;d+=c*this.rightPad.length;d+=(l+c+u-1)*this.separator.length,n[i+a]=new Uint8Array(d);const p=n[i+a];let f=0;const g=e=>e.forEach(e=>p[f++]=e);for(let e=0;e<l;++e)g(this.leftPad),g(this.separator);for(let t=0;t<u-1;++t)g(e[h+t]),g(this.separator);if(u>0){g(e[h+u-1]);for(let e=0;e<c;++e)g(this.separator),g(this.rightPad)}else{for(let e=0;e<c-1;++e)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,t){const n=e.length,i=t.length;if(i>0){let e=t[0];if(0!==e)throw new Error("First split value must be 0, got ".concat(e));for(let r=1;r<i;++r){let i=t[r]>=e;if(i=i&&t[r]<=n,!i)throw new Error("Invalid split value ".concat(t[r],", must be in [").concat(e,", ").concat(n,"]"));e=t[r]}if(e!==n)throw new Error("Last split value must be data size. Expected ".concat(n,", got ").concat(e))}const r=i-1,s=Y("int32",i);if(0===n||0===i){const e=new Array(n);for(let t=0;t<=r;++t)s[t]=0;return[e,s]}s[0]=0;for(let o=1;o<=r;++o){const e=t[o]-t[o-1];let n=0;this.nGramWidths.forEach(t=>{n+=this.getNumNGrams(e,t)}),this.preserveShort&&e>0&&0===n&&(n=1),s[o]=s[o-1]+n}const a=new Array(s[r]);for(let o=0;o<r;++o){const n=t[o];let i=s[o];if(this.nGramWidths.forEach(r=>{const s=t[o+1]-t[o],l=this.getNumNGrams(s,r);this.createNGrams(e,n,a,i,l,r),i+=l}),this.preserveShort&&i===s[o]){const r=t[o+1]-t[o];if(0===r)continue;const s=r+2*this.padWidth,l=1;this.createNGrams(e,n,a,i,l,s)}}return[a,s]}}function jC(e,t,n,i,r,s,a,o){return new VC(n,i,r,s,a,o).compute(e,t)}const WC={kernelName:pi,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{separator:r,nGramWidths:s,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:h}=t,d=n.data.get(u.dataId).values,p=n.data.get(h.dataId).values,[f,g]=jC(d,p,r,s,a,o,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}};function HC(e,t,n,i){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)i.push(e.subarray(t,t+1));return}if(1===t.length){const r=t[0];let s=e.indexOf(r);for(;-1!==s;){const t=e.subarray(0,s);n&&0===t.length||i.push(t),s=(e=e.subarray(s+1)).indexOf(r)}return void(n&&0===e.length||i.push(e))}let r=0;for(let s=0;s<e.length+1;s++)if(s===e.length||-1!==t.indexOf(e[s])){const t=e.subarray(r,s);n&&0===t.length||i.push(t),r=s+1}}function GC(e,t,n){const i=e.length,r=[];let s=0,a=0;const o=new Array(i);for(let d=0;d<i;++d){const i=r.length;HC(e[d],t,n,r);const l=r.length-i;o[d]=l,s+=l,a=Math.max(a,l)}const l=Y("int32",2*s),c=new Array(s),u=[i,a];let h=0;for(let d=0;d<i;++d)for(let e=0;e<o[d];++e)l[2*h]=d,l[2*h+1]=e,c[h]=r[h],++h;return[l,c,u]}const qC={kernelName:fi,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{skipEmpty:r}=i,{input:s,delimiter:a}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error("Input must be a vector, got shape: ".concat(s.shape));if(0!==a.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(a.shape));const o=n.data.get(s.dataId).values,l=n.data.get(a.dataId).values[0],[c,u,h]=GC(o,l,r),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};function XC(e,t){const n=Y("int32",e.length);for(let i=0;i<e.length;++i)n[i]=ir(e[i]).modulo(t).getLowBitsUnsigned();return n}const KC={kernelName:gi,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{numBuckets:r}=i,{input:s}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=XC(n.data.get(s.dataId).values,r);return n.makeTensorInfo(s.shape,"int32",a)}},YC=z_(yi,e=>Math.tan(e)),QC={kernelName:yi,backendName:"cpu",kernelFunc:YC},$C=z_(bi,e=>Math.tanh(e));const JC={kernelName:Wn,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{tensor:i,indices:r,updates:s}=t,{sliceRank:a,numUpdates:o,sliceSize:l,strides:c,outputSize:u}=Nu(0,r,i.shape),h=n.bufferSync(r),d=n.bufferSync(s),p=n.bufferSync(i),f=JS(h,d,i.shape,u,l,o,a,c,p,!1);return n.makeTensorInfo(i.shape,f.dtype,f.values)}};function ZC(e,t){const n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];const i=Vs(n,e.dtype);for(let r=0;r<i.values.length;++r){const t=i.indexToLoc(r),n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=t[i]%e.shape[i];const s=e.locToIndex(n);i.values[r]=e.values[s]}return i}const eI={kernelName:vi,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{reps:s}=i;F_(r,"tile");const a=ZC(n.bufferSync(r),s);return n.makeTensorInfo(a.shape,a.dtype,a.values)}},tI=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function nI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;for(;i>n;){if(i-n>600){const r=i-n+1,s=t-n+1,a=Math.log(r),o=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*o*(r-o)/r)*Math.sign(s-r/2);nI(e,t,Math.max(n,Math.floor(t-s*o/r+l)),Math.min(i,Math.floor(t+(r-s)*o/r+l)))}const r=e[t];let s=n,a=i;for(P(e,n,t),tI(e[i],r)>0&&P(e,n,i);s<a;){for(P(e,s,a),s++,a--;tI(e[s],r)<0;)s+=1;for(;tI(e[a],r)>0;)a-=1}0===tI(e[n],r)?P(e,n,a):(a+=1,P(e,a,i)),a<=t&&(n=a+1),t<=a&&(i=a-1)}}function iI(e,t,n,i,r){const s=t[t.length-1],[a,o]=[e.length/s,s],l=K(n,a*i),c=K("int32",a*i);for(let h=0;h<a;h++){const t=h*o,n=e.subarray(t,t+o);let s=new Array(n.length);n.forEach((e,t)=>s[t]={value:e,index:t}),i<s.length&&(nI(s,i),s=s.slice(0,i)),r&&s.sort(tI);const a=h*i,u=l.subarray(a,a+i),d=c.subarray(a,a+i);for(let e=0;e<i;e++)u[e]=s[e].value,d[e]=s[e].index}const u=t.slice();return u[u.length-1]=i,[Vs(u,n,l),Vs(u,"int32",c)]}const rI={kernelName:_i,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{k:s,sorted:a}=i;F_(r,"topk");const o=n.data.get(r.dataId).values,[l,c]=iI(o,r.shape,r.dtype,s,a);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}};const sI={kernelName:xi,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:i}=e,{image:r,transforms:s}=t,{interpolation:a,fillMode:o,fillValue:l,outputShape:c}=n,[u,h,d,p]=r.shape,[f,g]=null!=c?c:[h,d],m=[u,f,g,p],y=ie(r.shape),b=y[0],v=y[1],_=y[2],x=ie(m),w=x[0],T=x[1],k=x[2],S=K(r.dtype,B(m));S.fill(l);const C=i.data.get(r.dataId).values,I=i.data.get(s.dataId).values;for(let E=0;E<u;++E){const e=1===s.shape[0]?I:I.subarray(8*E,8*E+8);for(let t=0;t<f;++t)for(let n=0;n<g;++n)for(let i=0;i<p;++i){let r;const s=e[6]*n+e[7]*t+1;if(0===s)continue;const c=(e[0]*n+e[1]*t+e[2])/s,u=(e[3]*n+e[4]*t+e[5])/s,p=aI(c,d,o),f=aI(u,h,o);switch(a){case"nearest":r=lI(C,h,d,b,v,_,E,f,p,i,l);break;case"bilinear":r=cI(C,h,d,b,v,_,E,f,p,i,l);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(a))}S[E*w+t*T+n*k+i]=r}return i.makeTensorInfo(m,r.dtype,S)}return{dataId:i.write(S,m,r.dtype),shape:r.shape,dtype:r.dtype}}};function aI(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return O(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return O(0,n,t-1)}(e,t);case"nearest":return function(e,t){return O(0,e,t-1)}(e,t);default:return function(e){return e}(e)}}function oI(e,t,n,i,r,s,a,o,l,c,u){return 0<=o&&o<t&&0<=l&&l<n?e[a*i+o*r+l*s+c]:u}function lI(e,t,n,i,r,s,a,o,l,c,u){return oI(e,t,n,i,r,s,a,Math.round(o),Math.round(l),c,u)}function cI(e,t,n,i,r,s,a,o,l,c,u){const h=Math.floor(o),d=Math.floor(l),p=h+1,f=d+1;return(p-o)*((f-l)*oI(e,t,n,i,r,s,a,h,d,c,u)+(l-d)*oI(e,t,n,i,r,s,a,h,f,c,u))+(o-h)*((f-l)*oI(e,t,n,i,r,s,a,p,d,c,u)+(l-d)*oI(e,t,n,i,r,s,a,p,f,c,u))}function uI(e,t,n,i){const r=q(t,n)[0],s=[1,n[0],1];for(let f=0;f<r;f++)s[0]*=n[f];s[1]=n[r];for(let f=r+1;f<n.length;f++)s[2]*=n[f];const a=new Map,o=new Int32Array(n[r]),l=new vr(s,i,e),c=[],u=1===s[0]&&1===s[2];for(let f=0;f<n[r];f++){let t;if(u)t=e[f].toString();else{const e=[];for(let t=0;t<s[0];t++)for(let n=0;n<s[2];n++)e.push(l.get(t,f,n));t=e.join(",")}const n=a.get(t);if(null!=n)o[f]=n;else{const e=a.size;a.set(t,e),o[f]=e,c.push(f)}}const h=s.slice();h[1]=a.size;const d=new vr(h,i);c.forEach((e,t)=>{for(let n=0;n<s[0];n++)for(let i=0;i<s[2];i++)d.set(l.get(n,e,i),n,t,i)});const p=n.slice();return p[r]=h[1],{outputValues:d.values,outputShape:p,indices:o}}const hI={kernelName:Ti,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:i}=e,{axis:r}=n,{x:s}=t;F_(s,"unique");const a=i.data.get(s.dataId).values,{outputValues:o,outputShape:l,indices:c}=uI(a,r,s.shape,s.dtype);return[i.makeTensorInfo(l,s.dtype,o),i.makeTensorInfo([c.length],"int32",c)]}};const dI={kernelName:ki,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{value:r}=t;let{axis:s}=i;s<0&&(s+=r.shape.length);const a=r.shape.length,o=r.shape[s],l=new Array(a-1);let c=0;for(let p=0;p<a;p++)p!==s&&(l[c++]=r.shape[p]);const u=new Array(a).fill(0),h=r.shape.slice();h[s]=1;const d=new Array(o);for(let p=0;p<d.length;p++){u[s]=p;const e=sw({inputs:{x:r},backend:n,attrs:{begin:u,size:h}});d[p]=_x({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}};const pI={kernelName:Si,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,segmentIds:s}=t,{numSegments:a}=i;F_(r,"unsortedSegmentSum");const o=[],l=[],c=r.shape.length-s.shape.length;let u=s;for(let d=0;d<c;++d){const e=bT({inputs:{input:u},backend:n,attrs:{dim:d+1}});u=e,l.push(e)}for(let d=0;d<a;++d){const e=rr(d,"int32"),t=n.makeTensorInfo([],"int32",e),i=sT({inputs:{a:t,b:u},backend:n}),s=dx({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),a=Jw({inputs:{a:s,b:r},backend:n}),c=eT({inputs:{x:a},backend:n,attrs:{axis:0,keepDims:!1}});o.push(c),l.push(t),l.push(i),l.push(s),l.push(a),l.push(c)}const h=gS({inputs:o,backend:n,attrs:{axis:0}});return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),h}},fI=[kx,Cx,Ex,Ax,vx,Rx,Px,Fx,Mx,Ux,zx,jx,Hx,Xx,Yx,Zx,ew,tw,nw,Tx,iw,ow,uw,dw,pw,px,mw,bw,ox,vw,kw,Cw,Iw,Ew,Nw,Aw,Rw,Ow,Pw,Fw,Mw,Uw,Bw,zw,jw,Ww,Hw,Gw,qw,Xw,Kw,Yw,nT,W_,iT,aT,fT,yT,vT,wT,OT,PT,FT,BT,jT,WT,HT,qT,KT,$T,ek,G_,tk,ww,ik,sk,ok,X_,uk,pk,gk,bk,_k,Tk,Sk,Ek,Nk,Ak,Ok,Fk,Mk,Uk,Bk,zk,Vk,jk,Wk,qk,Xk,Qk,Zk,Zw,tS,iS,sS,oS,uS,hS,fS,mS,yS,_S,$_,wS,IS,AS,FS,US,ux,ST,zS,Z_,tx,xx,VS,jS,WS,HS,GS,qS,KS,$S,ZS,nC,iC,oC,rx,cC,hC,pC,aw,Jk,mC,yC,vC,xC,TC,kC,SC,CC,NC,AC,OC,FC,UC,zC,WC,qC,KC,NT,tT,QC,{kernelName:bi,backendName:"cpu",kernelFunc:$C},JC,eI,rI,sI,Lx,hI,dI,pI,pS];for(const n of fI)zi(n);const gI={},mI={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function yI(e,t){if(!(e in gI)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if(me().getBool("IS_SAFARI")||"undefined"===typeof OffscreenCanvas||2!==e){if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;n.addEventListener("webglcontextlost",t=>{t.preventDefault(),delete gI[e]},!1),me().getBool("SOFTWARE_WEBGL_ENABLED")&&(mI.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",mI)||n.getContext("experimental-webgl",mI);return n.getContext("webgl2",mI)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;gI[e]=n}const n=gI[e];return null==n||n.isContextLost()?(delete gI[e],yI(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),gI[e])}var bI,vI,_I;function xI(e,t){return[t,e]}function wI(e){const t=B(e);return j(Math.ceil(t/4))}function TI(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function kI(e,t){const n=e;let i,r,s,a,o,l,c,u,h,d;return 2===me().getNumber("WEBGL_VERSION")?(i=n.R32F,r=n.R16F,s=n.RGBA16F,a=n.RGBA32F,o=n.RED,c=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(i=e.RGBA,r=e.RGBA,s=e.RGBA,a=n.RGBA,o=e.RGBA,c=4,u=4,h=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,l=e.RGBA),{internalFormatFloat:i,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}function SI(e,t){const n=t();return me().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(bI||(bI={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(vI||(vI={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(_I||(_I={}));function CI(e){return!!(me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function II(e,t){return FI(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}const EI=/ERROR: [0-9]+:([0-9]+):/g;function NI(e,t){const n=EI.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);const i=+n[1],r=e.split("\n"),s=r.length.toString().length+2,a=r.map((e,t)=>W((t+1).toString(),s)+e);let o=0;for(let h=0;h<a.length;h++)o=Math.max(a[h].length,o);const l=a.slice(0,i-1),c=a.slice(i-1,i),u=a.slice(i);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(W(c[0],o)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join("\n"))}function AI(e,t){if(SI(e,()=>e.validateProgram(t)),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function RI(e,t,n,i,r,s,a){const o=e.getAttribLocation(t,n);return-1!==o&&(SI(e,()=>e.bindBuffer(e.ARRAY_BUFFER,i)),SI(e,()=>e.vertexAttribPointer(o,r,e.FLOAT,!1,s,a)),SI(e,()=>e.enableVertexAttribArray(o)),!0)}function DI(e,t,n,i){SI(e,()=>function(e,t,n){MI(e,n),SI(e,()=>e.activeTexture(e.TEXTURE0+n)),SI(e,()=>e.bindTexture(e.TEXTURE_2D,t))}(e,t,i)),SI(e,()=>e.uniform1i(n,i))}function OI(e,t,n){SI(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),SI(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function LI(e,t){SI(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),SI(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function PI(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function FI(e,t,n){const i=SI(e,()=>t());if(null==i)throw new Error(n);return i}function MI(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=t+e.TEXTURE0;if(i<e.TEXTURE0||i>n){const e="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(e,"."))}}function UI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return B(e.slice(0,e.length-t))}function BI(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function zI(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[UI(e),...BI(e)]),t}function VI(e){return e%2===0}function jI(e,t){if(z(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e[e.length-1],i=t[t.length-1];if(n===i)return!0;if(VI(n)&&VI(i)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&VI(e[0])&&VI(t[0])}let WI,HI;function GI(e,t){return null!=e.getExtension(t)}function qI(e){try{if(null!=yI(e))return!0}catch($F){return console.log("Error when getting WebGL context: ",$F),!1}return!1}function XI(e){if(0===e)return!1;const t=yI(e);if(1!==e){if(GI(t,"EXT_color_buffer_float"))return KI(t);const e="EXT_color_buffer_half_float";if(GI(t,e)){const n=t.getExtension(e);return function(e,t){const n=kI(e,t),i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const r=1,s=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,r,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(i),e.deleteFramebuffer(a),o}(t,n)}return!1}if(!GI(t,"OES_texture_float"))return!1;if(!GI(t,"WEBGL_color_buffer_float"))return!1;return KI(t)}function KI(e){const t=kI(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const r=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(i),r}function YI(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&F("complex64"!==e.dtype,()=>"".concat(t," does not support complex64 tensors ")+"in the WebGL backend.")})}const QI=me();function $I(){let e,t,n,i,r,s,a,o,l,c;return 2===me().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",i="in",r="texture",s="outputColor",a="out vec4 outputColor;",o=me().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",i="varying",r="texture2D",s="gl_FragColor",a="",o="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:i,texture2D:r,output:s,defineOutput:a,defineSpecialNaN:o,defineSpecialInf:l,defineRound:c}}function JI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const i=ie(t);return i.map((t,r)=>{const s="int ".concat(e[r]," = ").concat(n," / ").concat(t),a=r===i.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(t):"index -= ".concat(e[r]," * ").concat(t);return"".concat(s,"; ").concat(a,";")}).join("")}function ZI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const i=ie(t);return i.map((t,r)=>{const s="int ".concat(e[r]," = ").concat(n," / outShapeStrides[").concat(r,"]"),a=r===i.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * outShapeStrides[").concat(r,"]"):"index -= ".concat(e[r]," * outShapeStrides[").concat(r,"]");return"".concat(s,"; ").concat(a,";")}).join("")}function eE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const i=e.map((e,t)=>t),r=function(e,t){const n=e.length,i=e.map(e=>"".concat(t,"[").concat(e,"]")),r=new Array(n-1);r[n-2]=i[n-1];for(let s=n-3;s>=0;--s)r[s]="(".concat(r[s+1]," * ").concat(i[s+1],")");return r}(i,t);return r.map((t,i)=>{const s="int ".concat(e[i]," = ").concat(n," / ").concat(r[i]),a=i===r.length-1?"int ".concat(e[i+1]," = ").concat(n," - ").concat(e[i]," * ").concat(r[i]):"index -= ".concat(e[i]," * ").concat(r[i]);return"".concat(s,"; ").concat(a,";")}).join("")}function tE(e){const t=ie(e).map(e=>e.toString());return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}QI.registerFlag("HAS_WEBGL",()=>QI.getNumber("WEBGL_VERSION")>0),QI.registerFlag("WEBGL_VERSION",()=>qI(2)?2:qI(1)?1:0),QI.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),QI.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===QI.get("WEBGL_VERSION")),QI.registerFlag("WEBGL_CPU_FORWARD",()=>!0),QI.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),QI.registerFlag("WEBGL_PACK",()=>QI.getBool("HAS_WEBGL")),QI.registerFlag("WEBGL_PACK_NORMALIZATION",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_PACK_CLIP",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_PACK_REDUCE",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_LAZILY_UNPACK",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_CONV_IM2COL",()=>QI.getBool("WEBGL_PACK")),QI.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(e){if(null==WI){const t=yI(e);WI=t.getParameter(t.MAX_TEXTURE_SIZE)}return WI}(QI.getNumber("WEBGL_VERSION"))),QI.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(e){if(null==HI){const t=yI(e);HI=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,HI)}(QI.getNumber("WEBGL_VERSION"))),QI.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=QI.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=yI(e);return t=GI(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:GI(n,"EXT_disjoint_timer_query")?1:0,t}(e)}),QI.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>QI.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Xr()),QI.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(e){if(0===e)return!1;const t=yI(e);if(1===e){if(!GI(t,"OES_texture_float"))return!1}else if(!GI(t,"EXT_color_buffer_float"))return!1;return KI(t)}(QI.getNumber("WEBGL_VERSION"))),QI.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!QI.getBool("WEBGL_FORCE_F16_TEXTURES")&&QI.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),QI.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>XI(QI.getNumber("WEBGL_VERSION"))),QI.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return 2===(e=QI.getNumber("WEBGL_VERSION"))&&null!=yI(e).fenceSync;var e}),QI.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>QI.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),QI.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))}),QI.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Xr()?1:-1,e=>{if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))}),QI.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),QI.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),QI.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),QI.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),QI.registerFlag("WEBGL_EXP_CONV",()=>!1),QI.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>QI.getBool("IS_TEST")),QI.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),QI.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),QI.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),QI.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);const nE="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:iE}=i;function rE(e,t,n){const i=[];if(e.forEach(e=>{const t=B(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?i.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(i.push("uniform sampler2D ".concat(e.name,";")),i.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){const{uniformShape:t}=fE(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:i.push("uniform int ".concat(e.name,"Shape;"));break;case 2:i.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:i.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:i.push("uniform ivec4 ".concat(e.name,"Shape;"))}i.push("uniform ivec2 ".concat(e.name,"TexShape;"))}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:i.push("uniform int outShape;");break;case 2:i.push("uniform ivec2 outShape;"),i.push("uniform int outShapeStrides;");break;case 3:i.push("uniform ivec3 outShape;"),i.push("uniform ivec2 outShapeStrides;");break;case 4:i.push("uniform ivec4 outShape;"),i.push("uniform ivec3 outShapeStrides;")}i.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(e=>{i.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))});const r=i.join("\n"),s=e.map(e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,r="";r+=n?aE(e,i):sE(e,i);const s=e.shapeInfo.logicalShape,a=t.logicalShape;s.length<=a.length&&(r+=n?function(e,t){const n=e.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",s=e.shapeInfo.logicalShape.length,a=t.logicalShape.length,o=iE(e.shapeInfo.logicalShape,t.logicalShape),l=pE(a),c=a-s;let u;const h=["x","y","z","w","u","v"];u=0===s?"":a<2&&o.length>=1?"coords = 0;":o.map(e=>"coords.".concat(h[e+c]," = 0;")).join("\n");let d="";d=a<2&&s>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords.".concat(h[t+c])).join(", ");let p="return outputValue;";const f=1===B(e.shapeInfo.logicalShape),g=B(t.logicalShape),m=1===g;if(1!==s||f||m){if(f&&!m)p=1===a?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(o.length){const e=s-2,t=s-1;o.indexOf(e)>-1&&o.indexOf(t)>-1?p="return vec4(outputValue.x);":o.indexOf(e)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(t)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(r,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(u,"\n      vec4 outputValue = get").concat(i,"(").concat(d,");\n      ").concat(p,"\n    }\n  ")}(e,t):function(e,t){const n=e.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",s=t.texShape,a=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===l&&null==e.shapeInfo.flatOffset&&z(a,s))return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");const c=pE(l),u=iE(e.shapeInfo.logicalShape,t.logicalShape),h=l-o;let d;const p=["x","y","z","w","u","v"];d=0===o?"":l<2&&u.length>=1?"coords = 0;":u.map(e=>"coords.".concat(p[e+h]," = 0;")).join("\n");let f="";f=l<2&&o>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords.".concat(p[t+h])).join(", ");return"\n    float ".concat(r,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(d,"\n      return get").concat(i,"(").concat(f,");\n    }\n  ")}(e,t));return r}(e,t,n.packedInputs,n.enableShapeUniforms)).join("\n"),a=t.texShape,o=$I(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(o);let c,u,h=function(e){const t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(oE,"\n    ").concat(lE,"\n    ").concat(cE,"\n  ");return t}(o);t.isPacked?(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===i[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(i[1],".0);\n      }\n    ");if(1===i[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(i[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(i[0],", ").concat(i[1],"));\n      return 2 * (resTexRC.x * ").concat(i[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(z(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(i[0],", ").concat(i[1],"));\n      }\n    ");const r=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(i[0],", ").concat(i[1],"));\n\n      int index = resTexRC.x * ").concat(i[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),s=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(i[0],", ").concat(i[1],"));\n      int index = resTexRC.x * ").concat(i[1]," + resTexRC.y;\n\n      int b = index / ").concat(s,";\n      index -= b * ").concat(s,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),s=r*Math.ceil(e[e.length-2]/2);let a=s,o="",l="b, r, c";for(let c=2;c<e.length-1;c++)a*=e[e.length-c-1],o="\n      int b".concat(c," = index / ").concat(a,";\n      index -= b").concat(c," * ").concat(a,";\n    ")+o,l="b".concat(c,", ")+l;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(i[0],", ").concat(i[1],"));\n      int index = resTexRC.x * ").concat(i[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(s,";\n      index -= b * ").concat(s,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(l,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,a,n.enableShapeUniforms),u=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(o)):(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(z(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){const t=ZI(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(t,"\n    return ivec3(r, c, d);\n  }\n")}const i=JI(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(i,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){const t=ZI(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(t,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}const i=JI(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(i,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){const n=JI(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){const n=JI(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,a,n.enableShapeUniforms),u=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(o)),n.packedInputs&&(h+=uE);return[h,l,u,r,c,s,n.userCode].join("\n")}function sE(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(i,"() {return ").concat(n,";}");const[r,s]=e.shapeInfo.texShape;if(1===r&&1===s)return"\n      float ".concat(i,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const a=hE(n);if(t)return"\n    float ".concat(i,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(a,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");const[o,l]=e.shapeInfo.texShape;return"\n    float ".concat(i,"() {\n      vec2 uv = uvFromFlat(").concat(o,", ").concat(l,", ").concat(a,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int index) {\n        ").concat(dE(e),"\n      }\n    ");const r=e.shapeInfo.texShape,s=r[0],a=r[1];if(1===a&&1===s)return"\n      float ".concat(i,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const o=hE(n);if(1===a)return t?"\n      float ".concat(i,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(i,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(s,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(1===s)return t?"\n      float ".concat(i,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(i,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(a,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(t)return"\n    float ".concat(i,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n    float ".concat(i,"(int index) {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(a,", index + ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape;if(null!=s&&z(n,s)){if(t)return"\n      float ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(i,"TexShape[1], ").concat(i,"TexShape[0]);\n        return sampleTexture(").concat(i,", uv);\n      }\n    ");const e=s[0],n=s[1];return"\n    float ".concat(r,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(n,".0, ").concat(e,".0);\n      return sampleTexture(").concat(i,", uv);\n    }\n  ")}const{newShape:a,keptDims:o}=X(n),l=a;if(l.length<n.length){const n=gE(e,l),i=["row","col"];return"\n      ".concat(sE(n,t),"\n      float ").concat(r,"(int row, int col) {\n        return ").concat(r,"(").concat(mE(i,o),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(dE(e),"\n      }\n    ");const c=s[0],u=s[1],h=hE(i);if(1===u)return t?"\n      float ".concat(r,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(i,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(i,"TexShape[0]));\n        return sampleTexture(").concat(i,", uv);\n      }\n    "):"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(c,".0);\n      return sampleTexture(").concat(i,", uv);\n    }\n  ");if(1===c)return t?"\n      float ".concat(r,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(i,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(i,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(i,", uv);\n      }\n    "):"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(u,".0, 0.5);\n      return sampleTexture(").concat(i,", uv);\n    }\n  ");if(t)return"\n      float ".concat(r,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i,"Shape[1] + col + ").concat(h,";\n        vec2 uv = uvFromFlat(").concat(i,"TexShape[0], ").concat(i,"TexShape[1], index);\n        return sampleTexture(").concat(i,", uv);\n      }\n    ");return"\n  float ".concat(r,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(h,";\n    vec2 uv = uvFromFlat(").concat(c,", ").concat(u,", index);\n    return sampleTexture(").concat(i,", uv);\n  }\n")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[1]*n[2],a=n[2],{newShape:o,keptDims:l}=X(n),c=o;if(c.length<n.length){const n=gE(e,c),i=["row","col","depth"];return"\n        ".concat(sE(n,t),"\n        float ").concat(r,"(int row, int col, int depth) {\n          return ").concat(r,"(").concat(mE(i,l),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(s,", ").concat(a,", 1)));\n        ").concat(dE(e),"\n      }\n    ");const u=e.shapeInfo.texShape,h=u[0],d=u[1],p=e.shapeInfo.flatOffset;if(d===s&&null==p)return t?"\n      float ".concat(r,"(int row, int col, int depth) {\n        int stride1 = ").concat(i,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(i,"TexShape[1], ").concat(i,"TexShape[0]);\n        return sampleTexture(").concat(i,", uv);\n      }\n    "):"\n        float ".concat(r,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(a,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(h,".0);\n          return sampleTexture(").concat(i,", uv);\n        }\n      ");if(d===a&&null==p)return t?"\n      float ".concat(r,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(i,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(i,"TexShape[1], ").concat(i,"TexShape[0]);\n        return sampleTexture(").concat(i,", uv);\n      }\n    "):"\n    float ".concat(r,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(h,".0);\n      return sampleTexture(").concat(i,", uv);\n    }\n  ");const f=hE(i);if(t)return"\n    float ".concat(r,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(i,"Shape[1] * ").concat(i,"Shape[2];\n      int stride1 = ").concat(i,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(f,";\n      vec2 uv = uvFromFlat(").concat(i,"TexShape[0], ").concat(i,"TexShape[1], index);\n      return sampleTexture(").concat(i,", uv);\n    }\n    ");return"\n      float ".concat(r,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(s," + col * ").concat(a," + depth + ").concat(f,";\n        vec2 uv = uvFromFlat(").concat(h,", ").concat(d,", index);\n        return sampleTexture(").concat(i,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[3],a=n[2]*s,o=n[1]*a,{newShape:l,keptDims:c}=X(n);if(l.length<n.length){const n=gE(e,l),i=["row","col","depth","depth2"];return"\n      ".concat(sE(n,t),"\n      float ").concat(r,"(int row, int col, int depth, int depth2) {\n        return ").concat(r,"(").concat(mE(i,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(o,", ").concat(a,", ").concat(s,", 1)));\n        ").concat(dE(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1],f="int stride2 = ".concat(i,"Shape[3];"),g="int stride1 = ".concat(i,"Shape[2] * stride2;"),m="int stride0 = ".concat(i,"Shape[1] * stride1;");if(p===o&&null==u)return t?"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        ").concat(f,"\n        ").concat(g,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(i,"TexShape[1], ").concat(i,"TexShape[0]);\n        return sampleTexture(").concat(i,", uv);\n      }\n    "):"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(a,", ").concat(s,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(i,", uv);\n      }\n    ");if(p===s&&null==u)return t?"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(i,"Shape[1] * ").concat(i,"Shape[2], ").concat(i,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(i,"TexShape[1], ").concat(i,"TexShape[0]);\n        return sampleTexture(").concat(i,", uv);\n      }\n    "):"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(i,", uv);\n      }\n    ");const y=hE(i);if(t)return"\n    float ".concat(r,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(f,"\n      ").concat(g,"\n      ").concat(m,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(i,"TexShape[0], ").concat(i,"TexShape[1], index + ").concat(y,");\n      return sampleTexture(").concat(i,", uv);\n    }\n  ");return"\n    float ".concat(r,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(a," +\n          depth * ").concat(s," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index + ").concat(y,");\n      return sampleTexture(").concat(i,", uv);\n    }\n  ")}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t[4],s=t[3]*r,a=t[2]*s,o=t[1]*a,{newShape:l,keptDims:c}=X(t);if(l.length<t.length){const t=gE(e,l),n=["row","col","depth","depth2","depth3"];return"\n      ".concat(sE(t),"\n      float ").concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(i,"(").concat(mE(n,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(o,", ").concat(a,", ").concat(s,", ").concat(r,")) +\n          depth3;\n        ").concat(dE(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];if(p===o&&null==u)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(a,", ").concat(s,", ").concat(r,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===r&&null==u)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const f=hE(n);return"\n    float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(a," + depth * ").concat(s," +\n          depth2 * ").concat(r," + depth3 + ").concat(f,";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:s}=X(t);if(r.length<t.length){const t=gE(e,r),n=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(sE(t),"\n      float ").concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(i,"(").concat(mE(n,s),");\n      }\n    ")}const a=t[5],o=t[4]*a,l=t[3]*o,c=t[2]*l,u=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(u,", ").concat(c,", ").concat(l,", ").concat(o,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(a,", 1)));\n        ").concat(dE(e),"\n      }\n    ");const h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],f=d[1];if(f===u&&null==h)return"\n      float ".concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(c,", ").concat(l,", ").concat(o,", ").concat(a,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(f===a&&null==h)return"\n      float ".concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const g=hE(n);return"\n    float ".concat(i,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(c," + depth * ").concat(l," +\n          depth2 * ").concat(o," + depth3 * ").concat(a," + depth4 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(f,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function aE(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),i=$I();return"\n    vec4 ".concat(n,"() {\n      return ").concat(i.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e.shapeInfo.texShape,s=$I();if(t)return"\n    vec4 ".concat(i,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(s.texture2D,"(").concat(n,", uv);\n    }\n  ");const a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return"\n    vec4 ".concat(i,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(s.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape,a=s[0],o=s[1],l=$I();if(null!=s&&z(n,s))return t?"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(i,"TexShape[1], ").concat(i,"TexShape[0]);\n\n        return ").concat(l.texture2D,"(").concat(i,", uv);\n      }\n    "):"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(a,".0);\n\n        return ").concat(l.texture2D,"(").concat(i,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(r,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(i,"TexShape[0]) / 2.0), ceil(float(").concat(i,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(i,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(l.texture2D,"(").concat(i,", uv);\n    }\n  ");const c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return"\n    vec4 ".concat(r,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(u,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(l.texture2D,"(").concat(i,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape,a=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const i=[1,2],s=gE(e,n.slice(1)),a=["b","row","col"];return"\n        ".concat(aE(s,t),"\n        vec4 ").concat(r,"(int b, int row, int col) {\n          return ").concat(r,"(").concat(mE(a,i),");\n        }\n      ")}const o=$I();if(t)return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(i,"TexShape[0]) / 2.0), ceil(float(").concat(i,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(i,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(i,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(o.texture2D,"(").concat(i,", uv);\n    }\n  ");const l=a[0],c=a[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(l,", ").concat(c,", ").concat(h,", ").concat(u,", b, row, col);\n      return ").concat(o.texture2D,"(").concat(i,", uv);\n    }\n  ")}(e,t);default:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=$I();if(t)return"\n    vec4 ".concat(i,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(r.texture2D,"(").concat(n,", uv);\n    }\n  ");const s=e.shapeInfo.logicalShape,a=s.length,o=e.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=l[0],u=l[1],h=Math.ceil(s[a-1]/2);let d=h*Math.ceil(s[a-2]/2),p="int b, int row, int col",f="b * ".concat(d," + (row / 2) * ").concat(h," + (col / 2)");for(let g=2;g<a-1;g++)p="int b".concat(g,", ")+p,d*=s[a-g-1],f="b".concat(g," * ").concat(d," + ")+f;return"\n    vec4 ".concat(i,"(").concat(p,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(c,");\n      return ").concat(r.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}const oE="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",lE="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",cE="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",uE="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function hE(e){return"offset".concat(e)}function dE(e){const t=e.name,n=B(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function pE(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function fE(e,t,n){const{newShape:i,keptDims:r}=X(t),s=t.length,a=e&&3===s&&1===t[0],o=a?t.slice(1):i,l=!e&&s>1&&!z(t,n)&&i.length<s||a;return{useSqueezeShape:l,uniformShape:l?o:t,keptDims:r}}function gE(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function mE(e,t){return t.map(t=>e[t]).join(", ")}function yE(e,t,n,i){const r=n.map((e,n)=>{const i={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(i.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:i}}),s=r.map(e=>e.shapeInfo),a={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},o=rE(r,a,t),l=function(e,t){const n=FI(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(SI(e,()=>e.shaderSource(n,t)),SI(e,()=>e.compileShader(n)),me().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw NI(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,o),c=e.createProgram(l);return me().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:s,outShapeInfo:a,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:s,outShapeInfo:a},bE(e,t,c)))}function bE(e,t,n){const i=[],r=[];let s,a,o,l=null,c=null;c=e.getUniformLocation(n,"NAN",!1),1===me().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const h of t.variableNames){const r={name:h,uniform:e.getUniformLocation(n,h,u),offset:e.getUniformLocation(n,"offset".concat(h),u)};t.enableShapeUniforms&&(r.shape=e.getUniformLocation(n,"".concat(h,"Shape"),u),r.texShape=e.getUniformLocation(n,"".concat(h,"TexShape"),u)),i.push(r)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(n,"outShape",u),o=e.getUniformLocation(n,"outShapeStrides",u),a=e.getUniformLocation(n,"outTexShape",u)),t.customUniforms)for(const h of t.customUniforms)r.push(e.getUniformLocation(n,h.name,u));return{variablesLocations:i,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:s,outShapeStridesLocation:o,outTexShapeLocation:a}}function vE(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((e,n)=>{const i=e.logicalShape,r=t[n],s=r.shape;if(!z(i,s))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(i," and ").concat(s," must match"));if(e.isUniform&&r.isUniform)return;const a=e.texShape,o=r.isUniform?null:r.texData.texShape;if(!z(a,o))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(a," and ").concat(o," must match"))})}function _E(e){return me().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class xE{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=bI.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=$I();this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?ZI(["r","c","d"],e):JI(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class wE{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=bI.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=$I();this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?ZI(["r","c","d"],e):JI(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class TE{constructor(e){this.variableNames=["A"],this.outTexUsage=vI.DOWNLOAD;const t=$I();this.outputShape=e,this.userCode="\n      ".concat(nE,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}class kE{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=vI.DOWNLOAD;const t=$I();this.outputShape=e,this.userCode="\n      ".concat(nE,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}const SE={R:0,G:1,B:2,A:3};class CE{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=$I();this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length);let r="result";t&&(r="floor(result * 255. + 0.5)");let s="";for(let a=0;a<n.length;a++){const e=n[a];s+="\n          if(offset == ".concat(a,") {\n            result = values[").concat(SE[e],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":tE(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(n.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(n.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(i.texture2D,"(A, uv);\n          ").concat(s,"\n        }\n        ").concat(i.output," = vec4(").concat(r,", 0., 0., 0.);\n      }\n    ")}}class IE{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=$I();this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length);let i="",r="result";t&&(r="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let t=0;t<=1;t++){const r=2*s+t;i+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(t," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),") {\n          localCoords[2] += ").concat(t,";\n          if (localCoords[1] + ").concat(s," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),") {\n            localCoords[1] += ").concat(s,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(n.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(r,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(r,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(r,"] = values[2];\n            } else {\n              result[").concat(r,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":tE(e),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(i,"\n\n          ").concat(n.output," = ").concat(r,";\n        }\n    ")}}function EE(e){const t=$I();return function(e,t){const n=FI(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(SI(e,()=>e.shaderSource(n,t)),SI(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function NE(e){return function(e,t){const n=FI(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return SI(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),SI(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function AE(e){return function(e,t){const n=FI(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return SI(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),SI(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Uint16Array([0,1,2,2,1,3]))}function RE(e,t,n,i,r,s){!function(e,t){const n=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const n="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(e>n||t>n){const i="[".concat(e,"x").concat(t,"]"),r="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+r+".")}}(t,n);const a=function(e){return FI(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}(e),o=e.TEXTURE_2D;return SI(e,()=>e.bindTexture(o,a)),SI(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),SI(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),SI(e,()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST)),SI(e,()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST)),1===me().getNumber("WEBGL_VERSION")?SI(e,()=>e.texImage2D(o,0,i,t,n,0,r,s,null)):SI(e,()=>e.texStorage2D(o,1,i,t,n)),SI(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:a,texShape:[n,t]}}function DE(e){return e.internalFormatFloat}function OE(e){return e.internalFormatHalfFloat}function LE(e){return e.downloadTextureFormat}function PE(e){return e.internalFormatPackedFloat}function FE(e){return e.internalFormatPackedHalfFloat}function ME(e,t,n,i,r,s,a,o){const l=e,c=new Float32Array(function(e,t){const[n,i]=TI(e,t);return n*i*4}(s,a));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}class UE{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=me().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,function(e,t){gI[e]=t}(t,e)):this.gl=yI(t),e=this.gl,2===me().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>SI(t,()=>t.createVertexArray()),this.bindVertexArray=e=>SI(t,()=>t.bindVertexArray(e)),this.deleteVertexArray=e=>SI(t,()=>t.deleteVertexArray(e)),this.getVertexArray=()=>SI(t,()=>t.getParameter(t.VERTEX_ARRAY_BINDING))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>SI(e,()=>t.createVertexArrayOES()),this.bindVertexArray=n=>SI(e,()=>t.bindVertexArrayOES(n)),this.deleteVertexArray=n=>SI(e,()=>t.deleteVertexArrayOES(n)),this.getVertexArray=()=>SI(e,()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===me().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=II(this.gl,e),GI(this.gl,t))this.textureHalfFloatExtension=II(this.gl,t);else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),GI(this.gl,i))this.colorBufferHalfFloatExtension=II(this.gl,i);else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",GI(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!GI(this.gl,i))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(i)}this.vertexBuffer=NE(this.gl),this.indexBuffer=AE(this.gl),this.framebuffer=function(e){return FI(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=kI(this.gl,this.textureHalfFloatExtension)}get debug(){return me().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;SI(e,()=>e.finish()),SI(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),SI(e,()=>e.deleteFramebuffer(this.framebuffer)),SI(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),SI(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),SI(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=xI(t,n);return RE(e,r,s,DE(i),i.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=xI(t,n);return RE(e,r,s,OE(i),i.textureFormatFloat,i.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=xI(t,n);return RE(e,r,s,LE(i),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){SI(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?2===me().getNumber("WEBGL_VERSION")?SI(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):SI(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):2===me().getNumber("WEBGL_VERSION")?SI(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):SI(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),SI(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,i){this.throwIfDisposed(),function(e,t,n,i,r,s){let a,o,l;SI(e,()=>e.bindTexture(e.TEXTURE_2D,t)),r instanceof Uint8Array?(a=new Uint8Array(n*i*4),o=e.UNSIGNED_BYTE,l=e.RGBA):(a=new Float32Array(n*i*4),o=e.FLOAT,l=s.internalFormatPackedFloat),a.set(r),2===me().getNumber("WEBGL_VERSION")?SI(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,i,e.RGBA,o,a)):SI(e,()=>e.texImage2D(e.TEXTURE_2D,0,l,n,i,0,e.RGBA,o,a)),SI(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t,n,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=TI(t,n);return RE(e,r,s,FE(i),e.RGBA,i.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=TI(t,n);return RE(e,r,s,PE(i),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(LI(this.gl,this.framebuffer),this.outputTexture=null),SI(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n,i){const[r,s]=xI(t,n),a=new Uint8Array(t*n*4);return SI(e,()=>e.readPixels(0,0,r,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,i,r,s){return ME(this.gl,e,0,0,0,r,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const i=e,r=new Float32Array(n);return i.bindBuffer(i.PIXEL_PACK_BUFFER,t),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,r),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),r}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const i=function(e,t,n){const i=e.createBuffer();SI(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));const r=16*t*n;return SI(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,r,e.STREAM_READ)),SI(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),SI(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(me().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,r=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=i.clientWaitSync(r,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=r}else me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n){const i=new Float32Array(t*n*4);return SI(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,i)),i}(this.gl,t,n))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=EE(t));const n=function(e){return FI(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}(t);SI(t,()=>t.attachShader(n,this.vertexShader)),SI(t,()=>t.attachShader(n,e)),function(e,t){if(SI(e,()=>e.linkProgram(t)),!me().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n);const i=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&AI(t,i),i}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;SI(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),function(e,t,n){SI(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),RI(e,t,"clipSpacePos",n,3,20,0)&&RI(e,t,"uv",n,2,20,12)}(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(SI(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&AI(this.gl,this.program),SI(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return FI(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),SI(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),DI(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[i,r]=TI(t,n);this.setOutputMatrixTextureDriver(e,i,r)}setOutputMatrixWriteRegion(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)}setOutputPackedMatrixWriteRegion(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&AI(this.gl,this.program),PI(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}SI(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),SI(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=II(this.gl,2===me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await H(()=>this.disposed||this.isQueryAvailable(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),i=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),i&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=function(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in me().platform&&(n=me().platform.setTimeoutCustom.bind(me().platform)),H(()=>(this.pollItems(),0===this.itemsToPoll.length),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),OI(this.gl,e,this.framebuffer),this.debug&&PI(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(OI(this.gl,this.outputTexture,this.framebuffer),this.debug&&PI(this.gl)):LI(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const i=this.gl;OI(i,e,this.framebuffer),this.debug&&PI(i),this.outputTexture=e,SI(i,()=>i.viewport(0,0,t,n)),SI(i,()=>i.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,i){this.throwIfDisposed(),SI(this.gl,()=>this.gl.scissor(e,t,n,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{mx:BE,XI:zE,Nk:VE,f6:jE,ct:WE,YG:HE,hH:GE,z3:qE,sG:XE,uM:KE,vS:YE,qB:QE,GG:$E,rq:JE,lg:ZE,WR:eN,cu:tN,GE:nN,px:iN,jC:rN,He:sN,hE:aN,BF:oN,Dk:lN,cl:cN,_B:uN,ub:hN,_f:dN,Ku:pN,qy:fN,Zy:gN,bu:mN,zv:yN,dH:bN,HS:vN,yH:_N,l3:xN,z9:wN,x6:TN,_m:kN,eW:SN,GK:CN,SP:IN,yr:EN,dl:NN,Dw:AN,xT:RN,_X:DN,wz:ON}=r;function LN(e,t){return["x","y","z","w","u","v"].slice(0,t).map(t=>"".concat(e,".").concat(t))}function PN(e,t){return 1===t?[e]:LN(e,t)}class FN{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=_E(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=PN("rc",this.rank),t=pE(this.rank),n=this.getOutOfBoundsCondition(e),i=this.getSetup(e),r=this.getOutput(e);this.userCode="\n        void main() {\n          ".concat(t," rc = getOutputCoords();\n\n          if(").concat(n,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(r,"));\n          }\n        }\n      ")}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let i=0;i<=1;i++){let r="".concat(0===n?"r":"rp1",", ").concat(0===i?"c":"cp1");for(let t=2;t<this.rank;t++)r="".concat(e[e.length-1-t],",")+r;t.push(r)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);let t="";for(let n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],i=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(i,";\n    ")}getOutput(e){const t=this.getSourceCoordsArr(e);if(1===this.rank){const e=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(e," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}class MN{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length);let n="";for(let i=0;i<4;i++){let e="thisRC = rc;";i%2===1&&(e+="thisRC.z += 1;"),i>1&&(e+="thisRC.y += 1;"),n+="\n        ".concat(e,"\n        ").concat(i>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(i,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(i>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){const n=t?eE(["r","c","d"],"inputShape"):JI(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(t,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":tE(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":e[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")}}class UN{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){const i=zN(t,n),r=VN(e,i,n);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const s=BN(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const e=this.freeTextures[r].pop();return this.usedTextures[r].push(e),e}let a;return i===_I.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===_I.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===_I.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===_I.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===_I.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(e,t,n,i){if(null==this.freeTextures)return;const r=zN(n,i),s=VN(t,r,i);s in this.freeTextures||(this.freeTextures[s]=[]);const a=BN(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,i),o=me().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[s],c=l&&l.indexOf(e);if(null==c||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));const t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function BN(e,t,n,i,r){const s=function(e,t){switch(e){case _I.PACKED_2X2_FLOAT32:return PE(t);case _I.PACKED_2X2_FLOAT16:return FE(t);case _I.UNPACKED_FLOAT32:return DE(t);case _I.UNPACKED_FLOAT16:return OE(t);case _I.PACKED_4X1_UNSIGNED_BYTE:return LE(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,i);let a;if(r){const[t,n]=TI(e[0],e[1]);a=t*n}else{const[t,n]=xI(e[0],e[1]);a=t*n}const o=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,s);return a*o}function zN(e,t){if(e===vI.UPLOAD)return _I.PACKED_2X2_FLOAT32;if(e===vI.RENDER||null==e)return function(e){return me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?_I.PACKED_2X2_FLOAT32:_I.UNPACKED_FLOAT32:e?_I.PACKED_2X2_FLOAT16:_I.UNPACKED_FLOAT16}(t);if(e===vI.DOWNLOAD||e===vI.PIXELS)return _I.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function VN(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}class jN{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}const WN="if (isnan(x)) return x;",HN="return abs(x);";const GN=WN+"\n  return (x < 0.0) ? 0.0 : x;\n",qN=WN+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",XN="return x;";class KN{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}class YN{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length);const t=e.length,n=PN("rc",t),i=pE(t),r=function(e,t){if(1===e)return"rc";let n="";for(let i=0;i<e;i++)n+=t[i],i<e-1&&(n+=",");return n}(t,n),s=n.slice(-2),a=t<=1?"rc":"vec2(".concat(s.join(","),")");this.userCode="\n      void main() {\n        ".concat(i," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(r,");\n\n        setOutput(getChannel(packedInput, ").concat(a,"));\n      }\n    ")}}const QN=_h,$N={};const JN=me().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class ZN extends A{nextDataId(){return ZN.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!me().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof UE)t=e;else{const n=yI(me().getNumber("WEBGL_VERSION"),e);t=new UE(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=yI(me().getNumber("WEBGL_VERSION"));t=new UE(e),this.binaryCache=((n=me().getNumber("WEBGL_VERSION"))in $N||($N[n]={}),$N[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new UN(this.gpgpu),this.numMBBeforeWarning=null==me().global.screen?1024:me().global.screen.height*me().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new N(this,Gs())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,i,r,s){const a=this.makeTensorInfo(t,n),o=this.texData.get(a.dataId);o.isPacked=!1,o.texture={texture:e,texShape:[i,r]},o.texShape=[i,r];const l=zI(t),c=new CE(l,!1,s),u=this.runWebGLProgram(c,[a],n,[[i,r]]);return u.shape=t,o.texture=null,this.disposeIntermediateTensorInfo(a),u.dataId}write(e,t,n){if((me().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||me().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:t,dtype:n,values:e,usage:vI.UPLOAD,refCount:1}),i}refCount(e){if(this.texData.has(e)){return this.texData.get(e).refCount}return 0}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}move(e,t,n,i,r){if(me().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:i,values:t,usage:vI.UPLOAD,refCount:r})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:i,complexTensorInfos:r,slice:s,shape:a,isPacked:o}=t;if(null!=s){let t;t=o?new KN(a,XN):new jN(a,XN);const n=this.runWebGLProgram(t,[{dataId:e,shape:a,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===i)return n;const l=null!=this.activeTimers;let c,u;if(l&&(c=ar()),"complex64"===i){u=Uu(this.readSync(r.real.dataId),this.readSync(r.imag.dataId))}else u=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=ar()-c),this.convertAndCacheOnCPU(e,u)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise(e=>t.push(e))}const t=this.texData.get(e),{values:n,shape:i,slice:r,dtype:s,complexTensorInfos:a,isPacked:o}=t;if(null!=r){let t;t=o?new KN(i,XN):new jN(i,XN);const n=this.runWebGLProgram(t,[{dataId:e,shape:i,dtype:s}],s),r=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if(me().getBool("DEBUG")&&!me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===me().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,c,u=null;if("complex64"!==s&&me().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const t=this.texData.get(l.dataId);u=this.gpgpu.createBufferFromTexture(t.texture.texture,...wI(i))}if(this.pendingRead.set(e,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const e=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]);c=Uu(e[0],e[1])}else if(null==u)c=this.getValuesFromTexture(e);else{const e=B(i);c=this.gpgpu.downloadFloat32MatrixFromBuffer(u,e)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=u){const e=this.gpgpu.gl;SI(e,()=>e.deleteBuffer(u))}const h=this.convertAndCacheOnCPU(e,c),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach(e=>e(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Gs().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.texData.get(e),{values:i,shape:r,slice:s,dtype:a,isPacked:o,texture:l}=n;if("complex64"===a)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=s){let n;n=o?new KN(r,XN):new jN(r,XN);const i=this.runWebGLProgram(n,[{dataId:e,shape:r,dtype:a}],a),s=this.readToGPU(i,t);return this.disposeIntermediateTensorInfo(i),s}if(null==l)throw null!=i?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,t.customTexShape),u=Gs().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:u},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>lr(e));return Vs(e.shape,e.dtype,n)}catch(uG){throw new Error("Failed to decode encoded string bytes into utf-8")}return Vs(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!CI(n)){if(me().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:i}=this.texData.get(e),r=B(t);if(me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),i=this.texData.get(n.dataId),s=this.gpgpu.downloadMatrixFromPackedTexture(i.texture.texture,...wI(t)).subarray(0,r);return this.disposeIntermediateTensorInfo(n),s}const s=me().getBool("WEBGL_PACK")&&!0===i,a=s?zI(t):t,o=s?new kE(a):new TE(a),l=this.runWebGLProgram(o,[{shape:a,dtype:n,dataId:e}],"float32"),c=this.texData.get(l.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,r);return this.disposeIntermediateTensorInfo(l),u}timerAvailable(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let i=!1;null==this.programTimersStack?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,e();const r=ur(this.activeTimers.map(e=>e.query)).filter(e=>null!=e),s=ur(this.activeTimers.map(e=>e.name)).filter(e=>null!=e);this.activeTimers=t,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(r);a.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),a.getExtraProfileInfo=()=>e.map((e,t)=>({name:s[t],ms:e})).map(e=>"".concat(e.name,": ").concat(e.ms)).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ar(),endMs:null}}endTimer(e){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ar(),e)}async getQueryTime(e){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:i,usage:r,isPacked:s,slice:a}=this.texData.get(e),o=a&&a.origDataId||e,l=this.dataRefCount.get(o);l>1?this.dataRefCount.set(o,l-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(i,n),this.textureManager.releaseTexture(t,i,r,s)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JN;return me().getBool("WEBGL_CPU_FORWARD")&&e.every(e=>null==this.texData.get(e.dataId).texture&&B(e.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Oi("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return QN(e.shape,t)}packedUnaryOp(e,t,n){const i=new KN(e.shape,t),r=this.compileAndRun(i,[e],n);return Gs().makeTensorFromTensorInfo(r)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=bN(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,HN,e.dtype);const t=new jN(e.shape,HN),n=this.compileAndRun(t,[e]);return Gs().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let i;if("string"===t&&null!=n&&n.length>0&&J(n[0])){const r=n.map(e=>or(e));i=this.write(r,e,t)}else i=this.write(n,e,t);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:t}}makeOutput(e,t,n){return Gs().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new YN(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new FN(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[UI(e.shape),...BI(e.shape)],i={dtype:e.dtype,shape:n,dataId:e.dataId},r=[UI(t),...BI(t)],s=new MN(r,n),a=[n],o=this.runWebGLProgram(s,[i],e.dtype,a,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:i,shape:r,dtype:s}=n;if(null!=t){F(B(r)<=t[0]*t[1]*4,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=zI(r);let o;o=i?new wE(a):new xE(a);const l=[null!=t?t:wI(a)];return{dtype:s,shape:r,dataId:this.runWebGLProgram(o,[{shape:a,dtype:s,dataId:e}],s,l,!0,t).dataId}}runWebGLProgram(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;const a=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(a.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===bI.DENSE){const t=null!=s?s:wI(e.outputShape);o.texShape=t.map(e=>2*e)}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===B(a.shape))return o.values=K(a.dtype,0),a;const l=[],c=t.map(t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&B(t.shape)<=me().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),l.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!jI(n.shape,t.shape)){const e=t,i=t.shape;t.shape=n.shape,t=this.packedReshape(t,i),l.push(t),n=this.texData.get(t.dataId),e.shape=i}return{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(a.dataId);const u={shape:a.shape,texData:o,isUniform:!1},h=function(e,t,n){let i="";t.concat(n).forEach(t=>{const r=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const s=t.texData.texShape,{useSqueezeShape:a,uniformShape:o,keptDims:l}=fE(e.packedInputs,t.shape,s);let c="",u="",h="";if(1===o.length&&e.packedInputs){const e=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];c="".concat(e[0]>1,"_").concat(e[1]>1)}else if(2!==o.length||e.packedInputs){if(o.length>2&&!e.packedInputs){const e=ie(o);h="".concat(e[0]===s[1],"_").concat(e[e.length-1]===s[1])}}else u="".concat(o[0]>1,"_").concat(o[1]>1);const d=t.shape.length,p=2===o.length&&z(t.shape,s),f=1===B(t.shape),g=va(t.shape,n.shape),m=!e.packedInputs&&d===n.shape.length&&z(s,n.texData.texShape),y=e.packedInputs||o.length>2?"":"".concat(s[0]>1,"_").concat(s[1]>1);i+="".concat(d,"_").concat(m,"_").concat(a?l:"","_").concat(o.length,"_").concat(f,"_").concat(g,"_").concat(p,"_").concat(c,"_").concat(u,"_").concat(h,"_").concat(y,"_").concat(r)}else{const e=t.isUniform?"uniform":t.texData.texShape;i+="".concat(t.shape,"_").concat(e,"_").concat(r)}});const r=e.userCode;let s=e.constructor.name;return s+="_"+i+"_"+r+"".concat(me().getNumber("WEBGL_VERSION")),s}(e,c,u),d=this.getAndSaveBinary(h,()=>yE(this.gpgpu,e,c,u)),p=null!=this.activeTimers;let f;p&&(f=this.startTimer()),me().get("ENGINE_COMPILE_ONLY")||function(e,t,n,i,r){t.program.enableShapeUniforms||(vE(t.inShapeInfos,n),vE([t.outShapeInfo],[i]));const s=i.texData.texture,a=i.texData.texShape;i.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,a[0],a[1]):e.setOutputMatrixTexture(s.texture,a[0],a[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===me().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let l=0;l<n.length;++l){const i=n[l],{uniform:r,offset:s,shape:a,texShape:o}=t.variablesLocations[l];if(a){const{uniformShape:n}=fE(t.program.packedInputs,i.shape,i.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(a,new Int32Array(n));break;case 2:e.gl.uniform2iv(a,new Int32Array(n));break;case 3:e.gl.uniform3iv(a,new Int32Array(n));break;case 4:e.gl.uniform4iv(a,new Int32Array(n))}}if(o&&e.gl.uniform2i(o,i.texData.texShape[0],i.texData.texShape[1]),null!=r)if(i.isUniform)if(B(i.shape)<2)e.gl.uniform1f(r,i.uniformValues[0]);else{let t=i.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(r,t)}else null!=i.texData.slice&&null!=s&&e.gl.uniform1i(s,i.texData.slice.flatOffset),e.setInputMatrixTexture(i.texData.texture.texture,r,l)}const o=t.outShapeLocation;if(o)switch(i.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(i.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(i.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(i.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(i.shape))}if(t.outShapeStridesLocation){const n=ie(i.shape);switch(i.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,i.texData.texShape[0],i.texData.texShape[1]),t.program.customUniforms&&r)for(let l=0;l<t.program.customUniforms.length;++l){const n=t.program.customUniforms[l],i=t.customUniformLocations[l],s=r[l];if("float"===n.type)e.gl.uniform1fv(i,s);else if("vec2"===n.type)e.gl.uniform2fv(i,s);else if("vec3"===n.type)e.gl.uniform3fv(i,s);else if("vec4"===n.type)e.gl.uniform4fv(i,s);else if("int"===n.type)e.gl.uniform1iv(i,s);else if("ivec2"===n.type)e.gl.uniform2iv(i,s);else if("ivec3"===n.type)e.gl.uniform3iv(i,s);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(i,s)}}e.executeProgram()}(this.gpgpu,d,c,u,i),l.forEach(e=>this.disposeIntermediateTensorInfo(e)),p&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)}));const g=me().get("WEBGL_FLUSH_THRESHOLD");if(g>0){const e=ar();e-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!me().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===r){const e=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),e}return a}compileAndRun(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;return this.runWebGLProgram(e,t,n,i,r)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!me().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})}this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Xs(()=>{if(!me().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=me().getBool("DEBUG");me().set("DEBUG",!1);const t=this.abs(sa(1e-8)).dataSync()[0];if(me().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:i,values:r,texture:s,usage:a,isPacked:o}=t;if(null!=s)return;const l=null!=this.activeTimers;let c;l&&(c=ar());let u=t.texShape;if(null==u&&(u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=me().getNumber("WEBGL_MAX_TEXTURE_SIZE"),i=me().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(i===1/0&&me().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(i=n/2),t&&(n*=2,i*=2,e=e.map((t,n)=>n>=e.length-2?L(e[n]):e[n]),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=X(e);e=t.newShape}let r=B(e),s=null;e.length<=1&&r<=n?s=[1,r]:2===e.length&&e[0]<=n&&e[1]<=n?s=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);const a=null!=s&&Math.max(...s)>i&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(null==s||a)if(t){const t=UI(e);let n=2,i=2;e.length&&([n,i]=BI(e)),r=t*(n/2)*(i/2),s=j(r).map(e=>2*e)}else s=j(r);return s}(n,o),t.texShape=u),null!=r){const e=zI(n);let s,a=u[1],h=u[0];const d=r instanceof Uint8Array||r instanceof Uint8ClampedArray;!o&&d||([a,h]=TI(u[0],u[1])),s=o?new IE(e,d):new CE(e,d);const p=d?[h,a]:u,f=this.makeTensorInfo(p,i),g=this.texData.get(f.dataId);g.usage=d?vI.PIXELS:vI.UPLOAD,g.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),a,h,r);const m=[[h,a]],y=!0,b=this.runWebGLProgram(s,[f],i,m,y),v=this.texData.get(b.dataId);t.texShape=v.texShape,t.isPacked=v.isPacked,t.usage=v.usage,me().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(t.texture=v.texture,t.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(f),l&&(this.uploadWaitMs+=ar()-c)}else{const e=this.acquireTexture(u,a,i,o);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:i}=n;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype ".concat(t))}(t,i)),n.values}acquireTexture(e,t,n,i){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(e," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,i)}computeBytes(e,t){return e[0]*e[1]*$(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise(e=>{try{this.checkCompletion_(t),e(!0)}catch(n){throw n}});e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await uu(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw NI(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:n,infLoc:i,nanLoc:r,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}=bE(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=i,e.nanLoc=r,e.outShapeLocation=s,e.outShapeStridesLocation=a,e.outTexShapeLocation=o}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";const{texture:i,height:r,width:s,channels:a}=e,o=Gs().backend;if(!o.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=o.writeTexture(i,t,n,r,s,a);return Gs().makeTensorFromDataId(l,t,n,o)}}ZN.nextDataId=0;Kr()&&Qs("webgl",()=>new ZN,2);const eA="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class tA{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=xa(t,n),this.enableShapeUniforms=_E(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")}}const nA="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class iA{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xa(t,n);const r=this.outputShape.length;this.enableShapeUniforms=_E(r);let s="";if(i)if(0===r||1===B(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{const e=pE(r);if(s="\n          ".concat(e," coords = getOutputCoords();\n        "),1===r)this.enableShapeUniforms?s+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":s+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{const e=PN("coords",r);this.enableShapeUniforms?s+="\n            bool nextRowOutOfBounds =\n              (".concat(e[r-2]," + 1) >= outShape[").concat(r," - 2];\n            bool nextColOutOfBounds =\n              (").concat(e[r-1]," + 1) >= outShape[").concat(r," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):s+="\n            bool nextRowOutOfBounds =\n              (".concat(e[r-2]," + 1) >= ").concat(this.outputShape[r-2],";\n            bool nextColOutOfBounds =\n              (").concat(e[r-1]," + 1) >= ").concat(this.outputShape[r-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(s,"\n\n        setOutput(result);\n      }\n    ")}}function rA(e){const{inputs:t,backend:n}=e,{x:i}=t;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const sA={kernelName:Ft,backendName:"webgl",kernelFunc:rA};function aA(e){const{inputs:t,backend:n}=e,{real:i,imag:r}=t,s=n.makeTensorInfo(i.shape,"complex64"),a=n.texData.get(s.dataId),o=rA({inputs:{x:i},backend:n}),l=rA({inputs:{x:r},backend:n});return a.complexTensorInfos={real:o,imag:l},s}const oA={kernelName:Xe,backendName:"webgl",kernelFunc:aA},lA="return (a < 0.) ? b * a : a;",cA="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const uA={kernelName:jt,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{alpha:s}=i,a=n.makeTensorInfo([],"float32",rr(s,"float32")),o=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new iA(cA,r.shape,a.shape):new tA(lA,r.shape,a.shape),l=n.runWebGLProgram(o,[r,a],"float32");return n.disposeIntermediateTensorInfo(a),l}},hA="return (a < 0.) ? b * a : a;",dA="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const pA={kernelName:kn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i,alpha:r}=t,s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new iA(dA,i.shape,r.shape):new tA(hA,i.shape,r.shape);return n.runWebGLProgram(s,[i,r],"float32")}},fA="if (isnan(x)) return x;";function gA(e){let{opSnippet:t,packedOpSnippet:n,cpuKernelImpl:i,dtype:r}=e;return e=>{let{inputs:s,backend:a}=e;const{x:o}=s,l=a,c=r||o.dtype;if(l.shouldExecuteOnCPU([o])&&null!=i){const e=l.texData.get(o.dataId),t=i(e.values,c);return l.makeTensorInfo(o.shape,c,t)}let u;return u=me().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new KN(o.shape,n):new jN(o.shape,t),l.runWebGLProgram(u,[o],c)}}function mA(e){let{opSnippet:t,packedOpSnippet:n,checkOutOfBounds:i=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:a}=e;return e=>{let{inputs:o,backend:l}=e;const{a:c,b:u}=o,h=l;if(r&&"complex64"===c.dtype){const e=h.texData.get(c.dataId),n=h.texData.get(u.dataId),[i,r]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map(e=>{const[n,i]=e,r={dataId:n.dataId,dtype:n.dtype,shape:c.shape},s={dataId:i.dataId,dtype:i.dtype,shape:u.shape},a=new tA(t,c.shape,u.shape);return h.runWebGLProgram(a,[r,s],Dr(n.dtype,i.dtype))}),s=aA({inputs:{real:i,imag:r},backend:h});return h.disposeIntermediateTensorInfo(i),h.disposeIntermediateTensorInfo(r),s}const d=a||Dr(c.dtype,u.dtype);if(("string"===c.dtype||"string"===u.dtype||h.shouldExecuteOnCPU([c,u]))&&null!=s){const e=h.texData.get(c.dataId).values,t=h.texData.get(u.dataId).values,n="string"===c.dtype?bh(e):e,i="string"===c.dtype?bh(t):t,[r,a]=s(c.shape,u.shape,n,i,d),o=h.makeTensorInfo(a,d);return h.texData.get(o.dataId).values=r,o}let p;return p=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new iA(n,c.shape,u.shape,i):new tA(t,c.shape,u.shape),h.runWebGLProgram(p,[c,u],d)}}function yA(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":GN;if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":qN;if("prelu"===e)return t?dA:hA;if("leakyrelu"===e)return t?cA:lA;if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}class bA{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=_E(this.outputShape.length);const c=i?e[1]:e[2],u=Math.ceil(c/2),h=i?"i * 2, rc.y":"rc.y, i * 2",d=r?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",m="";a&&(g=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(a,"\n        }"):l?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(a,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(a,"\n        }"),m="result = activation(result);");const y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";e[0]<t[0]?b="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(v="imod(rc.x, ".concat(t[0],")")),this.userCode="\n      ".concat(g,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(u,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(b,";\n        int batchB = ").concat(v,";\n        for (int i = 0; i < ").concat(u,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(p[0]," * ").concat(f[0],");\n          result += (").concat(p[1]," * ").concat(f[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(m,"\n\n        setOutput(result);\n      }\n    ")}}const vA="return areal * breal - aimag * bimag;",_A="return areal * bimag + aimag * breal;";class xA{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=xa(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")}}const wA="return a * b;";function TA(e){const{inputs:t,backend:n}=e,{a:i,b:r}=t,s=Dr(i.dtype,r.dtype);if("complex64"===i.dtype){const e=n.texData.get(i.dataId),t=n.texData.get(r.dataId),s=new xA(vA,i.shape,r.shape),a=new xA(_A,i.shape,r.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:r.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:r.shape}],l=n.runWebGLProgram(s,o,"float32"),c=n.runWebGLProgram(a,o,"float32"),u=aA({inputs:{real:l,imag:c},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}if(n.shouldExecuteOnCPU([i,r])){const e=n.texData.get(i.dataId),t=n.texData.get(r.dataId),[a,o]=oN(i.shape,r.shape,e.values,t.values,s),l=n.makeTensorInfo(o,s);return n.texData.get(l.dataId).values=a,l}let a;return a=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new iA(wA,i.shape,r.shape):new tA(wA,i.shape,r.shape),n.runWebGLProgram(a,[i,r],s)}const kA={kernelName:pn,backendName:"webgl",kernelFunc:TA};function SA(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{shape:s}=i,a=n,o=B(r.shape),l=G(s,o),c=B(l);F(o===c,()=>"The new shape (".concat(l,") has ").concat(c," elements and the old ")+"shape (".concat(r.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements.");const u=a.texData.get(r.dataId);return!u.isPacked||jI(r.shape,l)||null!==u.texture&&jI(u.shape,l)?(a.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype}):function(e,t,n){const i=[UI(e.shape),...BI(e.shape)],r={dtype:e.dtype,shape:i,dataId:e.dataId},s=[UI(t),...BI(t)],a=new MN(s,i),o=[i],l=n.runWebGLProgram(a,[r],e.dtype,o,!0);return{dataId:l.dataId,shape:t,dtype:l.dtype}}(r,l,a)}const CA={kernelName:On,backendName:"webgl",kernelFunc:SA};class IA{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:r,outSize:s}=e;this.outputShape=[i,s];const a=4*Math.floor(n/4),o=n%4;let l="sumValue += dot(values, ones);";if(null!=t){const e=1/t;l="sumValue += dot(values * ".concat(V(e)?e.toPrecision(2):e,", ones);")}let c="";r%n>0&&(c="\n        if (inIdx < 0 || inIdx >= ".concat(r,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(c,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(a,";\n        if (").concat(1===o,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===o,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===o,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")}}class EA{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:r,outSize:s}=e;this.outputShape=[i,s];let a="0.0",o="";"prod"===t?a="1.0":"min"===t?(a="1.0 / 1e-20",o="min"):"max"===t&&(a="-1.0 / 1e-20",o="max");let l="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");const c=4*Math.floor(n/4),u=n%4;let h="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(o,"(values, minMaxValue);\n        if (").concat("min"===t," || ").concat("max"===t,") {\n          minMaxValue = ").concat(o,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===t?(a="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(a="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let p="";r%n>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(r,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(a,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(a,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(c,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(c,";\n        if (").concat(1===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(l,");\n      }\n    ")}}function NA(e,t,n,i){const r=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],i=vu(n);t.push({inSize:n,windowSize:i,outSize:Math.ceil(n/i)})}return t}(e.shape);let s=e;for(let a=0;a<r.length;a++){const{inSize:o,windowSize:l,outSize:c}=r[a];let u,h;u="mean"===n?0===a?new IA({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c},o):new IA({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c}):new EA({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c},n),h=s,s=i.runWebGLProgram(u,[s],t),h.dataId!==e.dataId&&i.disposeIntermediateTensorInfo(h)}return s}class AA{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[t[s]];this.outputShape=n,this.rank=n.length;const i=pE(this.rank),r=function(e){const t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(t);for(let r=0;r<e.length;r++)i[e[r]]=n[r];return i.join()}(t);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(r,"));\n    }\n    ")}}class RA{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let c=0;c<n.length;c++)n[c]=e[t[c]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));const i=pE(this.rank),r=LN("rc",this.rank),s=new Array(this.rank);for(let c=0;c<t.length;c++)s[t[c]]=r[c];const a="vec2(".concat(s.slice(-2).join(),")"),o="++".concat(r[this.rank-1]," < ").concat(n[this.rank-1]),l="getChannel(getA(".concat(s.join(),"), ").concat(a,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(l,";\n      if(").concat(o,") {\n        result[1] = ").concat(l,";\n      }\n      --").concat(r[this.rank-1],";\n      if(++").concat(r[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(l,";\n        if(").concat(o,") {\n          result[3] = ").concat(l,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}}function DA(e,t,n){const i=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RA(e.shape,t):new AA(e.shape,t);return n.runWebGLProgram(i,[e],e.dtype)}function OA(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;return function(e,t,n,i){const r=t,s=e.shape.length,a=q(r,e.shape);let o=a;const l=yl(o,s),c=null!=l;let u=e;c&&(u=DA(e,l,i),o=vl(o.length,s)),ml("sum",o,s);const[h,d]=fl(u.shape,o);let p=h;n&&(p=gl(h,a));const f=B(d),g=SA({inputs:{x:u},attrs:{shape:[B(e.shape)/f,f]},backend:i}),m=NA(g,Or(e.dtype),"sum",i),y=SA({inputs:{x:m},attrs:{shape:p},backend:i});return i.disposeIntermediateTensorInfo(g),i.disposeIntermediateTensorInfo(m),c&&i.disposeIntermediateTensorInfo(u),y}(r,s,a,n)}const LA={kernelName:ei,backendName:"webgl",kernelFunc:OA};function PA(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{perm:s}=i,a=n,o=r.shape.length,l=new Array(o);for(let u=0;u<l.length;u++)l[u]=r.shape[s[u]];let c;if(a.shouldExecuteOnCPU([r])){const e=a.texData.get(r.dataId).values,t=DN(e,r.shape,r.dtype,s,l);c=a.makeTensorInfo(l,r.dtype);a.texData.get(c.dataId).values=t}else c=DA(r,s,a);return c}const FA={kernelName:wi,backendName:"webgl",kernelFunc:PA};function MA(e){let{a:t,b:n,transposeA:i,transposeB:r,backend:s,bias:a=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:c=null}=e;const u=t.shape.length,h=n.shape.length,d=i?t.shape[u-2]:t.shape[u-1],p=r?n.shape[h-1]:n.shape[h-2],f=i?t.shape[u-1]:t.shape[u-2],g=r?n.shape[h-2]:n.shape[h-1],m=t.shape.slice(0,-2),y=n.shape.slice(0,-2),b=B(m),v=B(y),_=xa(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([f,g]);F(d===p,()=>"Error in matMul: inner shapes (".concat(d,") and (")+"".concat(p,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(i)+" and transposeB=".concat(r," must match."));const x=i?[b,d,f]:[b,f,d],w=r?[v,g,p]:[v,p,g],T=SA({inputs:{x:t},backend:s,attrs:{shape:x}}),k=SA({inputs:{x:n},backend:s,attrs:{shape:w}}),S=[T,k],C=Math.max(b,v),I=i?T.shape[1]:T.shape[2],E=null!=a,N=null!=o,A="leakyrelu"===c,R=null!=c?yA(c,!0):null;let D;if((1===f||1===g)&&I>1e3&&!1===(E||N||A||null!=R)){let e=T,t=k;i&&(e=PA({inputs:{x:T},backend:s,attrs:{perm:[0,2,1]}}),S.push(e)),r&&(t=PA({inputs:{x:k},backend:s,attrs:{perm:[0,2,1]}}),S.push(t));const n=1===g;let a=e;1!==g&&(a=SA({inputs:{x:e},backend:s,attrs:{shape:[C,I,1]}}),S.push(a));const o=1===g?2:1;let l=t;n&&(l=SA({inputs:{x:t},backend:s,attrs:{shape:[C,1,I]}}),S.push(l));const c=TA({inputs:{a:a,b:l},backend:s});D=OA({inputs:{x:c},backend:s,attrs:{axis:o,keepDims:!0}}),S.push(c)}else{const e=Dr(t.dtype,n.dtype),c=new bA(x,w,[C,f,g],i,r,E,R,N,A),u=[T,k];if(null!=a&&u.push(a),N&&u.push(o),A){const e=s.makeTensorInfo([],"float32",rr(l,"float32"));u.push(e),S.push(e)}D=s.runWebGLProgram(c,u,e)}const O=SA({inputs:{x:D},backend:s,attrs:{shape:_}});S.push(D);for(const L of S)s.disposeIntermediateTensorInfo(L);return O}const UA={kernelName:Ai,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s,bias:a,preluActivationWeights:o}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=i;return MA({a:r,b:s,transposeA:l,transposeB:c,backend:n,bias:a,preluActivationWeights:o,leakyreluAlpha:h,activation:u})}},BA="return abs(x);";const zA={kernelName:xe,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t;if(n.shouldExecuteOnCPU([i])&&"complex64"!==i.dtype){const e=n.texData.get(i.dataId),t=bN(e.values);return n.makeTensorInfo(i.shape,i.dtype,t)}let r;return r=me().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new KN(i.shape,BA):new jN(i.shape,BA),n.runWebGLProgram(r,[i],i.dtype)}},VA=gA({opSnippet:WN+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),jA={kernelName:we,backendName:"webgl",kernelFunc:VA},WA=gA({opSnippet:WN+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),HA={kernelName:Te,backendName:"webgl",kernelFunc:WA},GA="return a + b;",qA=mA({opSnippet:GA,packedOpSnippet:GA,supportsComplex:!0,cpuKernelImpl:BE}),XA={kernelName:ke,backendName:"webgl",kernelFunc:qA};class KA{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((e,t)=>"T".concat(t));const n=[];this.variableNames.forEach(e=>{n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))});const i=this.variableNames.map(e=>"v".concat(e)).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(i,";\n        setOutput(result);\n      }\n    ")}}class YA{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((e,t)=>"T".concat(t));const n=[];this.variableNames.forEach(e=>{n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))});const i=this.variableNames.map(e=>"v".concat(e)).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(i,";\n        setOutput(result);\n      }\n    ")}}const QA={kernelName:Se,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i}=t,r=n;if(1===r.length)return rA({inputs:{x:r[0]},backend:i});if(r.length>me().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(r.length/2),n=e({inputs:r.slice(0,t),backend:i}),s=e({inputs:r.slice(t),backend:i});return e({inputs:[n,s],backend:i})}const s=r.map(e=>e.dtype).reduce((e,t)=>Dr(e,t)),a=r.map(e=>e.shape),o=me().getBool("WEBGL_PACK")?new YA(r[0].shape,a):new KA(r[0].shape,a);return i.runWebGLProgram(o,r,s)}};const $A={kernelName:Ce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=r.shape.length,l=q(s,r.shape);let c=l;const u=yl(c,o);let h=r;null!=u&&(h=PA({inputs:{x:r},backend:n,attrs:{perm:u}}),c=vl(c.length,o)),ml("all",c,o);const[d,p]=fl(h.shape,c),f=SA({inputs:{x:h},backend:n,attrs:{shape:[-1,B(p)]}}),g=NA(f,f.dtype,"all",n);let m;if(a){m=SA({inputs:{x:g},backend:n,attrs:{shape:gl(d,l)}})}else m=SA({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),m}};const JA={kernelName:Ie,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=r.shape.length,l=q(s,r.shape);let c=l;const u=yl(c,o);let h=r;null!=u&&(h=PA({inputs:{x:r},backend:n,attrs:{perm:u}}),c=vl(c.length,o)),ml("any",c,o);const[d,p]=fl(h.shape,c),f=SA({inputs:{x:h},backend:n,attrs:{shape:[-1,B(p)]}}),g=NA(f,f.dtype,"any",n);let m;if(a){m=SA({inputs:{x:g},backend:n,attrs:{shape:gl(d,l)}})}else m=SA({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),m}};class ZA{constructor(e,t,n){this.variableNames=["A"];const{windowSize:i,batchSize:r,outSize:s}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[r,s];const a="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(i,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(i,"; i++) {\n          int inIdx = ").concat(o,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(a," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")}}class eR{constructor(e,t,n,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,F(e.length>2,()=>"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2."));const r=e[e.length-1],s=Math.ceil(r/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,o=a.length,l=pE(o),c=PN("coords",o);let u,h;if(1===s){h=o+1;const e=pE(h);u="\n        ".concat(e," sourceLocR = ").concat(e,"(").concat(c.join(),", 0);\n        ++").concat(c[o-1],";\n        ").concat(e," sourceLocG = ").concat(e,"(").concat(c.join(),", 0);\n        ++").concat(c[o-2],";\n        ").concat(e," sourceLocA = ").concat(e,"(").concat(c.join(),", 0);\n        --").concat(c[o-1],";\n        ").concat(e," sourceLocB = ").concat(e,"(").concat(c.join(),", 0);\n        --").concat(c[o-2],";")}else h=o,u="\n        ".concat(l," sourceLocR = coords;\n        ++").concat(c[o-1],";\n        ").concat(l," sourceLocG = coords;\n        ++").concat(c[o-2],";\n        ").concat(l," sourceLocA = coords;\n        --").concat(c[o-1],";\n        ").concat(l," sourceLocB = coords;\n        --").concat(c[o-2],";");const d=["x","y","z","w","u","v"].slice(0,h),p="."+d[h-1],f=d.map(e=>"int "+e),g=PN("sourceLocR",h-1).concat("inIdx.r"),m=PN("sourceLocG",h-1).concat("inIdx.g"),y=PN("sourceLocB",h-1).concat("inIdx.b"),b=PN("sourceLocA",h-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",_=i?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),")));"),x="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(m.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(b.join(),") : 0.)"),w=i?"":"\n      float getBestIndicesAChannel(".concat(f.join(),") {\n        return getChannel(getBestIndicesA(").concat(d.join(),"),\n                                          vec2(").concat(d.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(f.join(),") {\n        return getChannel(getA(").concat(d.join(),"),\n                               vec2(").concat(d.slice(-2).join(),"));\n      }\n      ").concat(w,"\n      void main() {\n        ").concat(l," coords = getOutputCoords();\n        bool hasNextCol = ").concat(c[o-1]," < ").concat(a[o-1]-1,";\n        bool hasNextRow = ").concat(c[o-2]," < ").concat(a[o-2]-1,";\n        ").concat(u,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(p,", sourceLocG").concat(p,",\n          sourceLocB").concat(p,", sourceLocA").concat(p,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(x,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(_,"\n          vec4 candidate = ").concat(x,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(v,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}}function tR(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=t.shape[0],s=t.shape[1];null!=i&&(r=i.shape[0],s=i.shape[1]);const a=vu(s),o={windowSize:a,inSize:s,batchSize:r,outSize:Math.ceil(s/a)},l=new ZA(o,n,null==i),c=[t];null!=i&&c.push(i);const u=e.runWebGLProgram(l,c,"int32");if(1===u.shape[1])return u;const h=tR(e,t,n,u);return e.disposeIntermediateTensorInfo(u),h}function nR(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=null!=i?i.shape:t.shape,s=vu(r[r.length-1]),a=new eR(r,s,n,null==i),o=null==i?[t]:[t,i],l=e.runWebGLProgram(a,o,"int32");if(l.shape.length===t.shape.length){const i=nR(e,t,n,l);return e.disposeIntermediateTensorInfo(l),i}return l}function iR(e,t,n,i){const r=[n];if(ml("arg"+i.charAt(0).toUpperCase()+i.slice(1),r,t.shape.length),!me().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],s=e.texData.get(t.dataId);let a=t;null!==s&&s.isPacked&&(a=e.unpackTensor(t),n.push(a));const[o,l]=fl(a.shape,r),c=B(l),u=SA({inputs:{x:a},backend:e,attrs:{shape:[-1,c]}});n.push(u);const h=tR(e,u,i);n.push(h);const d=SA({inputs:{x:h},backend:e,attrs:{shape:o}});return n.forEach(t=>e.disposeIntermediateTensorInfo(t)),d}return nR(e,t,i)}const rR={kernelName:Ee,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s}=i;let a=q(s,r.shape);const o=yl(a,r.shape.length);let l=r;const c=[];null!=o&&(l=PA({inputs:{x:r},backend:n,attrs:{perm:o}}),c.push(l),a=vl(a.length,l.shape.length)),ml("argMax",[a[0]],l.shape.length);const u=iR(n,l,a[0],"max");return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}};const sR={kernelName:Ne,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s}=i;let a=q(s,r.shape);const o=yl(a,r.shape.length);let l=r;const c=[];null!=o&&(l=PA({inputs:{x:r},backend:n,attrs:{perm:o}}),c.push(l),a=vl(a.length,l.shape.length)),ml("argMin",[a[0]],l.shape.length);const u=iR(n,l,a[0],"min");return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}},aR=gA({opSnippet:WN+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),oR={kernelName:Ae,backendName:"webgl",kernelFunc:aR},lR=gA({opSnippet:WN+"return log(x + sqrt(x * x + 1.0));"}),cR={kernelName:Re,backendName:"webgl",kernelFunc:lR},uR=gA({opSnippet:WN+"\n  return atan(x);\n"}),hR={kernelName:De,backendName:"webgl",kernelFunc:uR},dR=mA({opSnippet:eA+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+nA+"\n  return result;\n"}),pR={kernelName:Le,backendName:"webgl",kernelFunc:dR},fR=gA({opSnippet:WN+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),gR={kernelName:Oe,backendName:"webgl",kernelFunc:fR};class mR{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const f="avg"===t,g="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),m="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d");let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec2 strides = ivec2(".concat(a,", ").concat(o,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(u,";\n              wR += ").concat(l,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(c,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(t," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(i?r?g:m:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let b="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / max(count, 1.0)");const v=4*Math.floor(s/4),_=s%4,x="\n      if (".concat(f,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(a,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(l,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(v,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(c,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              getValue(batch, xR, xC + 3 * ").concat(c,", d)\n            );\n\n            ").concat(x,"\n          }\n\n          int xC = xCCorner + ").concat(v,";\n          if (").concat(1===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(x,"\n          } else if (").concat(2===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(x,"\n          } else if (").concat(3===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              initializationValue\n            );\n\n            ").concat(x,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}}class yR{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,g=e.padInfo.front,m=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const b="avg"===t;let v="0.0";if(b||(v="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(a,", ").concat(o,", ").concat(l,");\n        const ivec3 pads = ivec3(").concat(g,", ").concat(m,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(c,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(p,";\n                wR += ").concat(u,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(f,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(t," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(i?r?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(p," * ").concat(f," +\n                      wR * ").concat(f," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let _="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(_="avgValue / max(count, 1.0)");const x=4*Math.floor(s/4),w=s%4,T="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(a,", ").concat(o,", ").concat(l,");\n      const ivec3 pads = ivec3(").concat(g,", ").concat(m,", ").concat(y,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(c,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(u,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(T,"\n            }\n\n            int xC = xCCorner + ").concat(x,";\n            if (").concat(1===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(2===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(3===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(T,"\n            }\n          }\n        }\n        setOutput(").concat(_,");\n      }\n    ")}}const bR={kernelName:Pe,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;YI(r,"avgPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=i;F(mo(a,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(1,"'"));const c=so(r.shape,s,a,1,o,l);if(1===c.filterWidth&&1===c.filterHeight&&z(c.inShape,c.outShape))return rA({inputs:{x:r},backend:n});const u=new mR(c,"avg",!1);return n.runWebGLProgram(u,[r],"float32")}};const vR={kernelName:Me,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=i,u=ao(r.shape,s,a,[1,1,1],o,l,c),h=new yR(u,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}};class _R{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,a=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=o-1-e.padInfo.top,u=l-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(c,", ").concat(u,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(o,";\n            wR += ").concat(s,") {\n          float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(l,";\n            wC+= ").concat(a,") {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class xR{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,i=e.filterWidth,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=u-1-e.padInfo.front,f=h-1-e.padInfo.top,g=d-1-e.padInfo.left,m=1/(t*n*i);this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(f,", ").concat(g,");\n      const float avgMultiplier = float(").concat(m,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n            wD += ").concat(o,") {\n          float dyD = float(dyDCorner + wD) / ").concat(r,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(l,") {\n            float dyR = float(dyRCorner + wR) / ").concat(s,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(c,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const wR={kernelName:Ue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,a=s,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=i,h=ao(a.shape,o,l,[1,1,1],c,u),d=new xR(h);return n.runWebGLProgram(d,[r],a.dtype)}};const TR={kernelName:Fe,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,a=s;YI([r,s],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=i,u=so(a.shape,o,l,1,c),h=new _R(u);return n.runWebGLProgram(h,[r],a.dtype)}};const kR={kernelName:Be,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s}=t,{transposeA:a,transposeB:o}=i;return MA({a:r,b:s,transposeA:a,transposeB:o,backend:n})}};class SR{constructor(e,t,n,i,r,s){this.outputShape=[],this.variableNames=["x","mean","variance"],xa(e,t),xa(e,n);let a="0.0";null!=i&&(xa(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let o="1.0";null!=r&&(xa(e,r),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(a,";\n        float scale = ").concat(o,";\n        float inv = scale * inversesqrt(variance + float(").concat(s,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")}}class CR{constructor(e,t,n,i,r,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],xa(e,t),xa(e,n);let a="vec4(0.0)";null!=i&&(xa(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=r&&(xa(e,r),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(a,";\n        vec4 scale = ").concat(o,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(s,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")}}const IR={kernelName:Rt,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:i}=e;const{x:r,mean:s,variance:a,offset:o,scale:l}=t;F(s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(null==o||s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(null==l||s.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=i;null==c&&(c=.001);const u=[r,s,a];let h=null;null!=o&&(h=o.shape,u.push(o));let d=null;null!=l&&(d=l.shape,u.push(l));const p=me().getBool("WEBGL_PACK_NORMALIZATION")?new CR(r.shape,s.shape,a.shape,h,d,c):new SR(r.shape,s.shape,a.shape,h,d,c);return n.runWebGLProgram(p,u,u[0].dtype)}};class ER{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=pE(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return NR.slice(0,e).map(e=>"sourceLoc."+e).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);let i;const r=e.map((e,t)=>"sourceLoc.".concat(NR[t]," = start[").concat(t,"] + coords.").concat(NR[t],";"));i="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(r.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(i,"\n        setOutput(getSource(").concat(n,"));\n      }\n    ")}}const NR=["x","y","z","w","u","v"];class AR{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=pE(this.rank),n=PN("coords",this.rank),i=PN("sourceLoc",this.rank),r=1===this.rank?"sourceLoc":"vec2(".concat(i.slice(-2).join(),")"),s="getChannel(getSource(".concat(i.join(),"), ").concat(r,")"),a="\n      result.x = ".concat(s,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(i[this.rank-1],";\n        result.y = ").concat(s,";\n        --").concat(i[this.rank-1],";\n      }\n    "),o=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(i[this.rank-2],";\n        result.z = ").concat(s,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(i[this.rank-1],";\n          result.w = ").concat(s,";\n        }\n      }\n    "),l=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map((e,t)=>"start[".concat(t,"]")).join(),");"):e.map((e,t)=>"".concat(i[t]," = ").concat(n[t]," + start[").concat(t,"];")).join("\n");this.userCode="\n      void main() {\n        ".concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(l,"\n        vec4 result = vec4(0.);\n        ").concat(a,"\n        ").concat(o,"\n        setOutput(result);\n      }\n    ")}}function RR(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{begin:s,size:a}=i,[o,l]=Ja(r,s,a);if(Ua(r,o,l),0===B(l))return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||"string"===r.dtype){const e=n.texData.get(r.dataId),t=vN(e.values,o,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,t)}const{isPacked:c}=n.texData.get(r.dataId),u=Qa(r.shape,o,l);if(c||!u){const e=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new AR(l):new ER(l),t=[o];return n.runWebGLProgram(e,[r],r.dtype,t)}return n.uploadToGPU(r.dataId),function(e,t,n,i){const r=i.texData.get(e.dataId),s=i.makeTensorInfo(n,e.dtype),a=i.texData.get(s.dataId);Object.assign(a,r),a.refCount=1,a.shape=n,a.dtype=e.dtype;let o=$a(t,ie(e.shape));r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};const l=i.dataRefCount.get(a.slice.origDataId)||1;return i.dataRefCount.set(a.slice.origDataId,l+1),s}(r,o,l,n)}const DR={kernelName:Xn,backendName:"webgl",kernelFunc:RR},OR={kernelName:ze,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockShape:s,crops:a}=i;F(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const o=s.reduce((e,t)=>e*t),l=xu(r.shape,s,o),c=wu(l.length,s.length),u=Tu(r.shape,s,o),h=ku(a,s.length),d=Su(u,a,s.length),p=[],f=SA({inputs:{x:r},backend:n,attrs:{shape:l}}),g=PA({inputs:{x:f},backend:n,attrs:{perm:c}}),m=SA({inputs:{x:g},backend:n,attrs:{shape:u}}),y=RR({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return p.push(f),p.push(g),p.push(m),p.forEach(e=>n.disposeIntermediateTensorInfo(e)),y}};const LR={kernelName:Ve,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a}=i,o=n.readSync(r.dataId),l=n.readSync(s.dataId),c=zE(o,l,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,c)}};const PR={kernelName:je,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{a:i,b:r}=t,s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS"),a=me().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([i,r])||1===a){const e=n.texData.get(i.dataId).values,t=n.texData.get(r.dataId).values,[s,a]=jE(i.shape,r.shape,e,t,i.dtype),o=n.makeTensorInfo(a,i.dtype);return n.texData.get(o.dataId).values=s,o}let o;return o=s?new iA("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",i.shape,r.shape,!1):new tA("\n  return float(int(a.r) & int(b.r));\n",i.shape,r.shape),n.runWebGLProgram(o,[i,r],i.dtype)}};const FR={kernelName:We,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:i,s1:r}=t,s=n.readSync(i.dataId),a=n.readSync(r.dataId),o=xa(Array.from(s),Array.from(a));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},MR=mA({opSnippet:"return float(a != b);",cpuKernelImpl:cN,dtype:"bool"}),UR={kernelName:gn,backendName:"webgl",kernelFunc:MR};function BR(e){const{inputs:t,backend:n}=e,{input:i}=t;return rA({inputs:{x:n.texData.get(i.dataId).complexTensorInfos.real},backend:n})}const zR={kernelName:An,backendName:"webgl",kernelFunc:BR};const VR={kernelName:He,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i,attrs:r}=t,{x:s}=n,{dtype:a}=r;if("complex64"===a){if("complex64"===s.dtype)return rA({inputs:{x:s},backend:i});const t=kl(s.shape),n=e({inputs:{x:s},backend:i,attrs:{dtype:"float32"}}),r=aA({inputs:{real:n,imag:t},backend:i});return t.dispose(),i.disposeIntermediateTensorInfo(n),r}if("complex64"===s.dtype){const t=BR({inputs:{input:s},backend:i}),n=e({inputs:{x:t},backend:i,attrs:{dtype:a}});return i.disposeIntermediateTensorInfo(t),n}if(!Q(s.dtype,a)){const e=rA({inputs:{x:s},backend:i});return{dataId:e.dataId,shape:e.shape,dtype:a}}if(i.shouldExecuteOnCPU([s])){const e=i.texData.get(s.dataId).values,[t,n,r]=WE(e,s.shape,s.dtype,a);return i.makeTensorInfo(t,n,r)}if("int32"===a)return function(e,t){const n=new jN(e.shape,"return float(int(x));"),i=t.runWebGLProgram(n,[e],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}(s,i);if("bool"===a){const e=i.makeTensorInfo([],"bool",K("bool",1)),t=MR({inputs:{a:s,b:e},backend:i});return i.disposeIntermediateTensorInfo(e),t}throw new Error("Error in Cast: failed to cast ".concat(s.dtype," to ").concat(a))}},jR="return ceil(x);",WR=gA({opSnippet:jR,packedOpSnippet:jR,cpuKernelImpl:HE}),HR={kernelName:Ge,backendName:"webgl",kernelFunc:WR};class GR{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class qR{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const XR={kernelName:qe,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{clipValueMin:s,clipValueMax:a}=i;let o;o=me().getBool("WEBGL_PACK_CLIP")?new qR(r.shape):new GR(r.shape);const l=[[s],[a]];return n.runWebGLProgram(o,[r],r.dtype,l)}};class KR{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function YR(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const QR={kernelName:Ke,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t,r=n.texData.get(i.dataId),s=new KR(i.shape),a=[YR(i,r.complexTensorInfos.real),YR(i,r.complexTensorInfos.imag)];return n.runWebGLProgram(s,a,a[0].dtype)}};class $R{constructor(e){this.outputShape=[],this.outputShape=du(e,1),this.variableNames=e.map((e,t)=>"T".concat(t));const t=new Array(e.length-1);t[0]=e[0][1];for(let s=1;s<t.length;s++)t[s]=t[s-1]+e[s][1];const n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")];for(let s=1;s<t.length;s++){const e=t[s-1];n.push("else if (yC < ".concat(t[s],") ")+"setOutput(getT".concat(s,"(yR, yC-").concat(e,"));"))}const i=t.length,r=t[t.length-1];n.push("else setOutput(getT".concat(i,"(yR, yC-").concat(r,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")}}class JR{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=du(e,t);const n=this.outputShape,i=n.length,r=pE(i),s=PN("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map((e,t)=>"T".concat(t));const o=new Array(e.length-1);o[0]=e[0][t];for(let f=1;f<o.length;f++)o[f]=o[f-1]+e[f][t];const l=a[t],c=a.slice(-2),u=a.join();let h="if (".concat(l," < ").concat(o[0],") {\n        return getChannel(\n            getT0(").concat(u,"), vec2(").concat(c.join(),"));\n        }");for(let f=1;f<o.length;f++){const e=o[f-1];h+="\n        if (".concat(l," < ").concat(o[f],"  && ").concat(l," >= ").concat(o[f-1],") {\n          return getChannel(\n            getT").concat(f,"(").concat(ZR(a,l,e),"),\n            vec2(").concat(ZR(c,l,e),"));\n        }")}const d=o.length,p=o[o.length-1];h+="\n        return getChannel(\n          getT".concat(d,"(").concat(ZR(a,l,p),"),\n          vec2(").concat(ZR(c,l,p),"));"),this.userCode="\n      float getValue(".concat(a.map(e=>"int "+e),") {\n        ").concat(h,"\n      }\n\n      void main() {\n        ").concat(r," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(s,"), 0., 0., 0.);\n\n        ").concat(s[i-1]," = ").concat(s[i-1]," + 1;\n        if (").concat(s[i-1]," < ").concat(n[i-1],") {\n          result.g = getValue(").concat(s,");\n        }\n\n        ").concat(s[i-2]," = ").concat(s[i-2]," + 1;\n        if (").concat(s[i-2]," < ").concat(n[i-2],") {\n          result.a = getValue(").concat(s,");\n        }\n\n        ").concat(s[i-1]," = ").concat(s[i-1]," - 1;\n        if (").concat(s[i-2]," < ").concat(n[i-2]," &&\n            ").concat(s[i-1]," < ").concat(n[i-1],") {\n          result.b = getValue(").concat(s,");\n        }\n        setOutput(result);\n      }\n    ")}}function ZR(e,t,n){const i=e.indexOf(t),r=e.map((e,t)=>t===i?"".concat(e," - ").concat(n):e);return r.join()}function eD(e){const{inputs:t,backend:n}=e,{input:i}=t;return rA({inputs:{x:n.texData.get(i.dataId).complexTensorInfos.imag},backend:n})}const tD={kernelName:Ut,backendName:"webgl",kernelFunc:eD};function nD(e,t,n){const i=e[0].dtype;if("complex64"===i){const i=e.map(e=>BR({inputs:{input:e},backend:n})),r=e.map(e=>eD({inputs:{input:e},backend:n})),s=nD(i,t,n),a=nD(r,t,n),o=aA({inputs:{real:s,imag:a},backend:n});return i.forEach(e=>n.disposeIntermediateTensorInfo(e)),r.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),o}let r=n.shouldExecuteOnCPU(e);if("string"===i&&(r=!0),r){const r=e.map(e=>{const i=B(e.shape.slice(t));return SA({inputs:{x:e},backend:n,attrs:{shape:[-1,i]}})}),s=r.map(e=>({vals:n.readSync(e.dataId),shape:e.shape})),a=du(r.map(e=>e.shape),1),o=1===r[0].shape[0],l=GE(s,a,i,o),c=du(e.map(e=>e.shape),t),u=n.makeTensorInfo(c,i,l);return r.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}const s=e.filter(e=>B(e.shape)>0),a=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(1===s.length){const t=a?new jN(e[0].shape,XN):new KN(e[0].shape,XN);return n.runWebGLProgram(t,e,i)}const o=me().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>o){const e=[];for(let r=0;r<s.length;r+=o){const i=s.slice(r,r+o);e.push(nD(i,t,n))}const i=nD(e,t,n);for(const t of e)n.disposeIntermediateTensorInfo(t);return i}if(a){const e=new JR(s.map(e=>e.shape),t);return n.runWebGLProgram(e,s,i)}const{tensors2D:l,outShape:c}=function(e,t,n){const i=du(e.map(e=>e.shape),t),r=e.map(e=>SA({inputs:{x:e},attrs:{shape:[-1,B(e.shape.slice(t))]},backend:n}));return{tensors2D:r,outShape:i}}(s,t,n),u=new $R(l.map(e=>e.shape)),h=n.runWebGLProgram(u,l,i);l.forEach(e=>n.disposeIntermediateTensorInfo(e));const d=SA({inputs:{x:h},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(h),d}function iD(e){const{inputs:t,backend:n,attrs:i}=e,{axis:r}=i,s=q(r,t[0].shape)[0],a=t.map(e=>e.shape);hu(a,s);const o=du(t.map(e=>e.shape),s);if(0===B(o))return n.makeTensorInfo(o,t[0].dtype,[]);const l=t.filter(e=>B(e.shape)>0);return 1===l.length?rA({inputs:{x:l[0]},backend:n}):nD(l,s,n)}const rD={kernelName:Ye,backendName:"webgl",kernelFunc:iD};class sD{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.outputShape=e.outShape;const s=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4,g="channelsLast"===e.dataFormat,m=g?1:2,y=g?2:3,b=g?3:1;let v="",_="";n&&(v=i?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):r?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),_="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(v,"\n\n      const ivec2 strides = ivec2(").concat(o,", ").concat(l,");\n      const ivec2 pads = ivec2(").concat(s,", ").concat(a,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(m,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(c,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(u,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(g,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===f,") {\n\n              if (").concat(g,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(p,") *\n                    getW(wR, wC, ").concat(p,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(p,", xR, xC) *\n                    getW(wR, wC, ").concat(p,", d2);\n              }\n\n            } else if (").concat(2===f,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2)\n              );\n\n              if (").concat(g,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===f,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2),\n                getW(wR, wC, ").concat(p," + 2, d2)\n              );\n\n              if (").concat(g,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1),\n                  getX(batch, xR, xC, ").concat(p," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC),\n                  getX(batch, ").concat(p," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(x,"\n        ").concat(_,"\n        setOutput(result);\n      }\n    ")}}class aD{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,i=e.padInfo.left,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.filterDepth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(r,", ").concat(s,", ").concat(a,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(i,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(u,"; wF++) {\n          int xF = xFCorner + wF * ").concat(o,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(l,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(c,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===f,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(p,") *\n                  getW(wF, wR, wC, ").concat(p,", d2);\n              } else if (").concat(2===f,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===f,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1),\n                  getX(batch, xF, xR, xC, ").concat(p," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2),\n                  getW(wF, wR, wC, ").concat(p," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class oD{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=_E(this.outputShape.length);const s=e.padInfo.left,a=e.strideWidth,o=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,u=c;let h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let g=0;g<c;g++)h+="\n           vec4 xTexelC".concat(2*g,";\n           int xTexelC").concat(2*g,"Ready;\n           vec4 xTexelC").concat(2*g+1,";\n           int xTexelC").concat(2*g+1,"Ready;\n           vec4 xC").concat(g,";");h+="\n     for (int r = 0; r < ".concat(l,"; r++) {\n      for (int d1 = 0; d1 < ").concat(e.inChannels,"; d1 += 2) {\n       ");for(let g=0;g<c;g++)h+="\n           xTexelC".concat(2*g," = vec4(0.0);\n           xTexelC").concat(2*g,"Ready = 0;\n           xTexelC").concat(2*g+1," = vec4(0.0);\n           xTexelC").concat(2*g+1,"Ready = 0;\n           xC").concat(g," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let g=0;g<(u+1)/2;g++){const t=2*g;if(h+="\n           xC = xCCorner + ".concat(t*o,";\n           "),1===a){if(t<c&&(s%2===1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n               "),h+=1===o&&t>0?"\n                 xC".concat(t," = vec4(xTexelC").concat(t-2,".zw, xTexelC").concat(t,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(t," = vec4(previous.zw, xTexelC").concat(t,".xy);\n                   } else {\n                     xC").concat(t," = vec4(0.0, 0.0, xTexelC").concat(t,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xC").concat(t," = xTexelC").concat(t,";\n                 "),t+1<c)){const e=s%2===0?L(o):o;o%2===0&&s%2===1||o%2!==0&&s%2!==1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(e,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                     xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(t+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(t+1,"Ready = 1;\n                   }\n                   "),h+=o>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(t+1," = vec4(previous.zw, xTexelC").concat(t+1,".xy);\n                     } else {\n                      xC").concat(t+1," = vec4(0.0, 0.0, xTexelC").concat(t+1,".xy);\n                     }\n                     "):"\n                     xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".xy);\n                     ")):h+=1===e?"\n                     xC".concat(t+1," = xTexelC").concat(t,";\n                     "):"\n                     xCOffset = xC + ".concat(e,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                       xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(t+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(t+1,"Ready = 1;\n                     }\n\n                     xC").concat(t+1," = xTexelC").concat(t+1,";\n                     ")}}else t<c&&(s%2===1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n               "),t+1<c&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(t+1," = vec4(xTexelC").concat(t+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(\n                   xTexelC").concat(t,".xy, xTexelC").concat(t+1,".xy);\n               "),t+1<c&&(h+="\n                   xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n                 "))));t<c&&(h+="\n             wTexel = getW(r, ".concat(t,", d1, d2);\n             dotProd += xC").concat(t,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(e.inChannels,") {\n               dotProd += xC").concat(t,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),t+1<c&&(h+="\n               wTexel = getW(r, ".concat(t+1,", d1, d2);\n               dotProd += xC").concat(t+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(e.inChannels,") {\n                 dotProd += xC").concat(t+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";let d="",p="";n&&(d=i?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(n,"\n         }"):r?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(n,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(n,"\n         }"),p="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(d,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(f,"\n         ").concat(p,"\n         setOutput(result);\n       }\n     ")}}class lD{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=_E(this.outputShape.length);const{dataFormat:n}=t,i=$I(),r="channelsLast"===n,s=r?1:2,a=r?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {");let l="";for(let c=0;c<=1;c++)for(let e=0;e<=1;e++)l+="\n          blockIndex = rc.z + ".concat(e,";\n          pos = rc.y + ").concat(c,";\n\n          ").concat(o,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(s,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(a,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(r,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*c+e,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*c+e,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(l,"\n\n        ").concat(i.output," = result;\n      }\n    ")}}function cD(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function uD(e){let{x:t,filter:n,convInfo:i,backend:r,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:l=null}=e;const c=t.shape,u=r.texData.get(t.dataId),h=i.inChannels,d=c[0]*c[1]*c[2],p=i.outChannels,f="channelsLast"===i.dataFormat,g=!1;let m;const y=[];if(null!=a){const e=cD(a.shape,f);null!=e&&(a=SA({inputs:{x:a},backend:r,attrs:{shape:e}}),y.push(a))}if(null!=s){const e=cD(s.shape,f);null!=e&&(s=SA({inputs:{x:s},backend:r,attrs:{shape:e}}),y.push(s))}if(!((1===d||1===p)&&h>1e3)&&u.isPacked&&f&&null!=u.texture&&c[2]%2!==0&&z(u.shape.slice(-3),c.slice(-3))){const e=c[0]*c[1]*(c[2]+1),h={dataId:t.dataId,shape:[1,e,i.inChannels],dtype:t.dtype},d=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,F(jI(u.shape,h.shape),()=>"packed reshape ".concat(u.shape," to ").concat(h.shape," isn't free"));const p=SA({inputs:{x:n},backend:r,attrs:{shape:[1,i.inChannels,i.outChannels]}});y.push(p);const f=MA({a:h,b:p,backend:r,transposeA:false,transposeB:g,bias:s,activation:l,preluActivationWeights:a,leakyreluAlpha:o}),b=r.texData.get(f.dataId);F(b.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=d,b.shape=i.outShape,m=rA({inputs:{x:f},backend:r}),m.shape=i.outShape,y.push(f)}else{const e=i.outHeight*i.outWidth,c=SA({inputs:{x:t},backend:r,attrs:{shape:f?[i.batchSize,e,i.inChannels]:[i.batchSize,i.inChannels,e]}}),u=SA({inputs:{x:n},backend:r,attrs:{shape:[1,i.inChannels,i.outChannels]}}),h=MA({a:f?c:u,b:f?u:c,transposeA:!f,transposeB:g,backend:r,bias:s,activation:l,preluActivationWeights:a,leakyreluAlpha:o});m=SA({inputs:{x:h},backend:r,attrs:{shape:i.outShape}}),y.push(c),y.push(u),y.push(h)}for(const b of y)r.disposeIntermediateTensorInfo(b);return m}function hD(e){let{x:t,filter:n,convInfo:i,backend:r,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:l=null}=e;const{filterWidth:c,filterHeight:u,inChannels:h,outWidth:d,outHeight:p,dataFormat:f}=i,g="channelsLast"===f,m=c*u*h,y=p*d,b=[i.batchSize,m,y],v=[];if(null!=a){const e=cD(a.shape,g);null!=e&&(a=SA({inputs:{x:a},backend:r,attrs:{shape:e}}),v.push(a))}if(null!=s){const e=cD(s.shape,g);null!=e&&(s=SA({inputs:{x:s},backend:r,attrs:{shape:e}}),v.push(s))}const _=SA({inputs:{x:n},backend:r,attrs:{shape:[1,m,B(n.shape)/m]}});v.push(_);const x=new lD(b,i),w=[t.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],T=r.runWebGLProgram(x,[t],"float32",w),k=SA({inputs:{x:T},backend:r,attrs:{shape:b}});v.push(T),v.push(k);const S=null!=s,C=null!=a,I="leakyrelu"===l,E=l?yA(l,!0):null,N=new bA(g?k.shape:_.shape,g?_.shape:k.shape,g?[i.batchSize,y,i.outChannels]:[i.batchSize,i.outChannels,y],!0,!1,S,E,C,I),A=g?[k,_]:[_,k];if(s&&A.push(s),C&&A.push(a),I){const e=r.makeTensorInfo([],"float32",rr(o,"float32"));A.push(e),v.push(e)}const R=r.runWebGLProgram(N,A,"float32"),D=SA({inputs:{x:R},backend:r,attrs:{shape:i.outShape}});v.push(R);for(const O of v)r.disposeIntermediateTensorInfo(O);return D}const dD={kernelName:Qe,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dataFormat:l,dilations:c,dimRoundingMode:u}=i,h=bo(l),d=oo(r.shape,s.shape,a,c,o,u,!1,h);let p;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&me().getBool("WEBGL_EXP_CONV")){const e=new oD(d),t=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(e,[r,s],"float32",t)}else if(me().getBool("WEBGL_CONV_IM2COL"))p=hD({x:r,filter:s,convInfo:d,backend:n});else{const e=new sD(d);p=n.runWebGLProgram(e,[r,s],"float32")}else p=uD({x:r,filter:s,convInfo:d,backend:n});const f=SA({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}};class pD{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,s="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(i,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(r,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              ").concat(s?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class fD{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s="channelsLast"===e.dataFormat,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=s?1:2,c=s?2:3,u=s?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(u,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(l,"], coords[").concat(c,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(s,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class gD{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,i=e.strideWidth,r=e.padInfo.front,s=e.padInfo.top,a=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(r,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(s,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(i," - ").concat(a,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class mD{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,i=e.filterWidth,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,c=i-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(o,", ").concat(l,", ").concat(c,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(r,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(s,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(i,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(i," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const yD={kernelName:$e,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:u}=i,h=bo(l),d=oo(r.shape,u,a,1,o,c,!1,h),p=new pD(d);return n.runWebGLProgram(p,[r,s],"float32")}};class bD{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=_E(this.outputShape.length);const t=e.filterHeight,n=e.filterWidth,i=t-1-e.padInfo.top,r=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(i,", ").concat(r,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(e.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(e.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}}const vD={kernelName:Je,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{inputShape:a,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=i,h=bo(c),d=oo(a,s.shape,o,1,l,u,!1,h);if(me().getBool("WEBGL_PACK")&&"channelsLast"===h){const e=[[d.strideHeight,d.strideWidth]],t=new bD(d);return n.runWebGLProgram(t,[r,s],"float32",e)}{const e=new fD(d);return n.runWebGLProgram(e,[r,s],"float32")}}};const _D={kernelName:Ze,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l}=i,c=lo(r.shape,s.shape,a,l,o),u=new aD(c);return n.runWebGLProgram(u,[r,s],"float32")}};const xD={kernelName:et,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,pad:o,filterShape:l}=i,c=lo(r.shape,l,a,1,o),u=new gD(c);return n.runWebGLProgram(u,[r,s],"float32")}};const wD={kernelName:tt,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{pad:a,strides:o,inputShape:l}=i,c=lo(l,s.shape,o,1,a),u=new mD(c);return n.runWebGLProgram(u,[r,s],"float32")}},TD=gA({opSnippet:fA+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(nA,"\n  return result;\n")}),kD={kernelName:nt,backendName:"webgl",kernelFunc:TD},SD=gA({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),CD={kernelName:it,backendName:"webgl",kernelFunc:SD};class ID{constructor(e,t,n,i,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,a,o,l]=e,[c]=t,[u,h]=n;this.outputShape=[c,u,h,l];const d="bilinear"===i?1:0,[p,f]=["".concat(a-1,".0"),"".concat(o-1,".0")],[g,m,y]=u>1?["".concat((a-1)/(u-1)),"(y2-y1) * height_ratio","y1*".concat(p," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(p)],[b,v,_]=h>1?["".concat((o-1)/(h-1)),"(x2-x1) * width_ratio","x1*".concat(f," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(f)];this.userCode="\n      const float height_ratio = float(".concat(g,");\n      const float width_ratio = float(").concat(b,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(m,";\n        float width_scale = ").concat(v,";\n\n        float in_y = ").concat(y,";\n        if( in_y < 0.0 || in_y > ").concat(p," ) {\n          setOutput(float(").concat(r,"));\n          return;\n        }\n        float in_x = ").concat(_,";\n        if( in_x < 0.0 || in_x > ").concat(f," ) {\n          setOutput(float(").concat(r,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(d," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")}}const ED={kernelName:at,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{image:r,boxes:s,boxInd:a}=t,{cropSize:o,method:l,extrapolationValue:c}=i,u=new ID(r.shape,s.shape,o,l,c);return n.runWebGLProgram(u,[r,s,a],"float32")}};var ND;!function(e){e.Prod="*",e.Sum="+"}(ND||(ND={}));class AD{constructor(e,t,n,i){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const r=this.outputShape.length,s=this.op===ND.Prod?"1.0":"0.0",a=n?s:"getX(".concat(RD(r,"coords",this.op),")"),o=this.outputShape[this.outputShape.length-1];let l="",c="";n?(l=i?"end != ".concat(o-1):"end != 0",c=i?"end + 1":"end - 1"):(l=i?"end + pow2 < ".concat(o):"end >= pow2",c=i?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(pE(r)," coords = getOutputCoords();\n        int end = ").concat(DD(r,"coords",this.op),";\n        float val = ").concat(a,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(l,") {\n          int idx = ").concat(c,";\n          ").concat(DD(r,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(RD(r,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}}function RD(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function DD(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function OD(e,t,n,i,r,s){const a=t.shape.length,o=yl([i],a);let l=t;null!=o&&(l=PA({inputs:{x:t},backend:n,attrs:{perm:o}}));const c=vl(1,a)[0];if(c!==a-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(i));const u=l.shape[c];let h=rA({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){const t=new AD(e,l.shape,!1,s),i=[[d]],r=h;h=n.runWebGLProgram(t,[h],h.dtype,i),n.disposeIntermediateTensorInfo(r)}if(r){const t=new AD(e,l.shape,r,s),i=h;h=n.runWebGLProgram(t,[h],h.dtype),n.disposeIntermediateTensorInfo(i)}if(null!=o){const e=PA({inputs:{x:h},backend:n,attrs:{perm:bl(o)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),e}return h}const LD={kernelName:rt,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,exclusive:a,reverse:o}=i;return OD(ND.Prod,r,n,s,a,o)}};const PD={kernelName:st,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,exclusive:a,reverse:o}=i;return OD(ND.Sum,r,n,s,a,o)}};const FD={kernelName:ot,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a,binaryOutput:o}=i;if(1===r.shape.length){const e=n.readSync(r.dataId),t=n.readSync(s.dataId),i=zE(e,t,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,i)}if(2===r.shape.length){const e=n.bufferSync(r),t=n.bufferSync(s),i=VE(e,t,a,o);return n.makeTensorInfo(i.shape,s.dtype,i.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(r.shape.length,"."))}};class MD{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const UD={kernelName:lt,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockSize:s,dataFormat:a}=i,o=r.shape[0],l=("NHWC"===a?r.shape[1]:r.shape[2])*s,c=("NHWC"===a?r.shape[2]:r.shape[3])*s,u=("NHWC"===a?r.shape[3]:r.shape[1])/(s*s),h=new MD("NHWC"===a?[o,l,c,u]:[o,u,l,c],s,a);return n.runWebGLProgram(h,[r],r.dtype)}};class BD{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=_E(this.outputShape.length);const s=e.filterHeight,a=e.filterWidth,o=e.outChannels/e.inChannels;let l="",c="";n&&(l=i?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):r?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),c="result = activation(result);");const u=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(l,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(s,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(a,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(u,"\n        ").concat(c,"\n        setOutput(result);\n      }\n    ")}}class zD{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=_E(this.outputShape.length);const s=e.outChannels/e.inChannels,a=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,h=u;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let m=0;m<u;m++)d+="\n          vec4 xTexelC".concat(2*m,";\n          int xTexelC").concat(2*m,"Ready;\n          vec4 xTexelC").concat(2*m+1,";\n          int xTexelC").concat(2*m+1,"Ready;\n          vec4 xC").concat(m,";");d+="\n    for (int r = 0; r < ".concat(c,"; r++) {\n      ");for(let m=0;m<u;m++)d+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let m=0;m<(h+1)/2;m++){const e=2*m;if(d+="\n          xC = xCCorner + ".concat(e*l,";\n          "),1===o){if(e<u&&(a%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n              "),d+=1===l&&e>0?"\n                xC".concat(e," = vec4(xTexelC").concat(e-2,".zw, xTexelC").concat(e,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(e," = vec4(previous.zw, xTexelC").concat(e,".xy);\n                  } else {\n                    xC").concat(e," = vec4(0.0, 0.0, xTexelC").concat(e,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xC").concat(e," = xTexelC").concat(e,";\n                "),e+1<u)){const t=a%2===0?L(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(t,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                    xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(e+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(e+1,"Ready = 1;\n                  }\n                  "),d+=l>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(e+1," = vec4(previous.zw, xTexelC").concat(e+1,".xy);\n                    } else {\n                     xC").concat(e+1," = vec4(0.0, 0.0, xTexelC").concat(e+1,".xy);\n                    }\n                    "):"\n                    xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".xy);\n                    ")):d+=1===t?"\n                    xC".concat(e+1," = xTexelC").concat(e,";\n                    "):"\n                    xCOffset = xC + ".concat(t,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                      xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(e+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(e+1,"Ready = 1;\n                    }\n\n                    xC").concat(e+1," = xTexelC").concat(e+1,";\n                    ")}}else e<u&&(a%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n              "),e+1<u&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(e+1," = vec4(xTexelC").concat(e+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(\n                  xTexelC").concat(e,".xy, xTexelC").concat(e+1,".xy);\n              "),e+1<u&&(d+="\n                  xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n                "))));e<u&&(d+="\n            wTexel = getW(r, ".concat(e,", d1, q);\n            dotProd += xC").concat(e," * vec4(wTexel.xz, wTexel.xz);\n          "),e+1<u&&(d+="\n              wTexel = getW(r, ".concat(e+1,", d1, q);\n              dotProd += xC").concat(e+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";let p="",f="";n&&(p=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):r?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),f="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(p,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(s,";\n        int q = d2 - d1 * ").concat(s,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(g,"\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")}}const VD={kernelName:ct,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l,dimRoundingMode:c}=i;let u=l;null==u&&(u=[1,1]),F(mo(a,u),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(a," and dilations '").concat(u,"'"));const h=oo(r.shape,s.shape,a,u,o,c,!0);let d;d=me().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new zD(h):new BD(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[r,s],"float32",p)}};class jD{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(s," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(i,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(r,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class WD{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s=t-1-e.padInfo.top,a=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(a,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(o,"; dm++) {\n              int d2 = d1 * ").concat(o," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const HD={kernelName:ut,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:c,filterShape:u}=i,h=oo(r.shape,u,a,o,l,c,!0),d=new jD(h);return n.runWebGLProgram(d,[r,s],"float32")}};const GD={kernelName:ht,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:c,inputShape:u}=i,h=oo(u,s.shape,a,o,l,c,!0),d=new WD(h);return n.runWebGLProgram(d,[r,s],"float32")}};class qD{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const XD={kernelName:dt,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t,r=[...i.shape,...i.shape],s=B(i.shape),a=SA({inputs:{x:i},backend:n,attrs:{shape:[s]}}),o=new qD(s),l=n.runWebGLProgram(o,[a],a.dtype),c=SA({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}};class KD{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:i,strideHeight:r,strideWidth:s,filterHeight:a,filterWidth:o,dilationHeight:l,dilationWidth:c}=e,{top:u,left:h}=i;this.userCode="\n      const ivec2 strides = ivec2(".concat(r,", ").concat(s,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(a,"; h++) {\n          int hIn = hBeg + h * ").concat(l,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(o,"; w++) {\n              int wIn = wBeg + w * ").concat(c,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}}const YD={kernelName:pt,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l}=i,c=ro(r.shape,s.shape,a,o,"NHWC",l);let u;const h=new KD(c);u=n.runWebGLProgram(h,[r,s],"float32");const d=SA({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),d}};const QD={kernelName:bt,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{equation:r}=i,s=t,{allDims:a,summedDims:o,idDims:l}=Qu(r,s.length);Ju(a.length,l,s);const{path:c,steps:u}=Zu(o,l),h=u.length;let d=null,p=a.length;const f=[];for(let g=0;g<h;++g){for(const e of u[g]){const{permutationIndices:t,expandDims:i}=$u(p,l[e]);let r;eh(t)?r=s[e]:(r=PA({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),f.push(r));const a=r.shape.slice();for(let e=0;e<i.length;++e)a.splice(i[e],0,1);z(r.shape,a)||(r=SA({inputs:{x:r},backend:n,attrs:{shape:a}}),f.push(r)),null===d?d=r:(d=TA({inputs:{a:r,b:d},backend:n}),f.push(d))}g<h-1&&(c[g]>=0&&(d=OA({inputs:{x:d},backend:n,attrs:{axis:c[g]-(a.length-p),keepDims:!1}}),f.push(d)),p--)}for(const g of f)g!==d&&n.disposeIntermediateTensorInfo(g);return d}},$D=gA({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),JD={kernelName:vt,backendName:"webgl",kernelFunc:$D},ZD={kernelName:_t,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:i,y:r}=t,s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new iA("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",i.shape,r.shape):new tA("return (b >= 0.0) ? a : a * (b + 1.0);",i.shape,r.shape);return n.runWebGLProgram(s,[i,r],i.dtype)}},eO=mA({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:qE}),tO={kernelName:wt,backendName:"webgl",kernelFunc:eO},nO=gA({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(Du,";\n  float a1 = ").concat(Ou,";\n  float a2 = ").concat(Lu,";\n  float a3 = ").concat(Pu,";\n  float a4 = ").concat(Fu,";\n  float a5 = ").concat(Mu,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),iO={kernelName:xt,backendName:"webgl",kernelFunc:nO},rO=gA({opSnippet:fA+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:XE,dtype:"float32"}),sO={kernelName:Tt,backendName:"webgl",kernelFunc:rO};function aO(e){const{inputs:t,attrs:n,backend:i}=e,{dim:r}=n,{input:s}=t,a=s.shape.length,o=s.shape.slice();let l=r;return r<0&&(F(-(a+1)<=r,()=>"Axis must be in the interval [".concat(-(a+1),", ").concat(a,"]")),l=a+r+1),o.splice(l,0,1),SA({inputs:{x:s},backend:i,attrs:{shape:o}})}const oO={kernelName:kt,backendName:"webgl",kernelFunc:aO},lO="return exp(x) - 1.0;",cO=gA({opSnippet:lO,packedOpSnippet:lO,cpuKernelImpl:KE}),uO={kernelName:St,backendName:"webgl",kernelFunc:cO};class hO{constructor(e,t,n){this.variableNames=["real","imag"];const i=t[1];this.outputShape=t;const r=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=n?"".concat(i,".0"):"1.0";let a;if("real"===e)a="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));a="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(r,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(a,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(i,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(i,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}}function dO(e,t,n){const i=n.texData.get(e.dataId),r=B(e.shape),s=e.shape[e.shape.length-1],a=SA({inputs:{x:e},backend:n,attrs:{shape:[r/s,s]}}),o=a.shape,l=new hO("real",o,t),c=new hO("imag",o,t),u=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:o},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:o}],h=n.runWebGLProgram(l,u,"float32"),d=n.runWebGLProgram(c,u,"float32"),p=aA({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const f=SA({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),f}const pO={kernelName:Ct,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t;return dO(i,!1,n)}};class fO{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function gO(e){const{backend:t,attrs:n}=e,{shape:i,value:r}=n;let{dtype:s}=n;if(s=s||ee(r),"string"===s){const e=Y(s,B(i));return e.fill(r),t.makeTensorInfo(i,s,e)}{const e=new fO(i,r),n=[[r]];return t.runWebGLProgram(e,[],s,n)}}const mO={kernelName:It,backendName:"webgl",kernelFunc:gO};class yO{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const bO={kernelName:Et,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{image:i}=t,r=n,s=new yO(i.shape);return r.runWebGLProgram(s,[i],i.dtype)}},vO="return floor(x);",_O=gA({opSnippet:vO,packedOpSnippet:vO,cpuKernelImpl:YE}),xO={kernelName:Nt,backendName:"webgl",kernelFunc:_O},wO=mA({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),TO={kernelName:At,backendName:"webgl",kernelFunc:wO};class kO{constructor(e){this.variableNames=["A"];const t=$I(),[n,i]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")}}class SO{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=$I(),[n,i]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}const CO={kernelName:Ei,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e;let{pixels:r}=t;const{numChannels:s}=i,a="undefined"!==typeof HTMLVideoElement&&r instanceof HTMLVideoElement,o="undefined"!==typeof HTMLImageElement&&r instanceof HTMLImageElement,[l,c]=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[c,l],h=[c,l,s];if(o||a){const e=me().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=IO&&e===EO||(EO=e,IO=document.createElement("canvas").getContext("2d",{willReadFrequently:EO})),IO.canvas.width=l,IO.canvas.height=c,IO.drawImage(r,0,0,l,c),r=IO.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=vI.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),r);const p=me().getBool("WEBGL_PACK")?new SO(h):new kO(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}};let IO,EO=me().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const NO={kernelName:Ri,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i,g=bo(u),m=oo(r.shape,s.shape,l,h,c,d,!1,g);let y;const b=[],v=null!=a,_=null!=o,x="leakyrelu"===p,w=()=>{const e=[r,s],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=SA({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return b.push(t),t}return e};if(v&&e.push(t(a,u)),_&&e.push(t(o,u)),x){const t=n.makeTensorInfo([],"float32",rr(f,"float32"));e.push(t),b.push(t)}return e};if(1!==m.filterHeight||1!==m.filterWidth||1!==m.dilationHeight||1!==m.dilationWidth||1!==m.strideHeight||1!==m.strideWidth||"SAME"!==m.padInfo.type&&"VALID"!==m.padInfo.type)if(m.strideWidth<=2&&"channelsLast"===g&&me().getBool("WEBGL_EXP_CONV")){const e=p?yA(p,!0):null,t=new oD(m,v,e,_,x),i=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],r=w();y=n.runWebGLProgram(t,r,"float32",i)}else if(me().getBool("WEBGL_CONV_IM2COL"))y=hD({x:r,filter:s,convInfo:m,backend:n,bias:a,activation:p,preluActivationWeights:o,leakyreluAlpha:f});else{const e=p?yA(p,!1):null,t=new sD(m,v,e,_,x),i=w();y=n.runWebGLProgram(t,i,"float32")}else y=uD({x:r,filter:s,convInfo:m,backend:n,bias:a,activation:p,preluActivationWeights:o,leakyreluAlpha:f});const T=SA({inputs:{x:y},backend:n,attrs:{shape:m.outShape}});return b.push(y),b.forEach(e=>n.disposeIntermediateTensorInfo(e)),T}};const AO={kernelName:Di,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:c,dilations:u,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=i,f=[];let g=u;null==g&&(g=[1,1]),F(mo(l,g),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(l," and dilations '").concat(g,"'"));const m=oo(r.shape,s.shape,l,g,c,h,!0),y=me().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,b=d?yA(d,y):null,v=[r,s],_=null!=a,x=null!=o,w="leakyrelu"===d;if(_&&v.push(a),x&&v.push(o),w){const e=n.makeTensorInfo([],"float32",rr(p,"float32"));v.push(e),f.push(e)}let T;T=y?new zD(m,_,b,x,w):new BD(m,_,b,x,w);const k=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],S=n.runWebGLProgram(T,v,"float32",k);return f.forEach(e=>n.disposeIntermediateTensorInfo(e)),S}};class RO{constructor(e,t,n,i){this.sliceDim=e,this.strides=t,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=n;const r=pE(n.length);let s="\n    int index;";for(let a=0;a<this.sliceDim;a++)s+="\n          index = round(getIndices(coords[0], ".concat(a,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[a],";\n          flattenIndex += index * ").concat(this.strides[a],";");this.userCode="\n         void main() {\n          ".concat(r," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(s,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}}const DO={kernelName:Ot,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:i,indices:r}=t,s=r.shape,a=s[s.length-1],o=B(i.shape),[l,c,u,h]=Cu(i,r),d=SA({inputs:{x:r},backend:n,attrs:{shape:[c,a]}}),p=SA({inputs:{x:i},backend:n,attrs:{shape:[B(i.shape)/u,u]}});if(n.shouldExecuteOnCPU([i,r])||"string"===i.dtype){const e=n.readSync(r.dataId),t=n.bufferSync(i),s=QE(e,t,i.dtype,c,a,u,h,i.shape,o);return n.makeTensorInfo(l,i.dtype,s.values)}const f=new RO(a,h,[c,u],i.shape),g=n.runWebGLProgram(f,[p,d],p.dtype),m=SA({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}};class OO{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=pE(this.rank),i=function(e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let i=0;i<e.length;i++)2===i?n.push("index"):n.push("".concat(t[i]));return n.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(e[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(i,"));\n      }\n    ")}}function LO(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,indices:s}=t,{axis:a,batchDims:o}=i,l=q(a,r.shape)[0];if(me().get("DEBUG")){const e=n.readSync(s.dataId),t=r.shape[l];for(let n=0;n<e.length;++n){const i=e[n];F(i<=t-1&&i>=0,()=>"GatherV2: the index value ".concat(i," is not in [0, ").concat(t-1,"]"))}}const c=yh(r,s,l,o),u=B(s.shape),h=[],d=SA({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=SA({inputs:{x:s},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});h.push(d),h.push(p);const f=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([r,s])||"string"===r.dtype){const e=n.bufferSync(p),t=n.bufferSync(d),i=$E(t,e,f);return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(c.outputShape,i.dtype,i.values)}const g=new OO(d.shape,f),m=n.runWebGLProgram(g,[d,p],d.dtype);h.push(m);const y=SA({inputs:{x:m},backend:n,attrs:{shape:c.outputShape}});return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),y}const PO={kernelName:Dt,backendName:"webgl",kernelFunc:LO},FO=mA({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:JE,dtype:"bool"}),MO={kernelName:Lt,backendName:"webgl",kernelFunc:FO},UO=mA({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:ZE}),BO={kernelName:Pt,backendName:"webgl",kernelFunc:UO};const zO={kernelName:Mt,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t;return dO(i,!0,n)}},VO=gA({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),jO={kernelName:Bt,backendName:"webgl",kernelFunc:VO},WO=gA({opSnippet:"return float(isinf(x));",dtype:"bool"}),HO={kernelName:zt,backendName:"webgl",kernelFunc:WO},GO=gA({opSnippet:"return float(isnan(x));",dtype:"bool"}),qO={kernelName:Vt,backendName:"webgl",kernelFunc:GO},XO=mA({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:eN,dtype:"bool"}),KO={kernelName:Wt,backendName:"webgl",kernelFunc:XO},YO=mA({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:tN,dtype:"bool"}),QO={kernelName:Ht,backendName:"webgl",kernelFunc:YO};const $O={kernelName:Gt,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:i,stop:r,num:s}=n,a=nN(i,r,s);return t.makeTensorInfo([a.length],"float32",a)}},JO=gA({opSnippet:fA+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:iN}),ZO={kernelName:qt,backendName:"webgl",kernelFunc:JO},eL=gA({opSnippet:fA+"\n  return log(1.0 + x);\n"}),tL={kernelName:Xt,backendName:"webgl",kernelFunc:eL},nL=mA({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),iL={kernelName:Kt,backendName:"webgl",kernelFunc:nL},rL=gA({opSnippet:"return float(!(x >= 1.0));"}),sL={kernelName:Yt,backendName:"webgl",kernelFunc:rL},aL=mA({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),oL={kernelName:Qt,backendName:"webgl",kernelFunc:aL};class lL{constructor(e,t,n,i,r){this.variableNames=["x"],this.outputShape=[];const s=t,a=e[3]-1;let o;this.outputShape=e;const l="float(".concat(n,") + float(").concat(i,") * sum");o=.5===r?"inversesqrt(".concat(l,")"):1===r?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(r,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(a,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")}}class cL{constructor(e,t,n,i,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=t,a=e[3]-1;let o;this.outputShape=e;const l="float(".concat(n,") + float(").concat(i,") * sum");o=.5===r?"inversesqrt(".concat(l,")"):1===r?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(r,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(a,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")}}const uL={kernelName:$t,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{depthRadius:s,bias:a,alpha:o,beta:l}=i,c=me().getBool("WEBGL_PACK_NORMALIZATION")?new cL(r.shape,s,a,o,l):new lL(r.shape,s,a,o,l);return n.runWebGLProgram(c,[r],r.dtype)}};class hL{constructor(e,t,n,i,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=i,this.beta=r,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(i,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(i,")\n                * float(").concat(r,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(r,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")}}const dL={kernelName:Jt,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r,y:s,dy:a}=t,{depthRadius:o,bias:l,alpha:c,beta:u}=i,h=new hL(r.shape,o,l,c,u);return n.runWebGLProgram(h,[r,s,a],r.dtype)}};function pL(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{reductionIndices:s,keepDims:a}=i,o=r.shape.length,l=q(s,r.shape);let c=l;const u=yl(c,o),h=null!=u,d=n.shouldExecuteOnCPU([r]);let p=r;if(h){if(d){const e=n.texData.get(p.dataId).values,t=new Array(o);for(let n=0;n<t.length;n++)t[n]=r.shape[u[n]];const i=DN(e,r.shape,r.dtype,u,t);p=n.makeTensorInfo(t,r.dtype);n.texData.get(p.dataId).values=i}else p=DA(r,u,n);c=vl(c.length,o)}ml("max",c,o);const[f,g]=fl(p.shape,c);let m,y=f;if(a&&(y=gl(f,l)),d){const e=n.texData.get(p.dataId).values,t=rN(e,B(g),y,r.dtype);m=n.makeTensorInfo(y,r.dtype);n.texData.get(m.dataId).values=t}else m=function(e,t,n,i){const r=B(t),s=SA({inputs:{x:e},attrs:{shape:[B(e.shape)/r,r]},backend:i}),a=NA(s,e.dtype,"max",i),o=SA({inputs:{x:a},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}(p,g,y,n);return h&&n.disposeIntermediateTensorInfo(p),m}const fL={kernelName:Zt,backendName:"webgl",kernelFunc:pL},gL=mA({opSnippet:eA+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+nA+"\n  return result;\n",cpuKernelImpl:sN}),mL={kernelName:en,backendName:"webgl",kernelFunc:gL};const yL={kernelName:tn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;YI(r,"maxPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=i;F(mo(a,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(1,"'"));const c=so(r.shape,s,a,1,o,l);if(1===c.filterWidth&&1===c.filterHeight&&z(c.inShape,c.outShape))return rA({inputs:{x:r},backend:n});const u=new mR(c,"max",!1);return n.runWebGLProgram(u,[r],r.dtype)}};const bL={kernelName:rn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{filterSize:s,strides:a,pad:o,dataFormat:l,dimRoundingMode:c}=i,u=ao(r.shape,s,a,[1,1,1],o,c,l),h=new yR(u,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}};class vL{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,i=e.dilationHeight,r=e.effectiveFilterHeight,s=e.effectiveFilterWidth,a=r-1-e.padInfo.top,o=s-1-e.padInfo.left,l=r*s-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(r,";\n          wR += ").concat(i,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(l," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(s," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class _L{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,i=e.strideWidth,r=e.dilationDepth,s=e.dilationHeight,a=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=o-1-e.padInfo.front,h=l-1-e.padInfo.top,d=c-1-e.padInfo.left,p=o*l*c-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(h,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(o,";\n           wD += ").concat(r,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(l,";\n              wR += ").concat(s,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(c,";\n                wC += ").concat(a,") {\n              float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(p," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(l," * ").concat(c," +\n                  wR * ").concat(c," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const xL={kernelName:sn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,a=s,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=i,h=ao(a.shape,o,l,[1,1,1],c,u),d=new yR(h,"max",!0),p=n.runWebGLProgram(d,[a],a.dtype),f=new _L(h),g=n.runWebGLProgram(f,[r,p],a.dtype);return n.disposeIntermediateTensorInfo(p),g}};const wL={kernelName:nn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s,output:a}=t,o=s;YI([s,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=i,d=so(o.shape,l,c,1,u,h),p=new mR(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),g=new vL(d),m=n.runWebGLProgram(g,[r,f],o.dtype);return n.disposeIntermediateTensorInfo(f),m}};const TL={kernelName:an,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:i}=e;const{x:r}=t,{filterSize:s,strides:a,pad:o,includeBatchInIndex:l}=n,c=i;F(4===r.shape.length,()=>"Error in maxPool: input must be rank 4 but got rank ".concat(r.shape.length,"."));const u=[1,1];F(mo(a,u),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(u,"'"));const h=so(r.shape,s,a,u,o),[d,p]=function(e,t,n,i){let r=new mR(n,"max",!1);const s=i.runWebGLProgram(r,[e],"float32");return r=new mR(n,"max",!0,!0,t),[s,i.runWebGLProgram(r,[e],"float32")]}(r,l,h,c);return[d,p]}};const kL={kernelName:on,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:i}=e;const{x:r}=t,{keepDims:s,axis:a}=n,o=i,l=r.shape.length,c=q(a,r.shape);let u=c;const h=yl(u,l),d=null!=h,p=o.shouldExecuteOnCPU([r]),f=[];let g=r;if(d){if(p){const e=o.texData.get(g.dataId).values,t=new Array(l);for(let i=0;i<t.length;i++)t[i]=r.shape[h[i]];const n=DN(e,r.shape,r.dtype,h,t);g=o.makeTensorInfo(t,r.dtype);o.texData.get(g.dataId).values=n}else g=DA(r,h,o);f.push(g),u=vl(u.length,l)}ml("sum",u,l);const[m,y]=fl(g.shape,u);let b=m;s&&(b=gl(m,c));const v=function(e,t,n,i){const r=B(t),s=SA({inputs:{x:e},attrs:{shape:[B(e.shape)/r,r]},backend:i}),a=NA(s,"float32","mean",i),o=SA({inputs:{x:a},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}(g,y,b,o);for(const _ of f)o.disposeIntermediateTensorInfo(_);return v}};const SL={kernelName:ln,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=r.shape.length,l=q(s,r.shape);let c=l;const u=yl(c,o);let h=r;null!=u&&(h=PA({inputs:{x:r},backend:n,attrs:{perm:u}}),c=vl(c.length,r.shape.length)),ml("min",c,o);const[d,p]=fl(h.shape,c),f=SA({inputs:{x:h},backend:n,attrs:{shape:[-1,B(p)]}}),g=NA(f,f.dtype,"min",n);let m;if(a){m=SA({inputs:{x:g},backend:n,attrs:{shape:gl(d,l)}})}else m=SA({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),m}},CL=mA({opSnippet:eA+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+nA+"\n  return result;\n",cpuKernelImpl:aN}),IL={kernelName:cn,backendName:"webgl",kernelFunc:CL};class EL{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const i=e.length,r=pE(i),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),l="reflect"===n?0:1;this.userCode=1!==i?"\n      ".concat(r," start = ").concat(r,"(").concat(s,");\n      ").concat(r," end = ").concat(r,"(").concat(a,");\n\n      void main() {\n        ").concat(r," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(i,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(l,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(l,";\n          }\n        }\n        ").concat(r," coords = outC - start;\n        setOutput(getX(").concat(o,"));\n      }\n    "):"\n        int start = ".concat(s,";\n        int end = ").concat(a,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(l,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(l,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")}}class NL{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const i=e.length,r=pE(i),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=PN("rc",i),l=PN("source",i),c="".concat(o[i-1]," < ").concat(this.outputShape[i-1]),u=1===i?"source":"vec2(".concat(l.slice(-2).join(),")"),h="reflect"===n?0:1;let d="";if(1===i){const e="\n        ".concat(r," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");d="\n        ".concat(r," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        ").concat(o[i-1]," += 1;\n        if(").concat(c,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n      ")}else{const e="\n        ".concat(r," source = rc;\n        ").concat(r," lt = ").concat(r,"(lessThan(source, start));\n        ").concat(r," gte = ").concat(r,"(greaterThanEqual(source, end));\n        ").concat(r," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");d="\n        ".concat(r," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        ").concat(o[i-1]," += 1;\n        if(").concat(c,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n        rc = outputLoc;\n        ").concat(o[i-2]," += 1;\n        if(").concat(o[i-2]," < ").concat(this.outputShape[i-2],") {\n          ").concat(e,"\n          result[2] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n          ").concat(o[i-1]," += 1;\n          if(").concat(c,") {\n            ").concat(e,"\n            result[3] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(r," start = ").concat(r,"(").concat(s,");\n      const ").concat(r," end = ").concat(r,"(").concat(a,");\n\n      void main() {\n        ").concat(r," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")}}const AL={kernelName:un,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:i}=e;const{x:r}=t,{paddings:s,mode:a}=i,o=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new NL(r.shape,s,a):new EL(r.shape,s,a);return n.runWebGLProgram(o,[r],r.dtype)}},RL=mA({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+nA+"\n  return result;\n"}),DL={kernelName:hn,backendName:"webgl",kernelFunc:RL};class OL{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}}const LL=mA({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),PL={kernelName:yt,backendName:"webgl",kernelFunc:LL},FL="return a - b;",ML=mA({opSnippet:FL,packedOpSnippet:FL,supportsComplex:!0,cpuKernelImpl:NN}),UL={kernelName:mi,backendName:"webgl",kernelFunc:ML};function BL(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{dim:s}=i,a=q([s],r.shape),o=pL({inputs:{x:r},backend:n,attrs:{reductionIndices:a,keepDims:!1}}),l=gl(o.shape,a),c=SA({inputs:{x:o},backend:n,attrs:{shape:l}}),u=ML({inputs:{a:r,b:c},backend:n}),h=rO({inputs:{x:u},backend:n}),d=OA({inputs:{x:h},backend:n,attrs:{axis:a,keepDims:!1}}),p=SA({inputs:{x:d},backend:n,attrs:{shape:l}}),f=LL({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const zL={kernelName:ii,backendName:"webgl",kernelFunc:BL};const VL={kernelName:dn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{numSamples:s,seed:a,normalized:o}=i,l=o?r:BL({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),c=l.shape[0],u=l.shape[1],h=new OL(c,u,s),d=[[a]],p=n.runWebGLProgram(h,[l],"int32",d);return o||n.disposeIntermediateTensorInfo(l),p}},jL=WN+"\n  return -x;\n";const WL={kernelName:fn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t;if(n.shouldExecuteOnCPU([i])){const e=n.texData.get(i.dataId),[t,r]=lN(e.values,i.shape,i.dtype);return n.makeTensorInfo(r,i.dtype,t)}let r;return r=me().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new KN(i.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new jN(i.shape,jL),n.runWebGLProgram(r,[i],i.dtype)}},HL=Rc;const GL={kernelName:mn,backendName:"webgl",kernelFunc:function(e){Oi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=i,c=n.readSync(r.dataId),u=n.readSync(s.dataId),{selectedIndices:h}=HL(c,u,a,o,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},qL=Dc;const XL={kernelName:yn,backendName:"webgl",kernelFunc:function(e){Oi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=i,u=n.readSync(r.dataId),h=n.readSync(s.dataId),{selectedIndices:d,validOutputs:p}=qL(u,h,a,o,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},KL=Oc;const YL={kernelName:bn,backendName:"webgl",kernelFunc:function(e){Oi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=i,u=n.readSync(r.dataId),h=n.readSync(s.dataId),d=a,p=o,f=l,g=c,{selectedIndices:m,selectedScores:y}=KL(u,h,d,p,f,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};class QL{constructor(e,t,n,i){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(i,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")}}const $L={kernelName:_n,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{indices:r}=t,{dtype:s,depth:a,onValue:o,offValue:l}=i,c=B(r.shape),u=new QL(c,a,o,l),h=SA({inputs:{x:r},backend:n,attrs:{shape:[c]}}),d=n.runWebGLProgram(u,[h],s);n.disposeIntermediateTensorInfo(h);const p=SA({inputs:{x:d},backend:n,attrs:{shape:[...r.shape,a]}});return n.disposeIntermediateTensorInfo(d),p}};function JL(e){const{inputs:t,backend:n}=e,{x:i}=t;if("complex64"===i.dtype){const e=BR({inputs:{input:i},backend:n}),t=JL({inputs:{x:e},backend:n}),r=eD({inputs:{input:i},backend:n}),s=JL({inputs:{x:r},backend:n}),a=aA({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),a}return gO({attrs:{shape:i.shape,dtype:i.dtype,value:"string"===i.dtype?"":0},backend:n})}const ZL={kernelName:Ci,backendName:"webgl",kernelFunc:JL};const eP={kernelName:vn,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i}=t,{x:r}=n;if("string"===r.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===r.dtype){const t=BR({inputs:{input:r},backend:i}),n=e({inputs:{x:t},backend:i}),s=eD({inputs:{input:r},backend:i}),a=JL({inputs:{x:s},backend:i}),o=aA({inputs:{real:n,imag:a},backend:i});return i.disposeIntermediateTensorInfo(t),i.disposeIntermediateTensorInfo(n),i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}return gO({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:i})}};const tP={kernelName:xn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{axis:r}=i;if(1===t.length)return aO({inputs:{input:t[0]},backend:n,attrs:{dim:r}});const s=t[0].shape,a=t[0].dtype;t.forEach(e=>{M(s,e.shape,"All tensors passed to stack must have matching shapes"),F(a===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=t.map(e=>{const t=aO({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t}),c=iD({inputs:l,backend:n,attrs:{axis:r}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),c}};class nP{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const i=e.length,r=pE(i),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);this.userCode=1!==i?"\n      ".concat(r," start = ").concat(r,"(").concat(s,");\n      ").concat(r," end = ").concat(r,"(").concat(a,");\n\n      void main() {\n        ").concat(r," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(r," coords = outC - start;\n          setOutput(getX(").concat(o,"));\n        }\n      }\n    "):"\n        int start = ".concat(s,";\n        int end = ").concat(a,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}}class iP{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const i=e.length,r=pE(i),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=PN("rc",i),l=PN("source",i),c="".concat(o[i-1]," < ").concat(this.outputShape[i-1]),u=1===i?"source":"vec2(".concat(l.slice(-2).join(),")"),h=["".concat(r," rc = outputLoc;"),"".concat(o[i-1]," += 1;\n       if(").concat(c,") {\n      "),1===i?"":"}\n       rc = outputLoc;\n       ".concat(o[i-2]," += 1;\n       if(").concat(o[i-2]," < ").concat(this.outputShape[i-2],") {"),1===i?"":"  ".concat(o[i-1]," += 1;\n         if(").concat(c,") {")],d=1===i?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let f=0,g=1===i?2:4;f<g;f++)p+="\n        ".concat(h[f],"\n        if (").concat(d,") {\n          result[").concat(f,"] = float(value);\n        } else {\n          ").concat(r," source = rc - start;\n          result[").concat(f,"] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n      ");p+=1===i?"} ":"}}",this.userCode="\n      const ".concat(r," start = ").concat(r,"(").concat(s,");\n      const ").concat(r," end = ").concat(r,"(").concat(a,");\n\n      void main() {\n        ").concat(r," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")}}const rP=e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{paddings:s,constantValue:a}=i;if(0===B(r.shape)){const e=s.map((e,t)=>e[0]+r.shape[t]+e[1]);return gO({backend:n,attrs:{shape:e,value:a,dtype:r.dtype}})}const o=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iP(r.shape,s,a):new nP(r.shape,s,a),l=[[a]];return n.runWebGLProgram(o,[r],r.dtype,l)},sP={kernelName:wn,backendName:"webgl",kernelFunc:rP},aP=mA({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+nA+"\n  return result;\n"}),oP={kernelName:Tn,backendName:"webgl",kernelFunc:aP};const lP={kernelName:Sn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=r.shape.length,l=[],c=q(s,r.shape);let u=c;const h=yl(u,o);let d,p=r;if(null!=h&&(p=PA({inputs:{x:r},backend:n,attrs:{perm:h}}),u=vl(u.length,o),l.push(p)),ml("prod",u,o),n.shouldExecuteOnCPU([p])){const e=n.texData.get(p.dataId).values,{outVals:t,outShape:i,outDtype:r}=uN(p.shape,p.dtype,e,u);d=n.makeTensorInfo(i,r,t)}else{const[e,t]=fl(p.shape,u),i=B(t),s=SA({inputs:{x:p},backend:n,attrs:{shape:[-1,i]}}),a=NA(s,Or(r.dtype),"prod",n);d=SA({inputs:{x:a},backend:n,attrs:{shape:e}}),l.push(s),l.push(a)}if(a){l.push(d);const e=gl(d.shape,c);d=SA({inputs:{x:d},backend:n,attrs:{shape:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),d}};const cP={kernelName:Cn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{paramsNestedSplits:r,paramsDenseValues:s,indices:a}=t,{outputRaggedRank:o}=i,l=r.map(e=>n.readSync(e.dataId)),c=r.map(e=>e.shape),u=n.readSync(s.dataId),h=n.readSync(a.dataId),[d,p,f]=hN(l,c,u,s.shape,s.dtype,h,a.shape,o),g=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),m=n.makeTensorInfo(f,s.dtype,p);return g.concat([m])}};const uP={kernelName:In,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:i,limits:r,deltas:s}=t,a=n.readSync(i.dataId),o=n.readSync(r.dataId),l=n.readSync(s.dataId),[c,u]=dN(a,i.shape,i.dtype,o,r.shape,l,s.shape);return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([u.length],i.dtype,u)]}};const hP={kernelName:En,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{shape:r,values:s,defaultValue:a,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=i,c=n.readSync(r.dataId),u=n.readSync(s.dataId),h=n.readSync(a.dataId),d=o.map(e=>n.readSync(e.dataId)),p=o.map(e=>e.shape),[f,g]=pN(c,r.shape,u,s.shape,s.dtype,h,a.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,g)}},dP=e=>{const{backend:t,attrs:n}=e,{start:i,stop:r,step:s,dtype:a}=n,o=fN(i,r,s,a);return t.makeTensorInfo([o.length],a,o)},pP={kernelName:Nn,backendName:"webgl",kernelFunc:dP},fP=gA({opSnippet:"return 1.0 / x;"}),gP={kernelName:Rn,backendName:"webgl",kernelFunc:fP},mP=gA({opSnippet:WN+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),yP={kernelName:Dn,backendName:"webgl",kernelFunc:mP},bP=gA({opSnippet:WN+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),vP={kernelName:Un,backendName:"webgl",kernelFunc:bP};class _P{constructor(e,t,n,i,r){this.variableNames=["A"],this.outputShape=[];const[s,a,o,l]=e;this.outputShape=[s,t,n,l];const c=[i&&t>1?a-1:a,i&&n>1?o-1:o],u=[i&&t>1?t-1:t,i&&n>1?n-1:n];let h;h=r?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(a,".0, ").concat(o,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")}}class xP{constructor(e,t,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,o,l]=e;this.outputShape=[s,t,n,l];const c=[i&&t>1?a-1:a,i&&n>1?o-1:o],u=[i&&t>1?t-1:t,i&&n>1?n-1:n];let h;h=r?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],",\n          ").concat(c[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(a,".0, ").concat(o,".0,\n                                     ").concat(o,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}}const wP={kernelName:Fn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r}=t,{alignCorners:s,halfPixelCenters:a,size:o}=i,[l,c]=o,u=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new xP(r.shape,l,c,s,a):new _P(r.shape,l,c,s,a);return n.runWebGLProgram(u,[r],"float32")}};class TP{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,i,r]=t,[,s,a]=e,o=[n&&s>1?i-1:i,n&&a>1?r-1:r],l=[n&&s>1?s-1:s,n&&a>1?a-1:a],c=o[0]/l[0],u=o[1]/l[1],h=1/c,d=1/u,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(c,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(p,");\n        const int winWidth = int(").concat(f,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(s,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(a,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(r-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const kP={kernelName:Mn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i,o=new TP(s.shape,r.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};class SP{constructor(e,t,n,i,r){this.variableNames=["A"],this.outputShape=[];const[s,a,o,l]=e;this.outputShape=[s,t,n,l];const c=[i&&t>1?a-1:a,i&&n>1?o-1:o],u=[i&&t>1?t-1:t,i&&n>1?n-1:n],h=i?"0.5":"0.0";let d;d=r?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(a,".0, ").concat(o,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}}class CP{constructor(e,t,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,o,l]=e;this.outputShape=[s,t,n,l];const c=[i&&t>1?a-1:a,i&&n>1?o-1:o],u=[i&&t>1?t-1:t,i&&n>1?n-1:n],h=i?"0.5":"0.0";let d;d=r?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],",\n          ").concat(c[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(a,".0, ").concat(o,".0,\n                                     ").concat(o,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}}const IP={kernelName:Ln,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r}=t,{alignCorners:s,halfPixelCenters:a,size:o}=i,[l,c]=o,u=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new CP(r.shape,l,c,s,a):new SP(r.shape,l,c,s,a);return n.runWebGLProgram(u,[r],r.dtype)}};class EP{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,i,r]=t,[,s,a]=e,o=[n&&s>1?i-1:i,n&&a>1?r-1:r],l=[n&&s>1?s-1:s,n&&a>1?a-1:a],c=o[0]/l[0],u=o[1]/l[1],h=1/c,d=1/u,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(c,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(p,");\n        const int winWidth = int(").concat(f,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(s,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(a,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(o[0],") *\n                (float(dyR) / float(").concat(l[0],"));\n\n            float sourceFracCol =\n                float(").concat(o[1],") *\n                  (float(dyC) / float(").concat(l[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(r,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const NP={kernelName:Pn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i,o=new EP(s.shape,r.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};class AP{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1===n)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      "));const i=e.map((n,i)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]"))(i)).join(","),r=pE(n);this.userCode="\n      void main() {\n        ".concat(r," coords = getOutputCoords();\n        setOutput(getX(").concat(i,"));\n      }\n    ")}}class RP{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;const i=PN("rc",n),r="".concat(i[n-1]," + 1 < ").concat(this.outputShape[n-1]),s="".concat(i[n-2]," + 1 < ").concat(this.outputShape[n-2]),a=pE(n);function o(n){const i=e.map((i,r)=>function(n,i){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(i[n]," - 1"):"".concat(i[n])}(r,n)),r=i.join(","),s=i.slice(-2).join(",");return"getChannel(getX(".concat(r,"), vec2(").concat(s,"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(r,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(a," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return o(e)}(i.slice()),";\n          if(").concat(r,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",o(e)}(i.slice()),";\n          }\n          if(").concat(s,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",o(e)}(i.slice()),";\n            if(").concat(r,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",o(e)}(i.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}}const DP={kernelName:Bn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{dims:s}=i,a=r.shape.length,o=q(s,r.shape);if(0===a)return rA({inputs:{x:r},backend:n});const l=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RP(r.shape,o):new AP(r.shape,o);return n.runWebGLProgram(l,[r],r.dtype)}};class OP{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],i=e[2];this.outputShape=e;let r="";r="number"===typeof t?"float outputValue = ".concat(t.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(t.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(r,"\n          if(coordX >= 0 && coordX < ").concat(i," && coordY >= 0 && coordY < ").concat(n,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const LP={kernelName:Ni,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:i}=e;const{image:r}=t,{radians:s,fillValue:a,center:o}=n,l=i,c=new OP(r.shape,a),[u,h]=_u(o,r.shape[1],r.shape[2]),d=[[u,h,Math.sin(s),Math.cos(s)]];return l.runWebGLProgram(c,[r],r.dtype,d)}},PP=gA({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),FP={kernelName:zn,backendName:"webgl",kernelFunc:PP},MP=gA({opSnippet:"return inversesqrt(x);",cpuKernelImpl:gN}),UP={kernelName:Vn,backendName:"webgl",kernelFunc:MP};class BP{constructor(e,t,n,i,r,s){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const o=pE(r.length),l=pE(s.length);let c="";1===n?c="i":2===n&&(c="i, j");const u="getIndices(".concat(c,")");let h="";1===i?h="i":2===i&&(h="i, coords[1]");const d="getUpdates(".concat(h,")");let p="";a&&(p="coords[0], coords[1]");const f="getDefaultValue(".concat(p,")"),g=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(o," strides = ").concat(o,"(").concat(r,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(u,");\n              flattenedIndex += index * ").concat(g,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(f,", sum, float(found)));\n        }\n      ")}}class zP{constructor(e,t,n,i,r,s){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;const o=pE(r.length),l=pE(s.length);let c="";1===n?c="i":2===n&&(c="i, j");const u="getIndices(".concat(c,")");let h="";1===i?h="i":2===i&&(h="i, coords[1]");const d="getUpdates(".concat(h,")");let p="";a&&(p="coords[0], coords[1]");const f="getDefaultValue(".concat(p,")"),g=t>1?"strides[j]":"strides",m=t>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(o," strides = ").concat(o,"(").concat(r,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(e,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(t,"; j+=2) {\n              ivec4 index = round(").concat(u,");\n              flattenedIndex += index.xz * ").concat(g,";\n              if (j + 1 < ").concat(t,") {\n                flattenedIndex += index.yw * ").concat(m,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(f,", sum, found));\n        }\n      ")}}const VP={kernelName:jn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{indices:r,updates:s}=t,{shape:a}=i,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=Nu(0,r,a),d=[h/c,c];if(0===h)return n.makeTensorInfo(a,r.dtype);const p=SA({inputs:{x:r},backend:n,attrs:{shape:[l,o]}}),f=SA({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let m;m=me().getBool("WEBGL_PACK")?new zP(l,o,p.shape.length,f.shape.length,u,d):new BP(l,o,p.shape.length,f.shape.length,u,d);const y=n.runWebGLProgram(m,[f,p,g],f.dtype),b=SA({inputs:{x:y},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}};class jP{constructor(e,t,n,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const r="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),s=2===me().getNumber("WEBGL_VERSION")?"while (left < right) {":r,a="left"===i?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(s,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(a," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}}const WP={kernelName:Hn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{sortedSequence:r,values:s}=t,{side:a}=i,o=new jP(r.shape[0],r.shape[1],s.shape[1],a),l=[[r.shape[1]]];return n.runWebGLProgram(o,[r,s],"int32",l)}};class HP{constructor(e,t,n){let i,r;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)r="resRC",i="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[];for(let i=0;i<t.length;i++)a.push("".concat(n[i])),i<e&&s.push("".concat(n[i]));i=s.join(),r=a.join()}const s=pE(n);this.userCode="\n      void main() {\n        ".concat(s," resRC = getOutputCoords();\n        float cVal = getC(").concat(i,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(r,"));\n        } else {\n          setOutput(getB(").concat(r,"));\n        }\n      }\n    ")}}const GP={kernelName:Gn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:i,t:r,e:s}=t,a=new HP(i.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(a,[i,r,s],Dr(r.dtype,s.dtype))}},qP=gA({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(Au,";\n  float scale = ").concat(Ru,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),XP={kernelName:qn,backendName:"webgl",kernelFunc:qP},KP=gA({opSnippet:fA+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:yN}),YP={kernelName:$n,backendName:"webgl",kernelFunc:KP},QP=gA({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),$P={kernelName:Qn,backendName:"webgl",kernelFunc:QP},JP=gA({opSnippet:fA+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(nA,"\n  return result;\n")}),ZP={kernelName:Kn,backendName:"webgl",kernelFunc:JP},eF=gA({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),tF={kernelName:Yn,backendName:"webgl",kernelFunc:eF},nF=gA({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),iF={kernelName:Jn,backendName:"webgl",kernelFunc:nF},rF={kernelName:ti,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockShape:s,paddings:a}=i;F(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const o=s.reduce((e,t)=>e*t),l=[[0,0]];l.push(...a);for(let y=1+s.length;y<r.shape.length;++y)l.push([0,0]);const c=[],u=rP({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),h=xu(u.shape,s,o,!1),d=wu(h.length,s.length,!1),p=Tu(u.shape,s,o,!1),f=SA({inputs:{x:u},backend:n,attrs:{shape:h}}),g=PA({inputs:{x:f},backend:n,attrs:{perm:d}}),m=SA({inputs:{x:g},backend:n,attrs:{shape:p}});return c.push(u),c.push(f),c.push(g),c.forEach(e=>n.disposeIntermediateTensorInfo(e)),m}};const sF={kernelName:ri,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:i,values:r,denseShape:s,defaultValue:a}=t;if(1!==s.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(s.shape));if(2!==i.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(i.shape));if(1!==r.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(r.shape));if(0!==a.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(a.shape));const o=n.readSync(i.dataId),l=n.readSync(r.dataId),c=n.readSync(s.dataId),u=n.readSync(a.dataId)[0],[h,d,p,f,g]=_N(o,i.shape,i.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(d,i.dtype,h),n.makeTensorInfo([d[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(e=>Number(e)))),n.makeTensorInfo([g.length],i.dtype,new Int32Array(g))]}};const aF={kernelName:si,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:i,inputShape:r,newShape:s}=t;if(2!==i.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(i.shape));if(1!==r.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(r.shape));if(1!==s.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(s.shape));const a=Array.from(n.readSync(r.dataId)),o=n.readSync(i.dataId),l=Array.from(n.readSync(s.dataId)),[c,u,h]=xN(o,i.shape,i.dtype,a,l);return[n.makeTensorInfo(u,i.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};const oF={kernelName:ai,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(r.shape));if(1!==s.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(s.shape));const a=n.readSync(i.dataId),o=n.readSync(r.dataId),l=n.readSync(s.dataId),[c,u]=wN(a,i.shape,i.dtype,o,l,!0);return n.makeTensorInfo(u,i.dtype,c)}};const lF={kernelName:oi,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(r.shape));if(1!==s.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(s.shape));const a=n.readSync(i.dataId),o=n.readSync(r.dataId),l=n.readSync(s.dataId),[c,u]=wN(a,i.shape,i.dtype,o,l);return n.makeTensorInfo(u,i.dtype,c)}};const cF={kernelName:li,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{sparseIndices:r,sparseValues:s,defaultValue:a}=t,{outputShape:o}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=Nu(0,r,o),p=!1;if("string"===s.dtype){const e=n.bufferSync(r),t=n.bufferSync(s),i=lr(n.readSync(a.dataId)[0]),f=mN(e,t,o,d,u,c,l,h,i,p);return n.makeTensorInfo(o,f.dtype,f.values)}const f=new BP(c,l,r.shape.length,s.shape.length,h,[d,1],p),g=n.runWebGLProgram(f,[s,r,a],s.dtype),m=SA({inputs:{x:g},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(g),m}};const uF={kernelName:ni,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{numOrSizeSplits:s,axis:a}=i,o=q(a,r.shape)[0],l=nh(r,s,o),c=r.shape.length,u=new Array(c).fill(0),h=r.shape.slice();return l.map(e=>{const t=[...h];t[o]=e;const i=RR({inputs:{x:r},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,i})}},hF="return sqrt(x);",dF=gA({opSnippet:hF,packedOpSnippet:hF,cpuKernelImpl:TN}),pF={kernelName:Zn,backendName:"webgl",kernelFunc:dF},fF={kernelName:ui,backendName:"webgl",kernelFunc:gA({opSnippet:"return x * x;"})},gF="return (a - b) * (a - b);",mF=mA({opSnippet:gF,packedOpSnippet:gF}),yF={kernelName:ci,backendName:"webgl",kernelFunc:mF};const bF={kernelName:hi,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;if("string"!==r.dtype)throw new Error("Input must be of datatype string");const s=bh(n.readSync(r.dataId)),a=kN(s,"string",i);return n.makeTensorInfo(r.shape,"string",a)}};const vF={kernelName:Ii,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:i}=e;const{x:r}=t,s=WN+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),a=new jN(r.shape,s);return i.runWebGLProgram(a,[r],r.dtype)}};class _F{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const i=n.length,r=pE(n.length),s=pE(n.length);let a="";if(1===i)a="coords * strides + begin";else{let e=0;a=n.map((t,i)=>(e++,1===n.length?"coords * strides[".concat(i,"] + begin[").concat(i,"]"):"coords[".concat(e-1,"] * strides[").concat(i,"] + begin[").concat(i,"]"))).join(",")}this.userCode="\n      ".concat(r," begin = ").concat(r,"(").concat(e,");\n      ").concat(r," strides = ").concat(r,"(").concat(t,");\n\n      void main() {\n        ").concat(s," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}}const xF={kernelName:di,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{begin:s,end:a,strides:o,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=i,{finalShapeSparse:p,finalShape:f,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:b,end:v,strides:_}=Za(r.shape,s,a,o,l,c,u,h,d);let x;if(g)x=SA({inputs:{x:r},backend:n,attrs:{shape:f}});else if(m||y){F(r.shape.length>=1,()=>"Input must have rank at least 1, got: ".concat(r.shape.length));const e=za(b,v,_),t=RR({inputs:{x:r},backend:n,attrs:{begin:b,size:e}});x=SA({inputs:{x:t},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(t)}else{if(n.shouldExecuteOnCPU([r])){const e=n.readSync(r.dataId),t=Vs(r.shape,r.dtype,e),i=SN(p,t,_,b);x=n.makeTensorInfo(f,r.dtype,i.values)}else{const e=new _F(b,_,p);x=n.runWebGLProgram(e,[r],r.dtype)}}const w=SA({inputs:{x:x},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(x),w}};const wF={kernelName:pi,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{separator:r,nGramWidths:s,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:h}=t,d=n.readSync(u.dataId),p=n.readSync(h.dataId),[f,g]=CN(d,p,r,s,a,o,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}};const TF={kernelName:fi,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{skipEmpty:r}=i,{input:s,delimiter:a}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error("Input must be a vector, got shape: ".concat(s.shape));if(0!==a.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(a.shape));const o=n.readSync(s.dataId),l=n.readSync(a.dataId)[0],[c,u,h]=IN(o,l,r),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};const kF={kernelName:gi,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{numBuckets:r}=i,{input:s}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=n.readSync(s.dataId),o=EN(a,r);return n.makeTensorInfo(s.shape,"int32",o)}},SF=gA({opSnippet:"return tan(x);"}),CF={kernelName:yi,backendName:"webgl",kernelFunc:SF},IF=gA({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),EF={kernelName:bi,backendName:"webgl",kernelFunc:IF};const NF={kernelName:Wn,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{tensor:r,indices:s,updates:a}=t,{}=i,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=Nu(0,s,r.shape),d=[h/c,c];if(0===h)return n.makeTensorInfo(r.shape,s.dtype);const p=SA({inputs:{x:s},backend:n,attrs:{shape:[l,o]}}),f=SA({inputs:{x:a},backend:n,attrs:{shape:[l,c]}}),g=SA({inputs:{x:r},backend:n,attrs:{shape:d}}),m=new BP(l,o,p.shape.length,f.shape.length,u,d,!1,!0),y=n.runWebGLProgram(m,[f,p,g],g.dtype),b=SA({inputs:{x:y},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}};class AF{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[s]*t[s];this.outputShape=n,this.rank=n.length;const i=pE(this.rank),r=function(e){const t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let r=0;r<e.length;r++)i.push("imod(".concat(n[r],", ").concat(e[r],")"));return i.join()}(e);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(r,"));\n      }\n    ")}}function RF(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{reps:s}=i;if("string"===r.dtype||r.shape.length>5){const e=n.readSync(r.dataId),t="string"===r.dtype?e.map(e=>lr(e)):e,i=Vs(r.shape,r.dtype,t),a=AN(i,s);return n.makeTensorInfo(a.shape,a.dtype,a.values)}const a=new AF(r.shape,s);return n.runWebGLProgram(a,[r],r.dtype)}const DF={kernelName:vi,backendName:"webgl",kernelFunc:RF};class OF{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class LF{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function PF(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function FF(e){let t=1;for(;t<e;)t*=2;return t}const MF={kernelName:_i,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{k:s,sorted:a}=i,o=me().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=me().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([r])||u<o||s>l){const e=n.readSync(r.dataId),[t,i]=RN(e,c,r.dtype,s,a);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(i.shape,i.dtype,i.values)]}if(0===s)return c[c.length-1]=0,[n.makeTensorInfo(c,r.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===u)return[r,gO({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(r.dataId),d=null!==h&&h.isPacked,p=d?n.unpackTensor(r):r,f=B(c)/u,g=SA({inputs:{x:p},attrs:{shape:[f,u]},backend:n});d&&PF(n,p);const m=FF(s),y=FF(u);let b=null;const v=()=>null===b?[g,g]:[g,b],_=(e,t,i)=>{const r=v(),s=new OF(i),a=[[u],[null===b?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=b;b=n.runWebGLProgram(s,r,"int32",a),PF(n,o)};for(let S=1;S<m;S*=2){const e=2*S;for(let t=S;t>=1;t/=2)_(e,t,[f,y])}for(let S=y;S>m;S/=2){const e=v(),t=new LF([f,S/2]),i=[[u],[null===b?1:0],[m]],r=b;b=n.runWebGLProgram(t,e,"int32",i),PF(n,r);const s=m/2,a=2*s;for(let n=s;n>=1;n/=2)_(a,n,b.shape)}let x=b;b=RR({inputs:{x:b},backend:n,attrs:{begin:0,size:[f,s]}}),PF(n,x);let w=LO({inputs:{x:g,indices:b},backend:n,attrs:{axis:1,batchDims:1}});PF(n,g);const T=c.slice(0,-1);T.push(s),x=b,b=SA({inputs:{x:b},attrs:{shape:T},backend:n}),PF(n,x);const k=w;return w=SA({inputs:{x:w},attrs:{shape:T},backend:n}),PF(n,k),[w,b]}};class UF{constructor(e,t,n,i,r,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const a="nearest"===n?1:2;let o;switch(i){case"constant":default:o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(o," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(o," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(o," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(e," && 0 <= coordX && coordX < ").concat(t,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(r,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(r,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(t,"));\n                float mapY = mapCoord(inY, float(").concat(e,"));\n\n                if (").concat(a," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}}const BF={kernelName:xi,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{image:r,transforms:s}=t,{interpolation:a,fillMode:o,fillValue:l,outputShape:c}=i,[u,h,d,p]=r.shape,[f,g]=null!=c?c:[h,d],m=new UF(h,d,a,o,l,[u,f,g,p]);return n.runWebGLProgram(m,[r,s],"float32")}};const zF={kernelName:Ti,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:i}=e,{axis:r}=n,{x:s}=t;YI(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const a=i.readSync(s.dataId),{outputValues:o,outputShape:l,indices:c}=ON(a,r,s.shape,s.dtype);return[i.makeTensorInfo(l,s.dtype,o),i.makeTensorInfo([c.length],"int32",c)]}};const VF={kernelName:ki,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{value:r}=t;let{axis:s}=i;s<0&&(s+=r.shape.length);const a=r,o=a.shape.length,l=r.shape[s],c=new Array(o-1);let u=0;for(let g=0;g<o;g++)g!==s&&(c[u++]=a.shape[g]);const h=[],d=new Array(o).fill(0),p=a.shape.slice();p[s]=1;const f=new Array(l);for(let g=0;g<f.length;g++){d[s]=g;const e=RR({inputs:{x:a},backend:n,attrs:{begin:d,size:p}}),t=SA({inputs:{x:e},backend:n,attrs:{shape:c}});f[g]=t,h.push(e)}return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),f}};class jF{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,i=e.batchSize,r=e.inSize,s=e.numSegments,a=s*Math.ceil(r/n);this.outputShape=[i,a];const o=4*Math.floor(n/4),l=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let u="";r%n>0&&(u="\n        if (inIdx < 0 || inIdx >= ".concat(r,") {\n          return initializationValue;\n        }\n      "));let h="";r%n>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(r,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(u,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(s,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(s,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(o,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(o,";\n        if (").concat(1===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(c,"\n        } else if (").concat(2===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(c,"\n        } else if (").concat(3===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(c,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}}const WF={kernelName:Si,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,segmentIds:s}=t,{numSegments:a}=i,o=r.shape.length,l=[];let c=0;const u=yl([c],o);let h=r;null!=u&&(h=PA({inputs:{x:r},backend:n,attrs:{perm:u}}),l.push(h),c=vl(1,o)[0]);const d=mh(h.shape,c,a),p=B([h.shape[c]]),f=SA({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(f);const g=Or(r.dtype),m=(e,t,i,r,s)=>{const a=e.shape[0],o=e.shape[1],c=gh(o,s),u=new jF({windowSize:c,inSize:o,batchSize:a,numSegments:s},t),h=n.compileAndRun(u,[e,i],r);if(l.push(h),h.shape[1]===s)return h;const d=dP({backend:n,attrs:{start:0,stop:s,step:1,dtype:"float32"}}),p=RF({inputs:{x:d},backend:n,attrs:{reps:[o/c]}});l.push(d),l.push(p);return m(h,t,p,r,s)},y=SA({inputs:{x:m(f,"unsortedSegmentSum",s,g,a)},backend:n,attrs:{shape:d}});let b=y;if(null!=u){l.push(y);const e=bl(u);b=PA({inputs:{x:b},backend:n,attrs:{perm:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),b}},HF=[UA,zA,jA,HA,XA,QA,$A,JA,rR,sR,oR,cR,hR,pR,gR,bR,vR,wR,TR,kR,IR,OR,LR,PR,FR,VR,HR,XR,oA,QR,rD,dD,yD,vD,_D,xD,wD,kD,CD,ED,LD,PD,FD,UD,VD,HD,GD,XD,YD,QD,JD,ZD,tO,iO,sO,oO,uO,pO,mO,bO,xO,TO,CO,NO,AO,DO,PO,MO,BO,sA,zO,tD,jO,HO,qO,uA,KO,QO,$O,ZO,tL,iL,sL,oL,uL,dL,fL,mL,yL,bL,xL,wL,TL,kL,SL,IL,AL,DL,VL,kA,WL,GL,XL,YL,UR,$L,eP,tP,sP,oP,pA,lP,cP,uP,hP,pP,zR,PL,gP,yP,vP,CA,wP,kP,IP,NP,DP,LP,FP,UP,VP,WP,GP,XP,YP,$P,ZP,tF,DR,zL,iF,rF,sF,aF,oF,lF,cF,uF,pF,fF,yF,bF,vF,xF,wF,TF,kF,UL,LA,CF,EF,NF,DF,MF,BF,FA,zF,VF,WF,ZL];for(const n of HF)zi(n);function GF(e){return GF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},GF(e)}function qF(e){var t=function(e,t){if("object"!=GF(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=GF(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==GF(t)?t:t+""}function XF(e,t,n){return(t=qF(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function KF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function YF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KF(Object(n),!0).forEach(function(t){XF(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var QF="undefined"!=typeof self?self:{};function $F(e){e:{for(var t=["CLOSURE_FLAGS"],n=QF,i=0;i<t.length;i++)if(null==(n=n[t[i]])){t=null;break e}t=n}return null!=(e=t&&t[e])&&e}function JF(){throw Error("Invalid UTF8")}function ZF(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}let eM,tM;const nM="undefined"!=typeof TextDecoder;let iM;const rM="undefined"!=typeof TextEncoder;function sM(e){if(rM)e=(iM||(iM=new TextEncoder)).encode(e);else{let n=0;const i=new Uint8Array(3*e.length);for(let r=0;r<e.length;r++){var t=e.charCodeAt(r);if(128>t)i[n++]=t;else{if(2048>t)i[n++]=t>>6|192;else{if(55296<=t&&57343>=t){if(56319>=t&&r<e.length){const s=e.charCodeAt(++r);if(56320<=s&&57343>=s){t=1024*(t-55296)+s-56320+65536,i[n++]=t>>18|240,i[n++]=t>>12&63|128,i[n++]=t>>6&63|128,i[n++]=63&t|128;continue}r--}t=65533}i[n++]=t>>12|224,i[n++]=t>>6&63|128}i[n++]=63&t|128}}e=n===i.length?i:i.subarray(0,n)}return e}var aM,oM=$F(610401301),lM=$F(188588736);const cM=QF.navigator;function uM(e){return!!oM&&!!aM&&aM.brands.some(t=>{let{brand:n}=t;return n&&-1!=n.indexOf(e)})}function hM(e){var t;return(t=QF.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}function dM(){return!!oM&&!!aM&&0<aM.brands.length}function pM(){return dM()?uM("Chromium"):(hM("Chrome")||hM("CriOS"))&&!(!dM()&&hM("Edge"))||hM("Silk")}function fM(e){return fM[" "](e),e}aM=cM&&cM.userAgentData||null,fM[" "]=function(){};var gM=!dM()&&(hM("Trident")||hM("MSIE"));!hM("Android")||pM(),pM(),hM("Safari")&&(pM()||!dM()&&hM("Coast")||!dM()&&hM("Opera")||!dM()&&hM("Edge")||(dM()?uM("Microsoft Edge"):hM("Edg/"))||dM()&&uM("Opera"));var mM={},yM=null;function bM(){if(!yM){yM={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var i=e.concat(t[n].split(""));mM[n]=i;for(var r=0;r<i.length;r++){var s=i[r];void 0===yM[s]&&(yM[s]=r)}}}}var vM="undefined"!=typeof Uint8Array,_M=!gM&&"function"==typeof btoa;function xM(e){if(!_M){var t;void 0===t&&(t=0),bM(),t=mM[t];var n=Array(Math.floor(e.length/3)),i=t[64]||"";let l=0,c=0;for(;l<e.length-2;l+=3){var r=e[l],s=e[l+1],a=e[l+2],o=t[r>>2];r=t[(3&r)<<4|s>>4],s=t[(15&s)<<2|a>>6],a=t[63&a],n[c++]=o+r+s+a}switch(o=0,a=i,e.length-l){case 2:a=t[(15&(o=e[l+1]))<<2]||i;case 1:e=e[l],n[c]=t[e>>2]+t[(3&e)<<4|o>>4]+a+i}return n.join("")}for(t="",n=0,i=e.length-10240;n<i;)t+=String.fromCharCode.apply(null,e.subarray(n,n+=10240));return t+=String.fromCharCode.apply(null,n?e.subarray(n):e),btoa(t)}const wM=/[-_.]/g,TM={"-":"+",_:"/",".":"="};function kM(e){return TM[e]||""}function SM(e){if(!_M)return function(e){var t=e.length,n=3*t/4;n%3?n=Math.floor(n):-1!="=.".indexOf(e[t-1])&&(n=-1!="=.".indexOf(e[t-2])?n-2:n-1);var i=new Uint8Array(n),r=0;return function(e,t){function n(t){for(;i<e.length;){var n=e.charAt(i++),r=yM[n];if(null!=r)return r;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}bM();for(var i=0;;){var r=n(-1),s=n(0),a=n(64),o=n(64);if(64===o&&-1===r)break;t(r<<2|s>>4),64!=a&&(t(s<<4&240|a>>2),64!=o&&t(a<<6&192|o))}}(e,function(e){i[r++]=e}),r!==n?i.subarray(0,r):i}(e);wM.test(e)&&(e=e.replace(wM,kM)),e=atob(e);const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function CM(e){return vM&&null!=e&&e instanceof Uint8Array}let IM;function EM(){return IM||(IM=new Uint8Array(0))}var NM={};let AM;function RM(e){if(e!==NM)throw Error("illegal external caller")}function DM(){return AM||(AM=new LM(null,NM))}function OM(e){RM(NM);var t=e.g;return null==(t=null==t||CM(t)?t:"string"==typeof t?SM(t):null)?t:e.g=t}var LM=class{constructor(e,t){if(RM(t),this.g=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}h(){const e=OM(this);return e?new Uint8Array(e):EM()}};function PM(e,t){return Error("Invalid wire type: ".concat(e," (at position ").concat(t,")"))}function FM(){return Error("Failed to read varint, encoding is invalid.")}function MM(e,t){return Error("Tried to read past the end of the data ".concat(t," > ").concat(e))}function UM(e){if("string"==typeof e)return{buffer:SM(e),P:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),P:!1};if(e.constructor===Uint8Array)return{buffer:e,P:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),P:!1};if(e.constructor===LM)return{buffer:OM(e)||EM(),P:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),P:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function BM(){return"function"==typeof BigInt}const zM="function"==typeof Uint8Array.prototype.slice;let VM,jM=0,WM=0;function HM(e){const t=0>e;let n=(e=Math.abs(e))>>>0;if(e=Math.floor((e-n)/4294967296),t){const[t,i]=JM(n,e);e=i,n=t}jM=n>>>0,WM=e>>>0}function GM(e){const t=VM||(VM=new DataView(new ArrayBuffer(8)));t.setFloat32(0,+e,!0),WM=0,jM=t.getUint32(0,!0)}function qM(e,t){return 4294967296*t+(e>>>0)}function XM(e,t){const n=2147483648&t;return n&&(t=~t>>>0,0==(e=1+~e>>>0)&&(t=t+1>>>0)),e=qM(e,t),n?-e:e}function KM(e,t){if(e>>>=0,2097151>=(t>>>=0))var n=""+(4294967296*t+e);else BM()?n=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(n=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),n+=8147497*t,t*=2,1e7<=e&&(n+=Math.floor(e/1e7),e%=1e7),1e7<=n&&(t+=Math.floor(n/1e7),n%=1e7),n=t+YM(n)+YM(e));return n}function YM(e){return e=String(e),"0000000".slice(e.length)+e}function QM(){var e=jM,t=WM;if(2147483648&t)if(BM())e=""+(BigInt(0|t)<<BigInt(32)|BigInt(e>>>0));else{const[n,i]=JM(e,t);e="-"+KM(n,i)}else e=KM(e,t);return e}function $M(e){if(16>e.length)HM(Number(e));else if(BM())e=BigInt(e),jM=Number(e&BigInt(4294967295))>>>0,WM=Number(e>>BigInt(32)&BigInt(4294967295));else{const t=+("-"===e[0]);WM=jM=0;const n=e.length;for(let i=t,r=(n-t)%6+t;r<=n;i=r,r+=6){const t=Number(e.slice(i,r));WM*=1e6,jM=1e6*jM+t,4294967296<=jM&&(WM+=Math.trunc(jM/4294967296),WM>>>=0,jM>>>=0)}if(t){const[e,t]=JM(jM,WM);jM=e,WM=t}}}function JM(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function ZM(e,t){let n,i=0,r=0,s=0;const a=e.h;let o=e.g;do{n=a[o++],i|=(127&n)<<s,s+=7}while(32>s&&128&n);for(32<s&&(r|=(127&n)>>4),s=3;32>s&&128&n;s+=7)n=a[o++],r|=(127&n)<<s;if(oU(e,o),128>n)return t(i>>>0,r>>>0);throw FM()}function eU(e){let t=0,n=e.g;const i=n+10,r=e.h;for(;n<i;){const i=r[n++];if(t|=i,0==(128&i))return oU(e,n),!!(127&t)}throw FM()}function tU(e){const t=e.h;let n=e.g,i=t[n++],r=127&i;if(128&i&&(i=t[n++],r|=(127&i)<<7,128&i&&(i=t[n++],r|=(127&i)<<14,128&i&&(i=t[n++],r|=(127&i)<<21,128&i&&(i=t[n++],r|=i<<28,128&i&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++])))))throw FM();return oU(e,n),r}function nU(e){return tU(e)>>>0}function iU(e){var t=e.h;const n=e.g,i=t[n],r=t[n+1],s=t[n+2];return t=t[n+3],oU(e,e.g+4),(i|r<<8|s<<16|t<<24)>>>0}function rU(e){var t=iU(e);e=2*(t>>31)+1;const n=t>>>23&255;return t&=8388607,255==n?t?NaN:1/0*e:0==n?e*Math.pow(2,-149)*t:e*Math.pow(2,n-150)*(t+Math.pow(2,23))}function sU(e){return tU(e)}function aU(e,t){let{ca:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.ca=n,t&&(t=UM(t),e.h=t.buffer,e.m=t.P,e.j=0,e.l=e.h.length,e.g=e.j)}function oU(e,t){if(e.g=t,t>e.l)throw MM(e.l,t)}function lU(e,t){if(0>t)throw Error("Tried to read a negative byte length: ".concat(t));const n=e.g,i=n+t;if(i>e.l)throw MM(t,e.l-n);return e.g=i,n}function cU(e,t){if(0==t)return DM();var n=lU(e,t);return e.ca&&e.m?n=e.h.subarray(n,n+t):(e=e.h,n=n===(t=n+t)?EM():zM?e.slice(n,t):new Uint8Array(e.subarray(n,t))),0==n.length?DM():new LM(n,NM)}var uU=[];function hU(e){var t=e.g;if(t.g==t.l)return!1;e.l=e.g.g;var n=nU(e.g);if(t=n>>>3,!(0<=(n&=7)&&5>=n))throw PM(n,e.l);if(1>t)throw Error("Invalid field number: ".concat(t," (at position ").concat(e.l,")"));return e.m=t,e.h=n,!0}function dU(e){switch(e.h){case 0:0!=e.h?dU(e):eU(e.g);break;case 1:oU(e=e.g,e.g+8);break;case 2:if(2!=e.h)dU(e);else{var t=nU(e.g);oU(e=e.g,e.g+t)}break;case 5:oU(e=e.g,e.g+4);break;case 3:for(t=e.m;;){if(!hU(e))throw Error("Unmatched start-group tag: stream EOF");if(4==e.h){if(e.m!=t)throw Error("Unmatched end-group tag");break}dU(e)}break;default:throw PM(e.h,e.l)}}function pU(e,t,n){const i=e.g.l,r=nU(e.g),s=e.g.g+r;let a=s-i;if(0>=a&&(e.g.l=s,n(t,e,void 0,void 0,void 0),a=s-e.g.g),a)throw Error("Message parsing ended unexpectedly. Expected to read ".concat(r," bytes, instead read ").concat(r-a," bytes, either the data ended unexpectedly or the message misreported its own length"));return e.g.g=s,e.g.l=i,t}function fU(e){var t=nU(e.g),n=lU(e=e.g,t);if(e=e.h,nM){var i,r=e;(i=tM)||(i=tM=new TextDecoder("utf-8",{fatal:!0})),t=n+t,r=0===n&&t===r.length?r:r.subarray(n,t);try{var s=i.decode(r)}catch(e){if(void 0===eM){try{i.decode(new Uint8Array([128]))}catch(e){}try{i.decode(new Uint8Array([97])),eM=!0}catch(e){eM=!1}}throw!eM&&(tM=void 0),e}}else{t=(s=n)+t,n=[];let o,l=null;for(;s<t;){var a=e[s++];128>a?n.push(a):224>a?s>=t?JF():(o=e[s++],194>a||128!=(192&o)?(s--,JF()):n.push((31&a)<<6|63&o)):240>a?s>=t-1?JF():(o=e[s++],128!=(192&o)||224===a&&160>o||237===a&&160<=o||128!=(192&(i=e[s++]))?(s--,JF()):n.push((15&a)<<12|(63&o)<<6|63&i)):244>=a?s>=t-2?JF():(o=e[s++],128!=(192&o)||0!=o-144+(a<<28)>>30||128!=(192&(i=e[s++]))||128!=(192&(r=e[s++]))?(s--,JF()):(a=(7&a)<<18|(63&o)<<12|(63&i)<<6|63&r,a-=65536,n.push(55296+(a>>10&1023),56320+(1023&a)))):JF(),8192<=n.length&&(l=ZF(l,n),n.length=0)}s=ZF(l,n)}return s}function gU(e){const t=nU(e.g);return cU(e.g,t)}function mU(e,t,n){var i=nU(e.g);for(i=e.g.g+i;e.g.g<i;)n.push(t(e.g))}var yU=[];function bU(e){return e?/^\d+$/.test(e)?($M(e),new vU(jM,WM)):null:_U||(_U=new vU(0,0))}var vU=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let _U;function xU(e){return e?/^-?\d+$/.test(e)?($M(e),new wU(jM,WM)):null:TU||(TU=new wU(0,0))}var wU=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let TU;function kU(e,t,n){for(;0<n||127<t;)e.g.push(127&t|128),t=(t>>>7|n<<25)>>>0,n>>>=7;e.g.push(t)}function SU(e,t){for(;127<t;)e.g.push(127&t|128),t>>>=7;e.g.push(t)}function CU(e,t){if(0<=t)SU(e,t);else{for(let n=0;9>n;n++)e.g.push(127&t|128),t>>=7;e.g.push(1)}}function IU(e,t){e.g.push(t>>>0&255),e.g.push(t>>>8&255),e.g.push(t>>>16&255),e.g.push(t>>>24&255)}function EU(e,t){0!==t.length&&(e.l.push(t),e.h+=t.length)}function NU(e,t,n){SU(e.g,8*t+n)}function AU(e,t){return NU(e,t,2),t=e.g.end(),EU(e,t),t.push(e.h),t}function RU(e,t){var n=t.pop();for(n=e.h+e.g.length()-n;127<n;)t.push(127&n|128),n>>>=7,e.h++;t.push(n),e.h++}function DU(e,t,n){NU(e,t,2),SU(e.g,n.length),EU(e,e.g.end()),EU(e,n)}function OU(e,t,n,i){null!=n&&(t=AU(e,t),i(n,e),RU(e,t))}class LU{constructor(e,t,n,i){this.g=e,this.h=t,this.l=n,this.pa=i}}function PU(e){return Array.prototype.slice.call(e)}function FU(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol():e}var MU=FU(),UU=FU("0di"),BU=FU("2ex"),zU=FU("0dg"),VU=MU?(e,t)=>{e[MU]|=t}:(e,t)=>{void 0!==e.g?e.g|=t:Object.defineProperties(e,{g:{value:t,configurable:!0,writable:!0,enumerable:!1}})},jU=MU?(e,t)=>{e[MU]&=~t}:(e,t)=>{void 0!==e.g&&(e.g&=~t)};function WU(e,t,n){return n?e|t:e&~t}var HU=MU?e=>0|e[MU]:e=>0|e.g,GU=MU?e=>e[MU]:e=>e.g,qU=MU?(e,t)=>(e[MU]=t,e):(e,t)=>(void 0!==e.g?e.g=t:Object.defineProperties(e,{g:{value:t,configurable:!0,writable:!0,enumerable:!1}}),e);function XU(e){return VU(e,34),e}function KU(e,t){qU(t,-14591&e)}function YU(e,t){qU(t,-14557&e|34)}function QU(e){return 0===(e=e>>14&1023)?536870912:e}var $U,JU={},ZU={};function eB(e){return!(!e||"object"!=typeof e||e.Ja!==ZU)}function tB(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}function nB(e,t,n){if(null!=e)if("string"==typeof e)e=e?new LM(e,NM):DM();else if(e.constructor!==LM)if(CM(e))e=e.length?new LM(n?e:new Uint8Array(e),NM):DM();else{if(!t)throw Error();e=void 0}return e}function iB(e,t,n){if(!Array.isArray(e)||e.length)return!1;const i=HU(e);return!!(1&i)||!(!t||!(Array.isArray(t)?t.includes(n):t.has(n)))&&(qU(e,1|i),!0)}const rB=[];function sB(e){if(2&e)throw Error()}qU(rB,55),$U=Object.freeze(rB);class aB{constructor(e,t,n){this.l=0,this.g=e,this.h=t,this.m=n}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new aB(this.g,this.h,this.m)}}let oB,lB,cB;function uB(e,t){(t=oB?t[oB]:void 0)&&(e[oB]=PU(t))}function hB(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}function dB(){const e=Error();hB(e,"incident"),function(e){QF.setTimeout(()=>{throw e},0)}(e)}function pB(e){return hB(e=Error(e),"warning"),e}function fB(e){return null==e||"number"==typeof e?e:"NaN"===e||"Infinity"===e||"-Infinity"===e?Number(e):void 0}function gB(e){return null==e||"boolean"==typeof e?e:"number"==typeof e?!!e:void 0}Object.freeze(new class{}),Object.freeze(new class{});const mB=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function yB(e){const t=typeof e;return"number"===t?Number.isFinite(e):"string"===t&&mB.test(e)}function bB(e){if(null==e)return e;if("string"==typeof e){if(!e)return;e=+e}return"number"==typeof e&&Number.isFinite(e)?0|e:void 0}function vB(e){if(null==e)return e;if("string"==typeof e){if(!e)return;e=+e}return"number"==typeof e&&Number.isFinite(e)?e>>>0:void 0}function _B(e){return"-"!==e[0]&&(20>e.length||20===e.length&&184467>Number(e.substring(0,6)))}function xB(e){return"-"===e[0]?20>e.length||20===e.length&&-922337<Number(e.substring(0,7)):19>e.length||19===e.length&&922337>Number(e.substring(0,6))}function wB(e){return e=Math.trunc(e),Number.isSafeInteger(e)||(HM(e),e=XM(jM,WM)),e}function TB(e){var t=Math.trunc(Number(e));return Number.isSafeInteger(t)?String(t):(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),xB(e)||($M(e),e=QM()),e)}function kB(e){return null==e?e:yB(e)?"number"==typeof e?wB(e):TB(e):void 0}function SB(e){if("string"!=typeof e)throw Error();return e}function CB(e){if(null!=e&&"string"!=typeof e)throw Error();return e}function IB(e){return null==e||"string"==typeof e?e:void 0}function EB(e,t,n,i){if(null!=e&&"object"==typeof e&&e.X===JU)return e;if(!Array.isArray(e))return n?2&i?(e=t[UU])?t=e:(XU((e=new t).s),t=t[UU]=e):t=new t:t=void 0,t;let r=n=HU(e);return 0===r&&(r|=32&i),r|=2&i,r!==n&&qU(e,r),new t(e)}function NB(e,t,n){if(t){var i=!!i;if(!yB(t=e))throw pB("int64");"string"==typeof t?i=TB(t):i?(i=Math.trunc(t),Number.isSafeInteger(i)?i=String(i):xB(t=String(i))?i=t:(HM(i),i=QM())):i=wB(t)}else i=kB(e);return"string"==typeof(n=null==(e=i)?n?0:void 0:e)&&(i=+n,Number.isSafeInteger(i))?i:n}let AB,RB,DB;function OB(e){switch(typeof e){case"boolean":return RB||(RB=[0,void 0,!0]);case"number":return 0<e?void 0:0===e?DB||(DB=[0,void 0]):[-e,void 0];case"string":return[0,e];case"object":return e}}function LB(e,t){return PB(e,t[0],t[1])}function PB(e,t,n){if(null==e&&(e=AB),AB=void 0,null==e){var i=96;n?(e=[n],i|=512):e=[],t&&(i=-16760833&i|(1023&t)<<14)}else{if(!Array.isArray(e))throw Error("narr");if(2048&(i=HU(e)))throw Error("farr");if(64&i)return e;if(i|=64,n&&(i|=512,n!==e[0]))throw Error("mid");e:{const r=(n=e).length;if(r){const e=r-1;if(tB(n[e])){if(1024<=(t=e-(+!!(512&(i|=256))-1)))throw Error("pvtlmt");i=-16760833&i|(1023&t)<<14;break e}}if(t){if(1024<(t=Math.max(t,r-(+!!(512&i)-1))))throw Error("spvt");i=-16760833&i|(1023&t)<<14}}}return qU(e,i),e}const FB={};let MB=function(){try{return fM(new class extends Map{constructor(){super()}}),!1}catch(e){return!0}}();class UB{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,t){return this.g.set(e,t),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}[Symbol.iterator](){return this.entries()}}const BB=MB?(Object.setPrototypeOf(UB.prototype,Map.prototype),Object.defineProperties(UB.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),UB):class extends Map{constructor(){super()}};function zB(e){return e}function VB(e){if(2&e.N)throw Error("Cannot mutate an immutable Map")}var jB=class extends BB{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:zB,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:zB;super();let r=HU(e);r|=64,qU(e,r),this.N=r,this.U=t,this.S=n,this.Z=this.U?WB:i;for(let s=0;s<e.length;s++){const a=e[s],o=n(a[0],!1,!0);let l=a[1];t?void 0===l&&(l=null):l=i(a[1],!1,!0,void 0,void 0,r),super.set(o,l)}}oa(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:HB;if(0!==this.size)return this.Y(e)}Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:HB;const t=[],n=super.entries();for(var i;!(i=n.next()).done;)(i=i.value)[0]=e(i[0]),i[1]=e(i[1]),t.push(i);return t}clear(){VB(this),super.clear()}delete(e){return VB(this),super.delete(this.S(e,!0,!1))}entries(){var e=this.na();return new aB(e,GB,this)}keys(){return this.Ia()}values(){var e=this.na();return new aB(e,jB.prototype.get,this)}forEach(e,t){super.forEach((n,i)=>{e.call(t,this.get(i),i,this)})}set(e,t){return VB(this),null==(e=this.S(e,!0,!1))?this:null==t?(super.delete(e),this):super.set(e,this.Z(t,!0,!0,this.U,!1,this.N))}Oa(e){const t=this.S(e[0],!1,!0);e=e[1],e=this.U?void 0===e?null:e:this.Z(e,!1,!0,void 0,!1,this.N),super.set(t,e)}has(e){return super.has(this.S(e,!1,!1))}get(e){e=this.S(e,!1,!1);const t=super.get(e);if(void 0!==t){var n=this.U;return n?((n=this.Z(t,!1,!0,n,this.ta,this.N))!==t&&super.set(e,n),n):t}}na(){return Array.from(super.keys())}Ia(){return super.keys()}[Symbol.iterator](){return this.entries()}};function WB(e,t,n,i,r,s){return e=EB(e,i,n,s),r&&(e=tz(e)),e}function HB(e){return e}function GB(e){return[e,this.get(e)]}let qB;function XB(){return qB||(qB=new jB(XU([]),void 0,void 0,void 0,FB))}function KB(e,t,n,i,r){if(null!=e){if(Array.isArray(e))e=iB(e,void 0,0)?void 0:r&&2&HU(e)?e:YB(e,t,n,void 0!==i,r);else if(tB(e)){const s={};for(let a in e)s[a]=KB(e[a],t,n,i,r);e=s}else e=t(e,i);return e}}function YB(e,t,n,i,r){const s=i||n?HU(e):0;i=i?!!(32&s):void 0;const a=PU(e);for(let o=0;o<a.length;o++)a[o]=KB(a[o],t,n,i,r);return n&&(uB(a,e),n(s,a)),a}function QB(e){return KB(e,$B,void 0,void 0,!1)}function $B(e){return e.X===JU?e.toJSON():e instanceof jB?e.oa(QB):function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(iB(e,void 0,0))return}else{if(CM(e))return xM(e);if(e instanceof LM){const t=e.g;return null==t?"":"string"==typeof t?t:e.g=xM(t)}if(e instanceof jB)return e.oa()}}return e}(e)}function JB(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:YU;if(null!=e){if(vM&&e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var i=HU(e);return 2&i||(t&&(t=0===i||!!(32&i)&&!(64&i||!(16&i))),e=t?qU(e,-12293&i|34):YB(e,JB,4&i?YU:n,!0,!0)),e}return e.X===JU?(n=e.s,e=2&(i=GU(n))?e:ZB(e,n,i,!0)):e instanceof jB&&!(2&e.N)&&(n=XU(e.Y(JB)),e=new jB(n,e.U,e.S,e.Z)),e}}function ZB(e,t,n,i){return e=e.constructor,AB=t=ez(t,n,i),t=new e(t),AB=void 0,t}function ez(e,t,n){const i=n||2&t?YU:KU,r=!!(32&t);return e=function(e,t,n){const i=PU(e);var r=i.length;const s=256&t?i[r-1]:void 0;for(r+=s?-1:0,t=512&t?1:0;t<r;t++)i[t]=n(i[t]);if(s){t=i[t]={};for(const e in s)t[e]=n(s[e])}return uB(i,e),i}(e,t,e=>JB(e,r,i)),VU(e,32|(n?2:0)),e}function tz(e){const t=e.s,n=GU(t);return 2&n?ZB(e,t,n,!1):e}function nz(e,t,n,i){return!(4&t)||null!=n&&(!i&&0===n&&(4096&t||8192&t)&&5>(e.constructor[zU]=1+(0|e.constructor[zU]))&&dB(),0!==n&&!(n&t))}function iz(e,t){return sz(e=e.s,GU(e),t)}function rz(e,t,n,i){if(!(0>(t=i+(+!!(512&t)-1))||t>=e.length||t>=n))return e[t]}function sz(e,t,n,i){if(-1===n)return null;const r=QU(t);if(!(n>=r)){var s=e.length;return i&&256&t&&null!=(i=e[s-1][n])?(rz(e,t,r,n)&&null!=BU&&(4<=(t=(e=null!==cB&&void 0!==cB?cB:cB={})[BU]||0)||(e[BU]=t+1,dB())),i):rz(e,t,r,n)}return 256&t?e[e.length-1][n]:void 0}function az(e,t,n,i){const r=e.s;let s=GU(r);return sB(s),oz(r,s,t,n,i),e}function oz(e,t,n,i,r){const s=QU(t);if(n>=s||r){let a=t;if(256&t)r=e[e.length-1];else{if(null==i)return a;r=e[s+(+!!(512&t)-1)]={},a|=256}return r[n]=i,n<s&&(e[n+(+!!(512&t)-1)]=void 0),a!==t&&qU(e,a),a}return e[n+(+!!(512&t)-1)]=i,256&t&&n in(e=e[e.length-1])&&delete e[n],t}function lz(e,t,n,i,r){var s=2&t;let a=sz(e,t,n,r);Array.isArray(a)||(a=$U);const o=!(2&i);i=!(1&i);const l=!!(32&t);let c=HU(a);return 0!==c||!l||s||o?1&c||(c|=1,qU(a,c)):(c|=33,qU(a,c)),s?(e=!1,2&c||(XU(a),e=!!(4&c)),(i||e)&&Object.freeze(a)):(s=!!(2&c)||!!(2048&c),i&&s?(a=PU(a),i=1,l&&!o&&(i|=32),qU(a,i),oz(e,t,n,a,r)):o&&32&c&&!s&&jU(a,32)),a}function cz(e,t){e=e.s;let n=GU(e);const i=sz(e,n,t),r=fB(i);return null!=r&&r!==i&&oz(e,n,t,r),r}function uz(e){e=e.s;let t=GU(e);const n=sz(e,t,1),i=nB(n,!0,!!(34&t));return null!=i&&i!==n&&oz(e,t,1,i),i}function hz(e,t,n){const i=e.s;let r=GU(i);const s=2&r?1:2;let a=dz(i,r,t);var o=HU(a);if(nz(e,o,void 0,!1)){(4&o||Object.isFrozen(a))&&(a=PU(a),o=Nz(o,r),r=oz(i,r,t,a));let s=e=0;for(;e<a.length;e++){const t=n(a[e]);null!=t&&(a[s++]=t)}s<e&&(a.length=s),o=WU(o=pz(o,r),20,!0),o=WU(o,4096,!1),o=WU(o,8192,!1),qU(a,o),2&o&&Object.freeze(a)}return fz(o)||(n=o,(o=(e=1===s||4===s&&!!(32&o))?WU(o,2,!0):Az(o,r,!1))!==n&&qU(a,o),e&&Object.freeze(a)),2===s&&fz(o)&&(a=PU(a),o=Az(o=Nz(o,r),r,!1),qU(a,o),oz(i,r,t,a)),a}function dz(e,t,n){return e=sz(e,t,n),Array.isArray(e)?e:$U}function pz(e,t){return 0===e&&(e=Nz(e,t)),WU(e,1,!0)}function fz(e){return!!(2&e)&&!!(4&e)||!!(2048&e)}function gz(e){e=PU(e);for(let t=0;t<e.length;t++){const n=e[t]=PU(e[t]);Array.isArray(n[1])&&(n[1]=XU(n[1]))}return e}function mz(e,t,n){{const o=e.s;let l=GU(o);if(sB(l),null==n)oz(o,l,t);else{var i,r=HU(n),s=r,a=!!(2&r)||Object.isFrozen(n);if((i=!a)&&(i=!1),nz(e,r))for(r=21,a&&(n=PU(n),s=0,r=Az(r=Nz(r,l),l,!0)),e=0;e<n.length;e++)n[e]=SB(n[e]);i&&(n=PU(n),s=0,r=Az(r=Nz(r,l),l,!0)),r!==s&&qU(n,r),oz(o,l,t,n)}}}function yz(e,t,n,i){e=e.s;let r=GU(e);sB(r),oz(e,r,t,("0"===i?0===Number(n):n===i)?void 0:n)}function bz(e,t,n,i){const r=GU(e);sB(r),e=lz(e,r,t,2),i=n(i,!!(4&(t=HU(e)))&&!!(4096&t)),e.push(i)}function vz(e){return e}function _z(e,t){return xz(e=e.s,GU(e),gW)===t?t:-1}function xz(e,t,n){let i=0;for(let r=0;r<n.length;r++){const s=n[r];null!=sz(e,t,s)&&(0!==i&&(t=oz(e,t,i)),i=s)}return i}function wz(e,t,n,i){let r=GU(e);sB(r);const s=sz(e,r,n,i);let a;if(null!=s&&s.X===JU)return(t=tz(s))!==s&&oz(e,r,n,t,i),t.s;if(Array.isArray(s)){const e=HU(s);a=2&e?ez(s,e,!1):s,a=LB(a,t)}else a=LB(void 0,t);return a!==s&&oz(e,r,n,a,i),a}function Tz(e,t,n,i){e=e.s;let r=GU(e);const s=sz(e,r,n,i);return(t=EB(s,t,!1,r))!==s&&null!=t&&oz(e,r,n,t,i),t}function kz(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(null==(t=Tz(e,t,n,i)))return t;e=e.s;let r=GU(e);if(!(2&r)){const s=tz(t);s!==t&&oz(e,r,n,t=s,i)}return t}function Sz(e,t,n,i,r,s){var a=2,o=!!(2&t);a=o?1:a,r=!!r,s&&(s=!o),o=dz(e,t,i);var l=HU(o);const c=!!(4&l);if(!c){var u=o,h=t;const e=!!(2&(l=pz(l,t)));e&&(h=WU(h,2,!0));let i=!e,r=!0,s=0,a=0;for(;s<u.length;s++){const t=EB(u[s],n,!1,h);if(t instanceof n){if(!e){const e=!!(2&HU(t.s));i&&(i=!e),r&&(r=e)}u[a++]=t}}a<s&&(u.length=a),l=WU(l,4,!0),l=WU(l,16,r),l=WU(l,8,i),qU(u,l),e&&Object.freeze(u)}if(s&&!(8&l||!o.length&&(1===a||4===a&&32&l))){for(fz(l)&&(o=PU(o),l=Nz(l,t),t=oz(e,t,i,o)),n=o,s=l,u=0;u<n.length;u++)(l=n[u])!==(h=tz(l))&&(n[u]=h);s=WU(s,8,!0),s=WU(s,16,!n.length),qU(n,s),l=s}return fz(l)||(n=l,(l=(s=1===a||4===a&&!!(32&l))?WU(l,!o.length||16&l&&(!c||32&l)?2:2048,!0):Az(l,t,r))!==n&&qU(o,l),s&&Object.freeze(o)),2===a&&fz(l)&&(o=PU(o),l=Az(l=Nz(l,t),t,r),qU(o,l),oz(e,t,i,o)),o}function Cz(e,t,n){e=e.s;const i=GU(e);return Sz(e,i,t,n,!1,!(2&i))}function Iz(e,t,n,i,r){return null==i&&(i=void 0),az(e,n,i,r)}function Ez(e,t,n,i){null==i&&(i=void 0),e=e.s;let r=GU(e);sB(r),(n=xz(e,r,n))&&n!==t&&null!=i&&(r=oz(e,r,n)),oz(e,r,t,i)}function Nz(e,t){return e=WU(e,2,!!(2&t)),e=WU(e,32,!0),WU(e,2048,!1)}function Az(e,t,n){return 32&t&&n||(e=WU(e,32,!1)),e}function Rz(e,t,n,i){e=e.s;const r=GU(e);sB(r),t=Sz(e,r,n,t,!0),n=null!=i?i:new n,t.push(n),2&HU(n.s)?jU(t,8):jU(t,16)}function Dz(e,t){return bB(iz(e,t))}function Oz(e,t){return null!==e&&void 0!==e?e:t}function Lz(e,t){return Oz(cz(e,t),0)}function Pz(e,t){return Oz(IB(iz(e,t)),"")}function Fz(e,t,n){if(null!=n&&"boolean"!=typeof n)throw e=typeof n,Error("Expected boolean but got ".concat("object"!=e?e:n?Array.isArray(n)?"array":e:"null",": ").concat(n));az(e,t,n)}function Mz(e,t,n){if(null!=n){if("number"!=typeof n)throw pB("int32");if(!Number.isFinite(n))throw pB("int32");n|=0}az(e,t,n)}function Uz(e,t,n){if(null!=n&&"number"!=typeof n)throw Error("Value of float/double field must be a number, found ".concat(typeof n,": ").concat(n));az(e,t,n)}function Bz(e,t,n){t.g?t.m(e,t.g,t.h,n,!0):t.m(e,t.h,n,!0)}jB.prototype.toJSON=void 0,jB.prototype.Ja=ZU;var zz=class{constructor(e,t){this.s=PB(e,t)}toJSON(){return Vz(this,YB(this.s,$B,void 0,void 0,!1),!0)}l(){var e=bH;return e.g?e.l(this,e.g,e.h,!0):e.l(this,e.h,e.defaultValue,!0)}clone(){const e=this.s;return ZB(this,e,GU(e),!1)}P(){return!!(2&HU(this.s))}};function Vz(e,t,n){var i=lM?void 0:e.constructor.B;const r=GU(n?e.s:t);if(!(e=t.length))return t;let s,a;if(tB(n=t[e-1])){e:{var o=n;let e={},t=!1;for(var l in o){let n=o[l];if(Array.isArray(n)){let e=n;(iB(n,i,+l)||eB(n)&&0===n.size)&&(n=null),n!=e&&(t=!0)}null!=n?e[l]=n:t=!0}if(t){for(var c in e){o=e;break e}o=null}}o!=n&&(s=!0),e--}for(l=+!!(512&r)-1;0<e&&(n=t[c=e-1],c-=l,null==n||iB(n,i,c)||eB(n)&&0===n.size);e--)a=!0;return s||a?(t=Array.prototype.slice.call(t,0,e),o&&t.push(o),t):t}function jz(e){return Array.isArray(e)?e[0]instanceof LU?e:[WV,e]:[e,void 0]}function Wz(e,t){if(Array.isArray(t)){var n=HU(t);if(4&n)return t;for(var i=0,r=0;i<t.length;i++){const n=e(t[i]);null!=n&&(t[r++]=n)}return r<i&&(t.length=r),qU(t,-12289&n|5),2&n&&Object.freeze(t),t}}zz.prototype.X=JU,zz.prototype.toString=function(){return Vz(this,this.s,!1).toString()};const Hz=Symbol();function Gz(e){let t=e[Hz];if(!t){const n=Zz(e),i=hV(e),r=i.l;t=r?(e,t)=>r(e,t,i):(e,t)=>{for(;hU(t)&&4!=t.h;){var r=t.m,s=i[r];if(!s){var a=i.ea;a&&(a=a[r])&&(s=i[r]=qz(a))}s&&s(t,e,r)||(r=(s=t).l,dU(s),s.ia?s=void 0:(a=s.g.g-r,s.g.g=r,s=cU(s.g,a)),r=e,s&&(oB||(oB=Symbol()),(a=r[oB])?a.push(s):r[oB]=[s]))}n===Kz||n===Yz||n.j||(e[lB||(lB=Symbol())]=n)},e[Hz]=t}return t}function qz(e){const t=(e=jz(e))[0].g;if(e=e[1]){const n=Gz(e),i=hV(e).T;return(e,r,s)=>t(e,r,s,i,n)}return t}class Xz{}let Kz,Yz;const Qz=Symbol();function $z(e,t,n){const i=n[1];let r;if(i){const n=i[Qz];r=n?n.T:OB(i[0]),e[t]=null!==n&&void 0!==n?n:i}r&&r===RB?(e.g||(e.g=new Set)).add(t):n[0]&&(e.h||(e.h=new Set)).add(t)}function Jz(e,t){return[e.l,!t||0<t[0]?void 0:t]}function Zz(e){var t=e[Qz];if(t)return t;if(!(t=tV(e,e[Qz]=new Xz,Jz,Jz,$z)).ea&&!t.h&&!t.g){let n=!0;for(let e in t)isNaN(e)||(n=!1);n?(OB(e[0])===RB?Yz?t=Yz:((t=new Xz).T=OB(!0),t=Yz=t):t=Kz||(Kz=new Xz),t=e[Qz]=t):t.j=!0}return t}function eV(e,t,n){e[t]=n}function tV(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:eV;t.T=OB(e[0]);let s=0;var a=e[++s];a&&a.constructor===Object&&(t.ea=a,"function"==typeof(a=e[++s])&&(t.l=a,t.m=e[++s],a=e[++s]));const o={};for(;Array.isArray(a)&&"number"==typeof a[0]&&0<a[0];){for(var l=0;l<a.length;l++)o[a[l]]=a;a=e[++s]}for(l=1;void 0!==a;){let h;"number"==typeof a&&(l+=a,a=e[++s]);var c=void 0;if(a instanceof LU?h=a:(h=HV,s--),h.pa){a=e[++s],c=e;var u=s;"function"==typeof a&&(a=a(),c[u]=a),c=a}for(u=l+1,"number"==typeof(a=e[++s])&&0>a&&(u-=a,a=e[++s]);l<u;l++){const e=o[l];r(t,l,c?i(h,c,e):n(h,e))}}return t}const nV=Symbol();function iV(e){let t=e[nV];if(!t){const n=oV(e);t=(e,t)=>fV(e,t,n),e[nV]=t}return t}const rV=Symbol();function sV(e){return e.h}function aV(e,t){let n,i;const r=e.h;return(e,s,a)=>r(e,s,a,i||(i=oV(t).T),n||(n=iV(t)))}function oV(e){let t=e[rV];return t||(t=tV(e,e[rV]={},sV,aV),dV(e),t)}const lV=Symbol();function cV(e,t){const n=e.g;return t?(e,i,r)=>n(e,i,r,t):n}function uV(e,t,n){const i=e.g;let r,s;return(e,a,o)=>i(e,a,o,s||(s=hV(t).T),r||(r=Gz(t)),n)}function hV(e){let t=e[lV];return t||(Zz(e),t=tV(e,e[lV]={},cV,uV),dV(e),t)}function dV(e){lV in e&&Qz in e&&rV in e&&(e.length=0)}function pV(e,t){var n=e[t];if(n)return n;if((n=e.ea)&&(n=n[t])){var i=(n=jz(n))[0].h;if(n=n[1]){const t=iV(n),r=oV(n).T;n=(n=e.m)?n(r,t):(e,n,s)=>i(e,n,s,r,t)}else n=i;return e[t]=n}}function fV(e,t,n){for(var i=GU(e),r=+!!(512&i)-1,s=e.length,a=512&i?1:0,o=s+(256&i?-1:0);a<o;a++){const i=e[a];if(null==i)continue;const s=a-r,o=pV(n,s);o&&o(t,i,s)}if(256&i){i=e[s-1];for(let e in i)r=+e,Number.isNaN(r)||null!=(s=i[e])&&(o=pV(n,r))&&o(t,s,r)}if(e=oB?e[oB]:void 0)for(EU(t,t.g.end()),n=0;n<e.length;n++)EU(t,OM(e[n])||EM())}function gV(e,t){return new LU(e,t,!1,!1)}function mV(e,t){return new LU(e,t,!0,!1)}function yV(e,t){return new LU(e,t,!1,!0)}function bV(e,t,n){oz(e,GU(e),t,n)}var vV=yV(function(e,t,n,i,r){return 2===e.h&&(e=pU(e,LB([void 0,void 0],i),r),sB(i=GU(t)),(r=sz(t,i,n))instanceof jB?0!=(2&r.N)?((r=r.Y()).push(e),oz(t,i,n,r)):r.Oa(e):Array.isArray(r)?(2&HU(r)&&oz(t,i,n,r=gz(r)),r.push(e)):oz(t,i,n,[e]),!0)},function(e,t,n,i,r){if(t instanceof jB)t.forEach((t,s)=>{OU(e,n,LB([s,t],i),r)});else if(Array.isArray(t))for(let s=0;s<t.length;s++){const a=t[s];Array.isArray(a)&&OU(e,n,LB(a,i),r)}});function _V(e,t,n){e:if(null!=t){if(yB(t)){if("string"==typeof t){t=TB(t);break e}if("number"==typeof t){t=wB(t);break e}}t=void 0}null!=t&&("string"==typeof t&&xU(t),null!=t&&(NU(e,n,0),"number"==typeof t?(e=e.g,HM(t),kU(e,jM,WM)):(n=xU(t),kU(e.g,n.h,n.g))))}function xV(e,t,n){null!=(t=bB(t))&&null!=t&&(NU(e,n,0),CU(e.g,t))}function wV(e,t,n){null!=(t=gB(t))&&(NU(e,n,0),e.g.g.push(t?1:0))}function TV(e,t,n){null!=(t=IB(t))&&DU(e,n,sM(t))}function kV(e,t,n,i,r){OU(e,n,t instanceof zz?t.s:Array.isArray(t)?LB(t,i):void 0,r)}function SV(e,t,n){null!=(t=null==t||"string"==typeof t||CM(t)||t instanceof LM?t:void 0)&&DU(e,n,UM(t).buffer)}function CV(e,t,n){return(5===e.h||2===e.h)&&(t=lz(t,GU(t),n,2,!1),2==e.h?mU(e,rU,t):t.push(rU(e.g)),!0)}var IV,EV=gV(function(e,t,n){if(1!==e.h)return!1;var i=e.g;e=iU(i);const r=iU(i);i=2*(r>>31)+1;const s=r>>>20&2047;return e=4294967296*(1048575&r)+e,bV(t,n,2047==s?e?NaN:1/0*i:0==s?i*Math.pow(2,-1074)*e:i*Math.pow(2,s-1075)*(e+4503599627370496)),!0},function(e,t,n){null!=(t=fB(t))&&(NU(e,n,1),e=e.g,(n=VM||(VM=new DataView(new ArrayBuffer(8)))).setFloat64(0,+t,!0),jM=n.getUint32(0,!0),WM=n.getUint32(4,!0),IU(e,jM),IU(e,WM))}),NV=gV(function(e,t,n){return 5===e.h&&(bV(t,n,rU(e.g)),!0)},function(e,t,n){null!=(t=fB(t))&&(NU(e,n,5),e=e.g,GM(t),IU(e,jM))}),AV=mV(CV,function(e,t,n){if(null!=(t=Wz(fB,t)))for(let a=0;a<t.length;a++){var i=e,r=n,s=t[a];null!=s&&(NU(i,r,5),i=i.g,GM(s),IU(i,jM))}}),RV=mV(CV,function(e,t,n){if(null!=(t=Wz(fB,t))&&t.length){NU(e,n,2),SU(e.g,4*t.length);for(let i=0;i<t.length;i++)n=e.g,GM(t[i]),IU(n,jM)}}),DV=gV(function(e,t,n){return 0===e.h&&(bV(t,n,ZM(e.g,XM)),!0)},_V),OV=gV(function(e,t,n){return 0===e.h&&(bV(t,n,0===(e=ZM(e.g,XM))?void 0:e),!0)},_V),LV=gV(function(e,t,n){return 0===e.h&&(bV(t,n,ZM(e.g,qM)),!0)},function(e,t,n){e:if(null!=t){if(yB(t)){if("string"==typeof t){var i=Math.trunc(Number(t));Number.isSafeInteger(i)&&0<=i?t=String(i):(-1!==(i=t.indexOf("."))&&(t=t.substring(0,i)),_B(t)||($M(t),t=KM(jM,WM)));break e}if("number"==typeof t){t=0<=(t=Math.trunc(t))&&Number.isSafeInteger(t)?t:function(e){if(0>e){HM(e);const t=KM(jM,WM);return e=Number(t),Number.isSafeInteger(e)?e:t}return _B(String(e))?e:(HM(e),qM(jM,WM))}(t);break e}}t=void 0}null!=t&&("string"==typeof t&&bU(t),null!=t&&(NU(e,n,0),"number"==typeof t?(e=e.g,HM(t),kU(e,jM,WM)):(n=bU(t),kU(e.g,n.h,n.g))))}),PV=gV(function(e,t,n){return 0===e.h&&(bV(t,n,tU(e.g)),!0)},xV),FV=mV(function(e,t,n){return(0===e.h||2===e.h)&&(t=lz(t,GU(t),n,2,!1),2==e.h?mU(e,tU,t):t.push(tU(e.g)),!0)},function(e,t,n){if(null!=(t=Wz(bB,t))&&t.length){n=AU(e,n);for(let n=0;n<t.length;n++)CU(e.g,t[n]);RU(e,n)}}),MV=gV(function(e,t,n){return 0===e.h&&(bV(t,n,0===(e=tU(e.g))?void 0:e),!0)},xV),UV=gV(function(e,t,n){return 0===e.h&&(bV(t,n,eU(e.g)),!0)},wV),BV=gV(function(e,t,n){return 0===e.h&&(bV(t,n,!1===(e=eU(e.g))?void 0:e),!0)},wV),zV=mV(function(e,t,n){return 2===e.h&&(bz(t,n,vz,e=fU(e)),!0)},function(e,t,n){if(null!=(t=Wz(IB,t)))for(let a=0;a<t.length;a++){var i=e,r=n,s=t[a];null!=s&&DU(i,r,sM(s))}}),VV=gV(function(e,t,n){return 2===e.h&&(bV(t,n,""===(e=fU(e))?void 0:e),!0)},TV),jV=gV(function(e,t,n){return 2===e.h&&(bV(t,n,fU(e)),!0)},TV),WV=yV(function(e,t,n,i,r){return 2===e.h&&(pU(e,wz(t,i,n,!0),r),!0)},kV),HV=yV(function(e,t,n,i,r){return 2===e.h&&(pU(e,wz(t,i,n),r),!0)},kV);IV=new LU(function(e,t,n,i,r){if(2!==e.h)return!1;i=LB(void 0,i);let s=GU(t);sB(s);let a=lz(t,s,n,3);return s=GU(t),4&HU(a)&&(a=PU(a),qU(a,-2079&HU(a)|1),oz(t,s,n,a)),a.push(i),pU(e,i,r),!0},function(e,t,n,i,r){if(Array.isArray(t))for(let s=0;s<t.length;s++)kV(e,t[s],n,i,r)},!0,!0);var GV=yV(function(e,t,n,i,r,s){if(2!==e.h)return!1;let a=GU(t);return sB(a),(s=xz(t,a,s))&&n!==s&&oz(t,a,s),pU(e,t=wz(t,i,n),r),!0},kV),qV=gV(function(e,t,n){return 2===e.h&&(bV(t,n,gU(e)),!0)},SV),XV=mV(function(e,t,n){return(0===e.h||2===e.h)&&(t=lz(t,GU(t),n,2,!1),2==e.h?mU(e,nU,t):t.push(nU(e.g)),!0)},function(e,t,n){if(null!=(t=Wz(vB,t)))for(let a=0;a<t.length;a++){var i=e,r=n,s=t[a];null!=s&&(NU(i,r,0),SU(i.g,s))}}),KV=gV(function(e,t,n){return 0===e.h&&(bV(t,n,tU(e.g)),!0)},function(e,t,n){null!=(t=bB(t))&&(t=parseInt(t,10),NU(e,n,0),CU(e.g,t))}),YV=mV(function(e,t,n){return(0===e.h||2===e.h)&&(t=lz(t,GU(t),n,2,!1),2==e.h?mU(e,sU,t):t.push(tU(e.g)),!0)},function(e,t,n){if(null!=(t=Wz(bB,t))&&t.length){n=AU(e,n);for(let n=0;n<t.length;n++)CU(e.g,t[n]);RU(e,n)}});class QV{constructor(e,t){this.h=e,this.g=t,this.l=kz,this.m=Iz,this.defaultValue=void 0}}function $V(e,t){return new QV(e,t)}function JV(e,t){return(n,i)=>{if(yU.length){const e=yU.pop();e.o(i),aU(e.g,n,i),n=e}else n=new class{constructor(e,t){if(uU.length){const n=uU.pop();aU(n,e,t),e=n}else e=new class{constructor(e,t){this.h=null,this.m=!1,this.g=this.l=this.j=0,aU(this,e,t)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ca=!1}}(e,t);this.g=e,this.l=this.g.g,this.h=this.m=-1,this.o(t)}o(){let{ia:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.ia=e}}(n,i);try{const i=new e,s=i.s;Gz(t)(s,n);var r=i}finally{n.g.clear(),n.m=-1,n.h=-1,100>yU.length&&yU.push(n)}return r}}function ZV(e){return function(){const t=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const e=this.g;return this.g=[],e}}}};fV(this.s,t,oV(e)),EU(t,t.g.end());const n=new Uint8Array(t.h),i=t.l,r=i.length;let s=0;for(let e=0;e<r;e++){const t=i[e];n.set(t,s),s+=t.length}return t.l=[n],n}}var ej=class extends zz{constructor(e){super(e)}},tj=[0,VV,gV(function(e,t,n){return 2===e.h&&(bV(t,n,(e=gU(e))===DM()?void 0:e),!0)},function(e,t,n){if(null!=t){if(t instanceof zz){const i=t.Qa;return void(i&&(t=i(t),null!=t&&DU(e,n,UM(t).buffer)))}if(Array.isArray(t))return}SV(e,t,n)})],nj=[0,jV],ij=[0,PV,KV,UV,-1,FV,KV,-1],rj=[0,UV,-1],sj=class extends zz{constructor(){super()}};sj.B=[6];var aj=[0,UV,jV,UV,KV,-1,YV,jV,-1,rj,KV],oj=[0,jV,-2],lj=class extends zz{constructor(){super()}},cj=[0],uj=[0,PV,UV,-4],hj=class extends zz{constructor(e){super(e,2)}},dj={},pj=[-2,dj,UV];dj[336783863]=[0,jV,UV,-1,PV,[0,[1,2,3,4,5,6],GV,cj,GV,aj,GV,oj,GV,uj,GV,ij,GV,[0,jV]],nj,UV,[0,[1,3],[2,4],GV,[0,FV],-1,GV,[0,zV],-1,IV,[0,jV,-1]],jV];var fj=[0,VV,BV],gj=[0,OV,-1,BV,-3,OV,FV,VV,MV,OV,-1,BV,MV,BV,-2,VV],mj=[-1,{}],yj=[0,jV,1,mj],bj=[0,jV,zV,mj];function vj(e,t){yz(e,2,CB(t),"")}function _j(e,t){bz(e.s,3,SB,t)}function xj(e,t){bz(e.s,4,SB,t)}var wj=class extends zz{constructor(e){super(e,500)}o(e){return Iz(this,0,7,e)}};wj.B=[3,4,5,6,8,13,17,1005];var Tj=[-500,VV,-1,zV,-3,pj,IV,tj,MV,-1,yj,bj,IV,fj,VV,gj,MV,zV,987,zV],kj=[0,VV,-1,mj],Sj=[-500,jV,-1,[-1,{}],998,jV],Cj=[-500,jV,zV,-1,[-2,{},UV],997,zV,-1],Ij=[-500,jV,zV,mj,998,zV];function Ej(e,t){Rz(e,1,wj,t)}function Nj(e,t){bz(e.s,10,SB,t)}function Aj(e,t){bz(e.s,15,SB,t)}var Rj=class extends zz{constructor(e){super(e,500)}o(e){return Iz(this,0,1001,e)}};Rj.B=[1,6,7,9,10,15,16,17,14,1002];var Dj=[-500,IV,Tj,4,IV,Sj,IV,Cj,MV,IV,Ij,zV,MV,yj,bj,IV,kj,zV,-2,gj,VV,-1,BV,979,mj,IV,tj],Oj=JV(Rj,Dj);Rj.prototype.g=ZV(Dj);var Lj=[0,IV,[0,PV,-2]],Pj=class extends zz{constructor(e){super(e)}},Fj=[0,PV,NV,jV,-1],Mj=class extends zz{constructor(e){super(e)}g(){return Cz(this,Pj,1)}};Mj.B=[1];var Uj=[0,IV,Fj],Bj=JV(Mj,Uj),zj=[0,PV,NV],Vj=[0,PV,-1,Lj],jj=class extends zz{constructor(e){super(e)}},Wj=[0,PV,-3],Hj=[0,NV,-3],Gj=class extends zz{constructor(e){super(e)}},qj=[0,NV,-1,jV,NV],Xj=class extends zz{constructor(e){super(e)}h(){return kz(this,jj,2)}g(){return Cz(this,Gj,5)}};Xj.B=[5];var Kj=[0,KV,Wj,Hj,Vj,IV,qj],Yj=class extends zz{constructor(e){super(e)}};Yj.B=[1,2,3,8,9];var Qj=JV(Yj,[0,zV,FV,RV,Kj,jV,-1,DV,IV,zj,zV,DV]),$j=class extends zz{constructor(e){super(e)}},Jj=[0,NV,-4],Zj=class extends zz{constructor(e){super(e)}};Zj.B=[1];var eW=JV(Zj,[0,IV,Jj]),tW=class extends zz{constructor(e){super(e)}},nW=[0,NV,-4],iW=class extends zz{constructor(e){super(e)}};iW.B=[1];var rW=JV(iW,[0,IV,nW]),sW=class extends zz{constructor(e){super(e)}};sW.B=[3];var aW=[0,PV,-1,RV,KV],oW=class extends zz{constructor(){super()}};oW.prototype.g=ZV([0,NV,-4,DV]);var lW=class extends zz{constructor(e){super(e)}},cW=[0,1,PV,jV,Uj],uW=class extends zz{constructor(e){super(e)}};uW.B=[1];var hW=JV(uW,[0,IV,cW,DV]),dW=class extends zz{constructor(e){super(e)}};dW.B=[1];var pW=class extends zz{constructor(e){super(e)}qa(){const e=uz(this);return null==e?DM():e}},fW=class extends zz{constructor(e){super(e)}},gW=[1,2],mW=[0,gW,GV,[0,RV],GV,[0,qV],PV,jV],yW=class extends zz{constructor(e){super(e)}};yW.B=[1];var bW=JV(yW,[0,IV,mW,DV]),vW=class extends zz{constructor(e){super(e)}};vW.B=[4,5];var _W=[0,jV,PV,NV,zV,-1],xW=class extends zz{constructor(e){super(e)}},wW=[0,UV,-1],TW=class extends zz{constructor(e){super(e)}},kW=[1,2,3,4,5],SW=class extends zz{constructor(e){super(e)}g(){return null!=uz(this)}h(){return null!=IB(iz(this,2))}},CW=[0,qV,jV,[0,PV,DV,-1],[0,LV,DV]],IW=class extends zz{constructor(e){super(e)}g(){var e;return null!==(e=gB(iz(this,2)))&&void 0!==e&&e}},EW=[0,CW,UV,[0,kW,GV,uj,GV,aj,GV,ij,GV,cj,GV,oj],KV],NW=class extends zz{constructor(e){super(e)}},AW=[0,EW,NV,-1,PV],RW=$V(502141897,NW);dj[502141897]=AW;var DW=[0,CW];dj[512499200]=DW;var OW=[0,DW];dj[515723506]=OW;var LW=JV(class extends zz{constructor(e){super(e)}},[0,[0,KV,-1,AV,XV],aW]),PW=[0,EW];dj[508981768]=PW;var FW=class extends zz{constructor(e){super(e)}},MW=[0,EW,NV,PW,UV],UW=class extends zz{constructor(e){super(e)}},BW=[0,EW,AW,MW,NV,OW];dj[508968149]=MW;var zW=$V(508968150,UW);dj[508968150]=BW;var VW=class extends zz{constructor(e){super(e)}},jW=$V(513916220,VW);dj[513916220]=[0,EW,BW,PV];var WW=class extends zz{constructor(e){super(e)}h(){return kz(this,vW,2)}g(){az(this,2)}},HW=[0,EW,_W];dj[478825465]=HW;var GW=[0,EW];dj[478825422]=GW;var qW=class extends zz{constructor(e){super(e)}},XW=[0,EW,GW,HW,-1],KW=class extends zz{constructor(e){super(e)}},YW=[0,EW,NV,PV],QW=class extends zz{constructor(e){super(e)}},$W=[0,EW,NV],JW=class extends zz{constructor(e){super(e)}},ZW=[0,EW,YW,$W,NV],eH=class extends zz{constructor(e){super(e)}},tH=[0,EW,ZW,XW];dj[463370452]=XW,dj[464864288]=YW,dj[474472470]=$W;var nH=$V(462713202,JW);dj[462713202]=ZW;var iH=$V(479097054,eH);dj[479097054]=tH;var rH=class extends zz{constructor(e){super(e)}},sH=[0,EW],aH=class extends zz{constructor(e){super(e)}},oH=[0,EW,NV,-1,PV];dj[514774813]=oH;var lH=class extends zz{constructor(e){super(e)}},cH=[0,EW,NV,UV];dj[518928384]=cH;var uH=class extends zz{constructor(){super()}};uH.prototype.g=ZV([0,EW,$W,sH,AW,MW,oH,cH]);var hH=class extends zz{constructor(e){super(e)}},dH=$V(456383383,hH);dj[456383383]=[0,EW,_W];var pH=class extends zz{constructor(e){super(e)}},fH=$V(476348187,pH);dj[476348187]=[0,EW,wW];var gH=class extends zz{constructor(e){super(e)}},mH=[0,KV,-1],yH=class extends zz{constructor(e){super(e)}};yH.B=[3];var bH=$V(458105876,class extends zz{constructor(e){super(e)}g(){var e=this.s;const t=GU(e);var n=2&t;return e=function(e,t,n){var i=yH;const r=2&t;let s=!1;if(null==n){if(r)return XB();n=[]}else if(n.constructor===jB){if(0==(2&n.N)||r)return n;n=n.Y()}else Array.isArray(n)?s=!!(2&HU(n)):n=[];if(r){if(!n.length)return XB();s||(s=!0,XU(n))}else s&&(s=!1,n=gz(n));return s||(64&HU(n)?jU(n,32):32&t&&VU(n,32)),oz(e,t,2,i=new jB(n,i,NB,void 0),!1),i}(e,t,sz(e,t,2)),null==e||!n&&yH&&(e.ta=!0),e}});dj[458105876]=[0,mH,vV,[!0,DV,[0,jV,-1,zV]]];var vH=class extends zz{constructor(e){super(e)}},_H=$V(458105758,vH);dj[458105758]=[0,EW,jV,mH];var xH=class extends zz{constructor(e){super(e)}};xH.B=[5,6];var wH=$V(443442058,xH);dj[443442058]=[0,EW,jV,PV,NV,zV,-1];var TH=class extends zz{constructor(e){super(e)}},kH=$V(516587230,TH);function SH(e,t){return t=t?t.clone():new vW,void 0!==e.displayNamesLocale?az(t,1,CB(e.displayNamesLocale)):void 0===e.displayNamesLocale&&az(t,1),void 0!==e.maxResults?Mz(t,2,e.maxResults):"maxResults"in e&&az(t,2),void 0!==e.scoreThreshold?Uz(t,3,e.scoreThreshold):"scoreThreshold"in e&&az(t,3),void 0!==e.categoryAllowlist?mz(t,4,e.categoryAllowlist):"categoryAllowlist"in e&&az(t,4),void 0!==e.categoryDenylist?mz(t,5,e.categoryDenylist):"categoryDenylist"in e&&az(t,5),t}function CH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return{categories:e.map(e=>{var t,n,i,r;return{index:null!==(t=Oz(Dz(e,1),0))&&void 0!==t?t:-1,score:null!==(n=Lz(e,2))&&void 0!==n?n:0,categoryName:null!==(i=Pz(e,3))&&void 0!==i?i:"",displayName:null!==(r=Pz(e,4))&&void 0!==r?r:""}}),headIndex:t,headName:n}}function IH(e){var t,n,i,r,s,a,o=hz(e,3,fB),l=hz(e,2,bB),c=hz(e,1,IB),u=hz(e,9,IB);const h={categories:[],keypoints:[]};for(let v=0;v<o.length;v++){var d,p,f;h.categories.push({score:o[v],index:null!==(d=l[v])&&void 0!==d?d:-1,categoryName:null!==(p=c[v])&&void 0!==p?p:"",displayName:null!==(f=u[v])&&void 0!==f?f:""})}if((o=null===(t=kz(e,Xj,4))||void 0===t?void 0:t.h())&&(h.boundingBox={originX:null!==(n=Dz(o,1))&&void 0!==n?n:0,originY:null!==(i=Dz(o,2))&&void 0!==i?i:0,width:null!==(r=Dz(o,3))&&void 0!==r?r:0,height:null!==(s=Dz(o,4))&&void 0!==s?s:0,angle:0}),null!==(a=kz(e,Xj,4))&&void 0!==a&&a.g().length)for(const v of kz(e,Xj,4).g()){var g,m,y,b;h.keypoints.push({x:null!==(g=cz(v,1))&&void 0!==g?g:0,y:null!==(m=cz(v,2))&&void 0!==m?m:0,score:null!==(y=cz(v,4))&&void 0!==y?y:0,label:null!==(b=IB(iz(v,3)))&&void 0!==b?b:""})}return h}function EH(e){const t=[];for(const a of Cz(e,tW,1)){var n,i,r,s;t.push({x:null!==(n=Lz(a,1))&&void 0!==n?n:0,y:null!==(i=Lz(a,2))&&void 0!==i?i:0,z:null!==(r=Lz(a,3))&&void 0!==r?r:0,visibility:null!==(s=Lz(a,4))&&void 0!==s?s:0})}return t}function NH(e){const t=[];for(const a of Cz(e,$j,1)){var n,i,r,s;t.push({x:null!==(n=Lz(a,1))&&void 0!==n?n:0,y:null!==(i=Lz(a,2))&&void 0!==i?i:0,z:null!==(r=Lz(a,3))&&void 0!==r?r:0,visibility:null!==(s=Lz(a,4))&&void 0!==s?s:0})}return t}function AH(e){return Array.from(e,e=>127<e?e-256:e)}function RH(e,t){if(e.length!==t.length)throw Error("Cannot compute cosine similarity between embeddings of different sizes (".concat(e.length," vs. ").concat(t.length,")."));let n=0,i=0,r=0;for(let s=0;s<e.length;s++)n+=e[s]*t[s],i+=e[s]*e[s],r+=t[s]*t[s];if(0>=i||0>=r)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(i*r)}let DH;dj[516587230]=[0,EW,oH,cH,NV];const OH=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function LH(){if(void 0===DH)try{await WebAssembly.instantiate(OH),DH=!0}catch(e){DH=!1}return DH}async function PH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=await LH()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:"".concat(t,"/").concat(e,"_").concat(n,".js"),wasmBinaryPath:"".concat(t,"/").concat(e,"_").concat(n,".wasm")}}var FH=class{};function MH(){var e=navigator;return"undefined"!=typeof OffscreenCanvas&&(!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator;return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")}(e)||!!((e=e.userAgent.match(/Version\/([\d]+).*Safari/))&&1<=e.length&&17<=Number(e[1])))}async function UH(e){if("function"!=typeof importScripts){const t=document.createElement("script");return t.src=e.toString(),t.crossOrigin="anonymous",new Promise((e,n)=>{t.addEventListener("load",()=>{e()},!1),t.addEventListener("error",e=>{n(e)},!1),document.body.appendChild(t)})}importScripts(e.toString())}function BH(e){return void 0!==e.videoWidth?[e.videoWidth,e.videoHeight]:void 0!==e.naturalWidth?[e.naturalWidth,e.naturalHeight]:void 0!==e.displayWidth?[e.displayWidth,e.displayHeight]:[e.width,e.height]}function zH(e,t,n){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(t=e.i.stringToNewUTF8(t)),e.i._free(t)}function VH(e,t,n){if(!e.i.canvas)throw Error("No OpenGL canvas configured.");if(n?e.i._bindTextureToStream(n):e.i._bindTextureToCanvas(),!(n=e.i.canvas.getContext("webgl2")||e.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");e.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),e.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[i,r]=BH(t);return!e.l||i===e.i.canvas.width&&r===e.i.canvas.height||(e.i.canvas.width=i,e.i.canvas.height=r),[i,r]}function jH(e,t,n){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const i=new Uint32Array(t.length);for(let r=0;r<t.length;r++)i[r]=e.i.stringToNewUTF8(t[r]);t=e.i._malloc(4*i.length),e.i.HEAPU32.set(i,t>>2),n(t);for(const r of i)e.i._free(r);e.i._free(t)}function WH(e,t,n){e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=n}function HH(e,t,n){let i=[];e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=(e,t,r)=>{t?(n(i,r),i=[]):i.push(e)}}function GH(e,t){const n=kz(e.baseOptions,SW,1)||new SW;"string"==typeof t?(az(n,2,CB(t)),az(n,1)):t instanceof Uint8Array&&(az(n,1,nB(t,!1,!1)),az(n,2)),Iz(e.baseOptions,0,1,n)}function qH(e){try{const t=e.K.length;if(1===t)throw Error(e.K[0].message);if(1<t)throw Error("Encountered multiple errors: "+e.K.map(e=>e.message).join(", "))}finally{e.K=[]}}function XH(e,t){e.J=Math.max(e.J,t)}function KH(e,t){e.C=new wj,vj(e.C,"PassThroughCalculator"),_j(e.C,"free_memory"),xj(e.C,"free_memory_unused_out"),Nj(t,"free_memory"),Ej(t,e.C)}function YH(e,t){_j(e.C,t),xj(e.C,t+"_unused_out")}function QH(e){e.g.addBoolToStream(!0,"free_memory",e.J)}FH.forVisionTasks=function(e){return PH("vision",e)},FH.forTextTasks=function(e){return PH("text",e)},FH.forGenAiExperimentalTasks=function(e){return PH("genai_experimental",e)},FH.forGenAiTasks=function(e){return PH("genai",e)},FH.forAudioTasks=function(e){return PH("audio",e)},FH.isSimdSupported=function(){return LH()};var $H=class{constructor(e){this.g=e,this.K=[],this.J=0,this.g.setAutoRenderToScreen(!1)}l(e){if(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]){var t,n,i,r,s,a;const o=e.baseOptions||{};if(null!==(t=e.baseOptions)&&void 0!==t&&t.modelAssetBuffer&&null!==(n=e.baseOptions)&&void 0!==n&&n.modelAssetPath)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!(null!==(i=kz(this.baseOptions,SW,1))&&void 0!==i&&i.g()||null!==(r=kz(this.baseOptions,SW,1))&&void 0!==r&&r.h()||null!==(s=e.baseOptions)&&void 0!==s&&s.modelAssetBuffer||null!==(a=e.baseOptions)&&void 0!==a&&a.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(e,t){let n=kz(e.baseOptions,TW,3);if(!n){var i=n=new TW,r=new lj;Ez(i,4,kW,r)}"delegate"in t&&("GPU"===t.delegate?(t=n,i=new sj,Ez(t,2,kW,i)):(t=n,i=new lj,Ez(t,4,kW,i))),Iz(e.baseOptions,0,3,n)}(this,o),o.modelAssetPath)return fetch(o.modelAssetPath.toString()).then(e=>{if(e.ok)return e.arrayBuffer();throw Error("Failed to fetch model: ".concat(o.modelAssetPath," (").concat(e.status,")"))}).then(e=>{try{this.g.i.FS_unlink("/model.dat")}catch(t){}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(e),!0,!1,!1),GH(this,"/model.dat"),this.m(),this.L()});if(o.modelAssetBuffer instanceof Uint8Array)GH(this,o.modelAssetBuffer);else if(o.modelAssetBuffer)return async function(e){const t=[];for(var n=0;;){const{done:i,value:r}=await e.read();if(i)break;t.push(r),n+=r.length}if(0===t.length)return new Uint8Array(0);if(1===t.length)return t[0];e=new Uint8Array(n),n=0;for(const i of t)e.set(i,n),n+=i.length;return e}(o.modelAssetBuffer).then(e=>{GH(this,e),this.m(),this.L()})}return this.m(),this.L(),Promise.resolve()}L(){}fa(){let e;if(this.g.fa(t=>{e=Oj(t)}),!e)throw Error("Failed to retrieve CalculatorGraphConfig");return e}setGraph(e,t){this.g.attachErrorListener((e,t)=>{this.K.push(Error(t))}),this.g.Ma(),this.g.setGraph(e,t),this.C=void 0,qH(this)}finishProcessing(){this.g.finishProcessing(),qH(this)}close(){this.C=void 0,this.g.closeGraph()}};function JH(e,t){if(!e)throw Error("Unable to obtain required WebGL resource: ".concat(t));return e}$H.prototype.close=$H.prototype.close,function(e,t){e=e.split(".");var n,i=QF;e[0]in i||void 0===i.execScript||i.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?i=i[n]&&i[n]!==Object.prototype[n]?i[n]:i[n]={}:i[n]=t}("TaskRunner",$H);class ZH{constructor(e,t,n,i){this.g=e,this.h=t,this.m=n,this.l=i}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function eG(e,t,n){const i=e.g;if(n=JH(i.createShader(n),"Failed to create WebGL shader"),i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw Error("Could not compile WebGL shader: ".concat(i.getShaderInfoLog(n)));return i.attachShader(e.h,n),n}function tG(e,t){const n=e.g,i=JH(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(i);const r=JH(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,r),n.enableVertexAttribArray(e.K),n.vertexAttribPointer(e.K,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=JH(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(e.J),n.vertexAttribPointer(e.J,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new ZH(n,i,r,s)}function nG(e,t){if(e.g){if(t!==e.g)throw Error("Cannot change GL context once initialized")}else e.g=t}function iG(e,t,n,i){return nG(e,t),e.h||(e.m(),e.D()),n?(e.v||(e.v=tG(e,!0)),n=e.v):(e.A||(e.A=tG(e,!1)),n=e.A),t.useProgram(e.h),n.bind(),e.l(),e=i(),n.g.bindVertexArray(null),e}function rG(e,t,n){return nG(e,t),e=JH(t.createTexture(),"Failed to create texture"),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,null!==n&&void 0!==n?n:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,null!==n&&void 0!==n?n:t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),e}function sG(e,t,n){nG(e,t),e.u||(e.u=JH(t.createFramebuffer(),"Failed to create framebuffe.")),t.bindFramebuffer(t.FRAMEBUFFER,e.u),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}function aG(e){var t;null===(t=e.g)||void 0===t||t.bindFramebuffer(e.g.FRAMEBUFFER,null)}var oG=class{H(){return"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D inputTexture;\n  void main() {\n    gl_FragColor = texture2D(inputTexture, vTex);\n  }\n "}m(){const e=this.g;if(this.h=JH(e.createProgram(),"Failed to create WebGL program"),this.ba=eG(this,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",e.VERTEX_SHADER),this.aa=eG(this,this.H(),e.FRAGMENT_SHADER),e.linkProgram(this.h),!e.getProgramParameter(this.h,e.LINK_STATUS))throw Error("Error during program linking: ".concat(e.getProgramInfoLog(this.h)));this.K=e.getAttribLocation(this.h,"aVertex"),this.J=e.getAttribLocation(this.h,"aTex")}D(){}l(){}close(){if(this.h){const e=this.g;e.deleteProgram(this.h),e.deleteShader(this.ba),e.deleteShader(this.aa)}this.u&&this.g.deleteFramebuffer(this.u),this.A&&this.A.close(),this.v&&this.v.close()}},lG=class extends oG{H(){return"\n  precision mediump float;\n  uniform sampler2D backgroundTexture;\n  uniform sampler2D maskTexture;\n  uniform sampler2D colorMappingTexture;\n  varying vec2 vTex;\n  void main() {\n    vec4 backgroundColor = texture2D(backgroundTexture, vTex);\n    float category = texture2D(maskTexture, vTex).r;\n    vec4 categoryColor = texture2D(colorMappingTexture, vec2(category, 0.0));\n    gl_FragColor = mix(backgroundColor, categoryColor, categoryColor.a);\n  }\n "}D(){const e=this.g;e.activeTexture(e.TEXTURE1),this.C=rG(this,e,e.LINEAR),e.activeTexture(e.TEXTURE2),this.j=rG(this,e,e.NEAREST)}m(){super.m();const e=this.g;this.M=JH(e.getUniformLocation(this.h,"backgroundTexture"),"Uniform location"),this.V=JH(e.getUniformLocation(this.h,"colorMappingTexture"),"Uniform location"),this.L=JH(e.getUniformLocation(this.h,"maskTexture"),"Uniform location")}l(){super.l();const e=this.g;e.uniform1i(this.L,0),e.uniform1i(this.M,1),e.uniform1i(this.V,2)}close(){this.C&&this.g.deleteTexture(this.C),this.j&&this.g.deleteTexture(this.j),super.close()}},cG=class extends oG{H(){return"\n  precision mediump float;\n  uniform sampler2D maskTexture;\n  uniform sampler2D defaultTexture;\n  uniform sampler2D overlayTexture;\n  varying vec2 vTex;\n  void main() {\n    float confidence = texture2D(maskTexture, vTex).r;\n    vec4 defaultColor = texture2D(defaultTexture, vTex);\n    vec4 overlayColor = texture2D(overlayTexture, vTex);\n    // Apply the alpha from the overlay and merge in the default color\n    overlayColor = mix(defaultColor, overlayColor, overlayColor.a);\n    gl_FragColor = mix(defaultColor, overlayColor, confidence);\n  }\n "}D(){const e=this.g;e.activeTexture(e.TEXTURE1),this.j=rG(this,e),e.activeTexture(e.TEXTURE2),this.C=rG(this,e)}m(){super.m();const e=this.g;this.L=JH(e.getUniformLocation(this.h,"defaultTexture"),"Uniform location"),this.M=JH(e.getUniformLocation(this.h,"overlayTexture"),"Uniform location"),this.I=JH(e.getUniformLocation(this.h,"maskTexture"),"Uniform location")}l(){super.l();const e=this.g;e.uniform1i(this.I,0),e.uniform1i(this.L,1),e.uniform1i(this.M,2)}close(){this.j&&this.g.deleteTexture(this.j),this.C&&this.g.deleteTexture(this.C),super.close()}};function uG(e,t){switch(t){case 0:return e.g.find(e=>e instanceof Uint8Array);case 1:return e.g.find(e=>e instanceof Float32Array);case 2:return e.g.find(e=>"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture);default:throw Error("Type is not supported: ".concat(t))}}function hG(e){var t=uG(e,1);if(!t){if(t=uG(e,0))t=new Float32Array(t).map(e=>e/255);else{t=new Float32Array(e.width*e.height);const i=pG(e);var n=gG(e);if(sG(n,i,dG(e)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in self.document){n=new Float32Array(e.width*e.height*4),i.readPixels(0,0,e.width,e.height,i.RGBA,i.FLOAT,n);for(let e=0,i=0;e<t.length;++e,i+=4)t[e]=n[i]}else i.readPixels(0,0,e.width,e.height,i.RED,i.FLOAT,t)}e.g.push(t)}return t}function dG(e){let t=uG(e,2);if(!t){const n=pG(e);t=mG(e);const i=hG(e),r=fG(e);n.texImage2D(n.TEXTURE_2D,0,r,e.width,e.height,0,n.RED,n.FLOAT,i),yG(e)}return t}function pG(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=JH(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function fG(e){if(e=pG(e),!bG)if(e.getExtension("EXT_color_buffer_float")&&e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_float_blend"))bG=e.R32F;else{if(!e.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");bG=e.R16F}return bG}function gG(e){return e.l||(e.l=new oG),e.l}function mG(e){const t=pG(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let n=uG(e,2);return n||(n=rG(gG(e),t,e.m?t.LINEAR:t.NEAREST),e.g.push(n),e.j=!0),t.bindTexture(t.TEXTURE_2D,n),n}function yG(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}var bG,vG=class{constructor(e,t,n,i,r,s,a){this.g=e,this.m=t,this.j=n,this.canvas=i,this.l=r,this.width=s,this.height=a,this.j&&0===--_G&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Ha(){return!!uG(this,0)}la(){return!!uG(this,1)}R(){return!!uG(this,2)}ka(){return(e=uG(this,0))||(e=hG(this),e=new Uint8Array(e.map(e=>255*e)),this.g.push(e)),e;var e}ja(){return hG(this)}O(){return dG(this)}clone(){const e=[];for(const t of this.g){let n;if(t instanceof Uint8Array)n=new Uint8Array(t);else if(t instanceof Float32Array)n=new Float32Array(t);else{if(!(t instanceof WebGLTexture))throw Error("Type is not supported: ".concat(t));{const e=pG(this),t=gG(this);e.activeTexture(e.TEXTURE1),n=rG(t,e,this.m?e.LINEAR:e.NEAREST),e.bindTexture(e.TEXTURE_2D,n);const i=fG(this);e.texImage2D(e.TEXTURE_2D,0,i,this.width,this.height,0,e.RED,e.FLOAT,null),e.bindTexture(e.TEXTURE_2D,null),sG(t,e,n),iG(t,e,!1,()=>{mG(this),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),yG(this)}),aG(t),yG(this)}}e.push(n)}return new vG(e,this.m,this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&pG(this).deleteTexture(uG(this,2)),_G=-1}};vG.prototype.close=vG.prototype.close,vG.prototype.clone=vG.prototype.clone,vG.prototype.getAsWebGLTexture=vG.prototype.O,vG.prototype.getAsFloat32Array=vG.prototype.ja,vG.prototype.getAsUint8Array=vG.prototype.ka,vG.prototype.hasWebGLTexture=vG.prototype.R,vG.prototype.hasFloat32Array=vG.prototype.la,vG.prototype.hasUint8Array=vG.prototype.Ha;var _G=250;const xG={color:"white",lineWidth:4,radius:6};function wG(e){return YF(YF({},xG),{},{fillColor:(e=e||{}).color},e)}function TG(e,t){return e instanceof Function?e(t):e}function kG(e,t,n){return Math.max(Math.min(t,n),Math.min(Math.max(t,n),e))}function SG(e){if(!e.l)throw Error("CPU rendering requested but CanvasRenderingContext2D not provided.");return e.l}function CG(e){if(!e.j)throw Error("GPU rendering requested but WebGL2RenderingContext not provided.");return e.j}function IG(e,t,n){if(t.R())n(t.O());else{var i;const r=t.la()?t.ja():t.ka();e.m=null!==(i=e.m)&&void 0!==i?i:new oG;const s=CG(e);n((e=new vG([r],t.m,!1,s.canvas,e.m,t.width,t.height)).O()),e.close()}}function EG(e,t,n,i){const r=function(e){return e.g||(e.g=new lG),e.g}(e),s=CG(e),a=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n;iG(r,s,!0,()=>{!function(e,t,n,i){const r=e.g;if(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,e.C),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),e.I&&function(e,t){if(e!==t)return!1;e=e.entries(),t=t.entries();for(const[i,r]of e){e=i;const s=r;var n=t.next();if(n.done)return!1;const[a,o]=n.value;if(n=o,e!==a||s[0]!==n[0]||s[1]!==n[1]||s[2]!==n[2]||s[3]!==n[3])return!1}return!!t.next().done}(e.I,i))r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,e.j);else{e.I=i;const t=Array(1024).fill(0);i.forEach((e,n)=>{if(4!==e.length)throw Error("Color at index ".concat(n," is not a four-channel value."));t[4*n]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]}),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,e.j),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,256,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(t))}}(r,t,a,i),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.TRIANGLE_FAN,0,4);const e=r.g;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null)})}function NG(e,t,n,i){const r=CG(e),s=function(e){return e.h||(e.h=new cG),e.h}(e),a=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n,o=Array.isArray(i)?new ImageData(new Uint8ClampedArray(i),1,1):i;iG(s,r,!0,()=>{var e=s.g;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,s.j),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,s.C),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,o),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_FAN,0,4),r.bindTexture(r.TEXTURE_2D,null),(e=s.g).activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null)})}var AG=class{constructor(e,t){e instanceof CanvasRenderingContext2D||e instanceof OffscreenCanvasRenderingContext2D?(this.l=e,this.j=t):this.j=e}Aa(e,t){if(e){var n=SG(this);t=wG(t),n.save();var i=n.canvas,r=0;for(const s of e)n.fillStyle=TG(t.fillColor,{index:r,from:s}),n.strokeStyle=TG(t.color,{index:r,from:s}),n.lineWidth=TG(t.lineWidth,{index:r,from:s}),(e=new Path2D).arc(s.x*i.width,s.y*i.height,TG(t.radius,{index:r,from:s}),0,2*Math.PI),n.fill(e),n.stroke(e),++r;n.restore()}}za(e,t,n){if(e&&t){var i=SG(this);n=wG(n),i.save();var r=i.canvas,s=0;for(const a of t){i.beginPath(),t=e[a.start];const o=e[a.end];t&&o&&(i.strokeStyle=TG(n.color,{index:s,from:t,to:o}),i.lineWidth=TG(n.lineWidth,{index:s,from:t,to:o}),i.moveTo(t.x*r.width,t.y*r.height),i.lineTo(o.x*r.width,o.y*r.height)),++s,i.stroke()}i.restore()}}wa(e,t){const n=SG(this);t=wG(t),n.save(),n.beginPath(),n.lineWidth=TG(t.lineWidth,{}),n.strokeStyle=TG(t.color,{}),n.fillStyle=TG(t.fillColor,{}),n.moveTo(e.originX,e.originY),n.lineTo(e.originX+e.width,e.originY),n.lineTo(e.originX+e.width,e.originY+e.height),n.lineTo(e.originX,e.originY+e.height),n.lineTo(e.originX,e.originY),n.stroke(),n.fill(),n.restore()}xa(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,255];this.l?function(e,t,n,i){const r=CG(e);IG(e,t,t=>{EG(e,t,n,i),(t=SG(e)).drawImage(r.canvas,0,0,t.canvas.width,t.canvas.height)})}(this,e,n,t):EG(this,e.O(),n,t)}ya(e,t,n){this.l?function(e,t,n,i){const r=CG(e);IG(e,t,t=>{NG(e,t,n,i),(t=SG(e)).drawImage(r.canvas,0,0,t.canvas.width,t.canvas.height)})}(this,e,t,n):NG(this,e.O(),t,n)}close(){var e,t,n;null!==(e=this.g)&&void 0!==e&&e.close(),this.g=void 0,null!==(t=this.h)&&void 0!==t&&t.close(),this.h=void 0,null!==(n=this.m)&&void 0!==n&&n.close(),this.m=void 0}};function RG(e,t){switch(t){case 0:return e.g.find(e=>e instanceof ImageData);case 1:return e.g.find(e=>"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap);case 2:return e.g.find(e=>"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture);default:throw Error("Type is not supported: ".concat(t))}}function DG(e){var t=RG(e,0);if(!t){t=LG(e);const n=PG(e),i=new Uint8Array(e.width*e.height*4);sG(n,t,OG(e)),t.readPixels(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,i),aG(n),t=new ImageData(new Uint8ClampedArray(i.buffer),e.width,e.height),e.g.push(t)}return t}function OG(e){let t=RG(e,2);if(!t){const n=LG(e);t=FG(e);const i=RG(e,1)||DG(e);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i),MG(e)}return t}function LG(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when iniitializing the image.");return e.h||(e.h=JH(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function PG(e){return e.l||(e.l=new oG),e.l}function FG(e){const t=LG(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let n=RG(e,2);return n||(n=rG(PG(e),t),e.g.push(n),e.m=!0),t.bindTexture(t.TEXTURE_2D,n),n}function MG(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}function UG(e){const t=LG(e);return iG(PG(e),t,!0,()=>function(e,t){const n=e.canvas;if(n.width===e.width&&n.height===e.height)return t();const i=n.width,r=n.height;return n.width=e.width,n.height=e.height,e=t(),n.width=i,n.height=r,e}(e,()=>{if(t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),!(e.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return e.canvas.transferToImageBitmap()}))}AG.prototype.close=AG.prototype.close,AG.prototype.drawConfidenceMask=AG.prototype.ya,AG.prototype.drawCategoryMask=AG.prototype.xa,AG.prototype.drawBoundingBox=AG.prototype.wa,AG.prototype.drawConnectors=AG.prototype.za,AG.prototype.drawLandmarks=AG.prototype.Aa,AG.lerp=function(e,t,n,i,r){return kG(i*(1-(e-t)/(n-t))+r*(1-(n-e)/(n-t)),i,r)},AG.clamp=kG;var BG=class{constructor(e,t,n,i,r,s,a){this.g=e,this.j=t,this.m=n,this.canvas=i,this.l=r,this.width=s,this.height=a,(this.j||this.m)&&0===--zG&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ga(){return!!RG(this,0)}ma(){return!!RG(this,1)}R(){return!!RG(this,2)}Ea(){return DG(this)}Da(){var e=RG(this,1);return e||(OG(this),FG(this),e=UG(this),MG(this),this.g.push(e),this.j=!0),e}O(){return OG(this)}clone(){const e=[];for(const t of this.g){let n;if(t instanceof ImageData)n=new ImageData(t.data,this.width,this.height);else if(t instanceof WebGLTexture){const e=LG(this),t=PG(this);e.activeTexture(e.TEXTURE1),n=rG(t,e),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null),sG(t,e,n),iG(t,e,!1,()=>{FG(this),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),MG(this)}),aG(t),MG(this)}else{if(!(t instanceof ImageBitmap))throw Error("Type is not supported: ".concat(t));OG(this),FG(this),n=UG(this),MG(this)}e.push(n)}return new BG(e,this.ma(),this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&RG(this,1).close(),this.m&&LG(this).deleteTexture(RG(this,2)),zG=-1}};BG.prototype.close=BG.prototype.close,BG.prototype.clone=BG.prototype.clone,BG.prototype.getAsWebGLTexture=BG.prototype.O,BG.prototype.getAsImageBitmap=BG.prototype.Da,BG.prototype.getAsImageData=BG.prototype.Ea,BG.prototype.hasWebGLTexture=BG.prototype.R,BG.prototype.hasImageBitmap=BG.prototype.ma,BG.prototype.hasImageData=BG.prototype.Ga;var zG=250;function VG(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(e=>{let[t,n]=e;return{start:t,end:n}})}const jG=function(e){return class extends e{Ma(){this.i._registerModelResourcesGraphService()}}}((WG=class{constructor(e,t){this.l=!0,this.i=e,this.g=null,this.h=0,this.m="function"==typeof this.i._addIntToInputStream,void 0!==t?this.i.canvas=t:MH()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(e){const t=await(await fetch(e)).arrayBuffer();e=!(e.endsWith(".pbtxt")||e.endsWith(".textproto")),this.setGraph(new Uint8Array(t),e)}setGraphFromString(e){this.setGraph((new TextEncoder).encode(e),!1)}setGraph(e,t){const n=e.length,i=this.i._malloc(n);this.i.HEAPU8.set(e,i),t?this.i._changeBinaryGraph(n,i):this.i._changeTextGraph(n,i),this.i._free(i)}configureAudio(e,t,n,i,r){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),zH(this,i||"input_audio",i=>{zH(this,r=r||"audio_header",r=>{this.i._configureAudio(i,r,e,t,n)})})}setAutoResizeCanvas(e){this.l=e}setAutoRenderToScreen(e){this.i._setAutoRenderToScreen(e)}setGpuBufferVerticalFlip(e){this.i.gpuOriginForWebTexturesIsBottomLeft=e}fa(e){WH(this,"__graph_config__",t=>{e(t)}),zH(this,"__graph_config__",e=>{this.i._getGraphConfig(e,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(e){this.i.errorListener=e}attachEmptyPacketListener(e,t){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[e]=t}addAudioToStream(e,t,n){this.addAudioToStreamWithShape(e,0,0,t,n)}addAudioToStreamWithShape(e,t,n,i,r){const s=4*e.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(e,this.g/4),zH(this,i,e=>{this.i._addAudioToInputStream(this.g,t,n,e,r)})}addGpuBufferToStream(e,t,n){zH(this,t,t=>{const[i,r]=VH(this,e,t);this.i._addBoundTextureToStream(t,i,r,n)})}addBoolToStream(e,t,n){zH(this,t,t=>{this.i._addBoolToInputStream(e,t,n)})}addDoubleToStream(e,t,n){zH(this,t,t=>{this.i._addDoubleToInputStream(e,t,n)})}addFloatToStream(e,t,n){zH(this,t,t=>{this.i._addFloatToInputStream(e,t,n)})}addIntToStream(e,t,n){zH(this,t,t=>{this.i._addIntToInputStream(e,t,n)})}addUintToStream(e,t,n){zH(this,t,t=>{this.i._addUintToInputStream(e,t,n)})}addStringToStream(e,t,n){zH(this,t,t=>{zH(this,e,e=>{this.i._addStringToInputStream(e,t,n)})})}addStringRecordToStream(e,t,n){zH(this,t,t=>{jH(this,Object.keys(e),i=>{jH(this,Object.values(e),r=>{this.i._addFlatHashMapToInputStream(i,r,Object.keys(e).length,t,n)})})})}addProtoToStream(e,t,n,i){zH(this,n,n=>{zH(this,t,t=>{const r=this.i._malloc(e.length);this.i.HEAPU8.set(e,r),this.i._addProtoToInputStream(r,e.length,t,n,i),this.i._free(r)})})}addEmptyPacketToStream(e,t){zH(this,e,e=>{this.i._addEmptyPacketToInputStream(e,t)})}addBoolVectorToStream(e,t,n){zH(this,t,t=>{const i=this.i._allocateBoolVector(e.length);if(!i)throw Error("Unable to allocate new bool vector on heap.");for(const n of e)this.i._addBoolVectorEntry(i,n);this.i._addBoolVectorToInputStream(i,t,n)})}addDoubleVectorToStream(e,t,n){zH(this,t,t=>{const i=this.i._allocateDoubleVector(e.length);if(!i)throw Error("Unable to allocate new double vector on heap.");for(const n of e)this.i._addDoubleVectorEntry(i,n);this.i._addDoubleVectorToInputStream(i,t,n)})}addFloatVectorToStream(e,t,n){zH(this,t,t=>{const i=this.i._allocateFloatVector(e.length);if(!i)throw Error("Unable to allocate new float vector on heap.");for(const n of e)this.i._addFloatVectorEntry(i,n);this.i._addFloatVectorToInputStream(i,t,n)})}addIntVectorToStream(e,t,n){zH(this,t,t=>{const i=this.i._allocateIntVector(e.length);if(!i)throw Error("Unable to allocate new int vector on heap.");for(const n of e)this.i._addIntVectorEntry(i,n);this.i._addIntVectorToInputStream(i,t,n)})}addUintVectorToStream(e,t,n){zH(this,t,t=>{const i=this.i._allocateUintVector(e.length);if(!i)throw Error("Unable to allocate new unsigned int vector on heap.");for(const n of e)this.i._addUintVectorEntry(i,n);this.i._addUintVectorToInputStream(i,t,n)})}addStringVectorToStream(e,t,n){zH(this,t,t=>{const i=this.i._allocateStringVector(e.length);if(!i)throw Error("Unable to allocate new string vector on heap.");for(const n of e)zH(this,n,e=>{this.i._addStringVectorEntry(i,e)});this.i._addStringVectorToInputStream(i,t,n)})}addBoolToInputSidePacket(e,t){zH(this,t,t=>{this.i._addBoolToInputSidePacket(e,t)})}addDoubleToInputSidePacket(e,t){zH(this,t,t=>{this.i._addDoubleToInputSidePacket(e,t)})}addFloatToInputSidePacket(e,t){zH(this,t,t=>{this.i._addFloatToInputSidePacket(e,t)})}addIntToInputSidePacket(e,t){zH(this,t,t=>{this.i._addIntToInputSidePacket(e,t)})}addUintToInputSidePacket(e,t){zH(this,t,t=>{this.i._addUintToInputSidePacket(e,t)})}addStringToInputSidePacket(e,t){zH(this,t,t=>{zH(this,e,e=>{this.i._addStringToInputSidePacket(e,t)})})}addProtoToInputSidePacket(e,t,n){zH(this,n,n=>{zH(this,t,t=>{const i=this.i._malloc(e.length);this.i.HEAPU8.set(e,i),this.i._addProtoToInputSidePacket(i,e.length,t,n),this.i._free(i)})})}addBoolVectorToInputSidePacket(e,t){zH(this,t,t=>{const n=this.i._allocateBoolVector(e.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const i of e)this.i._addBoolVectorEntry(n,i);this.i._addBoolVectorToInputSidePacket(n,t)})}addDoubleVectorToInputSidePacket(e,t){zH(this,t,t=>{const n=this.i._allocateDoubleVector(e.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const i of e)this.i._addDoubleVectorEntry(n,i);this.i._addDoubleVectorToInputSidePacket(n,t)})}addFloatVectorToInputSidePacket(e,t){zH(this,t,t=>{const n=this.i._allocateFloatVector(e.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const i of e)this.i._addFloatVectorEntry(n,i);this.i._addFloatVectorToInputSidePacket(n,t)})}addIntVectorToInputSidePacket(e,t){zH(this,t,t=>{const n=this.i._allocateIntVector(e.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const i of e)this.i._addIntVectorEntry(n,i);this.i._addIntVectorToInputSidePacket(n,t)})}addUintVectorToInputSidePacket(e,t){zH(this,t,t=>{const n=this.i._allocateUintVector(e.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const i of e)this.i._addUintVectorEntry(n,i);this.i._addUintVectorToInputSidePacket(n,t)})}addStringVectorToInputSidePacket(e,t){zH(this,t,t=>{const n=this.i._allocateStringVector(e.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const i of e)zH(this,i,e=>{this.i._addStringVectorEntry(n,e)});this.i._addStringVectorToInputSidePacket(n,t)})}attachBoolListener(e,t){WH(this,e,t),zH(this,e,e=>{this.i._attachBoolListener(e)})}attachBoolVectorListener(e,t){HH(this,e,t),zH(this,e,e=>{this.i._attachBoolVectorListener(e)})}attachIntListener(e,t){WH(this,e,t),zH(this,e,e=>{this.i._attachIntListener(e)})}attachIntVectorListener(e,t){HH(this,e,t),zH(this,e,e=>{this.i._attachIntVectorListener(e)})}attachUintListener(e,t){WH(this,e,t),zH(this,e,e=>{this.i._attachUintListener(e)})}attachUintVectorListener(e,t){HH(this,e,t),zH(this,e,e=>{this.i._attachUintVectorListener(e)})}attachDoubleListener(e,t){WH(this,e,t),zH(this,e,e=>{this.i._attachDoubleListener(e)})}attachDoubleVectorListener(e,t){HH(this,e,t),zH(this,e,e=>{this.i._attachDoubleVectorListener(e)})}attachFloatListener(e,t){WH(this,e,t),zH(this,e,e=>{this.i._attachFloatListener(e)})}attachFloatVectorListener(e,t){HH(this,e,t),zH(this,e,e=>{this.i._attachFloatVectorListener(e)})}attachStringListener(e,t){WH(this,e,t),zH(this,e,e=>{this.i._attachStringListener(e)})}attachStringVectorListener(e,t){HH(this,e,t),zH(this,e,e=>{this.i._attachStringVectorListener(e)})}attachProtoListener(e,t,n){WH(this,e,t),zH(this,e,e=>{this.i._attachProtoListener(e,n||!1)})}attachProtoVectorListener(e,t,n){HH(this,e,t),zH(this,e,e=>{this.i._attachProtoVectorListener(e,n||!1)})}attachAudioListener(e,t,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),WH(this,e,(e,n)=>{e=new Float32Array(e.buffer,e.byteOffset,e.length/4),t(e,n)}),zH(this,e,e=>{this.i._attachAudioListener(e,n||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends WG{get ha(){return this.i}sa(e,t,n){zH(this,t,t=>{const[i,r]=VH(this,e,t);this.ha._addBoundTextureAsImageToStream(t,i,r,n)})}W(e,t){WH(this,e,t),zH(this,e,e=>{this.ha._attachImageListener(e)})}da(e,t){HH(this,e,t),zH(this,e,e=>{this.ha._attachImageVectorListener(e)})}}));var WG,HG=class extends jG{};async function GG(e,t,n){var i;return async function(e,t,n,i){return async function(e,t,n,i){return e=await(async(e,t,n,i,r)=>{if(t&&await UH(t),!self.ModuleFactory)throw Error("ModuleFactory not set.");if(n&&(await UH(n),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&r&&((t=self.Module).locateFile=r.locateFile,r.mainScriptUrlOrBlob&&(t.mainScriptUrlOrBlob=r.mainScriptUrlOrBlob)),r=await self.ModuleFactory(self.Module||r),self.ModuleFactory=self.Module=void 0,new e(r,i)})(e,n.wasmLoaderPath,n.assetLoaderPath,t,{locateFile:e=>e.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&e.endsWith(".data")?n.assetBinaryPath.toString():e}),await e.o(i),e}(e,t,n,i)}(e,null!==(i=n.canvas)&&void 0!==i?i:MH()?void 0:document.createElement("canvas"),t,n)}function qG(e,t,n,i){if(e.V){var r,s;const c=new oW;if(null!==(r=n)&&void 0!==r&&r.regionOfInterest){if(!e.ra)throw Error("This task doesn't support region-of-interest.");var a=n.regionOfInterest;if(a.left>=a.right||a.top>=a.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(0>a.left||0>a.top||1<a.right||1<a.bottom)throw Error("Expected RectF values to be in [0,1].");Uz(c,1,(a.left+a.right)/2),Uz(c,2,(a.top+a.bottom)/2),Uz(c,4,a.right-a.left),Uz(c,3,a.bottom-a.top)}else Uz(c,1,.5),Uz(c,2,.5),Uz(c,4,1),Uz(c,3,1);if(null!==(s=n)&&void 0!==s&&s.rotationDegrees){var o,l;if(0!=(null===(o=n)||void 0===o?void 0:o.rotationDegrees)%90)throw Error("Expected rotation to be a multiple of 90\xb0.");if(Uz(c,5,-Math.PI*n.rotationDegrees/180),0!=(null===(l=n)||void 0===l?void 0:l.rotationDegrees)%180){const[e,i]=BH(t);n=Lz(c,3)*i/e,a=Lz(c,4)*e/i,Uz(c,4,n),Uz(c,3,a)}}e.g.addProtoToStream(c.g(),"mediapipe.NormalizedRect",e.V,i)}e.g.sa(t,e.ba,null!==i&&void 0!==i?i:performance.now()),e.finishProcessing()}function XG(e,t,n){var i;if(null!==(i=e.baseOptions)&&void 0!==i&&i.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");qG(e,t,n,e.J+1)}function KG(e,t,n,i){var r;if(null===(r=e.baseOptions)||void 0===r||!r.g())throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");qG(e,t,n,i)}function YG(e,t,n,i){var r=t.data;const s=t.width,a=s*(t=t.height);if((r instanceof Uint8Array||r instanceof Float32Array)&&r.length!==a)throw Error("Unsupported channel count: "+r.length/a);return e=new vG([r],n,!1,e.g.i.canvas,e.M,s,t),i?e.clone():e}var QG=class extends $H{constructor(e,t,n,i){super(e),this.g=e,this.ba=t,this.V=n,this.ra=i,this.M=new oG}l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("runningMode"in e&&Fz(this.baseOptions,2,!!e.runningMode&&"IMAGE"!==e.runningMode),void 0!==e.canvas&&this.g.i.canvas!==e.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(e,t)}close(){this.M.close(),super.close()}};QG.prototype.close=QG.prototype.close;var $G=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect_in",!1),this.j={detections:[]},Iz(e=this.h=new NW,0,1,t=new IW),Uz(this.h,2,.5),Uz(this.h,3,.3)}get baseOptions(){return kz(this.h,IW,1)}set baseOptions(e){Iz(this.h,0,1,e)}o(e){var t,n;return"minDetectionConfidence"in e&&Uz(this.h,2,null!==(t=e.minDetectionConfidence)&&void 0!==t?t:.5),"minSuppressionThreshold"in e&&Uz(this.h,3,null!==(n=e.minSuppressionThreshold)&&void 0!==n?n:.3),this.l(e)}F(e,t){return this.j={detections:[]},XG(this,e,t),this.j}G(e,t,n){return this.j={detections:[]},KG(this,e,n,t),this.j}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"norm_rect_in"),Aj(e,"detections");const t=new hj;Bz(t,RW,this.h);const n=new wj;vj(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),_j(n,"IMAGE:image_in"),_j(n,"NORM_RECT:norm_rect_in"),xj(n,"DETECTIONS:detections"),n.o(t),Ej(e,n),this.g.attachProtoVectorListener("detections",(e,t)=>{for(const n of e)e=Qj(n),this.j.detections.push(IH(e));XH(this,t)}),this.g.attachEmptyPacketListener("detections",e=>{XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};$G.prototype.detectForVideo=$G.prototype.G,$G.prototype.detect=$G.prototype.F,$G.prototype.setOptions=$G.prototype.o,$G.createFromModelPath=async function(e,t){return GG($G,e,{baseOptions:{modelAssetPath:t}})},$G.createFromModelBuffer=function(e,t){return GG($G,e,{baseOptions:{modelAssetBuffer:t}})},$G.createFromOptions=function(e,t){return GG($G,e,t)};var JG=VG([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),ZG=VG([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),eq=VG([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),tq=VG([474,475],[475,476],[476,477],[477,474]),nq=VG([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),iq=VG([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),rq=VG([469,470],[470,471],[471,472],[472,469]),sq=VG([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),aq=[...JG,...ZG,...eq,...nq,...iq,...sq],oq=VG([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function lq(e){e.u={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var cq=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect",!1),this.u={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,Iz(e=this.h=new UW,0,1,t=new IW),this.H=new FW,Iz(this.h,0,3,this.H),this.j=new NW,Iz(this.h,0,2,this.j),Mz(this.j,4,1),Uz(this.j,2,.5),Uz(this.H,2,.5),Uz(this.h,4,.5)}get baseOptions(){return kz(this.h,IW,1)}set baseOptions(e){Iz(this.h,0,1,e)}o(e){var t,n,i,r;return"numFaces"in e&&Mz(this.j,4,null!==(t=e.numFaces)&&void 0!==t?t:1),"minFaceDetectionConfidence"in e&&Uz(this.j,2,null!==(n=e.minFaceDetectionConfidence)&&void 0!==n?n:.5),"minTrackingConfidence"in e&&Uz(this.h,4,null!==(i=e.minTrackingConfidence)&&void 0!==i?i:.5),"minFacePresenceConfidence"in e&&Uz(this.H,2,null!==(r=e.minFacePresenceConfidence)&&void 0!==r?r:.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in e&&(this.outputFacialTransformationMatrixes=!!e.outputFacialTransformationMatrixes),this.l(e)}F(e,t){return lq(this),XG(this,e,t),this.u}G(e,t,n){return lq(this),KG(this,e,n,t),this.u}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"norm_rect"),Aj(e,"face_landmarks");const t=new hj;Bz(t,zW,this.h);const n=new wj;vj(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),_j(n,"IMAGE:image_in"),_j(n,"NORM_RECT:norm_rect"),xj(n,"NORM_LANDMARKS:face_landmarks"),n.o(t),Ej(e,n),this.g.attachProtoVectorListener("face_landmarks",(e,t)=>{for(const n of e)e=rW(n),this.u.faceLandmarks.push(EH(e));XH(this,t)}),this.g.attachEmptyPacketListener("face_landmarks",e=>{XH(this,e)}),this.outputFaceBlendshapes&&(Aj(e,"blendshapes"),xj(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(e,t)=>{if(this.outputFaceBlendshapes)for(const i of e){var n;e=Bj(i),this.u.faceBlendshapes.push(CH(null!==(n=e.g())&&void 0!==n?n:[]))}XH(this,t)}),this.g.attachEmptyPacketListener("blendshapes",e=>{XH(this,e)})),this.outputFacialTransformationMatrixes&&(Aj(e,"face_geometry"),xj(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(e,t)=>{if(this.outputFacialTransformationMatrixes)for(const s of e){var n,i,r;(e=kz(LW(s),sW,2))&&this.u.facialTransformationMatrixes.push({rows:null!==(n=Oz(Dz(e,1),0))&&void 0!==n?n:0,columns:null!==(i=Oz(Dz(e,2),0))&&void 0!==i?i:0,data:null!==(r=hz(e,3,fB).slice())&&void 0!==r?r:[]})}XH(this,t)}),this.g.attachEmptyPacketListener("face_geometry",e=>{XH(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};cq.prototype.detectForVideo=cq.prototype.G,cq.prototype.detect=cq.prototype.F,cq.prototype.setOptions=cq.prototype.o,cq.createFromModelPath=function(e,t){return GG(cq,e,{baseOptions:{modelAssetPath:t}})},cq.createFromModelBuffer=function(e,t){return GG(cq,e,{baseOptions:{modelAssetBuffer:t}})},cq.createFromOptions=function(e,t){return GG(cq,e,t)},cq.FACE_LANDMARKS_LIPS=JG,cq.FACE_LANDMARKS_LEFT_EYE=ZG,cq.FACE_LANDMARKS_LEFT_EYEBROW=eq,cq.FACE_LANDMARKS_LEFT_IRIS=tq,cq.FACE_LANDMARKS_RIGHT_EYE=nq,cq.FACE_LANDMARKS_RIGHT_EYEBROW=iq,cq.FACE_LANDMARKS_RIGHT_IRIS=rq,cq.FACE_LANDMARKS_FACE_OVAL=sq,cq.FACE_LANDMARKS_CONTOURS=aq,cq.FACE_LANDMARKS_TESSELATION=oq;var uq=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect",!0),Iz(e=this.j=new VW,0,1,t=new IW)}get baseOptions(){return kz(this.j,IW,1)}set baseOptions(e){Iz(this.j,0,1,e)}o(e){return super.l(e)}Pa(e,t,n){const i="function"!=typeof t?t:{};if(this.h="function"==typeof t?t:n,XG(this,e,null!==i&&void 0!==i?i:{}),!this.h)return this.u}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"norm_rect"),Aj(e,"stylized_image");const t=new hj;Bz(t,jW,this.j);const n=new wj;vj(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),_j(n,"IMAGE:image_in"),_j(n,"NORM_RECT:norm_rect"),xj(n,"STYLIZED_IMAGE:stylized_image"),n.o(t),Ej(e,n),this.g.W("stylized_image",(e,t)=>{var n=!this.h,i=e.data,r=e.width;const s=r*(e=e.height);if(i instanceof Uint8Array)if(i.length===3*s){const t=new Uint8ClampedArray(4*s);for(let e=0;e<s;++e)t[4*e]=i[3*e],t[4*e+1]=i[3*e+1],t[4*e+2]=i[3*e+2],t[4*e+3]=255;i=new ImageData(t,r,e)}else{if(i.length!==4*s)throw Error("Unsupported channel count: "+i.length/s);i=new ImageData(new Uint8ClampedArray(i.buffer,i.byteOffset,i.length),r,e)}else if(!(i instanceof WebGLTexture))throw Error("Unsupported format: ".concat(i.constructor.name));r=new BG([i],!1,!1,this.g.i.canvas,this.M,r,e),this.u=n=n?r.clone():r,this.h&&this.h(n),XH(this,t)}),this.g.attachEmptyPacketListener("stylized_image",e=>{this.u=null,this.h&&this.h(null),XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};uq.prototype.stylize=uq.prototype.Pa,uq.prototype.setOptions=uq.prototype.o,uq.createFromModelPath=function(e,t){return GG(uq,e,{baseOptions:{modelAssetPath:t}})},uq.createFromModelBuffer=function(e,t){return GG(uq,e,{baseOptions:{modelAssetBuffer:t}})},uq.createFromOptions=function(e,t){return GG(uq,e,t)};var hq=VG([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function dq(e){e.gestures=[],e.landmarks=[],e.worldLandmarks=[],e.handedness=[]}function pq(e){return 0===e.gestures.length?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:e.gestures,landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handedness:e.handedness,handednesses:e.handedness}}function fq(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=[];for(const o of e){var i=Bj(o);e=[];for(const n of i.g()){var r,s,a;i=t&&null!=Dz(n,1)?Oz(Dz(n,1),0):-1,e.push({score:null!==(r=Lz(n,2))&&void 0!==r?r:0,index:i,categoryName:null!==(s=Pz(n,3))&&void 0!==s?s:"",displayName:null!==(a=Pz(n,4))&&void 0!==a?a:""})}n.push(e)}return n}var gq=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Iz(e=this.v=new eH,0,1,t=new IW),this.A=new JW,Iz(this.v,0,2,this.A),this.u=new QW,Iz(this.A,0,3,this.u),this.h=new KW,Iz(this.A,0,2,this.h),this.j=new qW,Iz(this.v,0,3,this.j),Uz(this.h,2,.5),Uz(this.A,4,.5),Uz(this.u,2,.5)}get baseOptions(){return kz(this.v,IW,1)}set baseOptions(e){Iz(this.v,0,1,e)}o(e){var t,n,i,r,s,a,o;if(Mz(this.h,3,null!==(t=e.numHands)&&void 0!==t?t:1),"minHandDetectionConfidence"in e&&Uz(this.h,2,null!==(n=e.minHandDetectionConfidence)&&void 0!==n?n:.5),"minTrackingConfidence"in e&&Uz(this.A,4,null!==(i=e.minTrackingConfidence)&&void 0!==i?i:.5),"minHandPresenceConfidence"in e&&Uz(this.u,2,null!==(r=e.minHandPresenceConfidence)&&void 0!==r?r:.5),e.cannedGesturesClassifierOptions){var l,c=new WW,u=c,h=SH(e.cannedGesturesClassifierOptions,null===(l=kz(this.j,WW,3))||void 0===l?void 0:l.h());Iz(u,0,2,h),Iz(this.j,0,3,c)}else void 0===e.cannedGesturesClassifierOptions&&(null===(s=kz(this.j,WW,3))||void 0===s||s.g());return e.customGesturesClassifierOptions?(Iz(u=c=new WW,0,2,h=SH(e.customGesturesClassifierOptions,null===(a=kz(this.j,WW,4))||void 0===a?void 0:a.h())),Iz(this.j,0,4,c)):void 0===e.customGesturesClassifierOptions&&(null===(o=kz(this.j,WW,4))||void 0===o||o.g()),this.l(e)}Ka(e,t){return dq(this),XG(this,e,t),pq(this)}La(e,t,n){return dq(this),KG(this,e,n,t),pq(this)}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"norm_rect"),Aj(e,"hand_gestures"),Aj(e,"hand_landmarks"),Aj(e,"world_hand_landmarks"),Aj(e,"handedness");const t=new hj;Bz(t,iH,this.v);const n=new wj;vj(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),_j(n,"IMAGE:image_in"),_j(n,"NORM_RECT:norm_rect"),xj(n,"HAND_GESTURES:hand_gestures"),xj(n,"LANDMARKS:hand_landmarks"),xj(n,"WORLD_LANDMARKS:world_hand_landmarks"),xj(n,"HANDEDNESS:handedness"),n.o(t),Ej(e,n),this.g.attachProtoVectorListener("hand_landmarks",(e,t)=>{for(const a of e){e=rW(a);const t=[];for(const a of Cz(e,tW,1)){var n,i,r,s;t.push({x:null!==(n=Lz(a,1))&&void 0!==n?n:0,y:null!==(i=Lz(a,2))&&void 0!==i?i:0,z:null!==(r=Lz(a,3))&&void 0!==r?r:0,visibility:null!==(s=Lz(a,4))&&void 0!==s?s:0})}this.landmarks.push(t)}XH(this,t)}),this.g.attachEmptyPacketListener("hand_landmarks",e=>{XH(this,e)}),this.g.attachProtoVectorListener("world_hand_landmarks",(e,t)=>{for(const a of e){e=eW(a);const t=[];for(const a of Cz(e,$j,1)){var n,i,r,s;t.push({x:null!==(n=Lz(a,1))&&void 0!==n?n:0,y:null!==(i=Lz(a,2))&&void 0!==i?i:0,z:null!==(r=Lz(a,3))&&void 0!==r?r:0,visibility:null!==(s=Lz(a,4))&&void 0!==s?s:0})}this.worldLandmarks.push(t)}XH(this,t)}),this.g.attachEmptyPacketListener("world_hand_landmarks",e=>{XH(this,e)}),this.g.attachProtoVectorListener("hand_gestures",(e,t)=>{this.gestures.push(...fq(e,!1)),XH(this,t)}),this.g.attachEmptyPacketListener("hand_gestures",e=>{XH(this,e)}),this.g.attachProtoVectorListener("handedness",(e,t)=>{this.handedness.push(...fq(e)),XH(this,t)}),this.g.attachEmptyPacketListener("handedness",e=>{XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};function mq(e){return{landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handednesses:e.handedness,handedness:e.handedness}}gq.prototype.recognizeForVideo=gq.prototype.La,gq.prototype.recognize=gq.prototype.Ka,gq.prototype.setOptions=gq.prototype.o,gq.createFromModelPath=function(e,t){return GG(gq,e,{baseOptions:{modelAssetPath:t}})},gq.createFromModelBuffer=function(e,t){return GG(gq,e,{baseOptions:{modelAssetBuffer:t}})},gq.createFromOptions=function(e,t){return GG(gq,e,t)},gq.HAND_CONNECTIONS=hq;var yq=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Iz(e=this.j=new JW,0,1,t=new IW),this.u=new QW,Iz(this.j,0,3,this.u),this.h=new KW,Iz(this.j,0,2,this.h),Mz(this.h,3,1),Uz(this.h,2,.5),Uz(this.u,2,.5),Uz(this.j,4,.5)}get baseOptions(){return kz(this.j,IW,1)}set baseOptions(e){Iz(this.j,0,1,e)}o(e){var t,n,i,r;return"numHands"in e&&Mz(this.h,3,null!==(t=e.numHands)&&void 0!==t?t:1),"minHandDetectionConfidence"in e&&Uz(this.h,2,null!==(n=e.minHandDetectionConfidence)&&void 0!==n?n:.5),"minTrackingConfidence"in e&&Uz(this.j,4,null!==(i=e.minTrackingConfidence)&&void 0!==i?i:.5),"minHandPresenceConfidence"in e&&Uz(this.u,2,null!==(r=e.minHandPresenceConfidence)&&void 0!==r?r:.5),this.l(e)}F(e,t){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],XG(this,e,t),mq(this)}G(e,t,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],KG(this,e,n,t),mq(this)}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"norm_rect"),Aj(e,"hand_landmarks"),Aj(e,"world_hand_landmarks"),Aj(e,"handedness");const t=new hj;Bz(t,nH,this.j);const n=new wj;vj(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),_j(n,"IMAGE:image_in"),_j(n,"NORM_RECT:norm_rect"),xj(n,"LANDMARKS:hand_landmarks"),xj(n,"WORLD_LANDMARKS:world_hand_landmarks"),xj(n,"HANDEDNESS:handedness"),n.o(t),Ej(e,n),this.g.attachProtoVectorListener("hand_landmarks",(e,t)=>{for(const n of e)e=rW(n),this.landmarks.push(EH(e));XH(this,t)}),this.g.attachEmptyPacketListener("hand_landmarks",e=>{XH(this,e)}),this.g.attachProtoVectorListener("world_hand_landmarks",(e,t)=>{for(const n of e)e=eW(n),this.worldLandmarks.push(NH(e));XH(this,t)}),this.g.attachEmptyPacketListener("world_hand_landmarks",e=>{XH(this,e)}),this.g.attachProtoVectorListener("handedness",(e,t)=>{var n=this.handedness,i=n.push;const r=[];for(const c of e){e=Bj(c);const t=[];for(const n of e.g()){var s,a,o,l;t.push({score:null!==(s=Lz(n,2))&&void 0!==s?s:0,index:null!==(a=Oz(Dz(n,1),0))&&void 0!==a?a:-1,categoryName:null!==(o=Pz(n,3))&&void 0!==o?o:"",displayName:null!==(l=Pz(n,4))&&void 0!==l?l:""})}r.push(t)}i.call(n,...r),XH(this,t)}),this.g.attachEmptyPacketListener("handedness",e=>{XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};yq.prototype.detectForVideo=yq.prototype.G,yq.prototype.detect=yq.prototype.F,yq.prototype.setOptions=yq.prototype.o,yq.createFromModelPath=function(e,t){return GG(yq,e,{baseOptions:{modelAssetPath:t}})},yq.createFromModelBuffer=function(e,t){return GG(yq,e,{baseOptions:{modelAssetBuffer:t}})},yq.createFromOptions=function(e,t){return GG(yq,e,t)},yq.HAND_CONNECTIONS=hq;var bq=VG([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function vq(e){e.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function _q(e){try{if(!e.I)return e.h;e.I(e.h)}finally{QH(e)}}function xq(e,t){e=rW(e),t.push(EH(e))}var wq=class extends QG{constructor(e,t){super(new HG(e,t),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,Iz(e=this.A=new uH,0,1,t=new IW),this.u=new QW,Iz(this.A,0,2,this.u),this.aa=new rH,Iz(this.A,0,3,this.aa),this.j=new NW,Iz(this.A,0,4,this.j),this.H=new FW,Iz(this.A,0,5,this.H),this.v=new aH,Iz(this.A,0,6,this.v),this.D=new lH,Iz(this.A,0,7,this.D),Uz(this.j,2,.5),Uz(this.j,3,.3),Uz(this.H,2,.5),Uz(this.v,2,.5),Uz(this.v,3,.3),Uz(this.D,2,.5),Uz(this.u,2,.5)}get baseOptions(){return kz(this.A,IW,1)}set baseOptions(e){Iz(this.A,0,1,e)}o(e){var t,n,i,r,s,a,o;return"minFaceDetectionConfidence"in e&&Uz(this.j,2,null!==(t=e.minFaceDetectionConfidence)&&void 0!==t?t:.5),"minFaceSuppressionThreshold"in e&&Uz(this.j,3,null!==(n=e.minFaceSuppressionThreshold)&&void 0!==n?n:.3),"minFacePresenceConfidence"in e&&Uz(this.H,2,null!==(i=e.minFacePresenceConfidence)&&void 0!==i?i:.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"minPoseDetectionConfidence"in e&&Uz(this.v,2,null!==(r=e.minPoseDetectionConfidence)&&void 0!==r?r:.5),"minPoseSuppressionThreshold"in e&&Uz(this.v,3,null!==(s=e.minPoseSuppressionThreshold)&&void 0!==s?s:.3),"minPosePresenceConfidence"in e&&Uz(this.D,2,null!==(a=e.minPosePresenceConfidence)&&void 0!==a?a:.5),"outputPoseSegmentationMasks"in e&&(this.outputPoseSegmentationMasks=!!e.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in e&&Uz(this.u,2,null!==(o=e.minHandLandmarksConfidence)&&void 0!==o?o:.5),this.l(e)}F(e,t,n){const i="function"!=typeof t?t:{};return this.I="function"==typeof t?t:n,vq(this),XG(this,e,i),_q(this)}G(e,t,n,i){const r="function"!=typeof n?n:{};return this.I="function"==typeof n?n:i,vq(this),KG(this,e,r,t),_q(this)}m(){var e=new Rj;Nj(e,"input_frames_image"),Aj(e,"pose_landmarks"),Aj(e,"pose_world_landmarks"),Aj(e,"face_landmarks"),Aj(e,"left_hand_landmarks"),Aj(e,"left_hand_world_landmarks"),Aj(e,"right_hand_landmarks"),Aj(e,"right_hand_world_landmarks");const t=new hj,n=new ej;yz(n,1,CB("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(e,t){if(null!=t)if(Array.isArray(t))az(e,2,YB(t,$B,void 0,void 0,!1));else{if(!("string"==typeof t||t instanceof LM||CM(t)))throw Error("invalid value in Any.value field: "+t+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");yz(e,2,nB(t,!1,!1),DM())}}(n,this.A.g());const i=new wj;vj(i,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),Rz(i,8,ej,n),_j(i,"IMAGE:input_frames_image"),xj(i,"POSE_LANDMARKS:pose_landmarks"),xj(i,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),xj(i,"FACE_LANDMARKS:face_landmarks"),xj(i,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),xj(i,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),xj(i,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),xj(i,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),i.o(t),Ej(e,i),KH(this,e),this.g.attachProtoListener("pose_landmarks",(e,t)=>{xq(e,this.h.poseLandmarks),XH(this,t)}),this.g.attachEmptyPacketListener("pose_landmarks",e=>{XH(this,e)}),this.g.attachProtoListener("pose_world_landmarks",(e,t)=>{var n=this.h.poseWorldLandmarks;e=eW(e),n.push(NH(e)),XH(this,t)}),this.g.attachEmptyPacketListener("pose_world_landmarks",e=>{XH(this,e)}),this.outputPoseSegmentationMasks&&(xj(i,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),YH(this,"pose_segmentation_mask"),this.g.W("pose_segmentation_mask",(e,t)=>{this.h.poseSegmentationMasks=[YG(this,e,!0,!this.I)],XH(this,t)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",e=>{this.h.poseSegmentationMasks=[],XH(this,e)})),this.g.attachProtoListener("face_landmarks",(e,t)=>{xq(e,this.h.faceLandmarks),XH(this,t)}),this.g.attachEmptyPacketListener("face_landmarks",e=>{XH(this,e)}),this.outputFaceBlendshapes&&(Aj(e,"extra_blendshapes"),xj(i,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(e,t)=>{var n,i=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(e=Bj(e),i.push(CH(null!==(n=e.g())&&void 0!==n?n:[]))),XH(this,t)}),this.g.attachEmptyPacketListener("extra_blendshapes",e=>{XH(this,e)})),this.g.attachProtoListener("left_hand_landmarks",(e,t)=>{xq(e,this.h.leftHandLandmarks),XH(this,t)}),this.g.attachEmptyPacketListener("left_hand_landmarks",e=>{XH(this,e)}),this.g.attachProtoListener("left_hand_world_landmarks",(e,t)=>{var n=this.h.leftHandWorldLandmarks;e=eW(e),n.push(NH(e)),XH(this,t)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",e=>{XH(this,e)}),this.g.attachProtoListener("right_hand_landmarks",(e,t)=>{xq(e,this.h.rightHandLandmarks),XH(this,t)}),this.g.attachEmptyPacketListener("right_hand_landmarks",e=>{XH(this,e)}),this.g.attachProtoListener("right_hand_world_landmarks",(e,t)=>{var n=this.h.rightHandWorldLandmarks;e=eW(e),n.push(NH(e)),XH(this,t)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",e=>{XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};wq.prototype.detectForVideo=wq.prototype.G,wq.prototype.detect=wq.prototype.F,wq.prototype.setOptions=wq.prototype.o,wq.createFromModelPath=function(e,t){return GG(wq,e,{baseOptions:{modelAssetPath:t}})},wq.createFromModelBuffer=function(e,t){return GG(wq,e,{baseOptions:{modelAssetBuffer:t}})},wq.createFromOptions=function(e,t){return GG(wq,e,t)},wq.HAND_CONNECTIONS=hq,wq.POSE_CONNECTIONS=bq,wq.FACE_LANDMARKS_LIPS=JG,wq.FACE_LANDMARKS_LEFT_EYE=ZG,wq.FACE_LANDMARKS_LEFT_EYEBROW=eq,wq.FACE_LANDMARKS_LEFT_IRIS=tq,wq.FACE_LANDMARKS_RIGHT_EYE=nq,wq.FACE_LANDMARKS_RIGHT_EYEBROW=iq,wq.FACE_LANDMARKS_RIGHT_IRIS=rq,wq.FACE_LANDMARKS_FACE_OVAL=sq,wq.FACE_LANDMARKS_CONTOURS=aq,wq.FACE_LANDMARKS_TESSELATION=oq;var Tq=class extends QG{constructor(e,t){super(new HG(e,t),"input_image","norm_rect",!0),this.j={classifications:[]},Iz(e=this.h=new hH,0,1,t=new IW)}get baseOptions(){return kz(this.h,IW,1)}set baseOptions(e){Iz(this.h,0,1,e)}o(e){return Iz(this.h,0,2,SH(e,kz(this.h,vW,2))),this.l(e)}ua(e,t){return this.j={classifications:[]},XG(this,e,t),this.j}va(e,t,n){return this.j={classifications:[]},KG(this,e,n,t),this.j}m(){var e=new Rj;Nj(e,"input_image"),Nj(e,"norm_rect"),Aj(e,"classifications");const t=new hj;Bz(t,dH,this.h);const n=new wj;vj(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),_j(n,"IMAGE:input_image"),_j(n,"NORM_RECT:norm_rect"),xj(n,"CLASSIFICATIONS:classifications"),n.o(t),Ej(e,n),this.g.attachProtoListener("classifications",(e,t)=>{this.j=function(e){const t={classifications:Cz(e,lW,1).map(e=>{var t,n;return CH(null!==(t=null===(n=kz(e,Mj,4))||void 0===n?void 0:n.g())&&void 0!==t?t:[],Oz(Dz(e,2),0),Pz(e,3))})};return null!=kB(iz(e,2))&&(t.timestampMs=Oz(kB(iz(e,2)),0)),t}(hW(e)),XH(this,t)}),this.g.attachEmptyPacketListener("classifications",e=>{XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Tq.prototype.classifyForVideo=Tq.prototype.va,Tq.prototype.classify=Tq.prototype.ua,Tq.prototype.setOptions=Tq.prototype.o,Tq.createFromModelPath=function(e,t){return GG(Tq,e,{baseOptions:{modelAssetPath:t}})},Tq.createFromModelBuffer=function(e,t){return GG(Tq,e,{baseOptions:{modelAssetBuffer:t}})},Tq.createFromOptions=function(e,t){return GG(Tq,e,t)};var kq=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect",!0),this.h=new pH,this.embeddings={embeddings:[]},Iz(e=this.h,0,1,t=new IW)}get baseOptions(){return kz(this.h,IW,1)}set baseOptions(e){Iz(this.h,0,1,e)}o(e){var t=this.h,n=kz(this.h,xW,2);return n=n?n.clone():new xW,void 0!==e.l2Normalize?Fz(n,1,e.l2Normalize):"l2Normalize"in e&&az(n,1),void 0!==e.quantize?Fz(n,2,e.quantize):"quantize"in e&&az(n,2),Iz(t,0,2,n),this.l(e)}Ba(e,t){return XG(this,e,t),this.embeddings}Ca(e,t,n){return KG(this,e,n,t),this.embeddings}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"norm_rect"),Aj(e,"embeddings_out");const t=new hj;Bz(t,fH,this.h);const n=new wj;vj(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),_j(n,"IMAGE:image_in"),_j(n,"NORM_RECT:norm_rect"),xj(n,"EMBEDDINGS:embeddings_out"),n.o(t),Ej(e,n),this.g.attachProtoListener("embeddings_out",(e,t)=>{e=bW(e),this.embeddings=function(e){return{embeddings:Cz(e,fW,1).map(e=>{var t,n;const i={headIndex:null!==(t=Oz(Dz(e,3),0))&&void 0!==t?t:-1,headName:null!==(n=Pz(e,4))&&void 0!==n?n:""};if(void 0!==Tz(e,dW,_z(e,1)))e=hz(e=kz(e,dW,_z(e,1)),1,fB),i.floatEmbedding=e.slice();else{var r,s;const t=new Uint8Array(0);i.quantizedEmbedding=null!==(r=null===(s=kz(e,pW,_z(e,2)))||void 0===s||null===(s=s.qa())||void 0===s?void 0:s.h())&&void 0!==r?r:t}return i}),timestampMs:Oz(kB(iz(e,2)),0)}}(e),XH(this,t)}),this.g.attachEmptyPacketListener("embeddings_out",e=>{XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};kq.cosineSimilarity=function(e,t){if(e.floatEmbedding&&t.floatEmbedding)e=RH(e.floatEmbedding,t.floatEmbedding);else{if(!e.quantizedEmbedding||!t.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");e=RH(AH(e.quantizedEmbedding),AH(t.quantizedEmbedding))}return e},kq.prototype.embedForVideo=kq.prototype.Ca,kq.prototype.embed=kq.prototype.Ba,kq.prototype.setOptions=kq.prototype.o,kq.createFromModelPath=function(e,t){return GG(kq,e,{baseOptions:{modelAssetPath:t}})},kq.createFromModelBuffer=function(e,t){return GG(kq,e,{baseOptions:{modelAssetBuffer:t}})},kq.createFromOptions=function(e,t){return GG(kq,e,t)};var Sq=class{constructor(e,t,n){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=n}close(){var e,t;null!==(e=this.confidenceMasks)&&void 0!==e&&e.forEach(e=>{e.close()}),null===(t=this.categoryMask)||void 0===t||t.close()}};function Cq(e){e.categoryMask=void 0,e.confidenceMasks=void 0,e.qualityScores=void 0}function Iq(e){try{const t=new Sq(e.confidenceMasks,e.categoryMask,e.qualityScores);if(!e.j)return t;e.j(t)}finally{QH(e)}}Sq.prototype.close=Sq.prototype.close;var Eq=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect",!1),this.u=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new vH,this.v=new gH,Iz(this.h,0,3,this.v),Iz(e=this.h,0,1,t=new IW)}get baseOptions(){return kz(this.h,IW,1)}set baseOptions(e){Iz(this.h,0,1,e)}o(e){var t,n;return void 0!==e.displayNamesLocale?az(this.h,2,CB(e.displayNamesLocale)):"displayNamesLocale"in e&&az(this.h,2),"outputCategoryMask"in e&&(this.outputCategoryMask=null!==(t=e.outputCategoryMask)&&void 0!==t&&t),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=null===(n=e.outputConfidenceMasks)||void 0===n||n),super.l(e)}L(){!function(e,t,n){const i=Cz(e.fa(),wj,1).filter(e=>Pz(e,1).includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(e.u=[],1<i.length)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");1===i.length&&(null!==(t=null===(n=kz(i[0],hj,7))||void 0===n||null===(n=n.l())||void 0===n?void 0:n.g())&&void 0!==t?t:new Map).forEach((t,n)=>{e.u[Number(n)]=Pz(t,1)})}(this)}ga(e,t,n){const i="function"!=typeof t?t:{};return this.j="function"==typeof t?t:n,Cq(this),XG(this,e,i),Iq(this)}Na(e,t,n,i){const r="function"!=typeof n?n:{};return this.j="function"==typeof n?n:i,Cq(this),KG(this,e,r,t),Iq(this)}Fa(){return this.u}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"norm_rect");const t=new hj;Bz(t,_H,this.h);const n=new wj;vj(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),_j(n,"IMAGE:image_in"),_j(n,"NORM_RECT:norm_rect"),n.o(t),Ej(e,n),KH(this,e),this.outputConfidenceMasks&&(Aj(e,"confidence_masks"),xj(n,"CONFIDENCE_MASKS:confidence_masks"),YH(this,"confidence_masks"),this.g.da("confidence_masks",(e,t)=>{this.confidenceMasks=e.map(e=>YG(this,e,!0,!this.j)),XH(this,t)}),this.g.attachEmptyPacketListener("confidence_masks",e=>{this.confidenceMasks=[],XH(this,e)})),this.outputCategoryMask&&(Aj(e,"category_mask"),xj(n,"CATEGORY_MASK:category_mask"),YH(this,"category_mask"),this.g.W("category_mask",(e,t)=>{this.categoryMask=YG(this,e,!1,!this.j),XH(this,t)}),this.g.attachEmptyPacketListener("category_mask",e=>{this.categoryMask=void 0,XH(this,e)})),Aj(e,"quality_scores"),xj(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(e,t)=>{this.qualityScores=e,XH(this,t)}),this.g.attachEmptyPacketListener("quality_scores",e=>{this.categoryMask=void 0,XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Eq.prototype.getLabels=Eq.prototype.Fa,Eq.prototype.segmentForVideo=Eq.prototype.Na,Eq.prototype.segment=Eq.prototype.ga,Eq.prototype.setOptions=Eq.prototype.o,Eq.createFromModelPath=function(e,t){return GG(Eq,e,{baseOptions:{modelAssetPath:t}})},Eq.createFromModelBuffer=function(e,t){return GG(Eq,e,{baseOptions:{modelAssetBuffer:t}})},Eq.createFromOptions=function(e,t){return GG(Eq,e,t)};var Nq=class{constructor(e,t,n){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=n}close(){var e,t;null!==(e=this.confidenceMasks)&&void 0!==e&&e.forEach(e=>{e.close()}),null===(t=this.categoryMask)||void 0===t||t.close()}};Nq.prototype.close=Nq.prototype.close;var Aq=class extends zz{constructor(e){super(e)}},Rq=[0,PV,-2],Dq=[0,EV,-3,UV],Oq=[0,EV,-3,UV,EV,-1],Lq=[0,Oq],Pq=[0,Lq,Rq],Fq=[0,Oq,Rq],Mq=[0,Oq,PV,-1],Uq=[0,Mq,Rq],Bq=[0,EV,-3,UV,Rq,-1],zq=[0,EV,-3,UV,KV],Vq=class extends zz{constructor(e){super(e)}},jq=[0,EV,-1,UV],Wq=class extends zz{constructor(){super()}};Wq.B=[1];var Hq=class extends zz{constructor(e){super(e)}},Gq=[1,2,3,4,5,6,7,8,9,10,14,15],qq=[0,Gq,GV,Oq,GV,Fq,GV,Lq,GV,Pq,GV,jq,GV,zq,GV,Dq,GV,[0,jV,EV,-2,UV,PV,UV,-1,2,EV,Rq],GV,Mq,GV,Uq,EV,Rq,jV,GV,Bq,GV,[0,IV,jq]],Xq=[0,jV,PV,-1,UV],Kq=class extends zz{constructor(){super()}};Kq.B=[1],Kq.prototype.g=ZV([0,IV,qq,jV,Xq]);var Yq=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new vH,this.v=new gH,Iz(this.h,0,3,this.v),Iz(e=this.h,0,1,t=new IW)}get baseOptions(){return kz(this.h,IW,1)}set baseOptions(e){Iz(this.h,0,1,e)}o(e){var t,n;return"outputCategoryMask"in e&&(this.outputCategoryMask=null!==(t=e.outputCategoryMask)&&void 0!==t&&t),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=null===(n=e.outputConfidenceMasks)||void 0===n||n),super.l(e)}ga(e,t,n,i){const r="function"!=typeof n?n:{};this.j="function"==typeof n?n:i,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.J+1,i=new Kq;const s=new Hq;var a=new Aq;if(Mz(a,1,255),Iz(s,0,12,a),t.keypoint&&t.scribble)throw Error("Cannot provide both keypoint and scribble.");if(t.keypoint){var o=new Vq;Fz(o,3,!0),Uz(o,1,t.keypoint.x),Uz(o,2,t.keypoint.y),Ez(s,5,Gq,o)}else{if(!t.scribble)throw Error("Must provide either a keypoint or a scribble.");for(o of(a=new Wq,t.scribble))Fz(t=new Vq,3,!0),Uz(t,1,o.x),Uz(t,2,o.y),Rz(a,1,Vq,t);Ez(s,15,Gq,a)}Rz(i,1,Hq,s),this.g.addProtoToStream(i.g(),"drishti.RenderData","roi_in",n),XG(this,e,r);e:{try{const e=new Nq(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=e;break e}this.j(e)}finally{QH(this)}l=void 0}return l}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"roi_in"),Nj(e,"norm_rect_in");const t=new hj;Bz(t,_H,this.h);const n=new wj;vj(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),_j(n,"IMAGE:image_in"),_j(n,"ROI:roi_in"),_j(n,"NORM_RECT:norm_rect_in"),n.o(t),Ej(e,n),KH(this,e),this.outputConfidenceMasks&&(Aj(e,"confidence_masks"),xj(n,"CONFIDENCE_MASKS:confidence_masks"),YH(this,"confidence_masks"),this.g.da("confidence_masks",(e,t)=>{this.confidenceMasks=e.map(e=>YG(this,e,!0,!this.j)),XH(this,t)}),this.g.attachEmptyPacketListener("confidence_masks",e=>{this.confidenceMasks=[],XH(this,e)})),this.outputCategoryMask&&(Aj(e,"category_mask"),xj(n,"CATEGORY_MASK:category_mask"),YH(this,"category_mask"),this.g.W("category_mask",(e,t)=>{this.categoryMask=YG(this,e,!1,!this.j),XH(this,t)}),this.g.attachEmptyPacketListener("category_mask",e=>{this.categoryMask=void 0,XH(this,e)})),Aj(e,"quality_scores"),xj(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(e,t)=>{this.qualityScores=e,XH(this,t)}),this.g.attachEmptyPacketListener("quality_scores",e=>{this.categoryMask=void 0,XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Yq.prototype.segment=Yq.prototype.ga,Yq.prototype.setOptions=Yq.prototype.o,Yq.createFromModelPath=function(e,t){return GG(Yq,e,{baseOptions:{modelAssetPath:t}})},Yq.createFromModelBuffer=function(e,t){return GG(Yq,e,{baseOptions:{modelAssetBuffer:t}})},Yq.createFromOptions=function(e,t){return GG(Yq,e,t)};var Qq=class extends QG{constructor(e,t){super(new HG(e,t),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},Iz(e=this.h=new xH,0,1,t=new IW)}get baseOptions(){return kz(this.h,IW,1)}set baseOptions(e){Iz(this.h,0,1,e)}o(e){return void 0!==e.displayNamesLocale?az(this.h,2,CB(e.displayNamesLocale)):"displayNamesLocale"in e&&az(this.h,2),void 0!==e.maxResults?Mz(this.h,3,e.maxResults):"maxResults"in e&&az(this.h,3),void 0!==e.scoreThreshold?Uz(this.h,4,e.scoreThreshold):"scoreThreshold"in e&&az(this.h,4),void 0!==e.categoryAllowlist?mz(this.h,5,e.categoryAllowlist):"categoryAllowlist"in e&&az(this.h,5),void 0!==e.categoryDenylist?mz(this.h,6,e.categoryDenylist):"categoryDenylist"in e&&az(this.h,6),this.l(e)}F(e,t){return this.j={detections:[]},XG(this,e,t),this.j}G(e,t,n){return this.j={detections:[]},KG(this,e,n,t),this.j}m(){var e=new Rj;Nj(e,"input_frame_gpu"),Nj(e,"norm_rect"),Aj(e,"detections");const t=new hj;Bz(t,wH,this.h);const n=new wj;vj(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),_j(n,"IMAGE:input_frame_gpu"),_j(n,"NORM_RECT:norm_rect"),xj(n,"DETECTIONS:detections"),n.o(t),Ej(e,n),this.g.attachProtoVectorListener("detections",(e,t)=>{for(const n of e)e=Qj(n),this.j.detections.push(IH(e));XH(this,t)}),this.g.attachEmptyPacketListener("detections",e=>{XH(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Qq.prototype.detectForVideo=Qq.prototype.G,Qq.prototype.detect=Qq.prototype.F,Qq.prototype.setOptions=Qq.prototype.o,Qq.createFromModelPath=async function(e,t){return GG(Qq,e,{baseOptions:{modelAssetPath:t}})},Qq.createFromModelBuffer=function(e,t){return GG(Qq,e,{baseOptions:{modelAssetBuffer:t}})},Qq.createFromOptions=function(e,t){return GG(Qq,e,t)};var $q=class{constructor(e,t,n){this.landmarks=e,this.worldLandmarks=t,this.segmentationMasks=n}close(){var e;null===(e=this.segmentationMasks)||void 0===e||e.forEach(e=>{e.close()})}};function Jq(e){e.landmarks=[],e.worldLandmarks=[],e.segmentationMasks=void 0}function Zq(e){try{const t=new $q(e.landmarks,e.worldLandmarks,e.segmentationMasks);if(!e.j)return t;e.j(t)}finally{QH(e)}}$q.prototype.close=$q.prototype.close;var eX=class extends QG{constructor(e,t){super(new HG(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,Iz(e=this.h=new TH,0,1,t=new IW),this.D=new lH,Iz(this.h,0,3,this.D),this.v=new aH,Iz(this.h,0,2,this.v),Mz(this.v,4,1),Uz(this.v,2,.5),Uz(this.D,2,.5),Uz(this.h,4,.5)}get baseOptions(){return kz(this.h,IW,1)}set baseOptions(e){Iz(this.h,0,1,e)}o(e){var t,n,i,r,s;return"numPoses"in e&&Mz(this.v,4,null!==(t=e.numPoses)&&void 0!==t?t:1),"minPoseDetectionConfidence"in e&&Uz(this.v,2,null!==(n=e.minPoseDetectionConfidence)&&void 0!==n?n:.5),"minTrackingConfidence"in e&&Uz(this.h,4,null!==(i=e.minTrackingConfidence)&&void 0!==i?i:.5),"minPosePresenceConfidence"in e&&Uz(this.D,2,null!==(r=e.minPosePresenceConfidence)&&void 0!==r?r:.5),"outputSegmentationMasks"in e&&(this.outputSegmentationMasks=null!==(s=e.outputSegmentationMasks)&&void 0!==s&&s),this.l(e)}F(e,t,n){const i="function"!=typeof t?t:{};return this.j="function"==typeof t?t:n,Jq(this),XG(this,e,i),Zq(this)}G(e,t,n,i){const r="function"!=typeof n?n:{};return this.j="function"==typeof n?n:i,Jq(this),KG(this,e,r,t),Zq(this)}m(){var e=new Rj;Nj(e,"image_in"),Nj(e,"norm_rect"),Aj(e,"normalized_landmarks"),Aj(e,"world_landmarks"),Aj(e,"segmentation_masks");const t=new hj;Bz(t,kH,this.h);const n=new wj;vj(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),_j(n,"IMAGE:image_in"),_j(n,"NORM_RECT:norm_rect"),xj(n,"NORM_LANDMARKS:normalized_landmarks"),xj(n,"WORLD_LANDMARKS:world_landmarks"),n.o(t),Ej(e,n),KH(this,e),this.g.attachProtoVectorListener("normalized_landmarks",(e,t)=>{this.landmarks=[];for(const n of e)e=rW(n),this.landmarks.push(EH(e));XH(this,t)}),this.g.attachEmptyPacketListener("normalized_landmarks",e=>{this.landmarks=[],XH(this,e)}),this.g.attachProtoVectorListener("world_landmarks",(e,t)=>{this.worldLandmarks=[];for(const n of e)e=eW(n),this.worldLandmarks.push(NH(e));XH(this,t)}),this.g.attachEmptyPacketListener("world_landmarks",e=>{this.worldLandmarks=[],XH(this,e)}),this.outputSegmentationMasks&&(xj(n,"SEGMENTATION_MASK:segmentation_masks"),YH(this,"segmentation_masks"),this.g.da("segmentation_masks",(e,t)=>{this.segmentationMasks=e.map(e=>YG(this,e,!0,!this.j)),XH(this,t)}),this.g.attachEmptyPacketListener("segmentation_masks",e=>{this.segmentationMasks=[],XH(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};function tX(e){let{src:t,onTimeUpdate:n,onSchemaLoaded:i,onAnalysisComplete:r,modelPath:a="/models/model.tflite",schemaLoaded:l=!1}=e;const u=(0,s.useRef)(null),h=(0,s.useRef)(null),[d,p]=(0,s.useState)(!1),[f,g]=(0,s.useState)(0),[m,y]=(0,s.useState)(0),[b,v]=(0,s.useState)(33.33),[_,C]=(0,s.useState)(null),[I,N]=(0,s.useState)(null),[A,R]=(0,s.useState)(null),D=(0,s.useRef)(null),[O,L]=(0,s.useState)(!1),[P,F]=(0,s.useState)(""),[M,U]=(0,s.useState)(""),[B,z]=(0,s.useState)(""),[V,j]=(0,s.useState)(!1),[W,H]=(0,s.useState)(!1),[G,q]=(0,s.useState)(!1),[X,K]=(0,s.useState)(!1),Y=(0,s.useRef)(null),Q=(0,s.useRef)(null),$=(0,s.useRef)(null),[J,Z]=(0,s.useState)([]),[ee,te]=(0,s.useState)("00:00.00"),ne=(0,s.useRef)(null),[ie,re]=(0,s.useState)(!1),[se,ae]=(0,s.useState)(""),oe=!!t;(0,s.useEffect)(()=>{const e=e=>{var t;return Z(Array.isArray(null===(t=e.detail)||void 0===t?void 0:t.annotations)?e.detail.annotations:[])};return window.addEventListener("at:state",e),()=>window.removeEventListener("at:state",e)},[]);const le=e=>{if(!e)return!1;try{const t=new URL(e);return["www.youtube.com","youtube.com","youtu.be"].includes(t.hostname)}catch(t){return!1}},ce=le(t),ue=e=>String(e).padStart(2,"0"),he=e=>{if(!isFinite(e))return"00:00.00";const t=Math.round(100*e),n=Math.floor(t/6e3),i=Math.floor(t%6e3/100),r=t%100;return"".concat(ue(n),":").concat(ue(i),".").concat(ue(r))};(0,s.useEffect)(()=>{te(he(m))},[m]),(0,s.useEffect)(()=>{var e;if(!u.current||!oe)return;const i=null!==(e=h.current)&&void 0!==e?e:h.current=(0,c.default)(u.current,{controls:!1,preload:"auto",fluid:!0,techOrder:["html5","youtube"],sources:[],youtube:{rel:0,iv_load_policy:3}});i.off(),i.on("loadedmetadata",()=>g(i.duration()||0)),i.on("timeupdate",()=>{const e=i.currentTime()||0;y(e),null===n||void 0===n||n(e)}),i.on("play",()=>p(!0)),i.on("pause",()=>p(!1)),i.src(le(t)?{src:t,type:"video/youtube"}:{src:t,type:"video/mp4"})},[t,oe,n]),(0,s.useEffect)(()=>()=>{if(h.current){try{h.current.dispose()}catch(e){}h.current=null}},[]);const de=()=>d?(()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.pause()})():(async()=>{try{var e;await(null===(e=h.current)||void 0===e?void 0:e.play())}catch(t){}})(),pe=e=>{const t=h.current;if(!t)return;const i=(Number(b)||0)/1e3,r=Math.max(0,Math.min(f,t.currentTime()+e*i));t.currentTime(r),y(r),null===n||void 0===n||n(r)};(0,s.useEffect)(()=>{const e=e=>{if(!(e=>{var t;if(!e)return!1;const n=null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase();return"input"===n||"textarea"===n||"select"===n||e.isContentEditable})(document.activeElement)&&("Space"===e.code&&(e.preventDefault(),de()),","===e.key&&(e.preventDefault(),pe(-1)),"."===e.key&&(e.preventDefault(),pe(1)),"["===e.key&&(e.preventDefault(),oe&&C(fe(m,0,f))),"]"===e.key&&(e.preventDefault(),oe))){var t;const e=fe(m,0,f);N(e),null===(t=h.current)||void 0===t||t.pause(),p(!1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[d,b,f,m,oe]);const fe=(e,t,n)=>Math.max(t,Math.min(n,e)),ge=e=>{const t=D.current;if(!t||f<=0)return 0;const n=t.getBoundingClientRect(),i=fe(e-n.left,0,n.width),r=0===n.width?0:i/n.width;return fe(r*f,0,f)},me=()=>{C(null),N(null),R(null)};(0,s.useEffect)(()=>{const e=e=>{if(!A)return;const t=ge(e.clientX);"start"===A?C(()=>{const e=null!==I&&void 0!==I?I:t;return t>e?(N(t),e):t}):"end"===A&&N(()=>{const e=null!==_&&void 0!==_?_:t;return t<e?(C(t),e):t})},t=()=>R(null);return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[A,_,I,f]),(0,s.useEffect)(()=>{const e=e=>{O&&(Y.current&&!Y.current.contains(e.target)&&H(!1),Q.current&&!Q.current.contains(e.target)&&q(!1),$.current&&!$.current.contains(e.target)&&K(!1))},t=e=>{"Escape"===e.key&&(H(!1),q(!1),K(!1))};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[O]);const ye=e=>f>0?e/f*100:0,be=null!=_&&null!=I&&f>0,ve=null!=_&&f>0,_e=null!=I&&f>0,xe=ve?_e?Math.min(_,I):_:0,we=be?Math.max(_,I):0,Te=e=>{if(null==e)return null;const t=String(e).trim();if(""===t)return null;if(t.includes(".")){const[e,n]=t.split("."),i=Number(e),r=Number(n);return Number.isFinite(i)&&Number.isFinite(r)?r<0||r>59?null:60*i+r:null}if(/^\d{2,3}$/.test(t)){const e=Number(t);if(2===t.length){return e%100}const n=Math.floor(e/100),i=e%100;return i>59?null:60*n+i}if(/^\d+$/.test(t)){return 60*Number(t)}return null},ke=30,Se=1/ke/2,Ce=(e=>Math.round(e*ke)/ke)(xe),Ie=J.some(e=>{var t;const n=e.startKey,i=null!==(t=e.endKey)&&void 0!==t?t:e.startKey,r=Math.min(n,i),s=Math.max(n,i);if(Ce>r&&Ce<s)return!0;const a=Math.abs(Ce-r)<=Se,o=Math.abs(Ce-s)<=Se;return a||o}),Ee=()=>{const e=h.current;if(!e)return;const t=(e=>{if(null==e)return null;const t=String(e).trim();if(""===t)return null;if(/^\d+(\.\d+)?$/.test(t))return Number(t);const n=t.match(/^(\d+):(\d{1,2})(?:\.(\d{1,3}))?$/);if(n){const e=Number(n[1]),t=Number(n[2]);let i=n[3]?Number("0.".concat(n[3])):0;return i=Math.round(100*i)/100,60*e+t+i}return null})(ee);if(null==t||!isFinite(t))return void te(he(m));const i=Math.max(0,Math.min(f||0,t)),r=Math.round(100*i)/100;e.currentTime(r),y(r),null===n||void 0===n||n(r),te(he(r))},Ne=(0,s.useRef)(null),Ae=e=>new Promise((t,n)=>{const i=h.current,r=u.current;if(!i||!r)return n(new Error("Player/video not ready"));const s=()=>{try{const e=r.videoWidth,n=r.videoHeight;if(!e||!n)throw new Error("No video dimension");const i=document.createElement("canvas");i.width=e,i.height=n;i.getContext("2d").drawImage(r,0,0,e,n),t(i)}catch(sX){n(sX)}finally{r.removeEventListener("seeked",s)}};r.addEventListener("seeked",s,{once:!0}),i.currentTime(e)}),Re={0:"BALL_CARRIER",1:"DEFENDER",2:"ATTACKER"},De=new Set(["BALL_CARRIER","ball_carrier","carrier"]),Oe=new Set(["DEFENDER","defender"]),Le=(new Set(["ATTACKER","attacker"]),e=>{const t=e.map(e=>{var t,n,i;const r=(e=>{var t;const n=null===(t=e.categories)||void 0===t?void 0:t[0],i=null===n||void 0===n?void 0:n.categoryName;if(i&&i.trim())return i.trim();const r=Number.isFinite(null===n||void 0===n?void 0:n.index)?n.index:void 0;return null!=r&&Re[r]?Re[r]:""})(e);return{label:r,score:null!==(t=null===(n=e.categories)||void 0===n||null===(i=n[0])||void 0===i?void 0:i.score)&&void 0!==t?t:0,bb:e.boundingBox}}),n=t.filter(e=>De.has(e.label)),i=t.filter(e=>Oe.has(e.label));if(0===n.length)return 0;let r=n[0];for(const o of n)o.score>r.score&&(r=o);const s=r.bb.originY+r.bb.height/2;let a=0;for(const o of i){o.bb.originY+o.bb.height/2<s&&a++}return a});return oe?(0,o.jsxs)("section",{className:"vp",children:[(0,o.jsx)("div",{className:"vp__videowrap",children:(0,o.jsx)("video",{ref:u,className:"video-js vjs-default-skin vp__videojs",playsInline:!0})}),(0,o.jsxs)("div",{className:"vp__controls",children:[(0,o.jsxs)("div",{className:"vp__toolbar",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center",gap:"12px"},children:[(0,o.jsxs)("div",{className:"vp__time",style:{justifySelf:"start",display:"flex",alignItems:"center",gap:6},children:[(0,o.jsx)("input",{className:"mono",value:ee,onChange:e=>te(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),Ee()),"Escape"===e.key&&te(he(m))},onBlur:()=>te(he(m)),"aria-label":"Current time (editable)",style:{width:84,padding:"2px 6px",borderRadius:6,border:"1px solid var(--line)",background:"#0f1420",color:"var(--text)"},inputMode:"numeric",placeholder:"mm:ss.hh"}),(0,o.jsx)("span",{className:"vp__timeSep",children:"/"}),(0,o.jsx)("span",{className:"vp__timeTotal mono",children:he(f)})]}),(0,o.jsxs)("div",{className:"vp__btnGroup",role:"group","aria-label":"Playback",style:{justifySelf:"center"},children:[(0,o.jsx)("button",{title:"Frame Back (,)",onClick:()=>pe(-1),"aria-label":"Frame Back",children:(0,o.jsx)(k,{size:22})}),(0,o.jsx)("button",{title:d?"Pause (Space)":"Play (Space)",onClick:de,"aria-label":d?"Pause":"Play",children:d?(0,o.jsx)(x,{size:22}):(0,o.jsx)(w,{size:22})}),(0,o.jsx)("button",{title:"Frame Forward (.)",onClick:()=>pe(1),"aria-label":"Frame Forward",children:(0,o.jsx)(T,{size:22})})]}),(0,o.jsxs)("div",{style:{justifySelf:"end",display:"flex",gap:8,alignItems:"center"},children:[se&&(0,o.jsx)("span",{className:"mono",style:{color:"var(--muted)",fontSize:12},children:se}),(0,o.jsx)("input",{ref:ne,type:"file",accept:".csv,text/csv",hidden:!0,onChange:e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&(async e=>{if(!e)return;const t=await e.text();window.dispatchEvent(new CustomEvent("vp:clear-annotations"));const n=t.replace(/\r\n?/g,"\n").split("\n").filter(Boolean),r=e=>{const t=[];let n="",i=!1;for(let r=0;r<e.length;r++){const s=e[r];'"'===s?i&&'"'===e[r+1]?(n+='"',r++):i=!i:","!==s||i?n+=s:(t.push(n),n="")}return t.push(n),t.map(e=>e.trim())},s=r(n[0]).map(e=>e.toLowerCase()),a=s.indexOf("tagname"),o=s.indexOf("starttime"),l=s.indexOf("endtime"),c=s.indexOf("modifiers");if(-1!==a&&-1!==o&&-1!==l&&-1!==c){for(let e=1;e<n.length;e++){var u,h;const t=r(n[e]);if(!t.length)continue;const i=(null!==(u=t[a])&&void 0!==u?u:"").trim(),s=t[o],d=t[l],p=(null!==(h=t[c])&&void 0!==h?h:"").trim(),f=Te(s),g=Te(d);if(!i||null==f||!isFinite(f))continue;const m={start:f,end:null!=g&&isFinite(g)?g:f,tag:i,modifier:p};window.dispatchEvent(new CustomEvent("vp:add-annotation",{detail:m}))}null===i||void 0===i||i(e.name)}else console.warn("CSV missing required headers: TagName, StartTime, EndTime, Modifiers")})(n),e.target.value=""}}),(0,o.jsx)("button",{className:"src__btn",type:"button",onClick:()=>{var e;return null===(e=ne.current)||void 0===e?void 0:e.click()},title:"Load annotation schema CSV",children:"Load Schema"}),(0,o.jsx)("button",{className:"src__btn",type:"button",onClick:async()=>{if(!ce&&l&&!ie)try{re(!0),ae("Preparing\u2026"),await Hr.ready();const e=await(async()=>{if(Ne.current)return Ne.current;ae("Loading detector\u2026");const e=await FH.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm"),t=await Qq.createFromOptions(e,{baseOptions:{modelAssetPath:a,delegate:"CPU"},scoreThreshold:.5,maxResults:25,runningMode:"IMAGE"});return Ne.current=t,t})(),t=J.filter(e=>Number.isFinite(e.startKey));if(0===t.length)return ae("No annotated windows found."),void re(!1);const n={};for(let i=0;i<t.length;i++){const r=t[i];ae("Analyzing ".concat(i+1,"/").concat(t.length,"\u2026"));const s=await Ae(r.startKey),a=await e.detect(s),o=Le(a.detections||[]);n[r.tagName]||(n[r.tagName]=[]),n[r.tagName].push(o)}ae("Done."),null===r||void 0===r||r(n)}catch(sX){console.error(sX),ae("Analysis failed (see console).")}finally{re(!1),setTimeout(()=>ae(""),1500)}},disabled:ce||!l||ie,title:ce?"YouTube sources are preview-only; analysis disabled":l?ie?"Analyzing\u2026":"Analyze":"Load a schema to enable Analyze",children:ie?"Analyzing\u2026":"Analyze"})]})]}),(0,o.jsx)("div",{className:"vp__slider",children:(0,o.jsxs)("div",{className:"vp__scrubwrap",ref:D,children:[(0,o.jsx)("input",{type:"range",min:0,max:f||0,step:.001,value:m,onChange:e=>{const t=Number(e.target.value),i=h.current;i&&!Number.isNaN(t)&&(i.currentTime(t),y(t),null===n||void 0===n||n(t))},className:"vp__scrub"}),(0,o.jsxs)("div",{className:"vp__rangeOverlay",onMouseDown:e=>{if(!oe)return;if(e.shiftKey){const t=ge(e.clientX);return C(t),N(t),R("end"),void e.preventDefault()}const t=ge(e.clientX),i=h.current;i&&(i.currentTime(t),y(t),null===n||void 0===n||n(t))},title:"Shift+Drag to select a time range. Click to move playhead.",children:[be&&(0,o.jsx)("div",{className:"vp__rangeBar",style:{left:"".concat(ye(Math.min(_,I)),"%"),width:"".concat(Math.max(0,ye(Math.max(_,I))-ye(Math.min(_,I))),"%")}}),null!=_&&(0,o.jsx)("div",{className:"vp__handle vp__handle--start ".concat("start"===A?"is-dragging":""),style:{left:"".concat(ye(_),"%")},onMouseDown:e=>{oe&&(R("start"),e.preventDefault(),e.stopPropagation())}}),null!=I&&(0,o.jsx)("div",{className:"vp__handle vp__handle--end ".concat("end"===A?"is-dragging":""),style:{left:"".concat(ye(I),"%")},onMouseDown:e=>{oe&&(R("end"),e.preventDefault(),e.stopPropagation())}})]})]})}),(0,o.jsxs)("div",{className:"vp__rangeRow",children:[ve?(0,o.jsxs)("div",{className:"vp__chips",children:[(0,o.jsxs)("button",{type:"button",className:"chip chip--clickable",onClick:()=>{var e;null===(e=h.current)||void 0===e||e.currentTime(xe),y(xe)},title:"Jump to Start",children:["Start ",he(xe)]}),(0,o.jsx)("button",{type:"button",className:"chip ".concat(_e?"chip--clickable":"chip--disabled"),onClick:()=>{var e;_e&&(null===(e=h.current)||void 0===e||e.currentTime(we),y(we))},title:_e?"Jump to End":"Set End (])",disabled:!_e,children:_e?"End ".concat(he(we)):"End --:--.--"}),(0,o.jsx)("button",{className:"chip ".concat(_e?"chip--clickable":"chip--disabled"),type:"button",disabled:!_e,onClick:()=>{F(""),U(""),z(""),j(!1),H(!1),q(!1),K(!1),L(!0)},title:_e?"Annotate range":"Set End (])",children:"Annotate"}),(0,o.jsx)("button",{className:"chipBtn chipBtn--danger",title:"Clear range",onClick:me,children:(0,o.jsx)(E,{size:18})})]}):(0,o.jsxs)("div",{className:"vp__hint mono",children:["Tip: ",(0,o.jsx)("kbd",{children:"Shift"})," + drag to select a range. Use ",(0,o.jsx)("kbd",{children:"["})," and ",(0,o.jsx)("kbd",{children:"]"})," to set Start/End."]}),(0,o.jsxs)("details",{className:"vp__adv",children:[(0,o.jsx)("summary",{children:"Advanced"}),(0,o.jsxs)("label",{className:"vp__stepLabel",children:["Step (ms): ",(0,o.jsx)("input",{type:"number",min:"1",step:"1",value:b,onChange:e=>v(e.target.value),className:"step-input"})]}),(0,o.jsx)("span",{className:"hint",children:"33.33 \u2248 30fps \xb7 16.67 \u2248 60fps"})]})]})]}),O&&(0,o.jsx)("div",{className:"modalOverlay",onMouseDown:e=>{e.target.classList.contains("modalOverlay")&&L(!1)},style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"grid",placeItems:"center",zIndex:1e3},children:(0,o.jsxs)("div",{className:"modalCard modalCard--fit",role:"dialog","aria-modal":"true","aria-labelledby":"annTitle",style:{background:"var(--panel)",border:"1px solid var(--line)",borderRadius:12,padding:16,position:"relative"},children:[(0,o.jsx)("button",{onClick:()=>L(!1),title:"Close","aria-label":"Close",style:{position:"absolute",top:8,right:8,background:"#4a2b2b",color:"#ffb3b3",border:"1px solid #5a3434",borderRadius:8,width:32,height:32,display:"grid",placeItems:"center",cursor:"pointer"},children:(0,o.jsx)(E,{size:18})}),(0,o.jsx)("h3",{id:"annTitle",style:{margin:"0 0 12px 0",fontSize:16},children:"Create Annotation"}),(0,o.jsxs)("div",{className:"annQuick",children:[(0,o.jsx)("button",{className:"src__btn",onClick:()=>{F("SPIN"),j(!0)},disabled:V||Ie,children:"+ Spin (S)"}),(0,o.jsx)("button",{className:"src__btn",onClick:()=>{F("JUKE"),j(!0)},disabled:V||Ie,children:"+ Juke (J)"}),(0,o.jsx)("button",{className:"src__btn",onClick:()=>{F("TACKLE"),j(!0)},disabled:V||Ie,children:"+ Tackle (T)"}),(0,o.jsx)("button",{className:"src__btn",onClick:()=>{F(""),j(!0)},disabled:V||Ie,children:"+ Custom Action"})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"center",marginBottom:12,color:"var(--muted)",fontSize:13},children:[(0,o.jsxs)("div",{children:["Start: ",(0,o.jsx)("span",{className:"mono",style:{color:"var(--text)"},children:he(xe)})]}),(0,o.jsxs)("div",{children:["End: ",(0,o.jsx)("span",{className:"mono",style:{color:"var(--text)"},children:he(we)})]})]}),(0,o.jsxs)("div",{className:"annFieldsStack",children:[(0,o.jsxs)("label",{className:"annField",children:[(0,o.jsx)("span",{className:"annField__label",children:"Tag name"}),(0,o.jsxs)("div",{className:"combo",ref:Y,children:[(0,o.jsx)("input",{type:"text",className:"src__input combo__input",value:P,onChange:e=>F(e.target.value),placeholder:"SPIN / JUKE / TACKLE / custom\u2026",disabled:Ie,"aria-label":"Tag name"}),(0,o.jsx)("button",{type:"button",className:"combo__btn",onClick:()=>H(e=>!e),"aria-haspopup":"listbox","aria-expanded":W,disabled:Ie,children:(0,o.jsx)(S,{size:18})}),W&&(0,o.jsx)("div",{className:"combo__menu",role:"listbox",children:["SPIN","JUKE","WALL_MOVE","HURDLE","TACKLE_BIG_HIT","STIFF_ARM","TACKLE_DIVE","PASS_THROW","PASS_CATCH","TACKLE_WRAP"].map(e=>(0,o.jsx)("button",{type:"button",className:"combo__option",onClick:()=>{F(e),H(!1)},children:e},e))})]})]}),(0,o.jsxs)("label",{className:"annField",children:[(0,o.jsx)("span",{className:"annField__label",children:"Modifier"}),(0,o.jsxs)("div",{className:"combo",ref:Q,children:[(0,o.jsx)("input",{type:"text",className:"src__input combo__input",value:M,onChange:e=>U(e.target.value),placeholder:"Optional details",disabled:Ie,"aria-label":"Modifier"}),(0,o.jsx)("button",{type:"button",className:"combo__btn",onClick:()=>q(e=>!e),"aria-haspopup":"listbox","aria-expanded":G,disabled:Ie,children:(0,o.jsx)(S,{size:18})}),G&&(0,o.jsx)("div",{className:"combo__menu",role:"listbox",children:["LEFT","RIGHT","IN_AIR","FORWARD","ON_GROUND","ON_SIDELINE","ON_WALL"].map(e=>(0,o.jsx)("button",{type:"button",className:"combo__option",onClick:()=>{U(e),q(!1)},children:e},e))})]})]}),(0,o.jsxs)("label",{className:"annField",children:[(0,o.jsx)("span",{className:"annField__label",children:"Down"}),(0,o.jsxs)("div",{className:"combo",ref:$,children:[(0,o.jsx)("input",{type:"text",className:"src__input combo__input",value:B,onChange:e=>z(e.target.value),placeholder:"1 / 2 / 3 / 4",disabled:Ie,"aria-label":"Down",inputMode:"numeric"}),(0,o.jsx)("button",{type:"button",className:"combo__btn",onClick:()=>K(e=>!e),"aria-haspopup":"listbox","aria-expanded":X,disabled:Ie,children:(0,o.jsx)(S,{size:18})}),X&&(0,o.jsx)("div",{className:"combo__menu",role:"listbox",children:[1,2,3,4].map(e=>(0,o.jsx)("button",{type:"button",className:"combo__option",onClick:()=>{z(String(e)),K(!1)},children:e},e))})]})]})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,justifyContent:"space-between"},children:[Ie&&(0,o.jsx)("div",{style:{color:"#ffb3b3"},children:"Annotation already exists for given start time."}),(0,o.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[(0,o.jsx)("button",{className:"src__btn",onClick:()=>L(!1),children:"Cancel"}),(0,o.jsx)("button",{className:"src__btn",onClick:()=>{if(!ve||!_e||!P.trim()||Ie)return;const e={start:xe,end:we,tag:P.trim(),modifier:(M||"").trim(),down:(B||"").trim()};window.dispatchEvent(new CustomEvent("vp:add-annotation",{detail:e}));const t=h.current,i=Math.max((Number(b)||0)/1e3,1/ke),r=fe(we+i+1e-4,0,f);t&&t.currentTime(r),y(r),null===n||void 0===n||n(r),me(),L(!1)},disabled:!_e||!ve||!P.trim()||Ie,title:P.trim()?"Add annotation":"Enter a tag name",children:"+ Add"})]})]})]})})]}):null}function nX(e){let{currentTime:t=0,hasSource:n}=e;const[i,r]=(0,s.useState)([]);if((0,s.useEffect)(()=>{n||r([])},[n]),(0,s.useEffect)(()=>{const e=()=>r([]);return window.addEventListener("vp:clear-annotations",e),()=>window.removeEventListener("vp:clear-annotations",e)},[]),!n)return null;const a=e=>Number.isFinite(e)?Math.round(30*e)/30:0,l=(0,s.useMemo)(()=>a(t),[t]),c=e=>(null!==e&&void 0!==e?e:"").trim().toLowerCase(),u=e=>{if(!isFinite(e))return"00:00.00";const t=Math.floor(e%1*100),n=Math.floor(e)%60,i=Math.floor(e/60);return"".concat(String(i).padStart(2,"0"),":").concat(String(n).padStart(2,"0"),".").concat(String(t).padStart(2,"0"))},h=e=>{if(!isFinite(e))return"0.00";const t=Math.floor(e),n=Math.floor(t/60),i=t%60;return"".concat(n,".").concat(String(i).padStart(2,"0"))},d=(e,t)=>i.some(n=>n.startKey===t&&c(n.tagName)===c(e));(0,s.useEffect)(()=>{window.dispatchEvent(new CustomEvent("at:state",{detail:{annotations:i}}))},[i]),(0,s.useEffect)(()=>{const e=e=>{var t,n,i;const{start:s,end:o,tag:l,modifier:c,down:h}=e.detail||{};if(null==s||!isFinite(s))return;const p=a(s),f=isFinite(o)?a(o):null,g=(null!==l&&void 0!==l?l:"").trim(),m=(null!==c&&void 0!==c?c:"").trim(),y=(null!==h&&void 0!==h?h:"").trim();if(g&&d(g,p))return;const b={id:null!==(t=null===(n=crypto)||void 0===n||null===(i=n.randomUUID)||void 0===i?void 0:i.call(n))&&void 0!==t?t:Date.now(),startKey:p,endKey:f,startTime:u(p),endTime:null!=f?u(f):"",tagName:g,modifier:m,down:y};r(e=>{const t=[...e,b];return t.sort((e,t)=>e.startKey-t.startKey),t})};return window.addEventListener("vp:add-annotation",e),()=>window.removeEventListener("vp:add-annotation",e)},[i]);const p={s:"SPIN",j:"JUKE",t:"TACKLE"};(0,s.useEffect)(()=>{const e=e=>{var t,n,i;if((e=>{var t;if(!e)return!1;const n=null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase();return"input"===n||"textarea"===n||"select"===n||e.isContentEditable})(document.activeElement))return;const s=e.key.toLowerCase(),a=p[s];if(!a)return;const o=l;if(d(a,o))return;e.preventDefault();const c={id:null!==(t=null===(n=crypto)||void 0===n||null===(i=n.randomUUID)||void 0===i?void 0:i.call(n))&&void 0!==t?t:Date.now(),startKey:o,endKey:null,startTime:u(o),endTime:"",tagName:a,modifier:"",down:""};r(e=>{const t=[...e,c];return t.sort((e,t)=>e.startKey-t.startKey),t})};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,i]);const f=function(e,t){const n=new Blob([t],{type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=e,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(i)},g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return f("annotations_".concat(Date.now(),".csv"),(e=>{const t=e=>{const t=null==e?"":String(e);return/[",\n]/.test(t)?'"'.concat(t.replace(/"/g,'""'),'"'):t},n=[["TagName","StartTime","EndTime","Modifiers","Down"].join(",")];for(const a of e){var i,r,s;const e=[t(null!==(i=a.tagName)&&void 0!==i?i:""),t(h(a.startKey)),t(null!=a.endKey?h(a.endKey):""),t(null!==(r=a.modifier)&&void 0!==r?r:""),t(null!==(s=a.down)&&void 0!==s?s:"")];n.push(e.join(","))}return n.join("\n")})(e),"text/csv")},[m,y]=(0,s.useState)(""),[b,v]=(0,s.useState)("All"),_=(0,s.useMemo)(()=>{const e=new Set(i.map(e=>e.tagName).filter(e=>""!==(null!==e&&void 0!==e?e:"").trim()).map(e=>e.trim()));return["All",...Array.from(e).sort((e,t)=>e.localeCompare(t))]},[i]),x=(0,s.useMemo)(()=>[...i].sort((e,t)=>e.startKey-t.startKey),[i]),w=(0,s.useMemo)(()=>{const e=(null!==m&&void 0!==m?m:"").trim().toLowerCase();return x.filter(t=>{if("All"!==b&&(t.tagName||"").trim()!==b)return!1;if(e){var n,i,r;if(!"".concat(t.startTime," ").concat(t.endTime," ").concat(null!==(n=t.tagName)&&void 0!==n?n:""," ").concat(null!==(i=t.modifier)&&void 0!==i?i:""," ").concat(null!==(r=t.down)&&void 0!==r?r:"").toLowerCase().includes(e))return!1}return!0})},[x,b,m]),[T,k]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{n||k(new Set)},[n]);const S=()=>{k(e=>{const t=w.map(e=>e.id),n=t.every(t=>e.has(t)),i=new Set(e);for(const r of t)n?i.delete(r):i.add(r);return i})},[E,N]=(0,s.useState)(1);(0,s.useEffect)(()=>{N(1)},[m,b,i]);const A=Math.max(1,Math.ceil(w.length/10)),R=10*(E-1),D=w.slice(R,R+10),O=E>1,L=E<A;return(0,o.jsxs)("section",{className:"timeline",children:[(0,o.jsx)("h2",{children:"Timeline: Action Annotations"}),(0,o.jsxs)("div",{className:"timeline__filters",style:{display:"grid",gap:8,gridTemplateColumns:"1fr 220px auto",marginBottom:12},children:[(0,o.jsx)("input",{type:"text",placeholder:"Search (start/end, tag, modifier, down)\u2026",value:m,onChange:e=>y(e.target.value)}),(0,o.jsx)("select",{value:b,onChange:e=>v(e.target.value),children:_.map(e=>(0,o.jsx)("option",{value:e,children:e},e))}),(0,o.jsx)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:(0,o.jsx)("button",{onClick:()=>{y(""),v("All")},title:"Clear search and filters",children:"Clear"})})]}),(0,o.jsxs)("div",{className:"timeline__buttons",style:{gap:8,marginTop:8},children:[(0,o.jsx)("button",{onClick:S,children:w.length>0&&w.every(e=>T.has(e.id))?"Unselect All (Filtered)":"Select All (Filtered)"}),(0,o.jsx)("button",{className:"btn--danger",onClick:()=>{0!==T.size&&(r(e=>e.filter(e=>!T.has(e.id))),k(new Set))},disabled:0===T.size,children:"Delete Selected"}),(0,o.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[(0,o.jsx)("button",{className:"btn--export",onClick:()=>function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:i).map(e=>{let{startKey:t,endKey:n,tagName:i,modifier:r,down:s}=e;return{TagName:null!==i&&void 0!==i?i:"",StartTime:h(t),EndTime:null!=n?h(n):"",Modifiers:null!==r&&void 0!==r?r:"",Down:null!==s&&void 0!==s?s:""}});f("annotations_".concat(Date.now(),".json"),JSON.stringify(e,null,2),"application/json")}(),title:"Export all as JSON",disabled:0===w.length,children:"Export JSON"}),(0,o.jsx)("button",{className:"btn--export",onClick:()=>g(),title:"Export all as CSV",disabled:0===w.length,children:"Export CSV"})]})]}),0===w.length?(0,o.jsx)("p",{className:"timeline__empty",children:"No annotations match your filters."}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("table",{className:"timeline__table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{width:28},children:(0,o.jsx)("input",{type:"checkbox",onChange:S,checked:w.length>0&&w.every(e=>T.has(e.id)),"aria-label":"Select all filtered"})}),(0,o.jsx)("th",{style:{width:110},children:"Start"}),(0,o.jsx)("th",{style:{width:110},children:"End"}),(0,o.jsx)("th",{style:{width:220},children:"Tag Name"}),(0,o.jsx)("th",{children:"Modifier"}),(0,o.jsx)("th",{style:{width:90},children:"Down"}),(0,o.jsx)("th",{style:{width:70}})]})}),(0,o.jsx)("tbody",{children:D.map(e=>{var t,n;return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"checkbox",checked:(n=e.id,T.has(n)),onChange:()=>(e=>k(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}))(e.id),"aria-label":"Select ".concat(e.tagName||"Custom Tag"," at ").concat(e.startTime)})}),(0,o.jsx)("td",{children:e.startTime}),(0,o.jsx)("td",{children:e.endTime}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"text",value:e.tagName,placeholder:"Tag name\u2026",onChange:t=>((e,t)=>{r(n=>{const i=n.find(t=>t.id===e);if(!i)return n;const r=n.some(n=>n.id!==e&&n.startKey===i.startKey&&c(n.tagName)===c(t));return r?n:n.map(n=>n.id===e?YF(YF({},n),{},{tagName:t}):n)})})(e.id,t.target.value)})}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"text",value:e.modifier,placeholder:"Modifier\u2026",onChange:t=>((e,t)=>r(n=>n.map(n=>n.id===e?YF(YF({},n),{},{modifier:t}):n)))(e.id,t.target.value)})}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"text",value:null!==(t=e.down)&&void 0!==t?t:"",placeholder:"1-4",onChange:t=>((e,t)=>r(n=>n.map(n=>n.id===e?YF(YF({},n),{},{down:t}):n)))(e.id,t.target.value),inputMode:"numeric"})}),(0,o.jsx)("td",{children:(0,o.jsx)("button",{className:"btn--danger",onClick:()=>(e=>r(t=>t.filter(t=>t.id!==e)))(e.id),onKeyDown:e=>{"Space"===e.code&&e.preventDefault()},title:"Delete annotation","aria-label":"Delete ".concat(e.tagName||"Custom Tag"," at ").concat(e.startTime),children:"Delete"})})]},e.id)})})]}),A>1&&(0,o.jsxs)("div",{className:"pager",children:[(0,o.jsx)("button",{onClick:()=>O&&N(E-1),disabled:!O,title:"Previous page","aria-label":"Previous page",className:"pagerBtn",children:(0,o.jsx)(C,{size:20})}),(0,o.jsxs)("span",{className:"pagerLabel",children:[E," of ",A]}),(0,o.jsx)("button",{onClick:()=>L&&N(E+1),disabled:!L,title:"Next page","aria-label":"Next page",className:"pagerBtn",children:(0,o.jsx)(I,{size:20})})]})]})]})}function iX(e){let{results:t,onClear:n}=e;const i=t&&"object"===typeof t&&Object.keys(t).length>0;return(0,o.jsxs)("section",{className:"timeline",style:{marginTop:20},children:[(0,o.jsx)("h2",{children:"Graphs"}),i?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"timeline__buttons",style:{gap:8,marginBottom:12},children:[(0,o.jsx)("button",{className:"btn--export",onClick:()=>{const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download="analysis_".concat(Date.now(),".json"),document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(n)},children:"Export JSON"}),(0,o.jsx)("button",{className:"btn--danger",onClick:n,children:"Clear Results"})]}),(0,o.jsx)("div",{className:"vp",style:{padding:16},children:Object.entries(t).map(e=>{let[t,n]=e;return(0,o.jsxs)("div",{style:{marginBottom:10},children:[(0,o.jsx)("div",{style:{fontWeight:600},children:t}),(0,o.jsxs)("div",{className:"mono",style:{color:"var(--muted)"},children:["Counts: [",Array.isArray(n)?n.join(", "):"","]"]})]},t)})}),(0,o.jsx)("div",{className:"timeline__empty",style:{marginTop:8}})]}):(0,o.jsxs)("p",{className:"timeline__empty",children:["Run ",(0,o.jsx)("strong",{children:"Analyze"})," to see results here."]})]})}function rX(){const[e,t]=(0,s.useState)(null),[n,i]=(0,s.useState)(null),[r,a]=(0,s.useState)(null);return(0,o.jsxs)("div",{className:"app",children:[(0,o.jsxs)("header",{className:"app__header",children:[(0,o.jsx)("h1",{children:"Gameplay Video Analyzer"}),n&&(0,o.jsxs)("div",{className:"src__status",style:{marginLeft:"auto"},children:[(0,o.jsx)("span",{className:"src__pill is-file",children:"Schema"}),(0,o.jsx)("span",{className:"src__name",title:n.name,children:n.name}),(0,o.jsx)("button",{className:"src__clear",onClick:()=>{i(null),window.dispatchEvent(new CustomEvent("vp:clear-annotations")),a(null)},children:"Clear"})]}),e&&(0,o.jsxs)("div",{className:"src__status",style:{marginLeft:n?8:"auto"},children:[(0,o.jsx)("span",{className:"src__pill ".concat(e.isURL?"is-url":"is-file"),children:e.isURL?"URL":"File"}),(0,o.jsx)("span",{className:"src__name",title:e.name,children:e.name}),(0,o.jsx)("button",{className:"src__clear",onClick:()=>{t(null),a(null)},children:"Clear"})]})]}),(0,o.jsxs)("main",{className:"app__content",children:[!e&&(0,o.jsx)(l,{onLoad:e=>{let{src:n,name:i,isURL:r}=e;t({src:n,name:i,isURL:r}),a(null)}}),e&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(tX,{src:e.src,onTimeUpdate:()=>{},onSchemaLoaded:e=>{i({name:e}),a(null)},onAnalysisComplete:e=>a(e),modelPath:"/models/model.tflite",schemaLoaded:!!n}),(0,o.jsx)(nX,{hasSource:!0}),r&&(0,o.jsx)(iX,{results:r,onClear:()=>a(null)})]})]}),(0,o.jsx)("footer",{className:"app__footer",children:(0,o.jsx)("small",{children:"Prototype \xb7 Upload \u2192 Playback \u2192 Scrub \u2192 Annotate \u2192 Analyze \u2192 Graph"})})]})}eX.prototype.detectForVideo=eX.prototype.G,eX.prototype.detect=eX.prototype.F,eX.prototype.setOptions=eX.prototype.o,eX.createFromModelPath=function(e,t){return GG(eX,e,{baseOptions:{modelAssetPath:t}})},eX.createFromModelBuffer=function(e,t){return GG(eX,e,{baseOptions:{modelAssetBuffer:t}})},eX.createFromOptions=function(e,t){return GG(eX,e,t)},eX.POSE_CONNECTIONS=bq;(0,a.H)(document.getElementById("root")).render((0,o.jsx)(rX,{}))})()})();